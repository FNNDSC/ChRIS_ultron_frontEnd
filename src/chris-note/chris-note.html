<!--
@license
Copyright (c) 2016 FNNDSC. All rights reserved.
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/iron-autogrow-textarea/iron-autogrow-textarea.html">
<link rel="import" href="../../bower_components/marked-element/marked-element.html">

<!-- STYLE -->
<link rel="import" href="../chris-feed/chris-feed-styles.html">

<dom-module id="chris-note">
  <template>
    <style include="chris-feed-styles"></style>
    <style>

      app-toolbar {
        flex:1;
        background-color: var(--paper-grey-100);
      }

      .content {
        padding: 20px;
      }

      #editor{
        display: none;
        width: inherit;
      }

      .markdown-html code {
        display: flex;
        padding: 10px;
        background-color: var(--paper-grey-200);
      }

    </style>

      <!-- Toolbar -->
      <div class="section toolbar">
        <div class="title">Note</div>
          <paper-icon-button icon="create" on-click="edit"></paper-icon-button>
          <paper-icon-button icon="delete" on-click="delete"></paper-icon-button>
          <paper-icon-button icon="save" on-click="save"></paper-icon-button>
      </div>

      <div class="content">
        <iron-autogrow-textarea id="editor" on-keydown="checkForEnter" value="{{note}}"></iron-autogrow-textarea>
        
        <marked-element markdown="{{note}}" on-marked-render-complete="renderComplete">
          <div class="markdown-html"></div>
        </marked-element>
      </div>

  </template>

  <script>
    Polymer({
        is: 'chris-note',

        properties: {

          note: {
            type: String
          }

        },

        donothing: function( evt ){

          evt.preventDefault( );
          evt.stopPropagation( );

        },

        edit: function( evt ){

          this.donothing( evt);
          this.$.editor.style.display = 'flex';
          this.fire('resized-content');

        },

        delete: function( evt ){

          this.donothing( evt);
          this.note = '';

        },

        save: function( evt ){

          this.donothing( evt);
          this.$.editor.style.display = 'none';
          this.fire('resized-content');

        },

        checkForEnter: function( evt ){

          evt.stopPropagation();

        },

        renderComplete: function( evt ){

          this.fire('resized-content');

        }
    });
  </script>
</dom-module>
