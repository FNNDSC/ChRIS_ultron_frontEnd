<script>
    /** @polymerBehavior Feed */
    Feed = {

      prepareFeed: function( what ){

        this.handleAs = 'json';

        switch( what ){

          case 'url':

            // http://httpbin.org/
            var url = 'https://httpbin.org/get';

            if( this.method === 'PUT' ){

              url = 'https://httpbin.org/put'

            }

            return url;

          case 'params':

            return this.params;

          case 'body':

            // format body for proper CJ POST
            var bodyCJ = this.body;

            if( this.body.template && this.body.data ){

              bodyCJ = this.formatQueryCJ( this.body.template, this.body.data );

            }
            
            return bodyCJ;

          default:

            break;

          }
        return false;
      },

      handleFeed: function(){

        if( this.method === 'PUT' ){

          // generate error 50% of the time
          var feedCJ = this.generateFeedCJ( this.body.data, Math.random() > 0.5 );
          var feed = this.formatFeedCJ( feedCJ );

          console.log( feed );

          return feed;

        }
        else{
          
          //

        }

        return this.response.json;

      },

      formatFeedCJ: function( feedCJ ){
      
        var feedObj = JSON.parse( feedCJ );
        var feed = {

          template: feedObj.collection.template

        }

        if( feedObj.collection.error ){

          feed.error = feedObj.collection.error;

        }
        else{

          feed.data = {};
          for( var j=0; j < feedObj.collection.items[0].data.length; j++ ){

            feed.data[ feedObj.collection.items[0].data[j].name ] = feedObj.collection.items[0].data[j].value;

          }

          feed.links = {};
          for( var j=0; j < feedObj.collection.items[0].links.length; j++ ){

            feed.links[ feedObj.collection.items[0].links[j].rel ] = feedObj.collection.items[0].links[j].href;

          }

          feed.href = feedObj.collection.items[0].href;

        }

        return feed;

      },

      handleErrorFeed: function(){

        return this.error;

      },

      _feedTemplate: function(){

      }

    };
</script>