<script>
    /** @polymerBehavior Feeds */
    Feeds = {

      prepareFeeds: function( what ){

        this.handleAs = 'json';

        switch( what ){

          case 'url':

            var url = "../../data/feeds.json";

            if( this.chrisAPI ){

              // generate REAL URL
              url = this.apiRoot + 'Feeds/NAME';

            }

            return url;

          case 'params':

            if( this.chrisAPI ){

              this.params.DBpath = this.dbPath;

            }

            return this.params;

          case 'body':
            return this.body;

          default:
            break;

          }

        return false;
      },

      handleFeeds: function( ){

        var feeds = [];

        if( this.chrisAPI ){
          feeds = this.handleFeedsFromChrisAPI();
        }
        else{
          feeds = this.handleFeedsFromMars();
        }

        return feeds;

      },

      handleFeedsFromChrisAPI: function( ){

        var feeds = [];
        var payload = this.response.return.payload;

        var colors = ['red', 'pink', 'purple', 'deep-purple', 'indigo', 'blue',
        'light-blue', 'cyan', 'teal', 'green', 'light-green', 'lime', 'yellow',
        'amber', 'orange', 'deep-orange'];

        for( var i=0; i<payload.length; i++ ){

          var feed = {
            id: 'id: ' + payload[i],
            name: 'name: ' + payload[i],
            image: '',
            opened: false,//this.response[i].expanded,
            favorite: i%3 ? true : false,
            selected: false,
            details: null,
            color: colors[Math.floor(Math.random() * colors.length)],
            letter: 'N',
            // status: ((this.response[i].zip < 20000) ? 'success' : (this.response[i].zip < 30000 ? 'running' : 'error')),
            description: 'description for ' + payload[i],
            fulldescription: 'full description for ' + payload[i],
            date: Date() //this.response[i].date
          };

          feeds.push(feed);

        }

        return feeds;

      },

      handleFeedsFromMars: function(){

        var feeds = [];

        var colors = [
          {
            name: 'red',
            value: '#F44336'
          },
          {
            name: 'pink',
            value: '#E91E63'
          },
          {
            name: 'purple',
            value: '#9C27B0'
          },
          {
            name: 'deep-purple',
            value: '#673AB7'
          },
          {
            name: 'indigo',
            value: '#3F51B5'
          },
          {
            name: 'blue',
            value: '#2196F3'
          },
          {
            name: 'light-blue',
            value: '#03A9F4'
          },
          {
            name: 'cyan',
            value: '#00BCD4'
          },
          {
            name: 'teal',
            value: '#009688'
          },
          {
            name: 'green',
            value: '#4CAF50'
          },
          {
            name: 'light-green',
            value: '#8BC34A'
          },
          {
            name: 'lime',
            value: '#CDDC39'
          },
          {
            name: 'yellow',
            value: '#FFEB3B'
          },
          {
            name: 'amber',
            value: '#FFC107'
          },
          {
            name: 'orange',
            value: '#FF9800'
          },
          {
            name: 'deep-orange',
            value: '#FF5722'
          },
          {
            name: 'brown',
            value: '#795548'
          },
          {
            name: 'grey',
            value: '#9E9E9E'
          },
          {
            name: 'blue-grey',
            value: '#607D8B'
          },
          {
            name: 'black',
            value: '#000000'
          }
          ];

        for( var i=0; i<this.response.length; i++ ){

          var feed = {
            id: 'id: ' + this.response[i].index,
            name: this.response[i].name,
            image: this.response[i].image,
            opened: false,//this.response[i].expanded,
            color: this.response[i].color,
            favorite: this.response[i].integer > 50 ? true : false,
            status: this._generateStatus(this.response[i].integer),
            tags: this._generateTags(colors),
            selected: false,
            details: null,
            color: colors[Math.floor(Math.random() * colors.length)].value,
            letter: 'N',
            // status: ((this.response[i].zip < 20000) ? 'success' : (this.response[i].zip < 30000 ? 'running' : 'error')),
            description: this.response[i].shortText,
            fulldescription: this.response[i].longText,
            date: this.response[i].date
          };

          feeds.push(feed);

        }

        // make first feed invalid
        feeds[0].id = true;

        return feeds;

      },

      handleErrorFeeds: function( ){

        return this.error;

      },

      _generateStatus: function( value ){

        if( value < 30 ){

          return 'done';

        }
        else if( value < 60 ){

          return 'running';

        }
        else{

          return 'error';

        }

      },

      _generateTags: function( available ){

        var tags = [];
        var countTags = {};
        var nbTags = Math.floor(Math.random() * available.length);

        for( var i=0; i<nbTags; i++ ){

          var tag = available[Math.floor(Math.random() * available.length)];

          if( !countTags[tag.name] ){

            tags.push({
              name: tag.name,
              color: tag.value
            });

            countTags[tag.name] = true;

          }

        }

        return tags;

      }

    };
</script>