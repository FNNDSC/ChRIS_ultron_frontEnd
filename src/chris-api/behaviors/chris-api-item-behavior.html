<script>
    /** @polymerBehavior Item */
    Item = {

      handleItem: function( request ){

        console.log(request.response);

        // should rework the login handle
        if( request.target === 'login'){
          return {
            status: true,
            message: 'Successful login.',
            token: 'ABCDEF123456789'
          };
        }

        var itemCJ = this[ 'prepare' + this.api + 'APIResponse' ](request.response);
        var cache = request.cache;

        // format the response
        var item = this.formatItemCJ( itemCJ );
        response = item;

        if( cache ){

          response.cache = cache;

        }

        return response;

      },


      formatItemCJ: function( itemObj ){

        var item = {

          href: itemObj.collection.href

        }

        if( itemObj.collection.template && itemObj.collection.template.data && itemObj.collection.template.data.length >0 ){

          // attach template if any
          item.template = itemObj.collection.template;

        }

        if( itemObj.collection.error ){

          // attach only error if any
          item.error = itemObj.collection.error;

        }
        else if( itemObj.collection.items ){

          // attach items if any
          item.data = [];

          for( var i = 0; i < itemObj.collection.items.length; i++ ){

            var data = {};
            data.data = {};
            for( var j=0; j < itemObj.collection.items[i].data.length; j++ ){

              data.data[ itemObj.collection.items[i].data[j].name ] = itemObj.collection.items[i].data[j].value;

            }

            if( itemObj.collection.items[i].links && itemObj.collection.items[i].links.length > 0){

              data.links = {};
              for( var j=0; j < itemObj.collection.items[i].links.length; j++ ){

                data.links[ itemObj.collection.items[i].links[j].rel ] = itemObj.collection.items[i].links[j].href;

              }

            }

            data.href = itemObj.collection.items[i].href;

            item.data.push( data);

          }

        }

        return item;

      },

      handleErrorItem: function( request ){

        return request;

      }
    };
</script>
