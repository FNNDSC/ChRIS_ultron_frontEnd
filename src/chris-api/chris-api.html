<html><head><link rel="import" href="../../bower_components/polymer/polymer.html">


<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">


<link rel="import" href="behaviors/chris-api-login-behavior.html">
<link rel="import" href="behaviors/chris-api-helper-behavior.html">
<link rel="import" href="behaviors/chris-api-plugin-pacspull-behavior.html">
<link rel="import" href="behaviors/chris-api-plugin-create-behavior.html">
<link rel="import" href="behaviors/chris-api-item-behavior.html">

<link rel="import" href="cj/helper-behavior.html">
<link rel="import" href="cj/comment-collection-behavior.html">
<link rel="import" href="cj/comment-behavior.html">
<link rel="import" href="cj/feed-collection-behavior.html">
<link rel="import" href="cj/feed-behavior.html">
<link rel="import" href="cj/label-collection-behavior.html">
<link rel="import" href="cj/label-behavior.html">
<link rel="import" href="cj/note-behavior.html">
<link rel="import" href="cj/pacsquery-behavior.html">
<link rel="import" href="cj/plugin-collection-behavior.html">
<link rel="import" href="cj/plugin-behavior.html">
<link rel="import" href="cj/pluginfs-collection-behavior.html">
<link rel="import" href="cj/pluginfs-behavior.html">

</head><body><dom-module id="chris-api">

  <template>

    <iron-ajax id="ironAjax" url="[[getUrl(url, api)]]" body="[[body]]" params="[[params]]" method="[[method]]" content-type="[[contentType]]" last-response="{{response}}" last-error="{{error}}" handle-as="[[handleAs]]" auto="[[auto]]"></iron-ajax>

  </template>

  <script>Polymer({is:"chris-api",properties:{url:{type:String},auto:{type:Boolean,value:!1},response:{type:Object},error:{type:Object},body:{type:Object},method:{type:String,value:"GET"},contentType:{type:String},params:{type:Object},api:{type:String,value:"",observer:"_validAPI"},handleAs:{type:String,value:"json"},apiRoot:{type:String,value:""}},observers:["getBody(body, body.*)","getParams(params, params.*)"],behaviors:[Helper,HelperCJ,CommentCollectionCJ,CommentCJ,FeedCollectionCJ,FeedCJ,LabelCollectionCJ,LabelCJ,NoteCJ,PacsqueryCJ,PluginCollectionCJ,PluginCJ,PluginFSCollectionCJ,PluginFSCJ,Item,Login,PluginCreate,PluginPacspull],ready:function(){},generateRequest:function(){return this.url=this.getUrl(),this.$.ironAjax.generateRequest()},handleResponse:function(e){var t=this["handle"+this.api](e);return this._setResponse(t),t},handleError:function(e){var t=this["handleError"+this.api](e);return this._setError(t),t},getUrl:function(){return this._validAPI()?this["prepare"+this.api]("url"):void 0},getBody:function(){return this._validAPI()?this["prepare"+this.api]("body"):void 0},getParams:function(){return this._validAPI()?this["prepare"+this.api]("params"):void 0},request:function(e,t,r){var i={auth:"user="+sessionStorage.getItem("username")+",hash="+sessionStorage.getItem("token")};this.params=i,this.method=e,this.url=t,"GET"!==e&&(this.body=r);var s=this.generateRequest();return"GET"!==e&&(s.cache=r.cache),s.completes.then(this.handleResponse.bind(this))["catch"](this.handleError.bind(this))},_setResponse:function(e){this.response=e,this.fire("response-changed"),this.fire("response",e)},_setError:function(e){this.error=e,this.fire("error-changed"),this.fire("error",e)},_validAPI:function(){var e="";if(this["prepare"+this.api]||(e+=" prepare"+this.api),this["handle"+this.api]||(e+=" handle"+this.api),this["handleError"+this.api]||(e+=" handleError"+this.api),""!==e){var t=this.api+" is not valid. ( Missing "+e+" )";return this._setError(t),this.api="",!1}return!0}});</script>
</dom-module>
</body></html>