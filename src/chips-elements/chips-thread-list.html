<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/polymer/lib/elements/dom-if.html">
<link rel="import" href="../../bower_components/polymer/lib/elements/dom-repeat.html">

<link rel="import" href="./chips-thread-item.html">
<link rel="import" href="./chips-thread-list.html">

<dom-module id="chips-thread-list">
  <template>
    <style>
      :host {
        display: flex;
        width:100%;
        box-sizing: border-box;
        flex-direction: column;
        padding-left: 12px;
        padding-top: 6px;
      }
    </style>

    <div on-tap="_handleExpanded">
      <chips-thread-item thread-item="[[thread]]"></chips-thread-item>
    </div>
    <template is="dom-if" if="[[expanded]]">
      <template is="dom-repeat" items="[[thread.children]]">
        <chips-thread-list thread="[[item]]" expanded="[[item.expanded]]"></chips-thread-list>
      </template>
    </template>

  </template>

  <script>
    class ChipsThreadList extends Polymer.Element {
      static get is() {
        return 'chips-thread-list';
      }

      static get properties() {
        return {
          thread: {
            type: Object,
            value: {},
          },
          expanded: {
            type: Boolean,
          }
        };
      }

      _handleExpanded() {
        this.expanded = !this.expanded;
        if (!this.expanded) {
          for(let i = 0; i < this.thread.children.length; i++){
            this.set(`thread.children.${i}.expanded`, false);
          }
        }
      }
    }

    window.customElements.define(ChipsThreadList.is, ChipsThreadList);
  </script>
</dom-module>
