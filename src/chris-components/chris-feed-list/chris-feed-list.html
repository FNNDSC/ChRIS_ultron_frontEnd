<!--
@license
Copyright (c) 2016 FNNDSC. All rights reserved.
-->

<link rel="import" href="../../../bower_components/polymer/polymer.html">

<!-- IRON ELEMENTS -->
<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../../bower_components/iron-list/iron-list.html">

<link rel="import" href="../chris-feed-preview/chris-feed-preview.html">

<dom-module id="chris-feed-list">

  <template>

    <style>

      :host {

        display: block;

      }

      iron-list {

        padding-top: 16px;
        padding-bottom: 64px;
        --iron-list-items-container: {
          max-width: 1200px;
          margin: auto;
          margin-top: 30px;
          margin-bottom: 60px;
          border-bottom: 1px solid var(--accent-color);
        };

      }

        chris-feed-preview {
          @apply(--layout);
          background-color: #fff;
          position: relative;
          /*width: 256px;
          height: 96px;*/
          margin: 4px;
        }

        @media (max-width: 896px) {
          .feedContainer {
            width: 100%;
          }

          chris-feed-preview {
            width: auto;
          }

          chris-feed-preview > .detail {
            opacity: 1;
          }
        }      

    </style>

    <iron-list id="feeds" items="[[feeds.data]]" as="feed" selection-enabled on-resize-feed="resizeFeed" scroll-target="[[scrollTarget]]">

      <template>

        <div class="feedContainer" style$="z-index: [[getIndex(index)]]">
            <chris-feed-preview tabindex$="[[tabIndex]]" index="[[index]]" feed="[[feed]]" on-tap="_openFeed"></chris-feed-preview>
        </div>

      </template>

    </iron-list>


  </template>

  <script>
    Polymer({
        is: 'chris-feed-list',
        properties: {

          feeds: {
            type: Array
          },

          scrollTarget: HTMLElement

        },

        resizeFeed: function( event ){

          this.$.feeds.updateSizeForItem( event.detail.index );

        },

        _openFeed: function( event ){

          this.fire( 'open-feed', event.model.__data__.feed );

        },

        // calculate z-index
        getIndex: function(itemIndex) {
          return this._jsonReceived()-itemIndex;
        },

        // Count json items
        _jsonReceived: function() {
          return this.feeds.data.length;
        }

    });
  </script>
</dom-module>
