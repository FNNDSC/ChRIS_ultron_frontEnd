<link rel="import" href="../../../bower_components/polymer/polymer.html">

<link rel="import" href="../../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">

<link rel="import" href="../../../bower_components/paper-button/paper-button.html">

<dom-module id="chris-plugin-tree-recursive">

  <template>

    <style>

      :host {

        display: flex;
        flex: 1;
        width: 100%;

        }

      .plugin, .label, .children {

        display: flex;
        width: 100%;

      }

      .plugin {

        flex-direction: column;
        flex: 1;
        width: 100%;
        display: flex;
        min-width: 0;
      }

      .children {

        flex-direction: row;
        width: 100%;

      }

      .label {

        /*height: 50px;
        color: red;*/
        justify-content: center;

      }

      paper-button.primary {

        /*background-color: var(--primary-color);*/
        /*color: white;*/
        width:100%;
        margin:0;
        border-radius: 0;
        border: 1px solid #dddddd;

      }

      paper-button.primary[selected] {
        border-color: var(--accent-color);
      }

      paper-button {
        display: flex;
        min-width: 0;
      }

      #okbutton {
            display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    -webkit-box-align: center;
    -ms-flex-align: center;
    align-items: center;
      }

      #okgo {
            -webkit-box-flex: 1;
    -ms-flex: 1;
    flex: 1;
    min-width: 0;
      }

      .labelyo {
        white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    text-align: center;
      }

      iron-icon {
        /*opacity: 0.5;*/
      }

      .iconWrap {
        box-sizing: border-box;
        border: 2px solid #212121;
        border-radius: 50%;
        padding: 4px;
      }

    </style>

    <template is="dom-repeat" items="{{tree}}">
      <div class="plugin">
        <div class="label" on-tap="_selectNode">
          <paper-button id="okbutton" class="primary" selected$="{{item.data.selected}}">
            <div id="okgo">
              <div class="labelyo">{{item.data.label}}</div>
            </div>
            <!--<div class="iconWrap" style$="{{_setStyle(item.data)}}">-->
              <iron-icon icon$="{{item.data.icon}}" style$="{{_setStyle(item.data.status)}}" item-icon></iron-icon>
              <div></div>
            <!--</div>-->
          </paper-button>     
        </div>
        <div class="children">
          <chris-plugin-tree-recursive id="testC" tree="{{item.data.children}}"></chris-plugin-tree-recursive>
        </div>
      </div>
    </template>
  </template>

  <script>
  Polymer({
    is: 'chris-plugin-tree-recursive',
    properties: {
    
      tree: {
        type: Array,
        observer: '_treeChanged',
      }

    },

    observers: [
          '_treeChanged(tree.*)',
        ],


    _selectNode: function(event) {
      this.fire('select-node', event.model.__data__.item);
    },

    _treeChanged: function() {
      for( var i=0; i < this.tree.length; i++){
        this.set(['tree',i, 'data', 'children'], this.tree[i].data.children);
      }
    },

    _setIcon: function(status) {
      if(status === 'finishedSuccessfully') {
        return 'icons:done';
      } else if(status === 'started') {
        return 'icons:schedule';
      } else {
        return 'icons:clear';
      }
    },

    _setStyle: function(status) {
      // set color
      var color = '#ff5722';
      if(status === 'started') {
        color = '#00bcd4';
      } else if(status === 'finishedSuccessfully') {
        color = '#8bc34a';
      }

      return 'color: ' + color;
    }
  });
</script>

</dom-module>