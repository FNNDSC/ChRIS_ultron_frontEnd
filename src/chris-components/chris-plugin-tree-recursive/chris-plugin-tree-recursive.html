<link rel="import" href="../../../bower_components/polymer/polymer.html">

<link rel="import" href="../../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">

<link rel="import" href="../../../bower_components/paper-button/paper-button.html">

<dom-module id="chris-plugin-tree-recursive">

  <template>

    <style>

      :host {

        display: flex;
        flex: 1;

        }

      .plugin, .label, .children {

        display: flex;

      }

      .plugin {

        flex-direction: column;
        flex: 1;

      }

      .children {

        flex-direction: row

      }

      .label {

        /*height: 50px;
        color: red;*/
        justify-content: center;

      }

      paper-button.primary {

        background-color: var(--primary-color);
        color: white;
        width:100%;
        margin:0;
        border-radius: 0;
        border: 1px solid #dddddd;

      }

      paper-button.primary[selected] {

        background-color: var(--accent-color);

      }

      iron-icon {
        right: 10px;
        position: absolute;
      }

    </style>

    <template is="dom-repeat" items="{{tree}}">
      <div class="plugin">
        <div class="label" on-tap="_selectNode">
          <paper-button class="primary" selected$="{{item.data.selected}}"><iron-icon icon$="{{_setIcon(item.data.status)}}" item-icon></iron-icon>{{item.data.plugin_name}}</paper-button>     
        </div>
        <div class="children">
          <chris-plugin-tree-recursive id="testC" tree="{{item.data.children}}"></chris-plugin-tree-recursive>
        </div>
      </div>
    </template>
  </template>

  <script>
  Polymer({
    is: 'chris-plugin-tree-recursive',
    properties: {
    
      tree: {
        type: Array,
        observer: '_treeChanged',
      }

    },

    _selectNode: function(event) {
      this.fire('select-node', event.model.__data__.item);
    },

    _treeChanged: function() {
      for( var i=0; i < this.tree.length; i++){
        this.set(['tree',i, 'data', 'children'], this.tree[i].data.children);
      }
    },

    _setIcon: function(status) {
      if(status === 'finishedSuccessfully') {
        return 'icons:done';
      } else if(status === 'started') {
        return 'icons:schedule';
      } else {
        return 'icons:clear';
      }
    }
  });
</script>

</dom-module>