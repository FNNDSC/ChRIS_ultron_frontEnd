<!--
@license
Copyright (c) 2016 FNNDSC. All rights reserved.
-->

<link rel="import" href="../../../bower_components/polymer/polymer.html">

<dom-module id="chris-comment">

  <template>

    <style>

    :host{

      display: block;

    }

    .container{

      min-height: 64px;
      display: flex;
      flex-direction: row;
      align-items: center;
      border-bottom: 1px solid var(--paper-grey-300);

    }

    .name{

      padding:8px;
      font-style: bold;
      font-size: smaller;

    }

    .content{

      padding:8px;

    }

    </style>

    <div class="container" style$="[[_setCommentStyle(comment.data.color)]]">
      <div class="name pad8">[[comment.data.author]]</div>
      <div class="content pad8">[[comment.data.content]]</div>
    </div>

  </template>

  <script>
    Polymer({
        is: 'chris-comment',

        properties: {

          comment: {
            type: Object,
            observer: '_commentChanged'
          },

          valid: {
            type: Boolean
          }

        },

        isValid: function( comment ){

          if( !this.comment ){

            return;

          }

          var error = [];

          if( !this.comment.data ){

            error.push( 'comment.data doesn\'t exist' );

          }
          else{

            // Author is a <string>
            if( !( typeof this.comment.data.author === 'string' ) ){

              error.push( 'author:String' );

            }

            // Color is a <string>
            if( !( typeof this.comment.data.color === 'string' ) ){

              error.push( 'color:String' );

            }

            // Content is a <string>
            if( !( typeof this.comment.data.content === 'string' ) ){

              error.push( 'content:String' );

            }

            // Date is a <string>
            if( !( typeof this.comment.data.date === 'string' ) ){

              error.push( 'date:String' );

            }

            // Id is a <string>
            if( !( typeof this.comment.data.id === 'string' ) ){

              error.push( 'id:String' );

            }

          }

          this.valid = ( error.length <= 0 );
          this.fire( 'valid-changed');

          if( !this.valid ){

            console.log( error );

            // fire error here because firefox complains if we do it before...?
            this.fire( 'error', error );

          }

          return this.valid;

        },

        _setCommentStyle: function( color ){

          return 'border-left: 1px solid ' + color;

        },

        _commentChanged: function( event ){

          if( !this.isValid( this.comment ) ){

            // if not valid

          }
          else{

            // if valid

          }

        }

    });
  </script>
</dom-module>
