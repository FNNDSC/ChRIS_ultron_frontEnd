<!--
@license
Copyright (c) 2016 FNNDSC. All rights reserved.
-->

<!-- POLYMER -->
<link rel="import" href="../../../bower_components/polymer/polymer.html">

<!-- IRON ELEMENTS -->
<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">

<!-- PAPER ELEMENTS -->
<link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../../bower_components/paper-material/paper-material.html">

<!-- CHRIS -->
<link rel="import" href="../chris-plugin/chris-plugin.html">

<dom-module id="chris-plugin-list">
  <template>
    <style>

      .toolbar {

          min-height: 48px;
          @apply(--layout-horizontal);
          @apply(--layout-end);
          @apply(--layout-wrap);
          border-bottom: 1px solid var(--accent-color);

        }

      .name {

        font-size: 16px;
        font-weight: bold;
        color: var(--primary-text-color);

      }

      .spacer {

        @apply(--layout-flex);

      }

      paper-icon-button {

        color: var(--secondary-text-color);

      }

      .content {

        padding: 20px;

      }

      .hidden {

        display: none;

      }

      #showAll{

        cursor: pointer;

      }

    </style>

    <div id="pluginList" class="plugin-list">


      <div class="content">

        <!-- Middle comments -->
        <template is="dom-repeat" items="[[plugins.data]]">

          <template is="dom-if" if="[[_computeShowAllButton(index)]]">

            <paper-material elevation=1 id="showAll" on-tap="_showAll">
              <paper-icon-button icon="icons:view-headline"></paper-icon-button>
              Show full workflow ([[_hiddenPlugins(plugins.data.length)]])
            </paper-material>

          </template>

          <chris-plugin plugin="[[item]]" class$="[[_computePluginVisible(index)]]" open$="[[_computePluginOpen(index)]]"></chris-plugin>

        </template>

      </div>

    </div>

  </template>

  <script>
    Polymer({
        is: 'chris-plugin-list',

        properties: {

          plugins: {
            type: Array
          },

          open: {
            type: Boolean,
            value: true,
            observer: '_openChanged'
          }

        },

        toggle: function(){

          this.open = !this.open;

        },

        _openChanged: function( ){

          this.open ? this.$.pluginList.classList.add('open') : this.$.pluginList.classList.remove('open');

        },

        _setToogleIcon: function( open ){
          
          return this.open ? 'icons:expand-less' : 'icons:expand-more';

        },

        _computePluginOpen: function( index ){

          if( this.plugins.data.length - 1 === index ){

            return true;

          } 
          else {

            return false;

          }

        },

        _computePluginVisible: function( index ){

          if( this.plugins.data.length <= 3 ||
            this.plugins.data.length - 1 === index ||
            index === 0 ){

            return '';

          } 
          else {

            return 'hidden';

          }

        },

        _computeShowAllButton: function( index ){

          // if last element and more than 3 elements

          if( this.plugins.data.length - 1 === index && this.plugins.data.length > 3 ){

            return true;

          } 
          else {

            return false;

          }

        },

        _showAll: function(){

          // hide button
          this.shadowRoot.querySelector('#showAll').classList.add('hidden');

          // show plugins
          var hiddenPlugins = this.shadowRoot.querySelectorAll('chris-plugin.hidden');

          for( var i=0; i<hiddenPlugins.length; i++ ){

            hiddenPlugins[i].classList.remove('hidden');

          }

          this.fire('resize-content');

        },

        _hiddenPlugins: function( allPlugins ){

          return allPlugins - 2;

        }

    });
  </script>
</dom-module>
