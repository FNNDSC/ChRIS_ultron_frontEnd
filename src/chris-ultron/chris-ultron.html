<!--
@license
Copyright (c) 2016 FNNDSC. All rights reserved.
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">

<!-- IRON -->
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-icons/av-icons.html">
<link rel="import" href="../../bower_components/iron-icons/editor-icons.html">
<link rel="import" href="../../bower_components/iron-icons/communication-icons.html">
<link rel="import" href="../../bower_components/iron-icons/image-icons.html">
<link rel="import" href="../../bower_components/iron-icons/social-icons.html">
<link rel="import" href="../../bower_components/iron-image/iron-image.html">
<link rel="import" href="../../bower_components/iron-list/iron-list.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/iron-scroll-threshold/iron-scroll-threshold.html">

<!-- Neon elements -->
<link rel="import" href="../../bower_components/neon-animation/neon-animated-pages.html">
<link rel="import" href="../../bower_components/neon-animation/neon-animatable.html">
<link rel="import" href="../../bower_components/neon-animation/animations/fade-in-animation.html">
<link rel="import" href="../../bower_components/neon-animation/animations/slide-from-left-animation.html">
<link rel="import" href="../../bower_components/neon-animation/animations/slide-from-bottom-animation.html">
<link rel="import" href="../../bower_components/neon-animation/animations/slide-up-animation.html">
<link rel="import" href="../../bower_components/neon-animation/animations/fade-out-animation.html">
<link rel="import" href="../../bower_components/neon-animation/animations/scale-up-animation.html">

<!-- PAPER <3 -->
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-item/paper-icon-item.html">
<link rel="import" href="../../bower_components/paper-spinner/paper-spinner.html">
<link rel="import" href="../../bower_components/paper-styles/color.html">
<link rel="import" href="../../bower_components/paper-styles/typography.html">
<link rel="import" href="../../bower_components/paper-tooltip/paper-tooltip.html">

<!-- APP LAYOUT -->
<link rel="import" href="../../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="../../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">
<link rel="import" href="../../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../../bower_components/app-layout/app-scrollpos-control/app-scrollpos-control.html">

<link rel="import" href="../../bower_components/app-layout/demo/sample-content.html">

<!-- NON POLYMER TEAM PROVIDED -->
<link rel="import" href="../../bower_components/paper-fab-transitions/paper-fab-speed-dial.html">

<!-- CHRIS -->
<link rel="import" href="../chris-api/chris-api.html">
<link rel="import" href="../chris-feed-list/chris-feed-list.html">
<link rel="import" href="../chris-feed-create/chris-feed-create.html">
<link rel="import" href="../chris-login/chris-login.html">

<!-- STYLE -->
<link rel="import" href="chris-ultron-styles.html">

<dom-module id="chris-ultron">

  <template>

    <style include="chris-ultron-styles"></style>
    <style>
      app-header {
        background-color: var(--paper-blue-500);
        color: #fff;
      }

      app-header paper-icon-button {
        --paper-icon-button-ink-color: white;
      }

      paper-fab-speed-dial{
        z-index:10;
        position: fixed;
        bottom: 16px;
        right: 16px;
      }

      paper-fab#create {
        --paper-fab-background: var(--paper-pink-a200);
      }


      paper-fab#merge {
         z-index:10;
        position:fixed;
        --paper-fab-background: var(--paper-green-a200);
        top: 80px;
        right: 16px;
      }

      .separator{
        font-size: 14px;
        font-weight: 500;
        color: rgb(170, 170, 170);
        padding: 16px;
        border-top: 1px solid rgb(224, 224, 224);
      }

      #navheader {
  font-size: inherit;
  color: white;
  flex-shrink: 0;
}

#navheader {
  background-color: #999;
  align-items: center;
}

#username {
  font-size: small;
  opacity: 0.8;
}

app-toolbar.tall{
        height: calc(var(--paper-toolbar-height, 64px) * 3);

}

      @media (max-width: 460px) {
        paper-toolbar .bottom.title {
          font-size: 14px;
        }
      }

    </style>

    <template is="dom-if" if="{{!logged}}" restamp>
      <chris-login logged={{logged}}></chris-login>
    </template>

    <template is="dom-if" if="{{logged}}" restamp>

      <chris-api api="Feeds" url="../../data/contacts.json" response="{{items}}"></chris-api>
      <chris-api api="PluginsFeed" url="../../data/plugins-feed.json" response="{{plugins}}"></chris-api>
      <chris-api api="Labels" url="../../data/contacts.json" response="{{labels}}"></chris-api>

      <app-drawer-layout class="fullbleed layout vertical">

        <app-drawer>
          <div style="height: 100%; overflow: auto;" on-scroll="donothing">

            <app-toolbar id="navheader" class="tall layout horizontal">
              <div>
                <div>Welcome to ChRIS Ultron</div>
                <span id="username">nicolas.rannou</span>
              </div>
            </app-toolbar>

            <paper-menu>

              <div class="separator">Categories</div>

              <paper-icon-item role="menuitem">
                <iron-icon icon="icons:view-headline" item-icon></iron-icon>All
              </paper-icon-item>
              <paper-icon-item role="menuitem">
                <iron-icon icon="icons:favorite" item-icon></iron-icon>Favorite
              </paper-icon-item>
              <paper-icon-item role="menuitem">
                <iron-icon icon="icons:refresh" item-icon></iron-icon>Running
              </paper-icon-item>
              <paper-icon-item role="menuitem">
                <iron-icon icon="icons:done" item-icon></iron-icon>Done
              </paper-icon-item>
              <paper-icon-item role="menuitem">
                <iron-icon icon="icons:clear" item-icon></iron-icon>Error
              </paper-icon-item>
   <!--            <paper-icon-item role="menuitem">
                <iron-icon icon="social:people" item-icon></iron-icon>Shared
              </paper-icon-item>
              <paper-icon-item role="menuitem">
                <iron-icon icon="icons:visibility-off" item-icon></iron-icon>Hidden
              </paper-icon-item> -->

              <div class="separator">Labels</div>

              <template is="dom-repeat" items="{{labels}}">
                <paper-icon-item>
                  <iron-icon icon="label" item-icon class$="primary {{item.color}} invert"></iron-icon><span>{{item.last}}</span>
                </paper-icon-item>
              </template>

            </paper-menu>

            <div class="version">@VERSION@</div>
          </div>
          </app-drawer>
        </app-drawer>

        <!-- use that? -->
        <app-scrollpos-control selected="{{page}}"></app-scrollpos-control>

        <neon-animated-pages id="pages" selected="{{page}}" class="flex" entry-animation="fade-in-animation" exit-animation="fade-out-animation">
          <neon-animatable >

            <app-header-layout id="ultronheader">

              <!-- HEADER -->
              <app-header fixed effects="waterfall">

                <app-toolbar>
                  <paper-icon-button icon="menu" drawer-toggle></paper-icon-button>
                  <div title>ChRIS Ultron</div>
                  <paper-icon-button icon="search" alt="Search"></paper-icon-button>
                  <paper-menu-button horizontal-align="right">
                    <paper-icon-button icon="more-vert" class="dropdown-trigger"></paper-icon-button>
                    <paper-menu class="dropdown-content">
                      <paper-item>Settings</paper-item>
                      <paper-item on-tap="logout">Logout</paper-item>
                      <paper-item>Help</paper-item>
                    </paper-menu>
                  </paper-menu-button>
                </app-toolbar>

              </app-header>


              <!-- CONTENT -->

              <!-- Menu to select plugins to CREATE feeds -->
              <paper-fab-speed-dial direction="top">
                <paper-fab id="create" icon="add" class="dropdown-trigger"></paper-fab>
                <div class="dropdown-content">
                  <template is="dom-repeat" items="{{plugins}}">
                    <paper-fab mini id="[[item.name]]" icon="[[item.icon]]" class$="primary [[item.color]]" item="[[item]]" on-tap="nextPage"></paper-fab>
                    <paper-tooltip for="[[item.name]]" position="left" animation-delay="0">[[item.label]]</paper-tooltip>
                  </template>
                </div>
              </paper-fab-speed-dial>

              <!-- fabs to merge data -->
              <paper-fab id="merge" icon="communication:call-merge" title="merge"></paper-fab>

              <!-- All feeds -->
              <chris-feed-list id="feeds" feeds="[[items]]"></chris-feed-list>

            </app-header-layout>

          </neon-animatable>

          <neon-animatable>

            <!-- CREATE FEED PAGE -->
            <chris-feed-create id="feedCreate" plugin="{{plugin}}" on-done="addFeedToList"></chris-feed-create>

          </neon-animatable>

        </neon-animated-pages>

    </app-drawer-layout>

    </template>

    <!-- faster with that.... -->
    <!-- <app-scrollpos-control selected="{{page}}"></app-scrollpos-control> -->

  </template>

  <script>
    Polymer({
        is: 'chris-ultron',
        properties: {
          logged:{
            type: Boolean,
            value: false
          },
          items: {
            type: Array
          },
          plugins:{
            type: Array
          },
          labels: {
            type: Array,
          },
          plugin:{
            type: Object
          },
          route:{
            type: String,
            value: 'feeds'
          },
          page: {
            type: Number,
            value: 0
          }
        },

        attached: function( ){

          // if username and token, we are still logged in
          if ( sessionStorage.getItem( 'username' ) &&
            sessionStorage.getItem( 'token' ) ) {

            this.logged = true;

          }
        },

        nextPage: function( item, more ){

          if( item ){
            this.set( 'plugin', item.model.__data__.item );
          }

          this.$$( '#pages' ).selectNext();

        },

        addFeedToList: function( ){

          // get the shell of the feed
          var feed = this.$$( '#feedCreate' ).feed;
          feed.id = this.items.length + 1;
          feed.name = this.plugin.name;

          this.unshift( 'items', feed );

          this.nextPage( null );

        },

        logout: function( ){

          sessionStorage.clear( );

          this.logged = false;

        },

        donothing: function(evt){

          // not blocking the scroling... :/
          evt.stopPropagation();
          evt.preventDefault();

        }
    });
  </script>
</dom-module>
