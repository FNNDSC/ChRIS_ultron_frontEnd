<!--
@license
Copyright (c) 2016 FNNDSC. All rights reserved.
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">

<!-- IRON ELEMENTS -->
<link rel="import" href="../../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-icons/communication-icons.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">

<!-- PAPER ELEMENTS -->
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-material/paper-material.html">

<dom-module id="chris-plugin">

  <template>

    <style>

      .plugin{

        background-color: white;

      }

      .toolbar{

        @apply(--layout-horizontal);
        @apply(--layout-center);
        @apply(--layout-wrap);
        

        /*border: 1px solid #ddd;*/
        cursor: pointer;
        margin: 10px 0;

      }

      .title{

        margin-left:8px;

      }

      .spacer {

        @apply(--layout-flex);

      }

      paper-icon-button{

        --paper-icon-button-ink-color: var(--paper-grey-300);

      }

      paper-icon-button.iron-selected{

        color: var(--accent-color);

      }

      iron-selector{

        border-bottom: 1px solid var(--primary-text-color);

      }

      .content {

        padding: 20px;
        display: none;

      }

      .plugin.open .content {

        display: block;

      }

/*      .dataview{

        display:none;

      }

      .dataview.iron-selected{

        display: block;

      }*/

    </style>

    <paper-material elevation=1 id="plugin" class="plugin">
      <div id$="[[plugin.id]]">


        <div class="toolbar">
          <template is="dom-repeat" items="{{plugin.workflow}}">
            <paper-icon-button icon="[[item.icon]]" style$="{{_setPluginStyle(item.color)}}" alt="More options"></paper-icon-button>

          </template>
        
          <div class="title" title>[[plugin.label]]</div>

          <div class="spacer"></div>

          <template is="dom-if" if="{{open}}" >
            <iron-selector id="dataButton" attr-for-selected="name" selected="{{selected}}">
              <paper-icon-button name="chris-dataviews-rows" icon="icons:view-headline"></paper-icon-button>
              <paper-icon-button name="chris-dataviews-columns" icon="icons:view-week"></paper-icon-button>
            </iron-selector>
          </template>
          <paper-icon-button icon="communication:call-split" on-tap="newFeed"></paper-icon-button>
          <paper-icon-button icon="add" alt="More options" on-tap="newPlugin"></paper-icon-button>
          <paper-icon-button icon$="[[_setToogleIcon(open)]]" on-tap="toggle"></paper-icon-button>
   
      </div>

      <div class="content">

        <iron-pages role="main" attr-for-selected="name" selected="[[selected]]">

          <chris-dataviews-rows name="chris-dataviews-rows" class="dataview" data="[[plugin.data]]" path="[[path]]"></chris-dataviews-rows>
          <chris-dataviews-columns name="chris-dataviews-columns" class="dataview" data="[[plugin.data]]" path="[[path]]"></chris-dataviews-columns>

        <iron-pages>

      </div>

      </paper-material>

  </template>

  <script>
    Polymer({
        is: 'chris-plugin',

        properties: {

          plugin: {
            type: Object
          },

          open: {
            type: Boolean,
            value: false,
            observer: '_openChanged'
          },

          selected: {
            type: String,
            value: 'chris-dataviews-rows',
            observer: '_selectedChanged'
          },

          path: {
            type: Array,
            observer: '_pathChanged'
          }

        },

        _pathChanged: function(){

          console.log( this.path);

        },

        _selectedChanged: function(){

          // load page import on demand.
          this.importHref(
            this.resolveUrl( '../chris-dataviews/' + this.selected + '/' + this.selected + '.html' ), function(){
              this.fire('resize-content');
            }, null, true );

        },

        donothing: function( evt ){

          evt.stopPropagation();
          evt.preventDefault();

        },

        newFeed: function( evt ){

          this.donothing(evt);
          
          console.log( 'create new feed' );

        },

        newPlugin: function( evt ){

          this.donothing(evt);
          
          console.log( 'create new plugin' );

        },

        toggle: function(){

          this.open = !this.open;

        },

        _setPluginStyle: function( color){

          return 'color: ' + color + ';';

        },

        _setToogleIcon: function( open ){
          
          return this.open ? 'icons:expand-less' : 'icons:expand-more';

        },

        _openChanged: function(){

          this.open ? this.$.plugin.classList.add('open') : this.$.plugin.classList.remove('open');
          this.open ? this.$.plugin.elevation = 4 : this.$.plugin.elevation = 1;

          this._resizeContent();
        },

        _resizeContent: function( event ){

          this.fire('resize-content');

        }

        // _selectedChanged: function(){

        //   // should lazy load data view...
        //   this.$.dataView.selected = this.selected;

        // }

    });
  </script>
</dom-module>
