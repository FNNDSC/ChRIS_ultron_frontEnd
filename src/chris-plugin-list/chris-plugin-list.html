<!--
@license
Copyright (c) 2016 FNNDSC. All rights reserved.
-->

<!-- POLYMER -->
<link rel="import" href="../../bower_components/polymer/polymer.html">

<!-- IRON ELEMENTS -->
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">

<!-- PAPER ELEMENTS -->
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">

<!-- CHRIS -->
<link rel="import" href="../chris-plugin/chris-plugin.html">

<dom-module id="chris-plugin-list">
  <template>
    <style>

      .toolbar {

          min-height: 48px;
          @apply(--layout-horizontal);
          @apply(--layout-end);
          @apply(--layout-wrap);
          border-bottom: 1px solid var(--accent-color);

        }

      .name {

        font-size: 16px;
        font-weight: bold;
        color: var(--primary-text-color);

      }

      .spacer {

        @apply(--layout-flex);

      }

      paper-icon-button {

        color: var(--secondary-text-color);

      }

      .content {

        padding: 20px;
        display: none;

      }

      .plugin-list.open .content {

        display: block;

      }

    </style>

    <div id="pluginList" class="plugin-list">

      <!-- Toolbar -->

      <div class="toolbar">

        <div class="name">Plugins ([[plugins.length]])</div>

        <div class="spacer"></div>

        <paper-icon-button icon$="[[_setToogleIcon(open)]]" on-tap="toggle"></paper-icon-button>

      </div>

      <div class="content">

        <!-- Middle comments -->
        <template is="dom-repeat" items="[[plugins]]">

          <chris-plugin plugin="[[item]]" open$="[[_computePluginOpen(index)]]"></chris-plugin>

        </template>

      </div>

    </div>

  </template>

  <script>
    Polymer({
        is: 'chris-plugin-list',

        properties: {

          plugins: {
            type: Array
          },

          open: {
            type: Boolean,
            value: true,
            observer: '_openChanged'
          }

        },

        toggle: function(){

          this.open = !this.open;

        },

        _openChanged: function( ){

          this.open ? this.$.pluginList.classList.add('open') : this.$.pluginList.classList.remove('open');

          this._resizeContent();

        },

        _setToogleIcon: function( open ){
          
          return this.open ? 'icons:expand-less' : 'icons:expand-more';

        },

        _resizeContent: function( event ){

          this.fire('resize-content');

        },

        _computePluginOpen: function( index ){

          if(this.plugins.length - 1 === index){

            return true;

          } 
          else {

            return false;

          }

        }

    });
  </script>
</dom-module>
