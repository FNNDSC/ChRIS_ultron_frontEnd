<html><head><link rel="import" href="../polymer/polymer.html">

<link rel="import" href="../ami-import/ami-import.html">



</head><body><dom-module id="ami-loader">
  <script>Polymer({is:"ami-loader",properties:{urls:{type:Array,value:[],observer:"_urlsChanged"},files:{type:Array,value:[],observer:"_filesChanged"},status:{type:Number,value:0},progress:{type:Number,value:0},loader:{type:Object,value:null},series:{type:Array,value:[]}},_loadSequence:function(e){var r=this;return Promise.resolve().then(function(){return r.loader.fetch(e)}).then(function(e){return r.loader.parse(e)}).then(function(e){r.series.push(e)}).catch(function(e){window.console.log("oops... something went wrong..."),window.console.log(e)})},_urlsChanged:function(){if(console.log(this.urls),this.urls&&!(this.urls.length<=0)){this.loader=new AMI.default.Loaders.Volume;var e=[],r=this;r.series=[],this.urls.forEach(function(s){e.push(r._loadSequence(s))}),this.startSequences(e)}},_parseSequence:function(e){var r=this;return Promise.resolve().then(function(){return new Promise(function(r,s){var n=new FileReader;n.addEventListener("load",function(e){r(e.target.result)}),n.readAsArrayBuffer(e)})}).then(function(s){var n={url:e.name,buffer:s};return r.loader.parse(n)}).then(function(e){r.series.push(e)}).catch(function(e){window.console.log("oops... something went wrong..."),window.console.log(e)})},_filesChanged:function(){if(this.files&&!(this.files.length<=0)){this.loader=new AMI.default.Loaders.Volume;var e=[],r=this;r.series=[],this.files.forEach(function(s){e.push(r._parseSequence(s))}),this.startSequences(e)}},startSequences:function(e){var r=this;Promise.all(e).then(function(){r.loader.free(),r.loader=null,r.series=r.series[0].mergeSeries(r.series),console.log("parsing done!"),r.fire("series-changed"),r.fire("loaded")})}});</script>
</dom-module>
</body></html>