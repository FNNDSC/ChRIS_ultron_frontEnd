<!DOCTYPE html><html><head>
  <title>iron-request</title>

  <script src="../../webcomponentsjs/webcomponents.js"></script>
  <script src="../../web-component-tester/browser.js"></script>

  <link rel="import" href="../../polymer/polymer.html">
  <link rel="import" href="../iron-request.html">
</head>
<body>
  <test-fixture id="TrivialRequest">
    <template>
      <iron-request></iron-request>
    </template>
  </test-fixture>
  <script>suite("<iron-request>",function(){var e,t,s,n;setup(function(){e={"Content-Type":"application/json"},n=sinon.fakeServer.create(),n.respondWith("GET","/responds_to_get_with_json",[200,e,'{"success":true}']),n.respondWith("GET","/responds_to_get_with_prefixed_json",[200,e,'])}while(1);</x>{"success":true}']),n.respondWith("GET","/responds_to_get_with_500",[500,{},""]),n.respondWith("GET","/responds_to_get_with_100",[100,{},""]),n.respondWith("GET","/responds_to_get_with_0",[0,e,'{"success":true}']),s=fixture("TrivialRequest"),t={url:"/responds_to_get_with_json"}}),teardown(function(){n.restore()}),suite("basic usage",function(){test("creates network requests, requiring only `url`",function(){s.send(t),n.respond(),expect(s.response).to.be.ok}),test("sets async to true by default",function(){s.send(t),expect(s.xhr.async).to.be.eql(!0)}),test("can be aborted",function(){return s.send(t),s.abort(),n.respond(),s.completes.then(function(){throw new Error("Request did not abort appropriately!")})["catch"](function(e){expect(s.response).to.not.be.ok})}),test("default responseType is text",function(){return s.send(t),n.respond(),s.completes.then(function(){expect(s.response).to.be.an("string")})}),test("default responseType of text is not applied, when async is false",function(){var e=Object.create(t);return e.async=!1,s.send(e),n.respond(),s.completes.then(function(){expect(s.xhr.responseType).to.be.empty})}),test("responseType can be configured via handleAs option",function(){var e=Object.create(t);return e.handleAs="json",s.send(e),expect(n.requests.length).to.be.equal(1),expect(n.requests[0].requestHeaders.accept).to.be.equal("application/json"),n.respond(),s.completes.then(function(){expect(s.response).to.be.an("object")})}),test("setting jsonPrefix correctly strips it from the response",function(){var e={url:"/responds_to_get_with_prefixed_json",handleAs:"json",jsonPrefix:"])}while(1);</x>"};return s.send(e),expect(n.requests.length).to.be.equal(1),expect(n.requests[0].requestHeaders.accept).to.be.equal("application/json"),n.respond(),s.completes.then(function(){expect(s.response).to.deep.eq({success:!0})})}),test("responseType cannot be configured via handleAs option, when async is false",function(){var e=Object.create(t);return e.handleAs="json",e.async=!1,s.send(e),expect(n.requests.length).to.be.equal(1),expect(n.requests[0].requestHeaders.accept).to.be.equal("application/json"),n.respond(),s.completes.then(function(){expect(s.response).to.be.a("string")})}),test("headers are sent up",function(){var e=Object.create(t);e.headers={foo:"bar",accept:"this should override the default"},s.send(e),expect(n.requests.length).to.be.equal(1);var o=n.requests[0];expect(o.requestHeaders.foo).to.be.equal("bar"),expect(o.requestHeaders.accept).to.be.equal("this should override the default")}),test("headers are deduped by lowercasing",function(){var e=Object.create(t);e.headers={foo:"bar",Foo:"bar",fOo:"bar",Accept:"this should also override the default"},s.send(e),expect(n.requests.length).to.be.equal(1);var o=n.requests[0];expect(Object.keys(o.requestHeaders).length).to.be.equal(2),expect(o.requestHeaders.foo).to.be.equal("bar"),expect(o.requestHeaders.accept).to.be.equal("this should also override the default")})}),suite("special cases",function(){test("treats status code 0 as success, though the outcome is ambiguous",function(){s.send({url:"/responds_to_get_with_0"}),n.respond(),expect(s.succeeded).to.be.equal(!0)})}),suite("errors",function(){test("treats status codes between 1 and 199 as errors",function(){s.send({url:"/responds_to_get_with_100"}),n.respond(),expect(s.succeeded).to.be.equal(!1)}),test("treats status codes between 300 and âˆž as errors",function(){s.send({url:"/responds_to_get_with_500"}),n.respond(),expect(s.succeeded).to.be.equal(!1)})}),suite("status codes",function(){test("status and statusText is set after a ambiguous request",function(){s.send({url:"/responds_to_get_with_0"}),n.respond(),expect(s.status).to.be.equal(0),expect(s.statusText).to.be.equal("")}),test("status and statusText is set after a request that succeeded",function(){s.send({url:"/responds_to_get_with_json"}),n.respond(),expect(s.status).to.be.equal(200),expect(s.statusText).to.be.equal("OK")}),test("status and statusText is set after a request that failed",function(){s.send({url:"/responds_to_get_with_500"}),n.respond(),expect(s.status).to.be.equal(500),expect(s.statusText).to.be.equal("Internal Server Error")})})});</script>



</body></html>