<!DOCTYPE html><html><head>
  <title>iron-request</title>

  <script src="../../webcomponentsjs/webcomponents.js"></script>
  <script src="../../web-component-tester/browser.js"></script>

  <link rel="import" href="../../polymer/polymer.html">
  <link rel="import" href="../iron-request.html">
</head>
<body>
  <test-fixture id="TrivialRequest">
    <template>
      <iron-request></iron-request>
    </template>
  </test-fixture>
  <script>suite("<iron-request>",function(){var e,t,s,o;setup(function(){e={"Content-Type":"application/json"},o=sinon.fakeServer.create(),o.respondWith("GET","/responds_to_get_with_json",[200,e,'{"success":true}']),o.respondWith("GET","/responds_to_get_with_prefixed_json",[200,e,'])}while(1);</x>{"success":true}']),o.respondWith("GET","/responds_to_get_with_500",[500,{},""]),o.respondWith("GET","/responds_to_get_with_100",[100,{},""]),o.respondWith("GET","/responds_to_get_with_0",[0,e,'{"success":true}']),s=fixture("TrivialRequest"),t={url:"/responds_to_get_with_json"},synchronousSuccessfulRequestOptions={url:"/responds_to_get_with_json",async:!1,timeout:100},asynchronousSuccessfulRequestOptions={url:"/responds_to_get_with_json",async:!0,timeout:100}}),teardown(function(){o.restore()}),suite("basic usage",function(){test("creates network requests, requiring only `url`",function(){s.send(t),o.respond(),expect(s.response).to.be.ok}),test("timeout not set if synchronous",function(){s.send(synchronousSuccessfulRequestOptions),expect(s.xhr.async).to.be.eql(!1),expect(s.xhr.timeout).to.be.eql(void 0)}),test("timeout set if asynchronous",function(){s.send(asynchronousSuccessfulRequestOptions),expect(s.xhr.async).to.be.eql(!0),expect(s.xhr.timeout).to.be.eql(100)}),test("sets async to true by default",function(){s.send(t),expect(s.xhr.async).to.be.eql(!0)}),test("can be aborted",function(){return s.send(t),s.abort(),o.respond(),s.completes.then(function(){throw new Error("Request did not abort appropriately!")})["catch"](function(e){expect(s.response).to.not.be.ok})}),test("default responseType is text",function(){return s.send(t),o.respond(),s.completes.then(function(){expect(s.response).to.be.an("string")})}),test("default responseType of text is not applied, when async is false",function(){var e=Object.create(t);return e.async=!1,s.send(e),o.respond(),s.completes.then(function(){expect(s.xhr.responseType).to.be.empty})}),test("responseType can be configured via handleAs option",function(){var e=Object.create(t);return e.handleAs="json",s.send(e),expect(o.requests.length).to.be.equal(1),expect(o.requests[0].requestHeaders.accept).to.be.equal("application/json"),o.respond(),s.completes.then(function(){expect(s.response).to.be.an("object")})}),test("setting jsonPrefix correctly strips it from the response",function(){var e={url:"/responds_to_get_with_prefixed_json",handleAs:"json",jsonPrefix:"])}while(1);</x>"};return s.send(e),expect(o.requests.length).to.be.equal(1),expect(o.requests[0].requestHeaders.accept).to.be.equal("application/json"),o.respond(),s.completes.then(function(){expect(s.response).to.deep.eq({success:!0})})}),test("responseType cannot be configured via handleAs option, when async is false",function(){var e=Object.create(t);return e.handleAs="json",e.async=!1,s.send(e),expect(o.requests.length).to.be.equal(1),expect(o.requests[0].requestHeaders.accept).to.be.equal("application/json"),o.respond(),s.completes.then(function(){expect(s.response).to.be.a("string")})}),test("headers are sent up",function(){var e=Object.create(t);e.headers={foo:"bar",accept:"this should override the default"},s.send(e),expect(o.requests.length).to.be.equal(1);var n=o.requests[0];expect(n.requestHeaders.foo).to.be.equal("bar"),expect(n.requestHeaders.accept).to.be.equal("this should override the default")}),test("headers are deduped by lowercasing",function(){var e=Object.create(t);e.headers={foo:"bar",Foo:"bar",fOo:"bar",Accept:"this should also override the default"},s.send(e),expect(o.requests.length).to.be.equal(1);var n=o.requests[0];expect(Object.keys(n.requestHeaders).length).to.be.equal(2),expect(n.requestHeaders.foo).to.be.equal("bar"),expect(n.requestHeaders.accept).to.be.equal("this should also override the default")})}),suite("special cases",function(){test("treats status code 0 as success, though the outcome is ambiguous",function(){s.send({url:"/responds_to_get_with_0"}),o.respond(),expect(s.succeeded).to.be.equal(!0)})}),suite("errors",function(){test("treats status codes between 1 and 199 as errors",function(){s.send({url:"/responds_to_get_with_100"}),o.respond(),expect(s.succeeded).to.be.equal(!1)}),test("treats status codes between 300 and âˆž as errors",function(){s.send({url:"/responds_to_get_with_500"}),o.respond(),expect(s.succeeded).to.be.equal(!1)})}),suite("status codes",function(){test("status and statusText is set after a ambiguous request",function(){s.send({url:"/responds_to_get_with_0"}),o.respond(),expect(s.status).to.be.equal(0),expect(s.statusText).to.be.equal("")}),test("status and statusText is set after a request that succeeded",function(){s.send({url:"/responds_to_get_with_json"}),o.respond(),expect(s.status).to.be.equal(200),expect(s.statusText).to.be.equal("OK")}),test("status and statusText is set after a request that failed",function(){s.send({url:"/responds_to_get_with_500"}),o.respond(),expect(s.status).to.be.equal(500),expect(s.statusText).to.be.equal("Internal Server Error")})})});</script>



</body></html>