!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.AMI=e()}}(function(){var e;return function e(t,n,i){function r(a,s){if(!n[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[a]={exports:{}};t[a][0].call(c.exports,function(e){var n=t[a][1][e];return r(n?n:e)},c,c.exports,e,t,n,i)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)r(i[a]);return r}({1:[function(e,t,n){var i={Unkown:0,Grayscale:1,AdobeRGB:2,RGB:3,CYMK:4},r=function(){"use strict";function e(){}function t(e,t){for(var n,i,r=0,o=[],a=16;a>0&&!e[a-1];)a--;o.push({children:[],index:0});var s,l=o[0];for(n=0;n<a;n++){for(i=0;i<e[n];i++){for(l=o.pop(),l.children[l.index]=t[r];l.index>0;)l=o.pop();for(l.index++,o.push(l);o.length<=n;)o.push(s={children:[],index:0}),l.children[l.index]=s.children,l=s;r++}n+1<a&&(o.push(s={children:[],index:0}),l.children[l.index]=s.children,l=s)}return o[0].children}function n(e,t,n){return 64*((e.blocksPerLine+1)*t+n)}function r(e,t,i,r,o,a,s,u,c){function h(){if(C>0)return C--,M>>C&1;if(M=e[t++],255==M){var n=e[t++];if(n)throw"unexpected marker: "+(M<<8|n).toString(16)}return C=7,M>>>7}function f(e){for(var t,n=e;null!==(t=h());){if(n=n[t],"number"==typeof n)return n;if("object"!=typeof n)throw"invalid huffman sequence"}return null}function d(e){for(var t=0;e>0;){var n=h();if(null===n)return;t=t<<1|n,e--}return t}function p(e){var t=d(e);return t>=1<<e-1?t:t+(-1<<e)+1}function m(e,t){var n=f(e.huffmanTableDC),i=0===n?0:p(n);e.blockData[t]=e.pred+=i;for(var r=1;r<64;){var o=f(e.huffmanTableAC),a=15&o,s=o>>4;if(0!==a){r+=s;var u=l[r];e.blockData[t+u]=p(a),r++}else{if(s<15)break;r+=16}}}function _(e,t){var n=f(e.huffmanTableDC),i=0===n?0:p(n)<<c;e.blockData[t]=e.pred+=i}function g(e,t){e.blockData[t]|=h()<<c}function y(e,t){if(R>0)return void R--;for(var n=a,i=s;n<=i;){var r=f(e.huffmanTableAC),o=15&r,u=r>>4;if(0!==o){n+=u;var h=l[n];e.blockData[t+h]=p(o)*(1<<c),n++}else{if(u<15){R=d(u)+(1<<u)-1;break}n+=16}}}function v(e,t){for(var n=a,i=s,r=0;n<=i;){var o=l[n];switch(L){case 0:var u=f(e.huffmanTableAC),m=15&u;if(r=u>>4,0===m)r<15?(R=d(r)+(1<<r),L=4):(r=16,L=1);else{if(1!==m)throw"invalid ACn encoding";x=p(m),L=r?2:3}continue;case 1:case 2:e.blockData[t+o]?e.blockData[t+o]+=h()<<c:(r--,0===r&&(L=2==L?3:0));break;case 3:e.blockData[t+o]?e.blockData[t+o]+=h()<<c:(e.blockData[t+o]=x<<c,L=0);break;case 4:e.blockData[t+o]&&(e.blockData[t+o]+=h()<<c)}n++}4===L&&(R--,0===R&&(L=0))}function b(e,t,i,r,o){var a=i/A|0,s=i%A,l=a*e.v+r,u=s*e.h+o,c=n(e,l,u);t(e,c)}function w(e,t,i){var r=i/e.blocksPerLine|0,o=i%e.blocksPerLine,a=n(e,r,o);t(e,a)}var x,k,E,S,I,T,P,A=(i.precision,i.samplesPerLine,i.scanLines,i.mcusPerLine),D=i.progressive,O=(i.maxH,i.maxV,t),M=0,C=0,R=0,L=0,F=r.length;P=D?0===a?0===u?_:g:0===u?y:v:m;var z,B,U=0;B=1==F?r[0].blocksPerLine*r[0].blocksPerColumn:A*i.mcusPerColumn,o||(o=B);for(var N,j;U<B;){for(E=0;E<F;E++)r[E].pred=0;if(R=0,1==F)for(k=r[0],T=0;T<o;T++)w(k,P,U),U++;else for(T=0;T<o;T++){for(E=0;E<F;E++)for(k=r[E],N=k.h,j=k.v,S=0;S<j;S++)for(I=0;I<N;I++)b(k,P,U,S,I);U++}if(C=0,z=e[t]<<8|e[t+1],z<=65280)throw"marker was not found";if(!(z>=65488&&z<=65495))break;t+=2}return t-O}function o(e,t,n){var i,r,o,a,s,l,g,y,v,b,w=e.quantizationTable;for(b=0;b<64;b++)n[b]=e.blockData[t+b]*w[b];for(b=0;b<8;++b){var x=8*b;0!==n[1+x]||0!==n[2+x]||0!==n[3+x]||0!==n[4+x]||0!==n[5+x]||0!==n[6+x]||0!==n[7+x]?(i=m*n[0+x]+128>>8,r=m*n[4+x]+128>>8,o=n[2+x],a=n[6+x],s=_*(n[1+x]-n[7+x])+128>>8,y=_*(n[1+x]+n[7+x])+128>>8,l=n[3+x]<<4,g=n[5+x]<<4,v=i-r+1>>1,i=i+r+1>>1,r=v,v=o*p+a*d+128>>8,o=o*d-a*p+128>>8,a=v,v=s-g+1>>1,s=s+g+1>>1,g=v,v=y+l+1>>1,l=y-l+1>>1,y=v,v=i-a+1>>1,i=i+a+1>>1,a=v,v=r-o+1>>1,r=r+o+1>>1,o=v,v=s*f+y*h+2048>>12,s=s*h-y*f+2048>>12,y=v,v=l*c+g*u+2048>>12,l=l*u-g*c+2048>>12,g=v,n[0+x]=i+y,n[7+x]=i-y,n[1+x]=r+g,n[6+x]=r-g,n[2+x]=o+l,n[5+x]=o-l,n[3+x]=a+s,n[4+x]=a-s):(v=m*n[0+x]+512>>10,n[0+x]=v,n[1+x]=v,n[2+x]=v,n[3+x]=v,n[4+x]=v,n[5+x]=v,n[6+x]=v,n[7+x]=v)}for(b=0;b<8;++b){var k=b;0!==n[8+k]||0!==n[16+k]||0!==n[24+k]||0!==n[32+k]||0!==n[40+k]||0!==n[48+k]||0!==n[56+k]?(i=m*n[0+k]+2048>>12,r=m*n[32+k]+2048>>12,o=n[16+k],a=n[48+k],s=_*(n[8+k]-n[56+k])+2048>>12,y=_*(n[8+k]+n[56+k])+2048>>12,l=n[24+k],g=n[40+k],v=i-r+1>>1,i=i+r+1>>1,r=v,v=o*p+a*d+2048>>12,o=o*d-a*p+2048>>12,a=v,v=s-g+1>>1,s=s+g+1>>1,g=v,v=y+l+1>>1,l=y-l+1>>1,y=v,v=i-a+1>>1,i=i+a+1>>1,a=v,v=r-o+1>>1,r=r+o+1>>1,o=v,v=s*f+y*h+2048>>12,s=s*h-y*f+2048>>12,y=v,v=l*c+g*u+2048>>12,l=l*u-g*c+2048>>12,g=v,n[0+k]=i+y,n[56+k]=i-y,n[8+k]=r+g,n[48+k]=r-g,n[16+k]=o+l,n[40+k]=o-l,n[24+k]=a+s,n[32+k]=a-s):(v=m*n[b+0]+8192>>14,n[0+k]=v,n[8+k]=v,n[16+k]=v,n[24+k]=v,n[32+k]=v,n[40+k]=v,n[48+k]=v,n[56+k]=v)}for(b=0;b<64;++b){var E=t+b,S=n[b];S=S<=-2056/e.bitConversion?0:S>=2024/e.bitConversion?255/e.bitConversion:S+2056/e.bitConversion>>4,e.blockData[E]=S}}function a(e,t){for(var i=t.blocksPerLine,r=t.blocksPerColumn,a=new Int32Array(64),s=0;s<r;s++)for(var l=0;l<i;l++){var u=n(t,s,l);o(t,u,a)}return t.blockData}function s(e){return e<=0?0:e>=255?255:0|e}var l=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),u=4017,c=799,h=3406,f=2276,d=1567,p=3784,m=5793,_=2896;return e.prototype={load:function(e){var t=function(e){this.parse(e),this.onload&&this.onload()}.bind(this);if(e.indexOf("data:")>-1){for(var n=e.indexOf("base64,")+7,i=atob(e.substring(n)),r=new Uint8Array(i.length),o=i.length-1;o>=0;o--)r[o]=i.charCodeAt(o);t(i)}else{var a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="arraybuffer",a.onload=function(){var e=new Uint8Array(a.response);t(e)}.bind(this),a.send(null)}},parse:function(e){function n(){var t=e[h]<<8|e[h+1];return h+=2,t}function o(){var t=n(),i=e.subarray(h,h+t-2);return h+=i.length,i}function s(e){for(var t=Math.ceil(e.samplesPerLine/8/e.maxH),n=Math.ceil(e.scanLines/8/e.maxV),i=0;i<e.components.length;i++){N=e.components[i];var r=Math.ceil(Math.ceil(e.samplesPerLine/8)*N.h/e.maxH),o=Math.ceil(Math.ceil(e.scanLines/8)*N.v/e.maxV),a=t*N.h,s=n*N.v,l=64*s*(a+1);N.blockData=new Int16Array(l),N.blocksPerLine=r,N.blocksPerColumn=o}e.mcusPerLine=t,e.mcusPerColumn=n}var u,c,h=0,f=(e.length,null),d=null,p=[],m=[],_=[],g=n();if(65496!=g)throw"SOI not found";for(g=n();65497!=g;){var y,v,b;switch(g){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var w=o();65504===g&&74===w[0]&&70===w[1]&&73===w[2]&&70===w[3]&&0===w[4]&&(f={version:{major:w[5],minor:w[6]},densityUnits:w[7],xDensity:w[8]<<8|w[9],yDensity:w[10]<<8|w[11],thumbWidth:w[12],thumbHeight:w[13],thumbData:w.subarray(14,14+3*w[12]*w[13])}),65518===g&&65===w[0]&&100===w[1]&&111===w[2]&&98===w[3]&&101===w[4]&&0===w[5]&&(d={version:w[6],flags0:w[7]<<8|w[8],flags1:w[9]<<8|w[10],transformCode:w[11]});break;case 65499:for(var x=n(),k=x+h-2;h<k;){var E=e[h++],S=new Int32Array(64);if(E>>4===0)for(v=0;v<64;v++){var I=l[v];S[I]=e[h++]}else{if(E>>4!==1)throw"DQT: invalid table spec";for(v=0;v<64;v++){var T=l[v];S[T]=n()}}p[15&E]=S}break;case 65472:case 65473:case 65474:if(u)throw"Only single frame JPEGs supported";n(),u={},u.extended=65473===g,u.progressive=65474===g,u.precision=e[h++],u.scanLines=n(),u.samplesPerLine=n(),u.components=[],u.componentIds={};var P,A=e[h++],D=0,O=0;for(y=0;y<A;y++){P=e[h];var M=e[h+1]>>4,C=15&e[h+1];D<M&&(D=M),O<C&&(O=C);var R=e[h+2];b=u.components.push({h:M,v:C,quantizationTable:p[R],quantizationTableId:R,bitConversion:255/((1<<u.precision)-1)}),u.componentIds[P]=b-1,h+=3}u.maxH=D,u.maxV=O,s(u);break;case 65476:var L=n();for(y=2;y<L;){var F=e[h++],z=new Uint8Array(16),B=0;for(v=0;v<16;v++,h++)B+=z[v]=e[h];var U=new Uint8Array(B);for(v=0;v<B;v++,h++)U[v]=e[h];y+=17+B,(F>>4===0?_:m)[15&F]=t(z,U)}break;case 65501:n(),c=n();break;case 65498:var N,j=(n(),e[h++]),V=[];for(y=0;y<j;y++){var H=u.componentIds[e[h++]];N=u.components[H];var q=e[h++];N.huffmanTableDC=_[q>>4],N.huffmanTableAC=m[15&q],V.push(N)}var G=e[h++],Z=e[h++],Y=e[h++],W=r(e,h,u,V,c,G,Z,Y>>4,15&Y);h+=W;break;default:if(255==e[h-3]&&e[h-2]>=192&&e[h-2]<=254){h-=3;break}throw"unknown JPEG marker "+g.toString(16)}g=n()}switch(this.width=u.samplesPerLine,this.height=u.scanLines,this.jfif=f,this.adobe=d,this.components=[],u.components.length){case 1:this.colorspace=i.Grayscale;break;case 3:this.adobe?this.colorspace=i.AdobeRGB:this.colorspace=i.RGB;break;case 4:this.colorspace=i.CYMK;break;default:this.colorspace=i.Unknown}for(var y=0;y<u.components.length;y++){var N=u.components[y];N.quantizationTable||null===N.quantizationTableId||(N.quantizationTable=p[N.quantizationTableId]),this.components.push({output:a(u,N),scaleX:N.h/u.maxH,scaleY:N.v/u.maxV,blocksPerLine:N.blocksPerLine,blocksPerColumn:N.blocksPerColumn,bitConversion:N.bitConversion})}},getData16:function(e,t){if(1!==this.components.length)throw"Unsupported color mode";var i,r,o,a,s,l,u=this.width/e,c=this.height/t,h=0,f=this.components.length,d=e*t*f,p=new Uint16Array(d),m=new Uint16Array((this.components[0].blocksPerLine<<3)*this.components[0].blocksPerColumn*8);for(l=0;l<f;l++){i=this.components[l];for(var _,g,y=i.blocksPerLine,v=i.blocksPerColumn,b=y<<3,w=0,x=0;x<v;x++)for(var k=x<<3,E=0;E<y;E++){var S=n(i,x,E),h=0,I=E<<3;for(_=0;_<8;_++){var w=(k+_)*b;for(g=0;g<8;g++)m[w+I+g]=i.output[S+h++]}}r=i.scaleX*u,o=i.scaleY*c,h=l;var T,P,A;for(s=0;s<t;s++)for(a=0;a<e;a++)P=0|s*o,T=0|a*r,A=P*b+T,p[h]=m[A],h+=f}return p},getData:function(e,t){var i,r,o,a,l,u,c,h,f,d,p,m,_,g,y,v=this.width/e,b=this.height/t,w=0,x=this.components.length,k=e*t*x,E=new Uint8Array(k),S=new Uint8Array((this.components[0].blocksPerLine<<3)*this.components[0].blocksPerColumn*8);for(u=0;u<x;u++){i=this.components[u];for(var I,T,P=i.blocksPerLine,A=i.blocksPerColumn,D=P<<3,O=0,M=0;M<A;M++)for(var C=M<<3,R=0;R<P;R++){var L=n(i,M,R),w=0,F=R<<3;for(I=0;I<8;I++){var O=(C+I)*D;for(T=0;T<8;T++)S[O+F+T]=i.output[L+w++]*i.bitConversion}}r=i.scaleX*v,o=i.scaleY*b,w=u;var z,B,U;for(l=0;l<t;l++)for(a=0;a<e;a++)B=0|l*o,z=0|a*r,U=B*D+z,E[w]=S[U],w+=x}switch(x){case 1:case 2:break;case 3:if(y=!0,this.adobe&&this.adobe.transformCode?y=!0:"undefined"!=typeof this.colorTransform&&(y=!!this.colorTransform),y)for(u=0;u<k;u+=x)c=E[u],h=E[u+1],f=E[u+2],m=s(c-179.456+1.402*f),_=s(c+135.459-.344*h-.714*f),g=s(c-226.816+1.772*h),E[u]=m,E[u+1]=_,E[u+2]=g;break;case 4:if(!this.adobe)throw"Unsupported color mode (4 components)";if(y=!1,this.adobe&&this.adobe.transformCode?y=!0:"undefined"!=typeof this.colorTransform&&(y=!!this.colorTransform),y)for(u=0;u<k;u+=x)c=E[u],h=E[u+1],f=E[u+2],d=s(434.456-c-1.402*f),p=s(119.541-c+.344*h+.714*f),c=s(481.816-c-1.772*h),E[u]=d,E[u+1]=p,E[u+2]=c;break;default:throw"Unsupported color mode"}return E}},e}(),o=typeof t;"undefined"!==o&&t.exports&&(t.exports=r)},{}],2:[function(e,t,n){"use strict";function i(e){PDFJS.verbosity>=PDFJS.VERBOSITY_LEVELS.infos&&console.log("Info: "+e)}function r(e){PDFJS.verbosity>=PDFJS.VERBOSITY_LEVELS.warnings&&console.log("Warning: "+e)}function o(e){if(arguments.length>1){var t=["Error:"];t.push.apply(t,arguments),console.log.apply(console,t),e=[].join.call(arguments," ")}else console.log("Error: "+e);throw console.log(a()),b.notify(v.unknown),new Error(e)}function a(){try{throw new Error}catch(e){return e.stack?e.stack.split("\n").slice(2).join("\n"):""}}function s(e,t){if(!e)return!1;var n=/^[a-z][a-z0-9+\-.]*(?=:)/i.exec(e);if(!n)return t;switch(n=n[0].toLowerCase()){case"http":case"https":case"ftp":case"mailto":case"tel":return!0;default:return!1}}function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!1}),n}function u(e){for(var t=1,n=0;e>t;)t<<=1,n++;return n}function c(e,t){return e[t]<<8|e[t+1]}function h(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}function f(){var e=new Uint8Array(2);e[0]=1;var t=new Uint16Array(e.buffer);return 1===t[0]}function d(){var e=document.createElement("canvas");e.width=e.height=1;var t=e.getContext("2d"),n=t.createImageData(1,1);return"undefined"!=typeof n.data.buffer}function p(){var e={};return e.promise=new Promise(function(t,n){e.resolve=t,e.reject=n}),e}function m(e,t){this.name=e,this.comObj=t,this.callbackIndex=1,this.postMessageTransfers=!0;var n=this.callbacksCapabilities={},i=this.actionHandler={};i.console_log=[function(e){console.log.apply(console,e)}],i.console_error=[function(e){console.error.apply(console,e)}],i._unsupported_feature=[function(e){b.notify(e)}],t.onmessage=function(e){var r=e.data;if(r.isReply){var a=r.callbackId;if(r.callbackId in n){var s=n[a];delete n[a],"error"in r?s.reject(r.error):s.resolve(r.data)}else o("Cannot resolve callback "+a)}else if(r.action in i){var l=i[r.action];r.callbackId?Promise.resolve().then(function(){return l[0].call(l[1],r.data)}).then(function(e){t.postMessage({isReply:!0,callbackId:r.callbackId,data:e})},function(e){t.postMessage({isReply:!0,callbackId:r.callbackId,error:e})}):l[0].call(l[1],r.data)}else o("Unknown action from worker: "+r.action)}}var _=function(){function e(){this.failOnCorruptedImage=!1}function t(e,t){e.x0=Math.ceil(t.XOsiz/e.XRsiz),e.x1=Math.ceil(t.Xsiz/e.XRsiz),e.y0=Math.ceil(t.YOsiz/e.YRsiz),e.y1=Math.ceil(t.Ysiz/e.YRsiz),e.width=e.x1-e.x0,e.height=e.y1-e.y0}function n(e,t){for(var n,i=e.SIZ,r=[],o=Math.ceil((i.Xsiz-i.XTOsiz)/i.XTsiz),a=Math.ceil((i.Ysiz-i.YTOsiz)/i.YTsiz),s=0;s<a;s++)for(var l=0;l<o;l++)n={},n.tx0=Math.max(i.XTOsiz+l*i.XTsiz,i.XOsiz),n.ty0=Math.max(i.YTOsiz+s*i.YTsiz,i.YOsiz),n.tx1=Math.min(i.XTOsiz+(l+1)*i.XTsiz,i.Xsiz),n.ty1=Math.min(i.YTOsiz+(s+1)*i.YTsiz,i.Ysiz),n.width=n.tx1-n.tx0,n.height=n.ty1-n.ty0,n.components=[],r.push(n);e.tiles=r;for(var u=i.Csiz,c=0,h=u;c<h;c++)for(var f=t[c],d=0,p=r.length;d<p;d++){var m={};n=r[d],m.tcx0=Math.ceil(n.tx0/f.XRsiz),m.tcy0=Math.ceil(n.ty0/f.YRsiz),m.tcx1=Math.ceil(n.tx1/f.XRsiz),m.tcy1=Math.ceil(n.ty1/f.YRsiz),m.width=m.tcx1-m.tcx0,m.height=m.tcy1-m.tcy0,n.components[c]=m}}function o(e,t,n){var i=t.codingStyleParameters,r={};return i.entropyCoderWithCustomPrecincts?(r.PPx=i.precinctsSizes[n].PPx,r.PPy=i.precinctsSizes[n].PPy):(r.PPx=15,r.PPy=15),r.xcb_=n>0?Math.min(i.xcb,r.PPx-1):Math.min(i.xcb,r.PPx),r.ycb_=n>0?Math.min(i.ycb,r.PPy-1):Math.min(i.ycb,r.PPy),r}function a(e,t,n){var i=1<<n.PPx,r=1<<n.PPy,o=0===t.resLevel,a=1<<n.PPx+(o?0:-1),s=1<<n.PPy+(o?0:-1),l=t.trx1>t.trx0?Math.ceil(t.trx1/i)-Math.floor(t.trx0/i):0,u=t.try1>t.try0?Math.ceil(t.try1/r)-Math.floor(t.try0/r):0,c=l*u;t.precinctParameters={precinctWidth:i,precinctHeight:r,numprecinctswide:l,numprecinctshigh:u,numprecincts:c,precinctWidthInSubband:a,precinctHeightInSubband:s}}function s(e,t,n){var i,r,o,a,s=n.xcb_,l=n.ycb_,u=1<<s,c=1<<l,h=t.tbx0>>s,f=t.tby0>>l,d=t.tbx1+u-1>>s,p=t.tby1+c-1>>l,m=t.resolution.precinctParameters,_=[],g=[];for(r=f;r<p;r++)for(i=h;i<d;i++){o={cbx:i,cby:r,tbx0:u*i,tby0:c*r,tbx1:u*(i+1),tby1:c*(r+1)},o.tbx0_=Math.max(t.tbx0,o.tbx0),o.tby0_=Math.max(t.tby0,o.tby0),o.tbx1_=Math.min(t.tbx1,o.tbx1),o.tby1_=Math.min(t.tby1,o.tby1);var y=Math.floor((o.tbx0_-t.tbx0)/m.precinctWidthInSubband),v=Math.floor((o.tby0_-t.tby0)/m.precinctHeightInSubband);if(a=y+v*m.numprecinctswide,o.precinctNumber=a,o.subbandType=t.type,o.Lblock=3,!(o.tbx1_<=o.tbx0_||o.tby1_<=o.tby0_)){_.push(o);var b=g[a];void 0!==b?(i<b.cbxMin?b.cbxMin=i:i>b.cbxMax&&(b.cbxMax=i),r<b.cbyMin?b.cbxMin=r:r>b.cbyMax&&(b.cbyMax=r)):g[a]=b={cbxMin:i,cbyMin:r,cbxMax:i,cbyMax:r},o.precinct=b}}t.codeblockParameters={codeblockWidth:s,codeblockHeight:l,numcodeblockwide:d-h+1,numcodeblockhigh:p-f+1},t.codeblocks=_,t.precincts=g}function l(e,t,n){for(var i=[],r=e.subbands,o=0,a=r.length;o<a;o++)for(var s=r[o],l=s.codeblocks,u=0,c=l.length;u<c;u++){var h=l[u];h.precinctNumber===t&&i.push(h)}return{layerNumber:n,codeblocks:i}}function f(e){for(var t=e.SIZ,n=e.currentTile.index,i=e.tiles[n],r=i.codingStyleDefaultParameters.layersCount,o=t.Csiz,a=0,s=0;s<o;s++)a=Math.max(a,i.components[s].codingStyleParameters.decompositionLevelsCount);var u=0,c=0,h=0,f=0;this.nextPacket=function(){for(;u<r;u++){for(;c<=a;c++){for(;h<o;h++){var e=i.components[h];if(!(c>e.codingStyleParameters.decompositionLevelsCount)){for(var t=e.resolutions[c],n=t.precinctParameters.numprecincts;f<n;){var s=l(t,f,u);return f++,s}f=0}}h=0}c=0}}}function d(e){for(var t=e.SIZ,n=e.currentTile.index,i=e.tiles[n],r=i.codingStyleDefaultParameters.layersCount,o=t.Csiz,a=0,s=0;s<o;s++)a=Math.max(a,i.components[s].codingStyleParameters.decompositionLevelsCount);var u=0,c=0,h=0,f=0;this.nextPacket=function(){for(;u<=a;u++){for(;c<r;c++){for(;h<o;h++){var e=i.components[h];if(!(u>e.codingStyleParameters.decompositionLevelsCount)){for(var t=e.resolutions[u],n=t.precinctParameters.numprecincts;f<n;){var s=l(t,f,c);return f++,s}f=0}}h=0}c=0}}}function p(e){var t,n,i,r,o=e.SIZ,a=e.currentTile.index,s=e.tiles[a],u=s.codingStyleDefaultParameters.layersCount,c=o.Csiz,h=0;for(i=0;i<c;i++){var f=s.components[i];h=Math.max(h,f.codingStyleParameters.decompositionLevelsCount)}var d=new Int32Array(h+1);for(n=0;n<=h;++n){var p=0;for(i=0;i<c;++i){var m=s.components[i].resolutions;n<m.length&&(p=Math.max(p,m[n].precinctParameters.numprecincts))}d[n]=p}t=0,n=0,i=0,r=0,this.nextPacket=function(){for(;n<=h;n++){for(;r<d[n];r++){for(;i<c;i++){var e=s.components[i];if(!(n>e.codingStyleParameters.decompositionLevelsCount)){var o=e.resolutions[n],a=o.precinctParameters.numprecincts;if(!(r>=a)){for(;t<u;){var f=l(o,r,t);return t++,f}t=0}}}i=0}r=0}}}function m(e){var t=e.SIZ,n=e.currentTile.index,i=e.tiles[n],r=i.codingStyleDefaultParameters.layersCount,o=t.Csiz,a=v(i),s=a,u=0,c=0,h=0,f=0,d=0;this.nextPacket=function(){for(;d<s.maxNumHigh;d++){for(;f<s.maxNumWide;f++){for(;h<o;h++){for(var e=i.components[h],t=e.codingStyleParameters.decompositionLevelsCount;c<=t;c++){var n=e.resolutions[c],p=a.components[h].resolutions[c],m=y(f,d,p,s,n);if(null!==m){for(;u<r;){var _=l(n,m,u);return u++,_}u=0}}c=0}h=0}f=0}}}function _(e){var t=e.SIZ,n=e.currentTile.index,i=e.tiles[n],r=i.codingStyleDefaultParameters.layersCount,o=t.Csiz,a=v(i),s=0,u=0,c=0,h=0,f=0;this.nextPacket=function(){for(;c<o;++c){for(var e=i.components[c],t=a.components[c],n=e.codingStyleParameters.decompositionLevelsCount;f<t.maxNumHigh;f++){for(;h<t.maxNumWide;h++){for(;u<=n;u++){var d=e.resolutions[u],p=t.resolutions[u],m=y(h,f,p,t,d);if(null!==m){for(;s<r;){var _=l(d,m,s);return s++,_}s=0}}u=0}h=0}f=0}}}function y(e,t,n,i,r){var o=e*i.minWidth,a=t*i.minHeight;if(o%n.width!==0||a%n.height!==0)return null;var s=a/n.width*r.precinctParameters.numprecinctswide;return o/n.height+s}function v(e){for(var t=e.components.length,n=Number.MAX_VALUE,i=Number.MAX_VALUE,r=0,o=0,a=new Array(t),s=0;s<t;s++){for(var l=e.components[s],u=l.codingStyleParameters.decompositionLevelsCount,c=new Array(u+1),h=Number.MAX_VALUE,f=Number.MAX_VALUE,d=0,p=0,m=1,_=u;_>=0;--_){var g=l.resolutions[_],y=m*g.precinctParameters.precinctWidth,v=m*g.precinctParameters.precinctHeight;h=Math.min(h,y),f=Math.min(f,v),d=Math.max(d,g.precinctParameters.numprecinctswide),p=Math.max(p,g.precinctParameters.numprecinctshigh),c[_]={width:y,height:v},m<<=1}n=Math.min(n,h),i=Math.min(i,f),r=Math.max(r,d),o=Math.max(o,p),a[s]={resolutions:c,minWidth:h,minHeight:f,maxNumWide:d,maxNumHigh:p}}return{components:a,minWidth:n,minHeight:i,maxNumWide:r,maxNumHigh:o}}function b(e){for(var t=e.SIZ,n=e.currentTile.index,i=e.tiles[n],r=t.Csiz,l=0;l<r;l++){for(var u=i.components[l],c=u.codingStyleParameters.decompositionLevelsCount,h=[],g=[],y=0;y<=c;y++){var v=o(e,u,y),b={},w=1<<c-y;b.trx0=Math.ceil(u.tcx0/w),b.try0=Math.ceil(u.tcy0/w),b.trx1=Math.ceil(u.tcx1/w),b.try1=Math.ceil(u.tcy1/w),b.resLevel=y,a(e,b,v),h.push(b);var x;if(0===y)x={},x.type="LL",x.tbx0=Math.ceil(u.tcx0/w),x.tby0=Math.ceil(u.tcy0/w),x.tbx1=Math.ceil(u.tcx1/w),x.tby1=Math.ceil(u.tcy1/w),x.resolution=b,s(e,x,v),g.push(x),b.subbands=[x];else{var k=1<<c-y+1,E=[];x={},x.type="HL",x.tbx0=Math.ceil(u.tcx0/k-.5),x.tby0=Math.ceil(u.tcy0/k),x.tbx1=Math.ceil(u.tcx1/k-.5),x.tby1=Math.ceil(u.tcy1/k),x.resolution=b,s(e,x,v),g.push(x),E.push(x),x={},x.type="LH",x.tbx0=Math.ceil(u.tcx0/k),x.tby0=Math.ceil(u.tcy0/k-.5),x.tbx1=Math.ceil(u.tcx1/k),x.tby1=Math.ceil(u.tcy1/k-.5),x.resolution=b,s(e,x,v),g.push(x),E.push(x),x={},x.type="HH",x.tbx0=Math.ceil(u.tcx0/k-.5),x.tby0=Math.ceil(u.tcy0/k-.5),x.tbx1=Math.ceil(u.tcx1/k-.5),x.tby1=Math.ceil(u.tcy1/k-.5),x.resolution=b,s(e,x,v),g.push(x),E.push(x),b.subbands=E}}u.resolutions=h,u.subbands=g}var S=i.codingStyleDefaultParameters.progressionOrder;switch(S){case 0:i.packetsIterator=new f(e);break;case 1:i.packetsIterator=new d(e);break;case 2:i.packetsIterator=new p(e);break;case 3:i.packetsIterator=new m(e);break;case 4:i.packetsIterator=new _(e);break;default:throw new Error("JPX Error: Unsupported progression order "+S)}}function w(e,t,n,i){function r(e){for(;f<e;){if(n+h>=t.length)throw new Error("Unexpected EOF");var i=t[n+h];h++,d?(c=c<<7|i,f+=7,d=!1):(c=c<<8|i,f+=8),255===i&&(d=!0)}return f-=e,c>>>f&(1<<e)-1}function o(e){return 255===t[n+h-1]&&t[n+h]===e?(a(1),!0):255===t[n+h]&&t[n+h+1]===e&&(a(2),!0)}function a(e){h+=e}function s(){f=0,d&&(h++,d=!1)}function l(){if(0===r(1))return 1;if(0===r(1))return 2;var e=r(2);return e<3?e+3:(e=r(5),e<31?e+6:(e=r(7),e+37))}for(var c,h=0,f=0,d=!1,p=e.currentTile.index,m=e.tiles[p],_=e.COD.sopMarkerUsed,g=e.COD.ephMarkerUsed,y=m.packetsIterator;h<i;)try{s(),_&&o(145)&&a(4);var v=y.nextPacket();if(void 0===v)return;if(!r(1))continue;for(var b,w=v.layerNumber,x=[],k=0,E=v.codeblocks.length;k<E;k++){b=v.codeblocks[k];var S,I=b.precinct,A=b.cbx-I.cbxMin,D=b.cby-I.cbyMin,O=!1,M=!1;if(void 0!==b.included)O=!!r(1);else{I=b.precinct;var C,R;if(void 0!==I.inclusionTree)C=I.inclusionTree;else{var L=I.cbxMax-I.cbxMin+1,F=I.cbyMax-I.cbyMin+1;C=new P(L,F),R=new T(L,F),I.inclusionTree=C,I.zeroBitPlanesTree=R}for(C.reset(A,D,w);;){if(h>=t.length)return;if(C.isAboveThreshold())break;if(C.isKnown())C.nextLevel();else if(r(1)){if(C.setKnown(),C.isLeaf()){b.included=!0,O=M=!0;break}C.nextLevel()}else C.incrementValue()}}if(O){if(M){for(R=I.zeroBitPlanesTree,R.reset(A,D);;){if(h>=t.length)return;if(r(1)){if(S=!R.nextLevel())break}else R.incrementValue()}b.zeroBitPlanes=R.value}for(var z=l();r(1);)b.Lblock++;var B=u(z),U=(z<1<<B?B-1:B)+b.Lblock,N=r(U);x.push({codeblock:b,codingpasses:z,dataLength:N})}}for(s(),g&&o(146);x.length>0;){var j=x.shift();b=j.codeblock,void 0===b.data&&(b.data=[]),b.data.push({data:t,start:n+h,end:n+h+j.dataLength,codingpasses:j.codingpasses}),h+=j.dataLength}}catch(e){return}return h}function x(e,t,n,i,r,o,a,s){for(var l=i.tbx0,u=i.tby0,c=i.tbx1-i.tbx0,h=i.codeblocks,f="H"===i.type.charAt(0)?1:0,d="H"===i.type.charAt(1)?t:0,p=0,m=h.length;p<m;++p){var _=h[p],y=_.tbx1_-_.tbx0_,v=_.tby1_-_.tby0_;if(0!==y&&0!==v&&void 0!==_.data){var b,w;b=new A(y,v,_.subbandType,_.zeroBitPlanes,o),w=2;var x,k,E,S=_.data,I=0,T=0;for(x=0,k=S.length;x<k;x++)E=S[x],I+=E.end-E.start,T+=E.codingpasses;var P=new Int16Array(I),D=0;for(x=0,k=S.length;x<k;x++){E=S[x];var O=E.data.subarray(E.start,E.end);P.set(O,D),D+=O.length}var M=new g(P,0,I);for(b.setDecoder(M),x=0;x<T;x++){switch(w){case 0:b.runSignificancePropogationPass();break;case 1:b.runMagnitudeRefinementPass();break;case 2:b.runCleanupPass(),s&&b.checkSegmentationSymbol()}w=(w+1)%3}var C,R,L,F=_.tbx0_-l+(_.tby0_-u)*c,z=b.coefficentsSign,B=b.coefficentsMagnitude,U=b.bitsDecoded,N=a?0:.5;D=0;var j="LL"!==i.type;for(x=0;x<v;x++){var V=F/c|0,H=2*V*(t-c)+f+d;for(C=0;C<y;C++){if(R=B[D],0!==R){R=(R+N)*r,0!==z[D]&&(R=-R),L=U[D];var q=j?H+(F<<1):F;a&&L>=o?e[q]=R:e[q]=R*(1<<o-L)}F++,D++}F+=c-y}}}}function k(e,t,n){for(var i=t.components[n],r=i.codingStyleParameters,o=i.quantizationParameters,a=r.decompositionLevelsCount,s=o.SPqcds,l=o.scalarExpounded,u=o.guardBits,c=r.segmentationSymbolUsed,h=e.components[n].precision,f=r.reversibleTransformation,d=f?new M:new O,p=[],m=0,_=0;_<=a;_++){for(var g=i.resolutions[_],y=g.trx1-g.trx0,v=g.try1-g.try0,b=new Float32Array(y*v),w=0,k=g.subbands.length;w<k;w++){var E,S;l?(E=s[m].mu,S=s[m].epsilon,m++):(E=s[0].mu,S=s[0].epsilon+(_>0?1-_:0));var T=g.subbands[w],P=I[T.type],A=f?1:Math.pow(2,h+P-S)*(1+E/2048),D=u+S-1;x(b,y,v,T,A,D,f,c)}p.push({width:y,height:v,items:b})}var C=d.calculate(p,i.tcx0,i.tcy0);return{left:i.tcx0,top:i.tcy0,width:C.width,height:C.height,items:C.items}}function E(e){for(var t=e.SIZ,n=e.components,i=t.Csiz,r=[],o=0,a=e.tiles.length;o<a;o++){var s,l=e.tiles[o],u=[];for(s=0;s<i;s++)u[s]=k(e,l,s);var c=u[0],h=n[0].isSigned;if(h)var f=new Int16Array(c.items.length*i);else var f=new Uint16Array(c.items.length*i);var d,p,m,_,g,y,v,b,w,x,E,S,I,T,P,A={left:c.left,top:c.top,width:c.width,height:c.height,items:f},D=0;if(l.codingStyleDefaultParameters.multipleComponentTransform){var O=4===i,M=u[0].items,C=u[1].items,R=u[2].items,L=O?u[3].items:null;d=n[0].precision-8,p=(128<<d)+.5,m=255*(1<<d),g=.5*m,_=-g;var F=l.components[0],z=i-3;if(v=M.length,F.codingStyleParameters.reversibleTransformation)for(y=0;y<v;y++,D+=z)b=M[y]+p,w=C[y],x=R[y],S=b-(x+w>>2),E=S+x,I=S+w,f[D++]=E<=0?0:E>=m?255:E>>d,f[D++]=S<=0?0:S>=m?255:S>>d,f[D++]=I<=0?0:I>=m?255:I>>d;else for(y=0;y<v;y++,D+=z)b=M[y]+p,w=C[y],x=R[y],E=b+1.402*x,S=b-.34413*w-.71414*x,I=b+1.772*w,f[D++]=E<=0?0:E>=m?255:E>>d,f[D++]=S<=0?0:S>=m?255:S>>d,f[D++]=I<=0?0:I>=m?255:I>>d;if(O)for(y=0,D=3;y<v;y++,D+=4)T=L[y],f[D]=T<=_?0:T>=g?255:T+p>>d}else for(s=0;s<i;s++)if(8===n[s].precision){var B=u[s].items;for(d=n[s].precision-8,p=(128<<d)+.5,m=127.5*(1<<d),_=-m,D=s,y=0,v=B.length;y<v;y++)P=B[y],f[D]=P<=_?0:P>=m?255:P+p>>d,D+=i}else{var h=n[s].isSigned,B=u[s].items;if(h)for(D=s,y=0,v=B.length;y<v;y++)f[D]=B[y],D+=i;else{d=n[s].precision-8,p=(128<<d)+.5;var U=Math.pow(2,n[s].precision)-1;for(D=s,y=0,v=B.length;y<v;y++)P=B[y],f[D]=Math.max(Math.min(P+p,U),0),D+=i}}r.push(A)}return r}function S(e,t){for(var n=e.SIZ,i=n.Csiz,r=e.tiles[t],o=0;o<i;o++){var a=r.components[o],s=void 0!==e.currentTile.QCC[o]?e.currentTile.QCC[o]:e.currentTile.QCD;a.quantizationParameters=s;var l=void 0!==e.currentTile.COC[o]?e.currentTile.COC[o]:e.currentTile.COD;a.codingStyleParameters=l}r.codingStyleDefaultParameters=e.currentTile.COD}var I={LL:0,LH:1,HL:1,HH:2};e.prototype={parse:function(e){var t=c(e,0);if(65359===t)return void this.parseCodestream(e,0,e.length);for(var n=0,o=e.length;n<o;){var a=8,s=h(e,n),l=h(e,n+4);if(n+=a,1===s&&(s=4294967296*h(e,n)+h(e,n+4),n+=8,a+=8),0===s&&(s=o-n+a),s<a)throw new Error("JPX Error: Invalid box field size");var u=s-a,f=!0;switch(l){case 1785737832:f=!1;break;case 1668246642:var d=e[n];e[n+1],e[n+2];if(1===d){var p=h(e,n+3);switch(p){case 16:case 17:case 18:break;default:r("Unknown colorspace "+p)}}else 2===d&&i("ICC profile not supported");break;case 1785737827:this.parseCodestream(e,n,n+u);break;case 1783636e3:218793738!==h(e,n)&&r("Invalid JP2 signature");break;case 1783634458:case 1718909296:case 1920099697:case 1919251232:case 1768449138:break;default:var m=String.fromCharCode(l>>24&255,l>>16&255,l>>8&255,255&l);r("Unsupported header type "+l+" ("+m+")")}f&&(n+=u)}},parseImageProperties:function(e){for(var t=e.getByte();t>=0;){var n=t;t=e.getByte();var i=n<<8|t;if(65361===i){e.skip(4);var r=e.getInt32()>>>0,o=e.getInt32()>>>0,a=e.getInt32()>>>0,s=e.getInt32()>>>0;e.skip(16);var l=e.getUint16();return this.width=r-a,this.height=o-s,this.componentsCount=l,void(this.bitsPerComponent=8)}}throw new Error("JPX Error: No size marker found in JPX stream")},parseCodestream:function(e,i,o){var a={};try{for(var s=!1,l=i;l+1<o;){var u=c(e,l);l+=2;var f,d,p,m,_,g,y=0;switch(u){case 65359:a.mainHeader=!0;break;case 65497:break;case 65361:y=c(e,l);var v={};v.Xsiz=h(e,l+4),v.Ysiz=h(e,l+8),v.XOsiz=h(e,l+12),v.YOsiz=h(e,l+16),v.XTsiz=h(e,l+20),v.YTsiz=h(e,l+24),v.XTOsiz=h(e,l+28),v.YTOsiz=h(e,l+32);var x=c(e,l+36);v.Csiz=x;var k=[];f=l+38;for(var I=0;I<x;I++){var T={precision:(127&e[f])+1,isSigned:!!(128&e[f]),XRsiz:e[f+1],YRsiz:e[f+1]};t(T,v),k.push(T)}a.SIZ=v,a.components=k,n(a,k),a.QCC=[],a.COC=[];break;case 65372:y=c(e,l);var P={};switch(f=l+2,d=e[f++],31&d){case 0:m=8,_=!0;break;case 1:m=16,_=!1;break;case 2:m=16,_=!0;break;default:throw new Error("JPX Error: Invalid SQcd value "+d)}for(P.noQuantization=8===m,P.scalarExpounded=_,P.guardBits=d>>5,p=[];f<y+l;){var A={};8===m?(A.epsilon=e[f++]>>3,A.mu=0):(A.epsilon=e[f]>>3,A.mu=(7&e[f])<<8|e[f+1],f+=2),p.push(A)}P.SPqcds=p,a.mainHeader?a.QCD=P:(a.currentTile.QCD=P,a.currentTile.QCC=[]);break;case 65373:y=c(e,l);var D={};f=l+2;var O;switch(a.SIZ.Csiz<257?O=e[f++]:(O=c(e,f),f+=2),d=e[f++],31&d){case 0:m=8,_=!0;break;case 1:m=16,_=!1;break;case 2:m=16,_=!0;break;default:throw new Error("JPX Error: Invalid SQcd value "+d)}for(D.noQuantization=8===m,D.scalarExpounded=_,D.guardBits=d>>5,p=[];f<y+l;)A={},8===m?(A.epsilon=e[f++]>>3,A.mu=0):(A.epsilon=e[f]>>3,A.mu=(7&e[f])<<8|e[f+1],f+=2),p.push(A);D.SPqcds=p,a.mainHeader?a.QCC[O]=D:a.currentTile.QCC[O]=D;break;case 65362:y=c(e,l);var M={};f=l+2;var C=e[f++];M.entropyCoderWithCustomPrecincts=!!(1&C),M.sopMarkerUsed=!!(2&C),M.ephMarkerUsed=!!(4&C),M.progressionOrder=e[f++],M.layersCount=c(e,f),f+=2,M.multipleComponentTransform=e[f++],M.decompositionLevelsCount=e[f++],M.xcb=(15&e[f++])+2,M.ycb=(15&e[f++])+2;var R=e[f++];if(M.selectiveArithmeticCodingBypass=!!(1&R),M.resetContextProbabilities=!!(2&R),M.terminationOnEachCodingPass=!!(4&R),M.verticalyStripe=!!(8&R),M.predictableTermination=!!(16&R),M.segmentationSymbolUsed=!!(32&R),M.reversibleTransformation=e[f++],M.entropyCoderWithCustomPrecincts){for(var L=[];f<y+l;){var F=e[f++];L.push({PPx:15&F,PPy:F>>4})}M.precinctsSizes=L}var z=[];if(M.selectiveArithmeticCodingBypass&&z.push("selectiveArithmeticCodingBypass"),M.resetContextProbabilities&&z.push("resetContextProbabilities"),M.terminationOnEachCodingPass&&z.push("terminationOnEachCodingPass"),M.verticalyStripe&&z.push("verticalyStripe"),M.predictableTermination&&z.push("predictableTermination"),z.length>0)throw s=!0,new Error("JPX Error: Unsupported COD options ("+z.join(", ")+")");a.mainHeader?a.COD=M:(a.currentTile.COD=M,a.currentTile.COC=[]);break;case 65424:y=c(e,l),g={},g.index=c(e,l+2),g.length=h(e,l+4),g.dataEnd=g.length+l-2,g.partIndex=e[l+8],g.partsCount=e[l+9],a.mainHeader=!1,0===g.partIndex&&(g.COD=a.COD,g.COC=a.COC.slice(0),g.QCD=a.QCD,g.QCC=a.QCC.slice(0)),a.currentTile=g;break;case 65427:g=a.currentTile,0===g.partIndex&&(S(a,g.index),b(a)),y=g.dataEnd-l,w(a,e,l,y);break;case 65365:case 65367:case 65368:case 65380:y=c(e,l);break;case 65363:throw new Error("JPX Error: Codestream code 0xFF53 (COC) is not implemented");default:throw new Error("JPX Error: Unknown codestream code: "+u.toString(16))}l+=y}}catch(e){if(s||this.failOnCorruptedImage)throw e;r("Trying to recover from "+e.message)}this.tiles=E(a),this.width=a.SIZ.Xsiz-a.SIZ.XOsiz,this.height=a.SIZ.Ysiz-a.SIZ.YOsiz,this.componentsCount=a.SIZ.Csiz}};var T=function(){function e(e,t){var n=u(Math.max(e,t))+1;this.levels=[];for(var i=0;i<n;i++){var r={width:e,height:t,items:[]};this.levels.push(r),e=Math.ceil(e/2),t=Math.ceil(t/2)}}return e.prototype={reset:function(e,t){for(var n,i=0,r=0;i<this.levels.length;){n=this.levels[i];var o=e+t*n.width;if(void 0!==n.items[o]){r=n.items[o];break}n.index=o,e>>=1,t>>=1,i++}i--,n=this.levels[i],n.items[n.index]=r,this.currentLevel=i,delete this.value},incrementValue:function(){var e=this.levels[this.currentLevel];e.items[e.index]++},nextLevel:function(){var e=this.currentLevel,t=this.levels[e],n=t.items[t.index];return e--,e<0?(this.value=n,!1):(this.currentLevel=e,t=this.levels[e],t.items[t.index]=n,!0)}},e}(),P=function(){function e(e,t){
var n=u(Math.max(e,t))+1;this.levels=[];for(var i=0;i<n;i++){for(var r=new Uint8Array(e*t),o=new Uint8Array(e*t),a=0,s=r.length;a<s;a++)r[a]=0,o[a]=0;var l={width:e,height:t,items:r,status:o};this.levels.push(l),e=Math.ceil(e/2),t=Math.ceil(t/2)}}return e.prototype={reset:function(e,t,n){this.currentStopValue=n;for(var i=0;i<this.levels.length;){var r=this.levels[i],o=e+t*r.width;r.index=o,e>>=1,t>>=1,i++}this.currentLevel=this.levels.length-1,this.minValue=this.levels[this.currentLevel].items[0]},incrementValue:function(){var e=this.levels[this.currentLevel];e.items[e.index]=e.items[e.index]+1,e.items[e.index]>this.minValue&&(this.minValue=e.items[e.index])},nextLevel:function(){var e=this.currentLevel;if(e--,e<0)return!1;this.currentLevel=e;var t=this.levels[e];return t.items[t.index]<this.minValue?t.items[t.index]=this.minValue:t.items[t.index]>this.minValue&&(this.minValue=t.items[t.index]),!0},isLeaf:function(){return 0===this.currentLevel},isAboveThreshold:function(){var e=this.currentLevel,t=this.levels[e];return t.items[t.index]>this.currentStopValue},isKnown:function(){var e=this.currentLevel,t=this.levels[e];return t.status[t.index]>0},setKnown:function(){var e=this.currentLevel,t=this.levels[e];t.status[t.index]=1}},e}(),A=function(){function e(e,t,n,a,s){this.width=e,this.height=t,this.contextLabelTable="HH"===n?o:"HL"===n?r:i;var l=e*t;this.neighborsSignificance=new Uint8Array(l),this.coefficentsSign=new Uint8Array(l),this.coefficentsMagnitude=s>14?new Uint32Array(l):s>6?new Uint16Array(l):new Uint8Array(l),this.processingFlags=new Uint8Array(l);var u=new Uint8Array(l);if(0!==a)for(var c=0;c<l;c++)u[c]=a;this.bitsDecoded=u,this.reset()}var t=17,n=18,i=new Uint8Array([0,5,8,0,3,7,8,0,4,7,8,0,0,0,0,0,1,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8]),r=new Uint8Array([0,3,4,0,5,7,7,0,8,8,8,0,0,0,0,0,1,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8]),o=new Uint8Array([0,1,2,0,1,2,2,0,2,2,2,0,0,0,0,0,3,4,5,0,4,5,5,0,5,5,5,0,0,0,0,0,6,7,7,0,7,7,7,0,7,7,7,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8]);return e.prototype={setDecoder:function(e){this.decoder=e},reset:function(){this.contexts=new Int8Array(19),this.contexts[0]=8,this.contexts[t]=92,this.contexts[n]=6},setNeighborsSignificance:function(e,t,n){var i,r=this.neighborsSignificance,o=this.width,a=this.height,s=t>0,l=t+1<o;e>0&&(i=n-o,s&&(r[i-1]+=16),l&&(r[i+1]+=16),r[i]+=4),e+1<a&&(i=n+o,s&&(r[i-1]+=16),l&&(r[i+1]+=16),r[i]+=4),s&&(r[n-1]+=1),l&&(r[n+1]+=1),r[n]|=128},runSignificancePropogationPass:function(){for(var e=this.decoder,t=this.width,n=this.height,i=this.coefficentsMagnitude,r=this.coefficentsSign,o=this.neighborsSignificance,a=this.processingFlags,s=this.contexts,l=this.contextLabelTable,u=this.bitsDecoded,c=-2,h=1,f=2,d=0;d<n;d+=4)for(var p=0;p<t;p++)for(var m=d*t+p,_=0;_<4;_++,m+=t){var g=d+_;if(g>=n)break;if(a[m]&=c,!i[m]&&o[m]){var y=l[o[m]],v=e.readBit(s,y);if(v){var b=this.decodeSignBit(g,p,m);r[m]=b,i[m]=1,this.setNeighborsSignificance(g,p,m),a[m]|=f}u[m]++,a[m]|=h}}},decodeSignBit:function(e,t,n){var i,r,o,a,s,l,u=this.width,c=this.height,h=this.coefficentsMagnitude,f=this.coefficentsSign;a=t>0&&0!==h[n-1],t+1<u&&0!==h[n+1]?(o=f[n+1],a?(r=f[n-1],i=1-o-r):i=1-o-o):a?(r=f[n-1],i=1-r-r):i=0;var d=3*i;return a=e>0&&0!==h[n-u],e+1<c&&0!==h[n+u]?(o=f[n+u],a?(r=f[n-u],i=1-o-r+d):i=1-o-o+d):a?(r=f[n-u],i=1-r-r+d):i=d,i>=0?(s=9+i,l=this.decoder.readBit(this.contexts,s)):(s=9-i,l=1^this.decoder.readBit(this.contexts,s)),l},runMagnitudeRefinementPass:function(){for(var e,t=this.decoder,n=this.width,i=this.height,r=this.coefficentsMagnitude,o=this.neighborsSignificance,a=this.contexts,s=this.bitsDecoded,l=this.processingFlags,u=1,c=2,h=n*i,f=4*n,d=0;d<h;d=e){e=Math.min(h,d+f);for(var p=0;p<n;p++)for(var m=d+p;m<e;m+=n)if(r[m]&&0===(l[m]&u)){var _=16;if(0!==(l[m]&c)){l[m]^=c;var g=127&o[m];_=0===g?15:14}var y=t.readBit(a,_);r[m]=r[m]<<1|y,s[m]++,l[m]|=u}}},runCleanupPass:function(){for(var e,i=this.decoder,r=this.width,o=this.height,a=this.neighborsSignificance,s=this.coefficentsMagnitude,l=this.coefficentsSign,u=this.contexts,c=this.contextLabelTable,h=this.bitsDecoded,f=this.processingFlags,d=1,p=2,m=r,_=2*r,g=3*r,y=0;y<o;y=e){e=Math.min(y+4,o);for(var v=y*r,b=y+3<o,w=0;w<r;w++){var x,k=v+w,E=b&&0===f[k]&&0===f[k+m]&&0===f[k+_]&&0===f[k+g]&&0===a[k]&&0===a[k+m]&&0===a[k+_]&&0===a[k+g],S=0,I=k,T=y;if(E){var P=i.readBit(u,n);if(!P){h[k]++,h[k+m]++,h[k+_]++,h[k+g]++;continue}S=i.readBit(u,t)<<1|i.readBit(u,t),0!==S&&(T=y+S,I+=S*r),x=this.decodeSignBit(T,w,I),l[I]=x,s[I]=1,this.setNeighborsSignificance(T,w,I),f[I]|=p,I=k;for(var A=y;A<=T;A++,I+=r)h[I]++;S++}for(T=y+S;T<e;T++,I+=r)if(!s[I]&&0===(f[I]&d)){var D=c[a[I]],O=i.readBit(u,D);1===O&&(x=this.decodeSignBit(T,w,I),l[I]=x,s[I]=1,this.setNeighborsSignificance(T,w,I),f[I]|=p),h[I]++}}}},checkSegmentationSymbol:function(){var e=this.decoder,n=this.contexts,i=e.readBit(n,t)<<3|e.readBit(n,t)<<2|e.readBit(n,t)<<1|e.readBit(n,t);if(10!==i)throw new Error("JPX Error: Invalid segmentation symbol")}},e}(),D=function(){function e(){}return e.prototype.calculate=function(e,t,n){for(var i=e[0],r=1,o=e.length;r<o;r++)i=this.iterate(i,e[r],t,n);return i},e.prototype.extend=function(e,t,n){var i=t-1,r=t+1,o=t+n-2,a=t+n;e[i--]=e[r++],e[a++]=e[o--],e[i--]=e[r++],e[a++]=e[o--],e[i--]=e[r++],e[a++]=e[o--],e[i]=e[r],e[a]=e[o]},e.prototype.iterate=function(e,t,n,i){var r,o,a,s,l,u,c=e.width,h=e.height,f=e.items,d=t.width,p=t.height,m=t.items;for(a=0,r=0;r<h;r++)for(s=2*r*d,o=0;o<c;o++,a++,s+=2)m[s]=f[a];f=e.items=null;var _=4,g=new Float32Array(d+2*_);if(1===d){if(0!==(1&n))for(u=0,a=0;u<p;u++,a+=d)m[a]*=.5}else for(u=0,a=0;u<p;u++,a+=d)g.set(m.subarray(a,a+d),_),this.extend(g,_,d),this.filter(g,_,d),m.set(g.subarray(_,_+d),a);var y=16,v=[];for(r=0;r<y;r++)v.push(new Float32Array(p+2*_));var b,w=0;if(e=_+p,1===p){if(0!==(1&i))for(l=0;l<d;l++)m[l]*=.5}else for(l=0;l<d;l++){if(0===w){for(y=Math.min(d-l,y),a=l,s=_;s<e;a+=d,s++)for(b=0;b<y;b++)v[b][s]=m[a+b];w=y}w--;var x=v[w];if(this.extend(x,_,p),this.filter(x,_,p),0===w)for(a=l-y+1,s=_;s<e;a+=d,s++)for(b=0;b<y;b++)m[a+b]=v[b][s]}return{width:d,height:p,items:m}},e}(),O=function(){function e(){D.call(this)}return e.prototype=Object.create(D.prototype),e.prototype.filter=function(e,t,n){var i=n>>1;t|=0;var r,o,a,s,l=-1.586134342059924,u=-.052980118572961,c=.882911075530934,h=.443506852043971,f=1.230174104914001,d=1/f;for(r=t-3,o=i+4;o--;r+=2)e[r]*=d;for(r=t-2,a=h*e[r-1],o=i+3;o--&&(s=h*e[r+1],e[r]=f*e[r]-a-s,o--);r+=2)r+=2,a=h*e[r+1],e[r]=f*e[r]-a-s;for(r=t-1,a=c*e[r-1],o=i+2;o--&&(s=c*e[r+1],e[r]-=a+s,o--);r+=2)r+=2,a=c*e[r+1],e[r]-=a+s;for(r=t,a=u*e[r-1],o=i+1;o--&&(s=u*e[r+1],e[r]-=a+s,o--);r+=2)r+=2,a=u*e[r+1],e[r]-=a+s;if(0!==i)for(r=t+1,a=l*e[r-1],o=i;o--&&(s=l*e[r+1],e[r]-=a+s,o--);r+=2)r+=2,a=l*e[r+1],e[r]-=a+s},e}(),M=function(){function e(){D.call(this)}return e.prototype=Object.create(D.prototype),e.prototype.filter=function(e,t,n){var i=n>>1;t|=0;var r,o;for(r=t,o=i+1;o--;r+=2)e[r]-=e[r-1]+e[r+1]+2>>2;for(r=t+1,o=i;o--;r+=2)e[r]+=e[r-1]+e[r+1]>>1},e}();return e}(),g=function(){function e(e,t,n){this.data=e,this.bp=t,this.dataEnd=n,this.chigh=e[t],this.clow=0,this.byteIn(),this.chigh=this.chigh<<7&65535|this.clow>>9&127,this.clow=this.clow<<7&65535,this.ct-=7,this.a=32768}var t=[{qe:22017,nmps:1,nlps:1,switchFlag:1},{qe:13313,nmps:2,nlps:6,switchFlag:0},{qe:6145,nmps:3,nlps:9,switchFlag:0},{qe:2753,nmps:4,nlps:12,switchFlag:0},{qe:1313,nmps:5,nlps:29,switchFlag:0},{qe:545,nmps:38,nlps:33,switchFlag:0},{qe:22017,nmps:7,nlps:6,switchFlag:1},{qe:21505,nmps:8,nlps:14,switchFlag:0},{qe:18433,nmps:9,nlps:14,switchFlag:0},{qe:14337,nmps:10,nlps:14,switchFlag:0},{qe:12289,nmps:11,nlps:17,switchFlag:0},{qe:9217,nmps:12,nlps:18,switchFlag:0},{qe:7169,nmps:13,nlps:20,switchFlag:0},{qe:5633,nmps:29,nlps:21,switchFlag:0},{qe:22017,nmps:15,nlps:14,switchFlag:1},{qe:21505,nmps:16,nlps:14,switchFlag:0},{qe:20737,nmps:17,nlps:15,switchFlag:0},{qe:18433,nmps:18,nlps:16,switchFlag:0},{qe:14337,nmps:19,nlps:17,switchFlag:0},{qe:13313,nmps:20,nlps:18,switchFlag:0},{qe:12289,nmps:21,nlps:19,switchFlag:0},{qe:10241,nmps:22,nlps:19,switchFlag:0},{qe:9217,nmps:23,nlps:20,switchFlag:0},{qe:8705,nmps:24,nlps:21,switchFlag:0},{qe:7169,nmps:25,nlps:22,switchFlag:0},{qe:6145,nmps:26,nlps:23,switchFlag:0},{qe:5633,nmps:27,nlps:24,switchFlag:0},{qe:5121,nmps:28,nlps:25,switchFlag:0},{qe:4609,nmps:29,nlps:26,switchFlag:0},{qe:4353,nmps:30,nlps:27,switchFlag:0},{qe:2753,nmps:31,nlps:28,switchFlag:0},{qe:2497,nmps:32,nlps:29,switchFlag:0},{qe:2209,nmps:33,nlps:30,switchFlag:0},{qe:1313,nmps:34,nlps:31,switchFlag:0},{qe:1089,nmps:35,nlps:32,switchFlag:0},{qe:673,nmps:36,nlps:33,switchFlag:0},{qe:545,nmps:37,nlps:34,switchFlag:0},{qe:321,nmps:38,nlps:35,switchFlag:0},{qe:273,nmps:39,nlps:36,switchFlag:0},{qe:133,nmps:40,nlps:37,switchFlag:0},{qe:73,nmps:41,nlps:38,switchFlag:0},{qe:37,nmps:42,nlps:39,switchFlag:0},{qe:21,nmps:43,nlps:40,switchFlag:0},{qe:9,nmps:44,nlps:41,switchFlag:0},{qe:5,nmps:45,nlps:42,switchFlag:0},{qe:1,nmps:45,nlps:43,switchFlag:0},{qe:22017,nmps:46,nlps:46,switchFlag:0}];return e.prototype={byteIn:function(){var e=this.data,t=this.bp;if(255===e[t]){var n=e[t+1];n>143?(this.clow+=65280,this.ct=8):(t++,this.clow+=e[t]<<9,this.ct=7,this.bp=t)}else t++,this.clow+=t<this.dataEnd?e[t]<<8:65280,this.ct=8,this.bp=t;this.clow>65535&&(this.chigh+=this.clow>>16,this.clow&=65535)},readBit:function(e,n){var i,r=e[n]>>1,o=1&e[n],a=t[r],s=a.qe,l=this.a-s;if(this.chigh<s)l<s?(l=s,i=o,r=a.nmps):(l=s,i=1^o,1===a.switchFlag&&(o=i),r=a.nlps);else{if(this.chigh-=s,0!==(32768&l))return this.a=l,o;l<s?(i=1^o,1===a.switchFlag&&(o=i),r=a.nlps):(i=o,r=a.nmps)}do 0===this.ct&&this.byteIn(),l<<=1,this.chigh=this.chigh<<1&65535|this.clow>>15&1,this.clow=this.clow<<1&65535,this.ct--;while(0===(32768&l));return this.a=l,e[n]=r<<1|o,i}},e}(),y="undefined"==typeof window?this:window;"undefined"==typeof window;y.PDFJS||(y.PDFJS={}),y.PDFJS.pdfBug=!1,PDFJS.VERBOSITY_LEVELS={errors:0,warnings:1,infos:5};var v=(PDFJS.OPS={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotations:78,endAnnotations:79,beginAnnotation:80,endAnnotation:81,paintJpegXObject:82,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91},PDFJS.UNSUPPORTED_FEATURES={unknown:"unknown",forms:"forms",javaScript:"javaScript",smask:"smask",shadingPattern:"shadingPattern",font:"font"}),b=PDFJS.UnsupportedManager=function(){var e=[];return{listen:function(t){e.push(t)},notify:function(t){r('Unsupported feature "'+t+'"');for(var n=0,i=e.length;n<i;n++)e[n](t)}}}();PDFJS.isValidUrl=s,PDFJS.shadow=l;var w=(PDFJS.PasswordResponses={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},function(){function e(e,t){this.name="PasswordException",this.message=e,this.code=t}return e.prototype=new Error,e.constructor=e,e}());PDFJS.PasswordException=w;var x=function(){function e(e,t){this.name="UnknownErrorException",this.message=e,this.details=t}return e.prototype=new Error,e.constructor=e,e}();PDFJS.UnknownErrorException=x;var k=function(){function e(e){this.name="InvalidPDFException",this.message=e}return e.prototype=new Error,e.constructor=e,e}();PDFJS.InvalidPDFException=k;var E=function(){function e(e){this.name="MissingPDFException",this.message=e}return e.prototype=new Error,e.constructor=e,e}();PDFJS.MissingPDFException=E;var S=function(){function e(e,t){this.name="UnexpectedResponseException",this.message=e,this.status=t}return e.prototype=new Error,e.constructor=e,e}();PDFJS.UnexpectedResponseException=S;(function(){function e(e){this.message=e}return e.prototype=new Error,e.prototype.name="NotImplementedException",e.constructor=e,e})(),function(){function e(e,t){this.begin=e,this.end=t,this.message="Missing data ["+e+", "+t+")"}return e.prototype=new Error,e.prototype.name="MissingDataException",e.constructor=e,e}(),function(){function e(e){this.message=e}return e.prototype=new Error,e.prototype.name="XRefParseException",e.constructor=e,e}();Object.defineProperty(PDFJS,"isLittleEndian",{configurable:!0,get:function(){return l(PDFJS,"isLittleEndian",f())}}),Object.defineProperty(PDFJS,"hasCanvasTypedArrays",{configurable:!0,get:function(){return l(PDFJS,"hasCanvasTypedArrays",d())}});var I=(function(){function e(e,t){this.buffer=e,this.byteLength=e.length,this.length=void 0===t?this.byteLength>>2:t,n(this.length)}function t(e){return{get:function(){var t=this.buffer,n=e<<2;return(t[n]|t[n+1]<<8|t[n+2]<<16|t[n+3]<<24)>>>0},set:function(t){var n=this.buffer,i=e<<2;n[i]=255&t,n[i+1]=t>>8&255,n[i+2]=t>>16&255,n[i+3]=t>>>24&255}}}function n(n){for(;i<n;)Object.defineProperty(e.prototype,i,t(i)),i++}e.prototype=Object.create(null);var i=0;return e}(),PDFJS.Util=function(){function e(){}var t=["rgb(",0,",",0,",",0,")"];return e.makeCssRgb=function(e,n,i){return t[1]=e,t[3]=n,t[5]=i,t.join("")},e.transform=function(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]},e.applyTransform=function(e,t){var n=e[0]*t[0]+e[1]*t[2]+t[4],i=e[0]*t[1]+e[1]*t[3]+t[5];return[n,i]},e.applyInverseTransform=function(e,t){var n=t[0]*t[3]-t[1]*t[2],i=(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/n,r=(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/n;return[i,r]},e.getAxialAlignedBoundingBox=function(t,n){var i=e.applyTransform(t,n),r=e.applyTransform(t.slice(2,4),n),o=e.applyTransform([t[0],t[3]],n),a=e.applyTransform([t[2],t[1]],n);return[Math.min(i[0],r[0],o[0],a[0]),Math.min(i[1],r[1],o[1],a[1]),Math.max(i[0],r[0],o[0],a[0]),Math.max(i[1],r[1],o[1],a[1])]},e.inverseTransform=function(e){var t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]},e.apply3dTransform=function(e,t){return[e[0]*t[0]+e[1]*t[1]+e[2]*t[2],e[3]*t[0]+e[4]*t[1]+e[5]*t[2],e[6]*t[0]+e[7]*t[1]+e[8]*t[2]]},e.singularValueDecompose2dScale=function(e){var t=[e[0],e[2],e[1],e[3]],n=e[0]*t[0]+e[1]*t[2],i=e[0]*t[1]+e[1]*t[3],r=e[2]*t[0]+e[3]*t[2],o=e[2]*t[1]+e[3]*t[3],a=(n+o)/2,s=Math.sqrt((n+o)*(n+o)-4*(n*o-r*i))/2,l=a+s||1,u=a-s||1;return[Math.sqrt(l),Math.sqrt(u)]},e.normalizeRect=function(e){var t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t},e.intersect=function(t,n){function i(e,t){return e-t}var r=[t[0],t[2],n[0],n[2]].sort(i),o=[t[1],t[3],n[1],n[3]].sort(i),a=[];return t=e.normalizeRect(t),n=e.normalizeRect(n),(r[0]===t[0]&&r[1]===n[0]||r[0]===n[0]&&r[1]===t[0])&&(a[0]=r[1],a[2]=r[2],(o[0]===t[1]&&o[1]===n[1]||o[0]===n[1]&&o[1]===t[1])&&(a[1]=o[1],a[3]=o[2],a))},e.sign=function(e){return e<0?-1:1},e.appendToArray=function(e,t){Array.prototype.push.apply(e,t)},e.prependToArray=function(e,t){Array.prototype.unshift.apply(e,t)},e.extendObj=function(e,t){for(var n in t)e[n]=t[n]},e.getInheritableProperty=function(e,t){for(;e&&!e.has(t);)e=e.get("Parent");return e?e.get(t):null},e.inherit=function(e,t,n){e.prototype=Object.create(t.prototype),e.prototype.constructor=e;for(var i in n)e.prototype[i]=n[i]},e.loadScript=function(e,t){var n=document.createElement("script"),i=!1;n.setAttribute("src",e),t&&(n.onload=function(){i||t(),i=!0}),document.getElementsByTagName("head")[0].appendChild(n)},e}());PDFJS.PageViewport=function(){function e(e,t,n,i,r,o){this.viewBox=e,this.scale=t,this.rotation=n,this.offsetX=i,this.offsetY=r;var a,s,l,u,c=(e[2]+e[0])/2,h=(e[3]+e[1])/2;switch(n%=360,n=n<0?n+360:n){case 180:a=-1,s=0,l=0,u=1;break;case 90:a=0,s=1,l=1,u=0;break;case 270:a=0,s=-1,l=-1,u=0;break;default:a=1,s=0,l=0,u=-1}o&&(l=-l,u=-u);var f,d,p,m;0===a?(f=Math.abs(h-e[1])*t+i,d=Math.abs(c-e[0])*t+r,p=Math.abs(e[3]-e[1])*t,m=Math.abs(e[2]-e[0])*t):(f=Math.abs(c-e[0])*t+i,d=Math.abs(h-e[1])*t+r,p=Math.abs(e[2]-e[0])*t,m=Math.abs(e[3]-e[1])*t),this.transform=[a*t,s*t,l*t,u*t,f-a*t*c-l*t*h,d-s*t*c-u*t*h],this.width=p,this.height=m,this.fontScale=t}return e.prototype={clone:function(t){t=t||{};var n="scale"in t?t.scale:this.scale,i="rotation"in t?t.rotation:this.rotation;return new e(this.viewBox.slice(),n,i,this.offsetX,this.offsetY,t.dontFlip)},convertToViewportPoint:function(e,t){return I.applyTransform([e,t],this.transform)},convertToViewportRectangle:function(e){var t=I.applyTransform([e[0],e[1]],this.transform),n=I.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],n[0],n[1]]},convertToPdfPoint:function(e,t){return I.applyInverseTransform([e,t],this.transform)}},e}();PDFJS.createPromiseCapability=p,function(){function e(e){this._status=t,this._handlers=[];try{e.call(this,this._resolve.bind(this),this._reject.bind(this))}catch(e){this._reject(e)}}if(y.Promise)return"function"!=typeof y.Promise.all&&(y.Promise.all=function(e){var t,n,i=0,r=[],o=new y.Promise(function(e,i){t=e,n=i});return e.forEach(function(e,o){i++,e.then(function(e){r[o]=e,i--,0===i&&t(r)},n)}),0===i&&t(r),o}),"function"!=typeof y.Promise.resolve&&(y.Promise.resolve=function(e){return new y.Promise(function(t){t(e)})}),"function"!=typeof y.Promise.reject&&(y.Promise.reject=function(e){return new y.Promise(function(t,n){n(e)})}),void("function"!=typeof y.Promise.prototype.catch&&(y.Promise.prototype.catch=function(e){return y.Promise.prototype.then(void 0,e)}));var t=0,n=1,i=2,o=500,a={handlers:[],running:!1,unhandledRejections:[],pendingRejectionCheck:!1,scheduleHandlers:function(e){e._status!==t&&(this.handlers=this.handlers.concat(e._handlers),e._handlers=[],this.running||(this.running=!0,setTimeout(this.runHandlers.bind(this),0)))},runHandlers:function(){for(var e=1,t=Date.now()+e;this.handlers.length>0;){var r=this.handlers.shift(),o=r.thisPromise._status,a=r.thisPromise._value;try{o===n?"function"==typeof r.onResolve&&(a=r.onResolve(a)):"function"==typeof r.onReject&&(a=r.onReject(a),o=n,r.thisPromise._unhandledRejection&&this.removeUnhandeledRejection(r.thisPromise))}catch(e){o=i,a=e}if(r.nextPromise._updateStatus(o,a),Date.now()>=t)break}return this.handlers.length>0?void setTimeout(this.runHandlers.bind(this),0):void(this.running=!1)},addUnhandledRejection:function(e){this.unhandledRejections.push({promise:e,time:Date.now()}),this.scheduleRejectionCheck()},removeUnhandeledRejection:function(e){e._unhandledRejection=!1;for(var t=0;t<this.unhandledRejections.length;t++)this.unhandledRejections[t].promise===e&&(this.unhandledRejections.splice(t),t--)},scheduleRejectionCheck:function(){this.pendingRejectionCheck||(this.pendingRejectionCheck=!0,setTimeout(function(){this.pendingRejectionCheck=!1;for(var e=Date.now(),t=0;t<this.unhandledRejections.length;t++)if(e-this.unhandledRejections[t].time>o){var n=this.unhandledRejections[t].promise._value,i="Unhandled rejection: "+n;n.stack&&(i+="\n"+n.stack),r(i),this.unhandledRejections.splice(t),t--}this.unhandledRejections.length&&this.scheduleRejectionCheck()}.bind(this),o))}};e.all=function(t){function n(e){a._status!==i&&(l=[],o(e))}var r,o,a=new e(function(e,t){r=e,o=t}),s=t.length,l=[];if(0===s)return r(l),a;for(var u=0,c=t.length;u<c;++u){var h=t[u],f=function(e){return function(t){a._status!==i&&(l[e]=t,s--,0===s&&r(l))}}(u);e.isPromise(h)?h.then(f,n):f(h)}return a},e.isPromise=function(e){return e&&"function"==typeof e.then},e.resolve=function(t){return new e(function(e){e(t)})},e.reject=function(t){return new e(function(e,n){n(t)})},e.prototype={_status:null,_value:null,_handlers:null,_unhandledRejection:null,_updateStatus:function(t,r){if(this._status!==n&&this._status!==i){if(t===n&&e.isPromise(r))return void r.then(this._updateStatus.bind(this,n),this._updateStatus.bind(this,i));this._status=t,this._value=r,t===i&&0===this._handlers.length&&(this._unhandledRejection=!0,a.addUnhandledRejection(this)),a.scheduleHandlers(this)}},_resolve:function(e){this._updateStatus(n,e)},_reject:function(e){this._updateStatus(i,e)},then:function(t,n){var i=new e(function(e,t){this.resolve=e,this.reject=t});return this._handlers.push({thisPromise:this,onResolve:t,onReject:n,nextPromise:i}),a.scheduleHandlers(this),i},catch:function(e){return this.then(void 0,e)}},y.Promise=e}();(function(){function e(e,t,n){for(;e.length<n;)e+=t;return e}function t(){this.started={},this.times=[],this.enabled=!0}return t.prototype={time:function(e){this.enabled&&(e in this.started&&r("Timer is already running for "+e),this.started[e]=Date.now())},timeEnd:function(e){this.enabled&&(e in this.started||r("Timer has not been started for "+e),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e])},toString:function(){var t,n,i=this.times,r="",o=0;for(t=0,n=i.length;t<n;++t){var a=i[t].name;a.length>o&&(o=a.length)}for(t=0,n=i.length;t<n;++t){var s=i[t],l=s.end-s.start;r+=e(s.name," ",o)+" "+l+"ms\n"}return r}},t})();PDFJS.createBlob=function(e,t){if("undefined"!=typeof Blob)return new Blob([e],{type:t});var n=new MozBlobBuilder;return n.append(e),n.getBlob(t)},PDFJS.createObjectURL=function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return function(t,n){if(!PDFJS.disableCreateObjectURL&&"undefined"!=typeof URL&&URL.createObjectURL){var i=PDFJS.createBlob(t,n);return URL.createObjectURL(i)}for(var r="data:"+n+";base64,",o=0,a=t.length;o<a;o+=3){var s=255&t[o],l=255&t[o+1],u=255&t[o+2],c=s>>2,h=(3&s)<<4|l>>4,f=o+1<a?(15&l)<<2|u>>6:64,d=o+2<a?63&u:64;r+=e[c]+e[h]+e[f]+e[d]}return r}}(),m.prototype={on:function(e,t,n){var i=this.actionHandler;i[e]&&o('There is already an actionName called "'+e+'"'),i[e]=[t,n]},send:function(e,t,n){var i={action:e,data:t};this.postMessage(i,n)},sendWithPromise:function(e,t,n){var i=this.callbackIndex++,r={action:e,data:t,callbackId:i},o=p();this.callbacksCapabilities[i]=o;try{this.postMessage(r,n)}catch(e){o.reject(e)}return o.promise},postMessage:function(e,t){t&&this.postMessageTransfers?this.comObj.postMessage(e,t):this.comObj.postMessage(e)}};var T=typeof t;"undefined"!==T&&t.exports&&(t.exports=_)},{}],3:[function(e,t,n){function i(e,t){return d.isUndefined(t)?""+t:d.isNumber(t)&&!isFinite(t)?t.toString():d.isFunction(t)||d.isRegExp(t)?t.toString():t}function r(e,t){return d.isString(e)?e.length<t?e:e.slice(0,t):e}function o(e){return r(JSON.stringify(e.actual,i),128)+" "+e.operator+" "+r(JSON.stringify(e.expected,i),128)}function a(e,t,n,i,r){throw new _.AssertionError({message:n,actual:e,expected:t,operator:i,stackStartFunction:r})}function s(e,t){e||a(e,!0,t,"==",_.ok)}function l(e,t){if(e===t)return!0;if(d.isBuffer(e)&&d.isBuffer(t)){if(e.length!=t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}return d.isDate(e)&&d.isDate(t)?e.getTime()===t.getTime():d.isRegExp(e)&&d.isRegExp(t)?e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase:d.isObject(e)||d.isObject(t)?c(e,t):e==t}function u(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function c(e,t){if(d.isNullOrUndefined(e)||d.isNullOrUndefined(t))return!1;if(e.prototype!==t.prototype)return!1;if(d.isPrimitive(e)||d.isPrimitive(t))return e===t;var n=u(e),i=u(t);if(n&&!i||!n&&i)return!1;if(n)return e=p.call(e),t=p.call(t),l(e,t);var r,o,a=g(e),s=g(t);if(a.length!=s.length)return!1;for(a.sort(),s.sort(),o=a.length-1;o>=0;o--)if(a[o]!=s[o])return!1;for(o=a.length-1;o>=0;o--)if(r=a[o],!l(e[r],t[r]))return!1;return!0}function h(e,t){return!(!e||!t)&&("[object RegExp]"==Object.prototype.toString.call(t)?t.test(e):e instanceof t||t.call({},e)===!0)}function f(e,t,n,i){var r;d.isString(n)&&(i=n,n=null);try{t()}catch(e){r=e}if(i=(n&&n.name?" ("+n.name+").":".")+(i?" "+i:"."),e&&!r&&a(r,n,"Missing expected exception"+i),!e&&h(r,n)&&a(r,n,"Got unwanted exception"+i),e&&r&&n&&!h(r,n)||!e&&r)throw r}var d=e("util/"),p=Array.prototype.slice,m=Object.prototype.hasOwnProperty,_=t.exports=s;_.AssertionError=function(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=o(this),this.generatedMessage=!0);var t=e.stackStartFunction||a;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var n=new Error;if(n.stack){var i=n.stack,r=t.name,s=i.indexOf("\n"+r);if(s>=0){var l=i.indexOf("\n",s+1);i=i.substring(l+1)}this.stack=i}}},d.inherits(_.AssertionError,Error),_.fail=a,_.ok=s,_.equal=function(e,t,n){e!=t&&a(e,t,n,"==",_.equal)},_.notEqual=function(e,t,n){e==t&&a(e,t,n,"!=",_.notEqual)},_.deepEqual=function(e,t,n){l(e,t)||a(e,t,n,"deepEqual",_.deepEqual)},_.notDeepEqual=function(e,t,n){l(e,t)&&a(e,t,n,"notDeepEqual",_.notDeepEqual)},_.strictEqual=function(e,t,n){e!==t&&a(e,t,n,"===",_.strictEqual)},_.notStrictEqual=function(e,t,n){e===t&&a(e,t,n,"!==",_.notStrictEqual)},_.throws=function(e,t,n){f.apply(this,[!0].concat(p.call(arguments)))},_.doesNotThrow=function(e,t){f.apply(this,[!1].concat(p.call(arguments)))},_.ifError=function(e){if(e)throw e};var g=Object.keys||function(e){var t=[];for(var n in e)m.call(e,n)&&t.push(n);return t}},{"util/":77}],4:[function(e,t,n){},{}],5:[function(e,t,n){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;n.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var i in n)n.hasOwnProperty(i)&&(e[i]=n[i])}}return e},n.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var r={arraySet:function(e,t,n,i,r){if(t.subarray&&e.subarray)return void e.set(t.subarray(n,n+i),r);for(var o=0;o<i;o++)e[r+o]=t[n+o]},flattenChunks:function(e){var t,n,i,r,o,a;for(i=0,t=0,n=e.length;t<n;t++)i+=e[t].length;for(a=new Uint8Array(i),r=0,t=0,n=e.length;t<n;t++)o=e[t],a.set(o,r),r+=o.length;return a}},o={arraySet:function(e,t,n,i,r){for(var o=0;o<i;o++)e[r+o]=t[n+o]},flattenChunks:function(e){return[].concat.apply([],e)}};n.setTyped=function(e){e?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,r)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,o))},n.setTyped(i)},{}],6:[function(e,t,n){"use strict";function i(e,t,n,i){for(var r=65535&e|0,o=e>>>16&65535|0,a=0;0!==n;){a=n>2e3?2e3:n,n-=a;do r=r+t[i++]|0,o=o+r|0;while(--a);r%=65521,o%=65521}return r|o<<16|0}t.exports=i},{}],7:[function(e,t,n){t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],8:[function(e,t,n){"use strict";function i(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}function r(e,t,n,i){var r=o,a=i+n;e^=-1;for(var s=i;s<a;s++)e=e>>>8^r[255&(e^t[s])];return e^-1}var o=i();t.exports=r},{}],9:[function(e,t,n){"use strict";function i(e,t){return e.msg=M[t],t}function r(e){return(e<<1)-(e>4?9:0)}function o(e){for(var t=e.length;--t>=0;)e[t]=0}function a(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(P.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function s(e,t){A._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,a(e.strm)}function l(e,t){e.pending_buf[e.pending++]=t}function u(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function c(e,t,n,i){var r=e.avail_in;return r>i&&(r=i),0===r?0:(e.avail_in-=r,P.arraySet(t,e.input,e.next_in,r,n),1===e.state.wrap?e.adler=D(e.adler,t,r,n):2===e.state.wrap&&(e.adler=O(e.adler,t,r,n)),e.next_in+=r,e.total_in+=r,r)}function h(e,t){var n,i,r=e.max_chain_length,o=e.strstart,a=e.prev_length,s=e.nice_match,l=e.strstart>e.w_size-ue?e.strstart-(e.w_size-ue):0,u=e.window,c=e.w_mask,h=e.prev,f=e.strstart+le,d=u[o+a-1],p=u[o+a];e.prev_length>=e.good_match&&(r>>=2),s>e.lookahead&&(s=e.lookahead);do if(n=t,u[n+a]===p&&u[n+a-1]===d&&u[n]===u[o]&&u[++n]===u[o+1]){o+=2,n++;do;while(u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&o<f);if(i=le-(f-o),o=f-le,i>a){if(e.match_start=t,a=i,i>=s)break;d=u[o+a-1],p=u[o+a]}}while((t=h[t&c])>l&&0!==--r);return a<=e.lookahead?a:e.lookahead}function f(e){var t,n,i,r,o,a=e.w_size;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=a+(a-ue)){P.arraySet(e.window,e.window,a,a,0),e.match_start-=a,e.strstart-=a,e.block_start-=a,n=e.hash_size,t=n;do i=e.head[--t],e.head[t]=i>=a?i-a:0;while(--n);n=a,t=n;do i=e.prev[--t],e.prev[t]=i>=a?i-a:0;while(--n);r+=a}if(0===e.strm.avail_in)break;if(n=c(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=n,e.lookahead+e.insert>=se)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+se-1])&e.hash_mask,e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<se)););}while(e.lookahead<ue&&0!==e.strm.avail_in)}function d(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(f(e),0===e.lookahead&&t===C)return ye;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var i=e.block_start+n;if((0===e.strstart||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,s(e,!1),0===e.strm.avail_out))return ye;if(e.strstart-e.block_start>=e.w_size-ue&&(s(e,!1),0===e.strm.avail_out))return ye}return e.insert=0,t===F?(s(e,!0),0===e.strm.avail_out?be:we):e.strstart>e.block_start&&(s(e,!1),0===e.strm.avail_out)?ye:ye}function p(e,t){for(var n,i;;){if(e.lookahead<ue){if(f(e),e.lookahead<ue&&t===C)return ye;if(0===e.lookahead)break}if(n=0,e.lookahead>=se&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+se-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-ue&&(e.match_length=h(e,n)),e.match_length>=se)if(i=A._tr_tally(e,e.strstart-e.match_start,e.match_length-se),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=se){e.match_length--;do e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+se-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(0!==--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],
e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=A._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(s(e,!1),0===e.strm.avail_out))return ye}return e.insert=e.strstart<se-1?e.strstart:se-1,t===F?(s(e,!0),0===e.strm.avail_out?be:we):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?ye:ve}function m(e,t){for(var n,i,r;;){if(e.lookahead<ue){if(f(e),e.lookahead<ue&&t===C)return ye;if(0===e.lookahead)break}if(n=0,e.lookahead>=se&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+se-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=se-1,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-ue&&(e.match_length=h(e,n),e.match_length<=5&&(e.strategy===q||e.match_length===se&&e.strstart-e.match_start>4096)&&(e.match_length=se-1)),e.prev_length>=se&&e.match_length<=e.prev_length){r=e.strstart+e.lookahead-se,i=A._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-se),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=r&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+se-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(0!==--e.prev_length);if(e.match_available=0,e.match_length=se-1,e.strstart++,i&&(s(e,!1),0===e.strm.avail_out))return ye}else if(e.match_available){if(i=A._tr_tally(e,0,e.window[e.strstart-1]),i&&s(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return ye}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=A._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<se-1?e.strstart:se-1,t===F?(s(e,!0),0===e.strm.avail_out?be:we):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?ye:ve}function _(e,t){for(var n,i,r,o,a=e.window;;){if(e.lookahead<=le){if(f(e),e.lookahead<=le&&t===C)return ye;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=se&&e.strstart>0&&(r=e.strstart-1,i=a[r],i===a[++r]&&i===a[++r]&&i===a[++r])){o=e.strstart+le;do;while(i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&r<o);e.match_length=le-(o-r),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=se?(n=A._tr_tally(e,1,e.match_length-se),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=A._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(s(e,!1),0===e.strm.avail_out))return ye}return e.insert=0,t===F?(s(e,!0),0===e.strm.avail_out?be:we):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?ye:ve}function g(e,t){for(var n;;){if(0===e.lookahead&&(f(e),0===e.lookahead)){if(t===C)return ye;break}if(e.match_length=0,n=A._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(s(e,!1),0===e.strm.avail_out))return ye}return e.insert=0,t===F?(s(e,!0),0===e.strm.avail_out?be:we):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?ye:ve}function y(e){e.window_size=2*e.w_size,o(e.head),e.max_lazy_match=T[e.level].max_lazy,e.good_match=T[e.level].good_length,e.nice_match=T[e.level].nice_length,e.max_chain_length=T[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=se-1,e.match_available=0,e.ins_h=0}function v(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=J,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new P.Buf16(2*oe),this.dyn_dtree=new P.Buf16(2*(2*ie+1)),this.bl_tree=new P.Buf16(2*(2*re+1)),o(this.dyn_ltree),o(this.dyn_dtree),o(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new P.Buf16(ae+1),this.heap=new P.Buf16(2*ne+1),o(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new P.Buf16(2*ne+1),o(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function b(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=X,t=e.state,t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?he:_e,e.adler=2===t.wrap?0:1,t.last_flush=C,A._tr_init(t),B):i(e,N)}function w(e){var t=b(e);return t===B&&y(e.state),t}function x(e,t){return e&&e.state?2!==e.state.wrap?N:(e.state.gzhead=t,B):N}function k(e,t,n,r,o,a){if(!e)return N;var s=1;if(t===H&&(t=6),r<0?(s=0,r=-r):r>15&&(s=2,r-=16),o<1||o>K||n!==J||r<8||r>15||t<0||t>9||a<0||a>Y)return i(e,N);8===r&&(r=9);var l=new v;return e.state=l,l.strm=e,l.wrap=s,l.gzhead=null,l.w_bits=r,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=o+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+se-1)/se),l.window=new P.Buf8(2*l.w_size),l.head=new P.Buf16(l.hash_size),l.prev=new P.Buf16(l.w_size),l.lit_bufsize=1<<o+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new P.Buf8(l.pending_buf_size),l.d_buf=l.lit_bufsize>>1,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=a,l.method=n,w(e)}function E(e,t){return k(e,t,J,Q,$,W)}function S(e,t){var n,s,c,h;if(!e||!e.state||t>z||t<0)return e?i(e,N):N;if(s=e.state,!e.output||!e.input&&0!==e.avail_in||s.status===ge&&t!==F)return i(e,0===e.avail_out?V:N);if(s.strm=e,n=s.last_flush,s.last_flush=t,s.status===he)if(2===s.wrap)e.adler=0,l(s,31),l(s,139),l(s,8),s.gzhead?(l(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),l(s,255&s.gzhead.time),l(s,s.gzhead.time>>8&255),l(s,s.gzhead.time>>16&255),l(s,s.gzhead.time>>24&255),l(s,9===s.level?2:s.strategy>=G||s.level<2?4:0),l(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(l(s,255&s.gzhead.extra.length),l(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(e.adler=O(e.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=fe):(l(s,0),l(s,0),l(s,0),l(s,0),l(s,0),l(s,9===s.level?2:s.strategy>=G||s.level<2?4:0),l(s,xe),s.status=_e);else{var f=J+(s.w_bits-8<<4)<<8,d=-1;d=s.strategy>=G||s.level<2?0:s.level<6?1:6===s.level?2:3,f|=d<<6,0!==s.strstart&&(f|=ce),f+=31-f%31,s.status=_e,u(s,f),0!==s.strstart&&(u(s,e.adler>>>16),u(s,65535&e.adler)),e.adler=1}if(s.status===fe)if(s.gzhead.extra){for(c=s.pending;s.gzindex<(65535&s.gzhead.extra.length)&&(s.pending!==s.pending_buf_size||(s.gzhead.hcrc&&s.pending>c&&(e.adler=O(e.adler,s.pending_buf,s.pending-c,c)),a(e),c=s.pending,s.pending!==s.pending_buf_size));)l(s,255&s.gzhead.extra[s.gzindex]),s.gzindex++;s.gzhead.hcrc&&s.pending>c&&(e.adler=O(e.adler,s.pending_buf,s.pending-c,c)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=de)}else s.status=de;if(s.status===de)if(s.gzhead.name){c=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>c&&(e.adler=O(e.adler,s.pending_buf,s.pending-c,c)),a(e),c=s.pending,s.pending===s.pending_buf_size)){h=1;break}h=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,l(s,h)}while(0!==h);s.gzhead.hcrc&&s.pending>c&&(e.adler=O(e.adler,s.pending_buf,s.pending-c,c)),0===h&&(s.gzindex=0,s.status=pe)}else s.status=pe;if(s.status===pe)if(s.gzhead.comment){c=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>c&&(e.adler=O(e.adler,s.pending_buf,s.pending-c,c)),a(e),c=s.pending,s.pending===s.pending_buf_size)){h=1;break}h=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,l(s,h)}while(0!==h);s.gzhead.hcrc&&s.pending>c&&(e.adler=O(e.adler,s.pending_buf,s.pending-c,c)),0===h&&(s.status=me)}else s.status=me;if(s.status===me&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&a(e),s.pending+2<=s.pending_buf_size&&(l(s,255&e.adler),l(s,e.adler>>8&255),e.adler=0,s.status=_e)):s.status=_e),0!==s.pending){if(a(e),0===e.avail_out)return s.last_flush=-1,B}else if(0===e.avail_in&&r(t)<=r(n)&&t!==F)return i(e,V);if(s.status===ge&&0!==e.avail_in)return i(e,V);if(0!==e.avail_in||0!==s.lookahead||t!==C&&s.status!==ge){var p=s.strategy===G?g(s,t):s.strategy===Z?_(s,t):T[s.level].func(s,t);if(p!==be&&p!==we||(s.status=ge),p===ye||p===be)return 0===e.avail_out&&(s.last_flush=-1),B;if(p===ve&&(t===R?A._tr_align(s):t!==z&&(A._tr_stored_block(s,0,0,!1),t===L&&(o(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),a(e),0===e.avail_out))return s.last_flush=-1,B}return t!==F?B:s.wrap<=0?U:(2===s.wrap?(l(s,255&e.adler),l(s,e.adler>>8&255),l(s,e.adler>>16&255),l(s,e.adler>>24&255),l(s,255&e.total_in),l(s,e.total_in>>8&255),l(s,e.total_in>>16&255),l(s,e.total_in>>24&255)):(u(s,e.adler>>>16),u(s,65535&e.adler)),a(e),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?B:U)}function I(e){var t;return e&&e.state?(t=e.state.status,t!==he&&t!==fe&&t!==de&&t!==pe&&t!==me&&t!==_e&&t!==ge?i(e,N):(e.state=null,t===_e?i(e,j):B)):N}var T,P=e("../utils/common"),A=e("./trees"),D=e("./adler32"),O=e("./crc32"),M=e("./messages"),C=0,R=1,L=3,F=4,z=5,B=0,U=1,N=-2,j=-3,V=-5,H=-1,q=1,G=2,Z=3,Y=4,W=0,X=2,J=8,K=9,Q=15,$=8,ee=29,te=256,ne=te+1+ee,ie=30,re=19,oe=2*ne+1,ae=15,se=3,le=258,ue=le+se+1,ce=32,he=42,fe=69,de=73,pe=91,me=103,_e=113,ge=666,ye=1,ve=2,be=3,we=4,xe=3,ke=function(e,t,n,i,r){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=r};T=[new ke(0,0,0,0,d),new ke(4,4,8,4,p),new ke(4,5,16,8,p),new ke(4,6,32,32,p),new ke(4,4,16,16,m),new ke(8,16,32,32,m),new ke(8,16,128,128,m),new ke(8,32,128,256,m),new ke(32,128,258,1024,m),new ke(32,258,258,4096,m)],n.deflateInit=E,n.deflateInit2=k,n.deflateReset=w,n.deflateResetKeep=b,n.deflateSetHeader=x,n.deflate=S,n.deflateEnd=I,n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":5,"./adler32":6,"./crc32":8,"./messages":13,"./trees":14}],10:[function(e,t,n){"use strict";var i=30,r=12;t.exports=function(e,t){var n,o,a,s,l,u,c,h,f,d,p,m,_,g,y,v,b,w,x,k,E,S,I,T,P;n=e.state,o=e.next_in,T=e.input,a=o+(e.avail_in-5),s=e.next_out,P=e.output,l=s-(t-e.avail_out),u=s+(e.avail_out-257),c=n.dmax,h=n.wsize,f=n.whave,d=n.wnext,p=n.window,m=n.hold,_=n.bits,g=n.lencode,y=n.distcode,v=(1<<n.lenbits)-1,b=(1<<n.distbits)-1;e:do{_<15&&(m+=T[o++]<<_,_+=8,m+=T[o++]<<_,_+=8),w=g[m&v];t:for(;;){if(x=w>>>24,m>>>=x,_-=x,x=w>>>16&255,0===x)P[s++]=65535&w;else{if(!(16&x)){if(0===(64&x)){w=g[(65535&w)+(m&(1<<x)-1)];continue t}if(32&x){n.mode=r;break e}e.msg="invalid literal/length code",n.mode=i;break e}k=65535&w,x&=15,x&&(_<x&&(m+=T[o++]<<_,_+=8),k+=m&(1<<x)-1,m>>>=x,_-=x),_<15&&(m+=T[o++]<<_,_+=8,m+=T[o++]<<_,_+=8),w=y[m&b];n:for(;;){if(x=w>>>24,m>>>=x,_-=x,x=w>>>16&255,!(16&x)){if(0===(64&x)){w=y[(65535&w)+(m&(1<<x)-1)];continue n}e.msg="invalid distance code",n.mode=i;break e}if(E=65535&w,x&=15,_<x&&(m+=T[o++]<<_,_+=8,_<x&&(m+=T[o++]<<_,_+=8)),E+=m&(1<<x)-1,E>c){e.msg="invalid distance too far back",n.mode=i;break e}if(m>>>=x,_-=x,x=s-l,E>x){if(x=E-x,x>f&&n.sane){e.msg="invalid distance too far back",n.mode=i;break e}if(S=0,I=p,0===d){if(S+=h-x,x<k){k-=x;do P[s++]=p[S++];while(--x);S=s-E,I=P}}else if(d<x){if(S+=h+d-x,x-=d,x<k){k-=x;do P[s++]=p[S++];while(--x);if(S=0,d<k){x=d,k-=x;do P[s++]=p[S++];while(--x);S=s-E,I=P}}}else if(S+=d-x,x<k){k-=x;do P[s++]=p[S++];while(--x);S=s-E,I=P}for(;k>2;)P[s++]=I[S++],P[s++]=I[S++],P[s++]=I[S++],k-=3;k&&(P[s++]=I[S++],k>1&&(P[s++]=I[S++]))}else{S=s-E;do P[s++]=P[S++],P[s++]=P[S++],P[s++]=P[S++],k-=3;while(k>2);k&&(P[s++]=P[S++],k>1&&(P[s++]=P[S++]))}break}}break}}while(o<a&&s<u);k=_>>3,o-=k,_-=k<<3,m&=(1<<_)-1,e.next_in=o,e.next_out=s,e.avail_in=o<a?5+(a-o):5-(o-a),e.avail_out=s<u?257+(u-s):257-(s-u),n.hold=m,n.bits=_}},{}],11:[function(e,t,n){"use strict";function i(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function r(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new g.Buf16(320),this.work=new g.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function o(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=F,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new g.Buf32(pe),t.distcode=t.distdyn=new g.Buf32(me),t.sane=1,t.back=-1,P):O}function a(e){var t;return e&&e.state?(t=e.state,t.wsize=0,t.whave=0,t.wnext=0,o(e)):O}function s(e,t){var n,i;return e&&e.state?(i=e.state,t<0?(n=0,t=-t):(n=(t>>4)+1,t<48&&(t&=15)),t&&(t<8||t>15)?O:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,a(e))):O}function l(e,t){var n,i;return e?(i=new r,e.state=i,i.window=null,n=s(e,t),n!==P&&(e.state=null),n):O}function u(e){return l(e,ge)}function c(e){if(ye){var t;for(m=new g.Buf32(512),_=new g.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(w(k,e.lens,0,288,m,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;w(E,e.lens,0,32,_,0,e.work,{bits:5}),ye=!1}e.lencode=m,e.lenbits=9,e.distcode=_,e.distbits=5}function h(e,t,n,i){var r,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new g.Buf8(o.wsize)),i>=o.wsize?(g.arraySet(o.window,t,n-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):(r=o.wsize-o.wnext,r>i&&(r=i),g.arraySet(o.window,t,n-i,r,o.wnext),i-=r,i?(g.arraySet(o.window,t,n-i,i,0),o.wnext=i,o.whave=o.wsize):(o.wnext+=r,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=r))),0}function f(e,t){var n,r,o,a,s,l,u,f,d,p,m,_,pe,me,_e,ge,ye,ve,be,we,xe,ke,Ee,Se,Ie=0,Te=new g.Buf8(4),Pe=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return O;n=e.state,n.mode===Y&&(n.mode=W),s=e.next_out,o=e.output,u=e.avail_out,a=e.next_in,r=e.input,l=e.avail_in,f=n.hold,d=n.bits,p=l,m=u,ke=P;e:for(;;)switch(n.mode){case F:if(0===n.wrap){n.mode=W;break}for(;d<16;){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}if(2&n.wrap&&35615===f){n.check=0,Te[0]=255&f,Te[1]=f>>>8&255,n.check=v(n.check,Te,2,0),f=0,d=0,n.mode=z;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&f)<<8)+(f>>8))%31){e.msg="incorrect header check",n.mode=he;break}if((15&f)!==L){e.msg="unknown compression method",n.mode=he;break}if(f>>>=4,d-=4,xe=(15&f)+8,0===n.wbits)n.wbits=xe;else if(xe>n.wbits){e.msg="invalid window size",n.mode=he;break}n.dmax=1<<xe,e.adler=n.check=1,n.mode=512&f?G:Y,f=0,d=0;break;case z:for(;d<16;){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}if(n.flags=f,(255&n.flags)!==L){e.msg="unknown compression method",n.mode=he;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=he;break}n.head&&(n.head.text=f>>8&1),512&n.flags&&(Te[0]=255&f,Te[1]=f>>>8&255,n.check=v(n.check,Te,2,0)),f=0,d=0,n.mode=B;case B:for(;d<32;){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}n.head&&(n.head.time=f),512&n.flags&&(Te[0]=255&f,Te[1]=f>>>8&255,Te[2]=f>>>16&255,Te[3]=f>>>24&255,n.check=v(n.check,Te,4,0)),f=0,d=0,n.mode=U;case U:for(;d<16;){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}n.head&&(n.head.xflags=255&f,n.head.os=f>>8),512&n.flags&&(Te[0]=255&f,Te[1]=f>>>8&255,n.check=v(n.check,Te,2,0)),f=0,d=0,n.mode=N;case N:if(1024&n.flags){for(;d<16;){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}n.length=f,n.head&&(n.head.extra_len=f),512&n.flags&&(Te[0]=255&f,Te[1]=f>>>8&255,n.check=v(n.check,Te,2,0)),f=0,d=0}else n.head&&(n.head.extra=null);n.mode=j;case j:if(1024&n.flags&&(_=n.length,_>l&&(_=l),_&&(n.head&&(xe=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),g.arraySet(n.head.extra,r,a,_,xe)),512&n.flags&&(n.check=v(n.check,r,_,a)),l-=_,a+=_,n.length-=_),n.length))break e;n.length=0,n.mode=V;case V:if(2048&n.flags){if(0===l)break e;_=0;do xe=r[a+_++],n.head&&xe&&n.length<65536&&(n.head.name+=String.fromCharCode(xe));while(xe&&_<l);if(512&n.flags&&(n.check=v(n.check,r,_,a)),l-=_,a+=_,xe)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=H;case H:if(4096&n.flags){if(0===l)break e;_=0;do xe=r[a+_++],n.head&&xe&&n.length<65536&&(n.head.comment+=String.fromCharCode(xe));while(xe&&_<l);if(512&n.flags&&(n.check=v(n.check,r,_,a)),l-=_,a+=_,xe)break e}else n.head&&(n.head.comment=null);n.mode=q;case q:if(512&n.flags){for(;d<16;){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}if(f!==(65535&n.check)){e.msg="header crc mismatch",n.mode=he;break}f=0,d=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=Y;break;case G:for(;d<32;){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}e.adler=n.check=i(f),f=0,d=0,n.mode=Z;case Z:if(0===n.havedict)return e.next_out=s,e.avail_out=u,e.next_in=a,e.avail_in=l,n.hold=f,n.bits=d,D;e.adler=n.check=1,n.mode=Y;case Y:if(t===I||t===T)break e;case W:if(n.last){f>>>=7&d,d-=7&d,n.mode=le;break}for(;d<3;){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}switch(n.last=1&f,f>>>=1,d-=1,3&f){case 0:n.mode=X;break;case 1:if(c(n),n.mode=te,t===T){f>>>=2,d-=2;break e}break;case 2:n.mode=Q;break;case 3:e.msg="invalid block type",n.mode=he}f>>>=2,d-=2;break;case X:for(f>>>=7&d,d-=7&d;d<32;){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}if((65535&f)!==(f>>>16^65535)){e.msg="invalid stored block lengths",n.mode=he;break}if(n.length=65535&f,f=0,d=0,n.mode=J,t===T)break e;case J:n.mode=K;case K:if(_=n.length){if(_>l&&(_=l),_>u&&(_=u),0===_)break e;g.arraySet(o,r,a,_,s),l-=_,a+=_,u-=_,s+=_,n.length-=_;break}n.mode=Y;break;case Q:for(;d<14;){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}if(n.nlen=(31&f)+257,f>>>=5,d-=5,n.ndist=(31&f)+1,f>>>=5,d-=5,n.ncode=(15&f)+4,f>>>=4,d-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=he;break}n.have=0,n.mode=$;case $:for(;n.have<n.ncode;){for(;d<3;){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}n.lens[Pe[n.have++]]=7&f,f>>>=3,d-=3}for(;n.have<19;)n.lens[Pe[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,Ee={bits:n.lenbits},ke=w(x,n.lens,0,19,n.lencode,0,n.work,Ee),n.lenbits=Ee.bits,ke){e.msg="invalid code lengths set",n.mode=he;break}n.have=0,n.mode=ee;case ee:for(;n.have<n.nlen+n.ndist;){for(;Ie=n.lencode[f&(1<<n.lenbits)-1],_e=Ie>>>24,ge=Ie>>>16&255,ye=65535&Ie,!(_e<=d);){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}if(ye<16)f>>>=_e,d-=_e,n.lens[n.have++]=ye;else{if(16===ye){for(Se=_e+2;d<Se;){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}if(f>>>=_e,d-=_e,0===n.have){e.msg="invalid bit length repeat",n.mode=he;break}xe=n.lens[n.have-1],_=3+(3&f),f>>>=2,d-=2}else if(17===ye){for(Se=_e+3;d<Se;){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}f>>>=_e,d-=_e,xe=0,_=3+(7&f),f>>>=3,d-=3}else{for(Se=_e+7;d<Se;){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}f>>>=_e,d-=_e,xe=0,_=11+(127&f),f>>>=7,d-=7}if(n.have+_>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=he;break}for(;_--;)n.lens[n.have++]=xe}}if(n.mode===he)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=he;break}if(n.lenbits=9,Ee={bits:n.lenbits},ke=w(k,n.lens,0,n.nlen,n.lencode,0,n.work,Ee),n.lenbits=Ee.bits,ke){e.msg="invalid literal/lengths set",n.mode=he;break}if(n.distbits=6,n.distcode=n.distdyn,Ee={bits:n.distbits},ke=w(E,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,Ee),n.distbits=Ee.bits,ke){e.msg="invalid distances set",n.mode=he;break}if(n.mode=te,t===T)break e;case te:n.mode=ne;case ne:if(l>=6&&u>=258){e.next_out=s,e.avail_out=u,e.next_in=a,e.avail_in=l,n.hold=f,n.bits=d,b(e,m),s=e.next_out,o=e.output,u=e.avail_out,a=e.next_in,r=e.input,l=e.avail_in,f=n.hold,d=n.bits,n.mode===Y&&(n.back=-1);break}for(n.back=0;Ie=n.lencode[f&(1<<n.lenbits)-1],_e=Ie>>>24,ge=Ie>>>16&255,ye=65535&Ie,!(_e<=d);){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}if(ge&&0===(240&ge)){for(ve=_e,be=ge,we=ye;Ie=n.lencode[we+((f&(1<<ve+be)-1)>>ve)],_e=Ie>>>24,ge=Ie>>>16&255,ye=65535&Ie,!(ve+_e<=d);){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}f>>>=ve,d-=ve,n.back+=ve}if(f>>>=_e,d-=_e,n.back+=_e,n.length=ye,0===ge){n.mode=se;break}if(32&ge){n.back=-1,n.mode=Y;break}if(64&ge){e.msg="invalid literal/length code",n.mode=he;break}n.extra=15&ge,n.mode=ie;case ie:if(n.extra){for(Se=n.extra;d<Se;){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}n.length+=f&(1<<n.extra)-1,f>>>=n.extra,d-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=re;case re:for(;Ie=n.distcode[f&(1<<n.distbits)-1],_e=Ie>>>24,ge=Ie>>>16&255,ye=65535&Ie,!(_e<=d);){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}if(0===(240&ge)){for(ve=_e,be=ge,we=ye;Ie=n.distcode[we+((f&(1<<ve+be)-1)>>ve)],_e=Ie>>>24,ge=Ie>>>16&255,ye=65535&Ie,!(ve+_e<=d);){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}f>>>=ve,d-=ve,n.back+=ve}if(f>>>=_e,d-=_e,n.back+=_e,64&ge){e.msg="invalid distance code",n.mode=he;break}n.offset=ye,n.extra=15&ge,n.mode=oe;case oe:if(n.extra){for(Se=n.extra;d<Se;){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}n.offset+=f&(1<<n.extra)-1,f>>>=n.extra,d-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=he;break}n.mode=ae;case ae:if(0===u)break e;if(_=m-u,n.offset>_){if(_=n.offset-_,_>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=he;break}_>n.wnext?(_-=n.wnext,pe=n.wsize-_):pe=n.wnext-_,_>n.length&&(_=n.length),me=n.window}else me=o,pe=s-n.offset,_=n.length;_>u&&(_=u),u-=_,n.length-=_;do o[s++]=me[pe++];while(--_);0===n.length&&(n.mode=ne);break;case se:if(0===u)break e;o[s++]=n.length,u--,n.mode=ne;break;case le:if(n.wrap){for(;d<32;){if(0===l)break e;l--,f|=r[a++]<<d,d+=8}if(m-=u,e.total_out+=m,n.total+=m,m&&(e.adler=n.check=n.flags?v(n.check,o,m,s-m):y(n.check,o,m,s-m)),m=u,(n.flags?f:i(f))!==n.check){e.msg="incorrect data check",n.mode=he;break}f=0,d=0}n.mode=ue;case ue:if(n.wrap&&n.flags){for(;d<32;){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}if(f!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=he;break}f=0,d=0}n.mode=ce;case ce:ke=A;break e;case he:ke=M;break e;case fe:return C;case de:default:return O}return e.next_out=s,e.avail_out=u,e.next_in=a,e.avail_in=l,n.hold=f,n.bits=d,(n.wsize||m!==e.avail_out&&n.mode<he&&(n.mode<le||t!==S))&&h(e,e.output,e.next_out,m-e.avail_out)?(n.mode=fe,C):(p-=e.avail_in,m-=e.avail_out,e.total_in+=p,e.total_out+=m,n.total+=m,n.wrap&&m&&(e.adler=n.check=n.flags?v(n.check,o,m,e.next_out-m):y(n.check,o,m,e.next_out-m)),e.data_type=n.bits+(n.last?64:0)+(n.mode===Y?128:0)+(n.mode===te||n.mode===J?256:0),(0===p&&0===m||t===S)&&ke===P&&(ke=R),ke)}function d(e){if(!e||!e.state)return O;var t=e.state;return t.window&&(t.window=null),e.state=null,P}function p(e,t){var n;return e&&e.state?(n=e.state,0===(2&n.wrap)?O:(n.head=t,t.done=!1,P)):O}var m,_,g=e("../utils/common"),y=e("./adler32"),v=e("./crc32"),b=e("./inffast"),w=e("./inftrees"),x=0,k=1,E=2,S=4,I=5,T=6,P=0,A=1,D=2,O=-2,M=-3,C=-4,R=-5,L=8,F=1,z=2,B=3,U=4,N=5,j=6,V=7,H=8,q=9,G=10,Z=11,Y=12,W=13,X=14,J=15,K=16,Q=17,$=18,ee=19,te=20,ne=21,ie=22,re=23,oe=24,ae=25,se=26,le=27,ue=28,ce=29,he=30,fe=31,de=32,pe=852,me=592,_e=15,ge=_e,ye=!0;n.inflateReset=a,n.inflateReset2=s,n.inflateResetKeep=o,n.inflateInit=u,n.inflateInit2=l,n.inflate=f,n.inflateEnd=d,n.inflateGetHeader=p,n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":5,"./adler32":6,"./crc32":8,"./inffast":10,"./inftrees":12}],12:[function(e,t,n){"use strict";var i=e("../utils/common"),r=15,o=852,a=592,s=0,l=1,u=2,c=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],h=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],f=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],d=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,n,p,m,_,g,y){var v,b,w,x,k,E,S,I,T,P=y.bits,A=0,D=0,O=0,M=0,C=0,R=0,L=0,F=0,z=0,B=0,U=null,N=0,j=new i.Buf16(r+1),V=new i.Buf16(r+1),H=null,q=0;for(A=0;A<=r;A++)j[A]=0;for(D=0;D<p;D++)j[t[n+D]]++;for(C=P,M=r;M>=1&&0===j[M];M--);if(C>M&&(C=M),0===M)return m[_++]=20971520,m[_++]=20971520,y.bits=1,0;for(O=1;O<M&&0===j[O];O++);for(C<O&&(C=O),F=1,A=1;A<=r;A++)if(F<<=1,F-=j[A],F<0)return-1;if(F>0&&(e===s||1!==M))return-1;for(V[1]=0,A=1;A<r;A++)V[A+1]=V[A]+j[A];for(D=0;D<p;D++)0!==t[n+D]&&(g[V[t[n+D]]++]=D);if(e===s?(U=H=g,E=19):e===l?(U=c,N-=257,H=h,q-=257,E=256):(U=f,H=d,E=-1),B=0,D=0,A=O,k=_,R=C,L=0,w=-1,z=1<<C,x=z-1,e===l&&z>o||e===u&&z>a)return 1;for(var G=0;;){G++,S=A-L,g[D]<E?(I=0,T=g[D]):g[D]>E?(I=H[q+g[D]],T=U[N+g[D]]):(I=96,T=0),v=1<<A-L,b=1<<R,O=b;do b-=v,m[k+(B>>L)+b]=S<<24|I<<16|T|0;while(0!==b);for(v=1<<A-1;B&v;)v>>=1;if(0!==v?(B&=v-1,B+=v):B=0,D++,0===--j[A]){if(A===M)break;A=t[n+g[D]]}if(A>C&&(B&x)!==w){for(0===L&&(L=C),k+=O,R=A-L,F=1<<R;R+L<M&&(F-=j[R+L],!(F<=0));)R++,F<<=1;if(z+=1<<R,e===l&&z>o||e===u&&z>a)return 1;w=B&x,m[w]=C<<24|R<<16|k-_|0}}return 0!==B&&(m[k+B]=A-L<<24|64<<16|0),y.bits=C,0}},{"../utils/common":5}],13:[function(e,t,n){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],14:[function(e,t,n){"use strict";function i(e){for(var t=e.length;--t>=0;)e[t]=0}function r(e){return e<256?ae[e]:ae[256+(e>>>7)]}function o(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function a(e,t,n){e.bi_valid>Y-n?(e.bi_buf|=t<<e.bi_valid&65535,o(e,e.bi_buf),e.bi_buf=t>>Y-e.bi_valid,e.bi_valid+=n-Y):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function s(e,t,n){a(e,n[2*t],n[2*t+1])}function l(e,t){var n=0;do n|=1&e,e>>>=1,n<<=1;while(--t>0);return n>>>1}function u(e){16===e.bi_valid?(o(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}function c(e,t){var n,i,r,o,a,s,l=t.dyn_tree,u=t.max_code,c=t.stat_desc.static_tree,h=t.stat_desc.has_stree,f=t.stat_desc.extra_bits,d=t.stat_desc.extra_base,p=t.stat_desc.max_length,m=0;for(o=0;o<=Z;o++)e.bl_count[o]=0;for(l[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<G;n++)i=e.heap[n],o=l[2*l[2*i+1]+1]+1,o>p&&(o=p,m++),l[2*i+1]=o,i>u||(e.bl_count[o]++,a=0,i>=d&&(a=f[i-d]),s=l[2*i],e.opt_len+=s*(o+a),h&&(e.static_len+=s*(c[2*i+1]+a)));if(0!==m){do{for(o=p-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[p]--,m-=2}while(m>0);for(o=p;0!==o;o--)for(i=e.bl_count[o];0!==i;)r=e.heap[--n],r>u||(l[2*r+1]!==o&&(e.opt_len+=(o-l[2*r+1])*l[2*r],l[2*r+1]=o),i--)}}function h(e,t,n){var i,r,o=new Array(Z+1),a=0;for(i=1;i<=Z;i++)o[i]=a=a+n[i-1]<<1;for(r=0;r<=t;r++){var s=e[2*r+1];0!==s&&(e[2*r]=l(o[s]++,s))}}function f(){var e,t,n,i,r,o=new Array(Z+1);for(n=0,i=0;i<N-1;i++)for(le[i]=n,e=0;e<1<<$[i];e++)se[n++]=i;for(se[n-1]=i,r=0,i=0;i<16;i++)for(ue[i]=r,e=0;e<1<<ee[i];e++)ae[r++]=i;for(r>>=7;i<H;i++)for(ue[i]=r<<7,e=0;e<1<<ee[i]-7;e++)ae[256+r++]=i;for(t=0;t<=Z;t++)o[t]=0;for(e=0;e<=143;)re[2*e+1]=8,e++,o[8]++;for(;e<=255;)re[2*e+1]=9,e++,o[9]++;for(;e<=279;)re[2*e+1]=7,e++,o[7]++;for(;e<=287;)re[2*e+1]=8,e++,o[8]++;for(h(re,V+1,o),e=0;e<H;e++)oe[2*e+1]=5,oe[2*e]=l(e,5);ce=new de(re,$,j+1,V,Z),he=new de(oe,ee,0,H,Z),fe=new de(new Array(0),te,0,q,W)}function d(e){var t;for(t=0;t<V;t++)e.dyn_ltree[2*t]=0;for(t=0;t<H;t++)e.dyn_dtree[2*t]=0;for(t=0;t<q;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*X]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function p(e){e.bi_valid>8?o(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function m(e,t,n,i){p(e),i&&(o(e,n),o(e,~n)),D.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}function _(e,t,n,i){var r=2*t,o=2*n;return e[r]<e[o]||e[r]===e[o]&&i[t]<=i[n]}function g(e,t,n){for(var i=e.heap[n],r=n<<1;r<=e.heap_len&&(r<e.heap_len&&_(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!_(t,i,e.heap[r],e.depth));)e.heap[n]=e.heap[r],n=r,r<<=1;e.heap[n]=i}function y(e,t,n){var i,o,l,u,c=0;if(0!==e.last_lit)do i=e.pending_buf[e.d_buf+2*c]<<8|e.pending_buf[e.d_buf+2*c+1],o=e.pending_buf[e.l_buf+c],c++,0===i?s(e,o,t):(l=se[o],s(e,l+j+1,t),u=$[l],0!==u&&(o-=le[l],a(e,o,u)),i--,l=r(i),s(e,l,n),u=ee[l],0!==u&&(i-=ue[l],a(e,i,u)));while(c<e.last_lit);s(e,X,t)}function v(e,t){var n,i,r,o=t.dyn_tree,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,l=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=G,n=0;n<l;n++)0!==o[2*n]?(e.heap[++e.heap_len]=u=n,e.depth[n]=0):o[2*n+1]=0;for(;e.heap_len<2;)r=e.heap[++e.heap_len]=u<2?++u:0,o[2*r]=1,e.depth[r]=0,e.opt_len--,s&&(e.static_len-=a[2*r+1]);for(t.max_code=u,n=e.heap_len>>1;n>=1;n--)g(e,o,n);r=l;do n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],g(e,o,1),i=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=i,o[2*r]=o[2*n]+o[2*i],e.depth[r]=(e.depth[n]>=e.depth[i]?e.depth[n]:e.depth[i])+1,o[2*n+1]=o[2*i+1]=r,e.heap[1]=r++,g(e,o,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],c(e,t),h(o,u,e.bl_count)}function b(e,t,n){var i,r,o=-1,a=t[1],s=0,l=7,u=4;for(0===a&&(l=138,u=3),t[2*(n+1)+1]=65535,i=0;i<=n;i++)r=a,a=t[2*(i+1)+1],++s<l&&r===a||(s<u?e.bl_tree[2*r]+=s:0!==r?(r!==o&&e.bl_tree[2*r]++,e.bl_tree[2*J]++):s<=10?e.bl_tree[2*K]++:e.bl_tree[2*Q]++,s=0,o=r,0===a?(l=138,u=3):r===a?(l=6,u=3):(l=7,u=4))}function w(e,t,n){var i,r,o=-1,l=t[1],u=0,c=7,h=4;for(0===l&&(c=138,h=3),i=0;i<=n;i++)if(r=l,l=t[2*(i+1)+1],!(++u<c&&r===l)){if(u<h){do s(e,r,e.bl_tree);while(0!==--u)}else 0!==r?(r!==o&&(s(e,r,e.bl_tree),u--),s(e,J,e.bl_tree),a(e,u-3,2)):u<=10?(s(e,K,e.bl_tree),a(e,u-3,3)):(s(e,Q,e.bl_tree),a(e,u-11,7));u=0,o=r,0===l?(c=138,h=3):r===l?(c=6,h=3):(c=7,h=4)}}function x(e){var t;for(b(e,e.dyn_ltree,e.l_desc.max_code),b(e,e.dyn_dtree,e.d_desc.max_code),v(e,e.bl_desc),t=q-1;t>=3&&0===e.bl_tree[2*ne[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}function k(e,t,n,i){var r;for(a(e,t-257,5),a(e,n-1,5),a(e,i-4,4),r=0;r<i;r++)a(e,e.bl_tree[2*ne[r]+1],3);w(e,e.dyn_ltree,t-1),w(e,e.dyn_dtree,n-1)}function E(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return M;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return C;for(t=32;t<j;t++)if(0!==e.dyn_ltree[2*t])return C;return M}function S(e){me||(f(),me=!0),e.l_desc=new pe(e.dyn_ltree,ce),e.d_desc=new pe(e.dyn_dtree,he),e.bl_desc=new pe(e.bl_tree,fe),e.bi_buf=0,e.bi_valid=0,d(e)}function I(e,t,n,i){a(e,(L<<1)+(i?1:0),3),m(e,t,n,!0)}function T(e){a(e,F<<1,3),s(e,X,re),u(e)}function P(e,t,n,i){var r,o,s=0;e.level>0?(e.strm.data_type===R&&(e.strm.data_type=E(e)),v(e,e.l_desc),v(e,e.d_desc),s=x(e),r=e.opt_len+3+7>>>3,o=e.static_len+3+7>>>3,o<=r&&(r=o)):r=o=n+5,n+4<=r&&t!==-1?I(e,t,n,i):e.strategy===O||o===r?(a(e,(F<<1)+(i?1:0),3),y(e,re,oe)):(a(e,(z<<1)+(i?1:0),3),k(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),y(e,e.dyn_ltree,e.dyn_dtree)),d(e),i&&p(e)}function A(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(se[n]+j+1)]++,e.dyn_dtree[2*r(t)]++),e.last_lit===e.lit_bufsize-1}var D=e("../utils/common"),O=4,M=0,C=1,R=2,L=0,F=1,z=2,B=3,U=258,N=29,j=256,V=j+1+N,H=30,q=19,G=2*V+1,Z=15,Y=16,W=7,X=256,J=16,K=17,Q=18,$=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],ee=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],te=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],ne=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ie=512,re=new Array(2*(V+2));i(re);var oe=new Array(2*H);i(oe);var ae=new Array(ie);i(ae);var se=new Array(U-B+1);i(se);var le=new Array(N);i(le);var ue=new Array(H);i(ue);var ce,he,fe,de=function(e,t,n,i,r){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=r,this.has_stree=e&&e.length},pe=function(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t},me=!1;n._tr_init=S,n._tr_stored_block=I,n._tr_flush_block=P,n._tr_tally=A,n._tr_align=T;
},{"../utils/common":5}],15:[function(e,t,n){"use strict";function i(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}t.exports=i},{}],16:[function(e,t,n){(function(t,i){function r(e){if(e<n.DEFLATE||e>n.UNZIP)throw new TypeError("Bad argument");this.mode=e,this.init_done=!1,this.write_in_progress=!1,this.pending_close=!1,this.windowBits=0,this.level=0,this.memLevel=0,this.strategy=0,this.dictionary=null}function o(e,t){for(var n=0;n<e.length;n++)this[t+n]=e[n]}var a=e("pako/lib/zlib/messages"),s=e("pako/lib/zlib/zstream"),l=e("pako/lib/zlib/deflate.js"),u=e("pako/lib/zlib/inflate.js"),c=e("pako/lib/zlib/constants");for(var h in c)n[h]=c[h];n.NONE=0,n.DEFLATE=1,n.INFLATE=2,n.GZIP=3,n.GUNZIP=4,n.DEFLATERAW=5,n.INFLATERAW=6,n.UNZIP=7,r.prototype.init=function(e,t,i,r,o){switch(this.windowBits=e,this.level=t,this.memLevel=i,this.strategy=r,this.mode!==n.GZIP&&this.mode!==n.GUNZIP||(this.windowBits+=16),this.mode===n.UNZIP&&(this.windowBits+=32),this.mode!==n.DEFLATERAW&&this.mode!==n.INFLATERAW||(this.windowBits=-this.windowBits),this.strm=new s,this.mode){case n.DEFLATE:case n.GZIP:case n.DEFLATERAW:var a=l.deflateInit2(this.strm,this.level,n.Z_DEFLATED,this.windowBits,this.memLevel,this.strategy);break;case n.INFLATE:case n.GUNZIP:case n.INFLATERAW:case n.UNZIP:var a=u.inflateInit2(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}return a!==n.Z_OK?void this._error(a):(this.write_in_progress=!1,void(this.init_done=!0))},r.prototype.params=function(){throw new Error("deflateParams Not supported")},r.prototype._writeCheck=function(){if(!this.init_done)throw new Error("write before init");if(this.mode===n.NONE)throw new Error("already finalized");if(this.write_in_progress)throw new Error("write already in progress");if(this.pending_close)throw new Error("close is pending")},r.prototype.write=function(e,n,i,r,o,a,s){this._writeCheck(),this.write_in_progress=!0;var l=this;return t.nextTick(function(){l.write_in_progress=!1;var t=l._write(e,n,i,r,o,a,s);l.callback(t[0],t[1]),l.pending_close&&l.close()}),this},r.prototype.writeSync=function(e,t,n,i,r,o,a){return this._writeCheck(),this._write(e,t,n,i,r,o,a)},r.prototype._write=function(e,t,r,a,s,c,h){if(this.write_in_progress=!0,e!==n.Z_NO_FLUSH&&e!==n.Z_PARTIAL_FLUSH&&e!==n.Z_SYNC_FLUSH&&e!==n.Z_FULL_FLUSH&&e!==n.Z_FINISH&&e!==n.Z_BLOCK)throw new Error("Invalid flush value");null==t&&(t=new i(0),a=0,r=0),s._set?s.set=s._set:s.set=o;var f=this.strm;switch(f.avail_in=a,f.input=t,f.next_in=r,f.avail_out=h,f.output=s,f.next_out=c,this.mode){case n.DEFLATE:case n.GZIP:case n.DEFLATERAW:var d=l.deflate(f,e);break;case n.UNZIP:case n.INFLATE:case n.GUNZIP:case n.INFLATERAW:var d=u.inflate(f,e);break;default:throw new Error("Unknown mode "+this.mode)}return d!==n.Z_STREAM_END&&d!==n.Z_OK&&this._error(d),this.write_in_progress=!1,[f.avail_in,f.avail_out]},r.prototype.close=function(){return this.write_in_progress?void(this.pending_close=!0):(this.pending_close=!1,this.mode===n.DEFLATE||this.mode===n.GZIP||this.mode===n.DEFLATERAW?l.deflateEnd(this.strm):u.inflateEnd(this.strm),void(this.mode=n.NONE))},r.prototype.reset=function(){switch(this.mode){case n.DEFLATE:case n.DEFLATERAW:var e=l.deflateReset(this.strm);break;case n.INFLATE:case n.INFLATERAW:var e=u.inflateReset(this.strm)}e!==n.Z_OK&&this._error(e)},r.prototype._error=function(e){this.onerror(a[e]+": "+this.strm.msg,e),this.write_in_progress=!1,this.pending_close&&this.close()},n.Zlib=r}).call(this,e("_process"),e("buffer").Buffer)},{_process:68,buffer:19,"pako/lib/zlib/constants":7,"pako/lib/zlib/deflate.js":9,"pako/lib/zlib/inflate.js":11,"pako/lib/zlib/messages":13,"pako/lib/zlib/zstream":15}],17:[function(e,t,n){(function(t,i){function r(e,t,n){function r(){for(var t;null!==(t=e.read());)s.push(t),l+=t.length;e.once("readable",r)}function o(t){e.removeListener("end",a),e.removeListener("readable",r),n(t)}function a(){var t=i.concat(s,l);s=[],n(null,t),e.close()}var s=[],l=0;e.on("error",o),e.on("end",a),e.end(t),r()}function o(e,t){if("string"==typeof t&&(t=new i(t)),!i.isBuffer(t))throw new TypeError("Not a string or buffer");var n=m.Z_FINISH;return e._processChunk(t,n)}function a(e){return this instanceof a?void d.call(this,e,m.DEFLATE):new a(e)}function s(e){return this instanceof s?void d.call(this,e,m.INFLATE):new s(e)}function l(e){return this instanceof l?void d.call(this,e,m.GZIP):new l(e)}function u(e){return this instanceof u?void d.call(this,e,m.GUNZIP):new u(e)}function c(e){return this instanceof c?void d.call(this,e,m.DEFLATERAW):new c(e)}function h(e){return this instanceof h?void d.call(this,e,m.INFLATERAW):new h(e)}function f(e){return this instanceof f?void d.call(this,e,m.UNZIP):new f(e)}function d(e,t){if(this._opts=e=e||{},this._chunkSize=e.chunkSize||n.Z_DEFAULT_CHUNK,p.call(this,e),e.flush&&e.flush!==m.Z_NO_FLUSH&&e.flush!==m.Z_PARTIAL_FLUSH&&e.flush!==m.Z_SYNC_FLUSH&&e.flush!==m.Z_FULL_FLUSH&&e.flush!==m.Z_FINISH&&e.flush!==m.Z_BLOCK)throw new Error("Invalid flush flag: "+e.flush);if(this._flushFlag=e.flush||m.Z_NO_FLUSH,e.chunkSize&&(e.chunkSize<n.Z_MIN_CHUNK||e.chunkSize>n.Z_MAX_CHUNK))throw new Error("Invalid chunk size: "+e.chunkSize);if(e.windowBits&&(e.windowBits<n.Z_MIN_WINDOWBITS||e.windowBits>n.Z_MAX_WINDOWBITS))throw new Error("Invalid windowBits: "+e.windowBits);if(e.level&&(e.level<n.Z_MIN_LEVEL||e.level>n.Z_MAX_LEVEL))throw new Error("Invalid compression level: "+e.level);if(e.memLevel&&(e.memLevel<n.Z_MIN_MEMLEVEL||e.memLevel>n.Z_MAX_MEMLEVEL))throw new Error("Invalid memLevel: "+e.memLevel);if(e.strategy&&e.strategy!=n.Z_FILTERED&&e.strategy!=n.Z_HUFFMAN_ONLY&&e.strategy!=n.Z_RLE&&e.strategy!=n.Z_FIXED&&e.strategy!=n.Z_DEFAULT_STRATEGY)throw new Error("Invalid strategy: "+e.strategy);if(e.dictionary&&!i.isBuffer(e.dictionary))throw new Error("Invalid dictionary: it should be a Buffer instance");this._binding=new m.Zlib(t);var r=this;this._hadError=!1,this._binding.onerror=function(e,t){r._binding=null,r._hadError=!0;var i=new Error(e);i.errno=t,i.code=n.codes[t],r.emit("error",i)};var o=n.Z_DEFAULT_COMPRESSION;"number"==typeof e.level&&(o=e.level);var a=n.Z_DEFAULT_STRATEGY;"number"==typeof e.strategy&&(a=e.strategy),this._binding.init(e.windowBits||n.Z_DEFAULT_WINDOWBITS,o,e.memLevel||n.Z_DEFAULT_MEMLEVEL,a,e.dictionary),this._buffer=new i(this._chunkSize),this._offset=0,this._closed=!1,this._level=o,this._strategy=a,this.once("end",this.close)}var p=e("_stream_transform"),m=e("./binding"),_=e("util"),g=e("assert").ok;m.Z_MIN_WINDOWBITS=8,m.Z_MAX_WINDOWBITS=15,m.Z_DEFAULT_WINDOWBITS=15,m.Z_MIN_CHUNK=64,m.Z_MAX_CHUNK=1/0,m.Z_DEFAULT_CHUNK=16384,m.Z_MIN_MEMLEVEL=1,m.Z_MAX_MEMLEVEL=9,m.Z_DEFAULT_MEMLEVEL=8,m.Z_MIN_LEVEL=-1,m.Z_MAX_LEVEL=9,m.Z_DEFAULT_LEVEL=m.Z_DEFAULT_COMPRESSION,Object.keys(m).forEach(function(e){e.match(/^Z/)&&(n[e]=m[e])}),n.codes={Z_OK:m.Z_OK,Z_STREAM_END:m.Z_STREAM_END,Z_NEED_DICT:m.Z_NEED_DICT,Z_ERRNO:m.Z_ERRNO,Z_STREAM_ERROR:m.Z_STREAM_ERROR,Z_DATA_ERROR:m.Z_DATA_ERROR,Z_MEM_ERROR:m.Z_MEM_ERROR,Z_BUF_ERROR:m.Z_BUF_ERROR,Z_VERSION_ERROR:m.Z_VERSION_ERROR},Object.keys(n.codes).forEach(function(e){n.codes[n.codes[e]]=e}),n.Deflate=a,n.Inflate=s,n.Gzip=l,n.Gunzip=u,n.DeflateRaw=c,n.InflateRaw=h,n.Unzip=f,n.createDeflate=function(e){return new a(e)},n.createInflate=function(e){return new s(e)},n.createDeflateRaw=function(e){return new c(e)},n.createInflateRaw=function(e){return new h(e)},n.createGzip=function(e){return new l(e)},n.createGunzip=function(e){return new u(e)},n.createUnzip=function(e){return new f(e)},n.deflate=function(e,t,n){return"function"==typeof t&&(n=t,t={}),r(new a(t),e,n)},n.deflateSync=function(e,t){return o(new a(t),e)},n.gzip=function(e,t,n){return"function"==typeof t&&(n=t,t={}),r(new l(t),e,n)},n.gzipSync=function(e,t){return o(new l(t),e)},n.deflateRaw=function(e,t,n){return"function"==typeof t&&(n=t,t={}),r(new c(t),e,n)},n.deflateRawSync=function(e,t){return o(new c(t),e)},n.unzip=function(e,t,n){return"function"==typeof t&&(n=t,t={}),r(new f(t),e,n)},n.unzipSync=function(e,t){return o(new f(t),e)},n.inflate=function(e,t,n){return"function"==typeof t&&(n=t,t={}),r(new s(t),e,n)},n.inflateSync=function(e,t){return o(new s(t),e)},n.gunzip=function(e,t,n){return"function"==typeof t&&(n=t,t={}),r(new u(t),e,n)},n.gunzipSync=function(e,t){return o(new u(t),e)},n.inflateRaw=function(e,t,n){return"function"==typeof t&&(n=t,t={}),r(new h(t),e,n)},n.inflateRawSync=function(e,t){return o(new h(t),e)},_.inherits(d,p),d.prototype.params=function(e,i,r){if(e<n.Z_MIN_LEVEL||e>n.Z_MAX_LEVEL)throw new RangeError("Invalid compression level: "+e);if(i!=n.Z_FILTERED&&i!=n.Z_HUFFMAN_ONLY&&i!=n.Z_RLE&&i!=n.Z_FIXED&&i!=n.Z_DEFAULT_STRATEGY)throw new TypeError("Invalid strategy: "+i);if(this._level!==e||this._strategy!==i){var o=this;this.flush(m.Z_SYNC_FLUSH,function(){o._binding.params(e,i),o._hadError||(o._level=e,o._strategy=i,r&&r())})}else t.nextTick(r)},d.prototype.reset=function(){return this._binding.reset()},d.prototype._flush=function(e){this._transform(new i(0),"",e)},d.prototype.flush=function(e,n){var r=this._writableState;if(("function"==typeof e||void 0===e&&!n)&&(n=e,e=m.Z_FULL_FLUSH),r.ended)n&&t.nextTick(n);else if(r.ending)n&&this.once("end",n);else if(r.needDrain){var o=this;this.once("drain",function(){o.flush(n)})}else this._flushFlag=e,this.write(new i(0),"",n)},d.prototype.close=function(e){if(e&&t.nextTick(e),!this._closed){this._closed=!0,this._binding.close();var n=this;t.nextTick(function(){n.emit("close")})}},d.prototype._transform=function(e,t,n){var r,o=this._writableState,a=o.ending||o.ended,s=a&&(!e||o.length===e.length);if(null===!e&&!i.isBuffer(e))return n(new Error("invalid input"));s?r=m.Z_FINISH:(r=this._flushFlag,e.length>=o.length&&(this._flushFlag=this._opts.flush||m.Z_NO_FLUSH));this._processChunk(e,r,n)},d.prototype._processChunk=function(e,t,n){function r(c,d){if(!l._hadError){var p=a-d;if(g(p>=0,"have should not go down"),p>0){var m=l._buffer.slice(l._offset,l._offset+p);l._offset+=p,u?l.push(m):(h.push(m),f+=m.length)}if((0===d||l._offset>=l._chunkSize)&&(a=l._chunkSize,l._offset=0,l._buffer=new i(l._chunkSize)),0===d){if(s+=o-c,o=c,!u)return!0;var _=l._binding.write(t,e,s,o,l._buffer,l._offset,l._chunkSize);return _.callback=r,void(_.buffer=e)}return!!u&&void n()}}var o=e&&e.length,a=this._chunkSize-this._offset,s=0,l=this,u="function"==typeof n;if(!u){var c,h=[],f=0;this.on("error",function(e){c=e});do var d=this._binding.writeSync(t,e,s,o,this._buffer,this._offset,a);while(!this._hadError&&r(d[0],d[1]));if(this._hadError)throw c;var p=i.concat(h,f);return this.close(),p}var m=this._binding.write(t,e,s,o,this._buffer,this._offset,a);m.buffer=e,m.callback=r},_.inherits(a,d),_.inherits(s,d),_.inherits(l,d),_.inherits(u,d),_.inherits(c,d),_.inherits(h,d),_.inherits(f,d)}).call(this,e("_process"),e("buffer").Buffer)},{"./binding":16,_process:68,_stream_transform:73,assert:3,buffer:19,util:77}],18:[function(e,t,n){"use strict";function i(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0,n=e.length;t<n;++t)l[t]=e[t],u[e.charCodeAt(t)]=t;u["-".charCodeAt(0)]=62,u["_".charCodeAt(0)]=63}function r(e){var t,n,i,r,o,a,s=e.length;if(s%4>0)throw new Error("Invalid string. Length must be a multiple of 4");o="="===e[s-2]?2:"="===e[s-1]?1:0,a=new c(3*s/4-o),i=o>0?s-4:s;var l=0;for(t=0,n=0;t<i;t+=4,n+=3)r=u[e.charCodeAt(t)]<<18|u[e.charCodeAt(t+1)]<<12|u[e.charCodeAt(t+2)]<<6|u[e.charCodeAt(t+3)],a[l++]=r>>16&255,a[l++]=r>>8&255,a[l++]=255&r;return 2===o?(r=u[e.charCodeAt(t)]<<2|u[e.charCodeAt(t+1)]>>4,a[l++]=255&r):1===o&&(r=u[e.charCodeAt(t)]<<10|u[e.charCodeAt(t+1)]<<4|u[e.charCodeAt(t+2)]>>2,a[l++]=r>>8&255,a[l++]=255&r),a}function o(e){return l[e>>18&63]+l[e>>12&63]+l[e>>6&63]+l[63&e]}function a(e,t,n){for(var i,r=[],a=t;a<n;a+=3)i=(e[a]<<16)+(e[a+1]<<8)+e[a+2],r.push(o(i));return r.join("")}function s(e){for(var t,n=e.length,i=n%3,r="",o=[],s=16383,u=0,c=n-i;u<c;u+=s)o.push(a(e,u,u+s>c?c:u+s));return 1===i?(t=e[n-1],r+=l[t>>2],r+=l[t<<4&63],r+="=="):2===i&&(t=(e[n-2]<<8)+e[n-1],r+=l[t>>10],r+=l[t>>4&63],r+=l[t<<2&63],r+="="),o.push(r),o.join("")}n.toByteArray=r,n.fromByteArray=s;var l=[],u=[],c="undefined"!=typeof Uint8Array?Uint8Array:Array;i()},{}],19:[function(e,t,n){(function(t){"use strict";function i(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}function r(){return a.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function o(e,t){if(r()<t)throw new RangeError("Invalid typed array length");return a.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t),e.__proto__=a.prototype):(null===e&&(e=new a(t)),e.length=t),e}function a(e,t,n){if(!(a.TYPED_ARRAY_SUPPORT||this instanceof a))return new a(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return c(this,e)}return s(this,e,t,n)}function s(e,t,n,i){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?d(e,t,n,i):"string"==typeof t?h(e,t,n):p(e,t)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number')}function u(e,t,n,i){return l(t),t<=0?o(e,t):void 0!==n?"string"==typeof i?o(e,t).fill(n,i):o(e,t).fill(n):o(e,t)}function c(e,t){if(l(t),e=o(e,t<0?0:0|m(t)),!a.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function h(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!a.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var i=0|g(t,n);e=o(e,i);var r=e.write(t,n);return r!==i&&(e=e.slice(0,r)),e}function f(e,t){var n=0|m(t.length);e=o(e,n);for(var i=0;i<n;i+=1)e[i]=255&t[i];return e}function d(e,t,n,i){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(i||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===i?new Uint8Array(t):void 0===i?new Uint8Array(t,n):new Uint8Array(t,n,i),a.TYPED_ARRAY_SUPPORT?(e=t,e.__proto__=a.prototype):e=f(e,t),e}function p(e,t){if(a.isBuffer(t)){var n=0|m(t.length);return e=o(e,n),0===e.length?e:(t.copy(e,0,0,n),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||J(t.length)?o(e,0):f(e,t);if("Buffer"===t.type&&$(t.data))return f(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function m(e){if(e>=r())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r().toString(16)+" bytes");return 0|e}function _(e){return+e!=e&&(e=0),a.alloc(+e)}function g(e,t){if(a.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return G(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return W(e).length;default:if(i)return G(e).length;t=(""+t).toLowerCase(),i=!0}}function y(e,t,n){var i=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if(n>>>=0,t>>>=0,n<=t)return"";for(e||(e="utf8");;)switch(e){case"hex":return C(this,t,n);case"utf8":case"utf-8":return A(this,t,n);case"ascii":return O(this,t,n);case"latin1":case"binary":return M(this,t,n);case"base64":return P(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,t,n);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}function v(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function b(e,t,n,i,r){if(0===e.length)return-1;if("string"==typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=r?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(r)return-1;n=e.length-1}else if(n<0){if(!r)return-1;n=0}if("string"==typeof t&&(t=a.from(t,i)),a.isBuffer(t))return 0===t.length?-1:w(e,t,n,i,r);if("number"==typeof t)return t&=255,a.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):w(e,[t],n,i,r);throw new TypeError("val must be string, number or Buffer")}function w(e,t,n,i,r){function o(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}var a=1,s=e.length,l=t.length;if(void 0!==i&&(i=String(i).toLowerCase(),"ucs2"===i||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;a=2,s/=2,l/=2,n/=2}var u;if(r){var c=-1;for(u=n;u<s;u++)if(o(e,u)===o(t,c===-1?0:u-c)){if(c===-1&&(c=u),u-c+1===l)return c*a}else c!==-1&&(u-=u-c),c=-1}else for(n+l>s&&(n=s-l),u=n;u>=0;u--){for(var h=!0,f=0;f<l;f++)if(o(e,u+f)!==o(t,f)){h=!1;break}if(h)return u}return-1}function x(e,t,n,i){n=Number(n)||0;var r=e.length-n;i?(i=Number(i),i>r&&(i=r)):i=r;var o=t.length;if(o%2!==0)throw new TypeError("Invalid hex string");i>o/2&&(i=o/2);for(var a=0;a<i;++a){var s=parseInt(t.substr(2*a,2),16);if(isNaN(s))return a;e[n+a]=s}return a}function k(e,t,n,i){return X(G(t,e.length-n),e,n,i)}function E(e,t,n,i){return X(Z(t),e,n,i)}function S(e,t,n,i){return E(e,t,n,i)}function I(e,t,n,i){return X(W(t),e,n,i)}function T(e,t,n,i){return X(Y(t,e.length-n),e,n,i)}function P(e,t,n){return 0===t&&n===e.length?K.fromByteArray(e):K.fromByteArray(e.slice(t,n))}function A(e,t,n){n=Math.min(e.length,n);for(var i=[],r=t;r<n;){var o=e[r],a=null,s=o>239?4:o>223?3:o>191?2:1;if(r+s<=n){var l,u,c,h;switch(s){case 1:o<128&&(a=o);break;case 2:l=e[r+1],128===(192&l)&&(h=(31&o)<<6|63&l,h>127&&(a=h));break;case 3:l=e[r+1],u=e[r+2],128===(192&l)&&128===(192&u)&&(h=(15&o)<<12|(63&l)<<6|63&u,h>2047&&(h<55296||h>57343)&&(a=h));break;case 4:l=e[r+1],u=e[r+2],c=e[r+3],128===(192&l)&&128===(192&u)&&128===(192&c)&&(h=(15&o)<<18|(63&l)<<12|(63&u)<<6|63&c,h>65535&&h<1114112&&(a=h))}}null===a?(a=65533,s=1):a>65535&&(a-=65536,i.push(a>>>10&1023|55296),a=56320|1023&a),i.push(a),r+=s}return D(i)}function D(e){var t=e.length;if(t<=ee)return String.fromCharCode.apply(String,e);for(var n="",i=0;i<t;)n+=String.fromCharCode.apply(String,e.slice(i,i+=ee));return n}function O(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(127&e[r]);return i}function M(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(e[r]);return i}function C(e,t,n){var i=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>i)&&(n=i);for(var r="",o=t;o<n;++o)r+=q(e[o]);return r}function R(e,t,n){for(var i=e.slice(t,n),r="",o=0;o<i.length;o+=2)r+=String.fromCharCode(i[o]+256*i[o+1]);return r}function L(e,t,n){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function F(e,t,n,i,r,o){if(!a.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<o)throw new RangeError('"value" argument is out of bounds');if(n+i>e.length)throw new RangeError("Index out of range")}function z(e,t,n,i){t<0&&(t=65535+t+1);for(var r=0,o=Math.min(e.length-n,2);r<o;++r)e[n+r]=(t&255<<8*(i?r:1-r))>>>8*(i?r:1-r)}function B(e,t,n,i){t<0&&(t=4294967295+t+1);for(var r=0,o=Math.min(e.length-n,4);r<o;++r)e[n+r]=t>>>8*(i?r:3-r)&255}function U(e,t,n,i,r,o){if(n+i>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function N(e,t,n,i,r){return r||U(e,t,n,4,3.4028234663852886e38,-3.4028234663852886e38),Q.write(e,t,n,i,23,4),n+4}function j(e,t,n,i,r){return r||U(e,t,n,8,1.7976931348623157e308,-1.7976931348623157e308),Q.write(e,t,n,i,52,8),n+8}function V(e){if(e=H(e).replace(te,""),e.length<2)return"";for(;e.length%4!==0;)e+="=";return e}function H(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function q(e){return e<16?"0"+e.toString(16):e.toString(16)}function G(e,t){t=t||1/0;for(var n,i=e.length,r=null,o=[],a=0;a<i;++a){if(n=e.charCodeAt(a),n>55295&&n<57344){if(!r){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===i){(t-=3)>-1&&o.push(239,191,189);continue}r=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),r=n;continue}n=(r-55296<<10|n-56320)+65536}else r&&(t-=3)>-1&&o.push(239,191,189);if(r=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function Z(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}function Y(e,t){for(var n,i,r,o=[],a=0;a<e.length&&!((t-=2)<0);++a)n=e.charCodeAt(a),i=n>>8,r=n%256,o.push(r),o.push(i);return o}function W(e){return K.toByteArray(V(e))}function X(e,t,n,i){for(var r=0;r<i&&!(r+n>=t.length||r>=e.length);++r)t[r+n]=e[r];return r}function J(e){return e!==e}var K=e("base64-js"),Q=e("ieee754"),$=e("isarray");n.Buffer=a,n.SlowBuffer=_,n.INSPECT_MAX_BYTES=50,a.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:i(),n.kMaxLength=r(),a.poolSize=8192,a._augment=function(e){return e.__proto__=a.prototype,e},a.from=function(e,t,n){return s(null,e,t,n)},a.TYPED_ARRAY_SUPPORT&&(a.prototype.__proto__=Uint8Array.prototype,a.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&a[Symbol.species]===a&&Object.defineProperty(a,Symbol.species,{value:null,configurable:!0})),a.alloc=function(e,t,n){return u(null,e,t,n)},a.allocUnsafe=function(e){return c(null,e)},a.allocUnsafeSlow=function(e){return c(null,e)},a.isBuffer=function(e){return!(null==e||!e._isBuffer)},a.compare=function(e,t){if(!a.isBuffer(e)||!a.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,i=t.length,r=0,o=Math.min(n,i);r<o;++r)if(e[r]!==t[r]){n=e[r],i=t[r];break}return n<i?-1:i<n?1:0},a.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(e,t){if(!$(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return a.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var i=a.allocUnsafe(t),r=0;for(n=0;n<e.length;++n){var o=e[n];if(!a.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(i,r),r+=o.length}return i},a.byteLength=g,a.prototype._isBuffer=!0,a.prototype.swap16=function(){var e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)v(this,t,t+1);return this},a.prototype.swap32=function(){var e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)v(this,t,t+3),v(this,t+1,t+2);return this},a.prototype.swap64=function(){var e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)v(this,t,t+7),v(this,t+1,t+6),v(this,t+2,t+5),v(this,t+3,t+4);return this},a.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?A(this,0,e):y.apply(this,arguments)},a.prototype.equals=function(e){if(!a.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===a.compare(this,e)},a.prototype.inspect=function(){var e="",t=n.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"},a.prototype.compare=function(e,t,n,i,r){if(!a.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),t<0||n>e.length||i<0||r>this.length)throw new RangeError("out of range index");if(i>=r&&t>=n)return 0;if(i>=r)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,i>>>=0,r>>>=0,this===e)return 0;for(var o=r-i,s=n-t,l=Math.min(o,s),u=this.slice(i,r),c=e.slice(t,n),h=0;h<l;++h)if(u[h]!==c[h]){o=u[h],s=c[h];break}return o<s?-1:s<o?1:0},a.prototype.includes=function(e,t,n){return this.indexOf(e,t,n)!==-1},a.prototype.indexOf=function(e,t,n){return b(this,e,t,n,!0)},a.prototype.lastIndexOf=function(e,t,n){return b(this,e,t,n,!1)},a.prototype.write=function(e,t,n,i){if(void 0===t)i="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)i=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===i&&(i="utf8")):(i=n,n=void 0)}var r=this.length-t;if((void 0===n||n>r)&&(n=r),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var o=!1;;)switch(i){case"hex":return x(this,e,t,n);case"utf8":case"utf-8":return k(this,e,t,n);case"ascii":return E(this,e,t,n);case"latin1":case"binary":return S(this,e,t,n);case"base64":return I(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return T(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),o=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var ee=4096;a.prototype.slice=function(e,t){var n=this.length;e=~~e,t=void 0===t?n:~~t,e<0?(e+=n,e<0&&(e=0)):e>n&&(e=n),t<0?(t+=n,t<0&&(t=0)):t>n&&(t=n),t<e&&(t=e);var i;if(a.TYPED_ARRAY_SUPPORT)i=this.subarray(e,t),i.__proto__=a.prototype;else{var r=t-e;i=new a(r,void 0);for(var o=0;o<r;++o)i[o]=this[o+e]}return i},a.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||L(e,t,this.length);for(var i=this[e],r=1,o=0;++o<t&&(r*=256);)i+=this[e+o]*r;return i},a.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||L(e,t,this.length);for(var i=this[e+--t],r=1;t>0&&(r*=256);)i+=this[e+--t]*r;return i},a.prototype.readUInt8=function(e,t){return t||L(e,1,this.length),this[e]},a.prototype.readUInt16LE=function(e,t){return t||L(e,2,this.length),this[e]|this[e+1]<<8},a.prototype.readUInt16BE=function(e,t){return t||L(e,2,this.length),this[e]<<8|this[e+1]},a.prototype.readUInt32LE=function(e,t){return t||L(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},a.prototype.readUInt32BE=function(e,t){return t||L(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},a.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||L(e,t,this.length);for(var i=this[e],r=1,o=0;++o<t&&(r*=256);)i+=this[e+o]*r;return r*=128,i>=r&&(i-=Math.pow(2,8*t)),i},a.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||L(e,t,this.length);for(var i=t,r=1,o=this[e+--i];i>0&&(r*=256);)o+=this[e+--i]*r;return r*=128,o>=r&&(o-=Math.pow(2,8*t)),o},a.prototype.readInt8=function(e,t){return t||L(e,1,this.length),128&this[e]?(255-this[e]+1)*-1:this[e]},a.prototype.readInt16LE=function(e,t){t||L(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt16BE=function(e,t){t||L(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt32LE=function(e,t){return t||L(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},a.prototype.readInt32BE=function(e,t){return t||L(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},a.prototype.readFloatLE=function(e,t){return t||L(e,4,this.length),Q.read(this,e,!0,23,4)},a.prototype.readFloatBE=function(e,t){return t||L(e,4,this.length),Q.read(this,e,!1,23,4)},a.prototype.readDoubleLE=function(e,t){return t||L(e,8,this.length),Q.read(this,e,!0,52,8)},a.prototype.readDoubleBE=function(e,t){return t||L(e,8,this.length),Q.read(this,e,!1,52,8)},a.prototype.writeUIntLE=function(e,t,n,i){if(e=+e,t|=0,n|=0,!i){var r=Math.pow(2,8*n)-1;F(this,e,t,n,r,0)}var o=1,a=0;for(this[t]=255&e;++a<n&&(o*=256);)this[t+a]=e/o&255;return t+n},a.prototype.writeUIntBE=function(e,t,n,i){if(e=+e,t|=0,n|=0,!i){var r=Math.pow(2,8*n)-1;F(this,e,t,n,r,0)}var o=n-1,a=1;for(this[t+o]=255&e;--o>=0&&(a*=256);)this[t+o]=e/a&255;return t+n},a.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||F(this,e,t,1,255,0),a.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},a.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||F(this,e,t,2,65535,0),a.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):z(this,e,t,!0),t+2},a.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||F(this,e,t,2,65535,0),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):z(this,e,t,!1),t+2},a.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||F(this,e,t,4,4294967295,0),a.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):B(this,e,t,!0),t+4},a.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||F(this,e,t,4,4294967295,0),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):B(this,e,t,!1),t+4},a.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t|=0,!i){var r=Math.pow(2,8*n-1);F(this,e,t,n,r-1,-r)}var o=0,a=1,s=0;for(this[t]=255&e;++o<n&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},a.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t|=0,!i){var r=Math.pow(2,8*n-1);F(this,e,t,n,r-1,-r)}var o=n-1,a=1,s=0;for(this[t+o]=255&e;--o>=0&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},a.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||F(this,e,t,1,127,-128),a.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},a.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||F(this,e,t,2,32767,-32768),a.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):z(this,e,t,!0),t+2},a.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||F(this,e,t,2,32767,-32768),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):z(this,e,t,!1),t+2},a.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||F(this,e,t,4,2147483647,-2147483648),a.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):B(this,e,t,!0),t+4},a.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||F(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):B(this,e,t,!1),t+4},a.prototype.writeFloatLE=function(e,t,n){return N(this,e,t,!0,n)},a.prototype.writeFloatBE=function(e,t,n){return N(this,e,t,!1,n)},a.prototype.writeDoubleLE=function(e,t,n){return j(this,e,t,!0,n)},a.prototype.writeDoubleBE=function(e,t,n){return j(this,e,t,!1,n)},a.prototype.copy=function(e,t,n,i){if(n||(n=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);var r,o=i-n;if(this===e&&n<t&&t<i)for(r=o-1;r>=0;--r)e[r+t]=this[r+n];else if(o<1e3||!a.TYPED_ARRAY_SUPPORT)for(r=0;r<o;++r)e[r+t]=this[r+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},a.prototype.fill=function(e,t,n,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),1===e.length){var r=e.charCodeAt(0);r<256&&(e=r)}if(void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!a.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;t>>>=0,n=void 0===n?this.length:n>>>0,
e||(e=0);var o;if("number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var s=a.isBuffer(e)?e:G(new a(e,i).toString()),l=s.length;for(o=0;o<n-t;++o)this[o+t]=s[o%l]}return this};var te=/[^+\/0-9A-Za-z-_]/g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"base64-js":18,ieee754:26,isarray:29}],20:[function(e,t,n){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function o(e){return"number"==typeof e}function a(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}t.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(e){if(!o(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},i.prototype.emit=function(e){var t,n,i,o,l,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||a(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}if(n=this._events[e],s(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),n.apply(this,o)}else if(a(n))for(o=Array.prototype.slice.call(arguments,1),u=n.slice(),i=u.length,l=0;l<i;l++)u[l].apply(this,o);return!0},i.prototype.addListener=function(e,t){var n;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?a(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,a(this._events[e])&&!this._events[e].warned&&(n=s(this._maxListeners)?i.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())),this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(e,t){function n(){this.removeListener(e,n),i||(i=!0,t.apply(this,arguments))}if(!r(t))throw TypeError("listener must be a function");var i=!1;return n.listener=t,this.on(e,n),this},i.prototype.removeListener=function(e,t){var n,i,o,s;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],o=n.length,i=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(a(n)){for(s=o;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){i=s;break}if(i<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},i.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],r(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},i.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},i.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},i.listenerCount=function(e,t){return e.listenerCount(t)}},{}],21:[function(e,t,n){(function(t){"use strict";var i=e("buffer"),r=i.Buffer,o=i.SlowBuffer,a=i.kMaxLength||2147483647;n.alloc=function(e,t,n){if("function"==typeof r.alloc)return r.alloc(e,t,n);if("number"==typeof n)throw new TypeError("encoding must not be number");if("number"!=typeof e)throw new TypeError("size must be a number");if(e>a)throw new RangeError("size is too large");var i=n,o=t;void 0===o&&(i=void 0,o=0);var s=new r(e);if("string"==typeof o)for(var l=new r(o,i),u=l.length,c=-1;++c<e;)s[c]=l[c%u];else s.fill(o);return s},n.allocUnsafe=function(e){if("function"==typeof r.allocUnsafe)return r.allocUnsafe(e);if("number"!=typeof e)throw new TypeError("size must be a number");if(e>a)throw new RangeError("size is too large");return new r(e)},n.from=function(e,n,i){if("function"==typeof r.from&&(!t.Uint8Array||Uint8Array.from!==r.from))return r.from(e,n,i);if("number"==typeof e)throw new TypeError('"value" argument must not be a number');if("string"==typeof e)return new r(e,n);if("undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer){var o=n;if(1===arguments.length)return new r(e);"undefined"==typeof o&&(o=0);var a=i;if("undefined"==typeof a&&(a=e.byteLength-o),o>=e.byteLength)throw new RangeError("'offset' is out of bounds");if(a>e.byteLength-o)throw new RangeError("'length' is out of bounds");return new r(e.slice(o,o+a))}if(r.isBuffer(e)){var s=new r(e.length);return e.copy(s,0,0,e.length),s}if(e){if(Array.isArray(e)||"undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return new r(e);if("Buffer"===e.type&&Array.isArray(e.data))return new r(e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")},n.allocUnsafeSlow=function(e){if("function"==typeof r.allocUnsafeSlow)return r.allocUnsafeSlow(e);if("number"!=typeof e)throw new TypeError("size must be a number");if(e>=a)throw new RangeError("size is too large");return new o(e)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{buffer:19}],22:[function(e,t,n){"use strict";var i=new Float32Array(1),r=new Uint32Array(i.buffer),o=4286578688;r[0]=o,t.exports=i[0]},{}],23:[function(e,t,n){"use strict";var i=new Float32Array(1),r=new Uint32Array(i.buffer),o=2139095040;r[0]=o,t.exports=i[0]},{}],24:[function(e,t,n){(function(e){function t(e){return Array.isArray?Array.isArray(e):"[object Array]"===_(e)}function i(e){return"boolean"==typeof e}function r(e){return null===e}function o(e){return null==e}function a(e){return"number"==typeof e}function s(e){return"string"==typeof e}function l(e){return"symbol"==typeof e}function u(e){return void 0===e}function c(e){return"[object RegExp]"===_(e)}function h(e){return"object"==typeof e&&null!==e}function f(e){return"[object Date]"===_(e)}function d(e){return"[object Error]"===_(e)||e instanceof Error}function p(e){return"function"==typeof e}function m(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function _(e){return Object.prototype.toString.call(e)}n.isArray=t,n.isBoolean=i,n.isNull=r,n.isNullOrUndefined=o,n.isNumber=a,n.isString=s,n.isSymbol=l,n.isUndefined=u,n.isRegExp=c,n.isObject=h,n.isDate=f,n.isError=d,n.isFunction=p,n.isPrimitive=m,n.isBuffer=e.isBuffer}).call(this,{isBuffer:e("../../is-buffer/index.js")})},{"../../is-buffer/index.js":28}],25:[function(t,n,i){(function(i){!function(t,i){"undefined"!=typeof n&&n.exports?n.exports=i():"function"==typeof e&&e.amd?e([],i):("undefined"==typeof cornerstone&&(dicomParser={},"undefined"!=typeof Package&&(t.dicomParser=dicomParser)),dicomParser=i())}(this,function(){var e=function(e){return void 0===e&&(e={}),e.parseDicom=function(i,r){function o(t){if(void 0===t.elements.x00020010)throw"dicomParser.parseDicom: missing required meta header attribute 0002,0010";var n=t.elements.x00020010;return e.readFixedString(i,n.dataOffset,n.length)}function a(e){return"1.2.840.10008.1.2"!==e}function s(o,a){if("1.2.840.10008.1.2.1.99"===o){if(r&&r.inflater){var s=r.inflater(i,a);return new e.ByteStream(e.littleEndianByteArrayParser,s,0)}if("undefined"!=typeof n&&this.module!==n){var l=t("zlib"),u=e.sharedCopy(i,a,i.length-a),c=l.inflateRawSync(u),h=e.alloc(i,c.length+a);return i.copy(h,0,0,a),c.copy(h,a),new e.ByteStream(e.littleEndianByteArrayParser,h,0)}if("undefined"!=typeof pako){var f=i.slice(a),d=pako.inflateRaw(f),p=e.alloc(i,d.length+a);return p.set(i.slice(0,a),0),p.set(d,a),new e.ByteStream(e.littleEndianByteArrayParser,p,0)}throw"dicomParser.parseDicom: no inflater available to handle deflate transfer syntax"}return"1.2.840.10008.1.2.2"===o?new e.ByteStream(e.bigEndianByteArrayParser,i,a):new e.ByteStream(e.littleEndianByteArrayParser,i,a)}function l(e,t){for(var n in e.elements)e.elements.hasOwnProperty(n)&&(t.elements[n]=e.elements[n]);return void 0!==e.warnings&&(t.warnings=e.warnings.concat(t.warnings)),t}function u(t){var n=o(t),i=a(n),l=s(n,t.position),u={},c=new e.DataSet(l.byteArrayParser,l.byteArray,u);c.warnings=l.warnings;try{i?e.parseDicomDataSetExplicit(c,l,l.byteArray.length,r):e.parseDicomDataSetImplicit(c,l,l.byteArray.length,r)}catch(e){var h={exception:e,dataSet:c};throw h}return c}function c(){var t=e.readPart10Header(i,r),n=u(t);return l(t,n)}if(void 0===i)throw"dicomParser.parseDicom: missing required parameter 'byteArray'";return c()},e}(e),e=function(e){"use strict";function t(e,t){return 255===e.byteArray[t]&&217===e.byteArray[t+1]}function n(e,n,i){var r=n.fragments[i];return!(!t(e,r.position+r.length-2)&&!t(e,r.position+r.length-3))}function i(e,t,i){for(var r=i;r<t.fragments.length;r++)if(n(e,t,r))return r}return void 0===e&&(e={}),e.createJPEGBasicOffsetTable=function(e,t,n){if(void 0===e)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter dataSet";if(void 0===t)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter pixelDataElement";if("x7fe00010"!==t.tag)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010'";if(t.encapsulatedPixelData!==!0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(t.hadUndefinedLength!==!0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.basicOffsetTable)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.fragments)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(t.fragments.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(n&&n.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'fragments' must not be zero length";n=n||t.fragments;for(var r=[],o=0;;){r.push(t.fragments[o].offset);var a=i(e,t,o);if(void 0===a||a===t.fragments.length-1)return r;o=a+1}},e}(e),e=function(e){"use strict";return void 0===e&&(e={}),e.explicitDataSetToJS=function(t,n){if(void 0===t)throw"dicomParser.explicitDataSetToJS: missing required parameter dataSet";n=n||{omitPrivateAttibutes:!0,maxElementLength:128};var i={};for(var r in t.elements){var o=t.elements[r];if(n.omitPrivateAttibutes!==!0||!e.isPrivateTag(r))if(o.items){for(var a=[],s=0;s<o.items.length;s++)a.push(e.explicitDataSetToJS(o.items[s].dataSet,n));i[r]=a}else{var l;l=void 0,o.length<n.maxElementLength&&(l=e.explicitElementToString(t,o)),void 0!==l?i[r]=l:i[r]={dataOffset:o.dataOffset,length:o.length}}}return i},e}(e),e=function(e){"use strict";return void 0===e&&(e={}),e.explicitElementToString=function(t,n){function i(e,n){for(var i="",r=0;r<e;r++)0!==r&&(i+="/"),i+=n.call(t,a,r).toString();return i}if(void 0===t||void 0===n)throw"dicomParser.explicitElementToString: missing required parameters";if(void 0===n.vr)throw"dicomParser.explicitElementToString: cannot convert implicit element to string";var r,o=n.vr,a=n.tag;if(e.isStringVr(o)===!0)r=t.string(a);else{if("AT"==o){var s=t.uint32(a);if(void 0===s)return;return s<0&&(s=4294967295+s+1),"x"+s.toString(16).toUpperCase()}"US"==o?r=i(n.length/2,t.uint16):"SS"===o?r=i(n.length/2,t.int16):"UL"==o?r=i(n.length/4,t.uint32):"SL"===o?r=i(n.length/4,t.int32):"FD"==o?r=i(n.length/8,t.double):"FL"==o&&(r=i(n.length/4,t.float))}return r},e}(e),e=function(e){"use strict";function t(e,t){switch(e){case 2:return t%4==0&&t%100||t%400==0?29:28;case 9:case 4:case 6:case 11:return 30;default:return 31}}function n(e,n,i){return!isNaN(i)&&(n>0&&n<=12&&e>0&&e<=t(n,i))}return void 0===e&&(e={}),e.parseDA=function(e,t){if(e&&8===e.length){var i=parseInt(e.substring(0,4),10),r=parseInt(e.substring(4,6),10),o=parseInt(e.substring(6,8),10);if(t&&n(o,r,i)!==!0)throw"invalid DA '"+e+"'";return{year:i,month:r,day:o}}if(t)throw"invalid DA '"+e+"'"},e}(e),e=function(e){"use strict";return void 0===e&&(e={}),e.parseTM=function(e,t){if(e.length>=2){var n=parseInt(e.substring(0,2),10),i=e.length>=4?parseInt(e.substring(2,4),10):void 0,r=e.length>=6?parseInt(e.substring(4,6),10):void 0,o=e.length>=8?parseInt(e.substring(7,13),10):void 0;if(t&&(isNaN(n)||void 0!==i&&isNaN(i)||void 0!==r&&isNaN(r)||void 0!==o&&isNaN(o)||n<0||n>23||i&&(i<0||i>59)||r&&(r<0||r>59)||o&&(o<0||o>999999)))throw"invalid TM '"+e+"'";return{hours:n,minutes:i,seconds:r,fractionalSeconds:o}}if(t)throw"invalid TM '"+e+"'"},e}(e),e=function(e){"use strict";void 0===e&&(e={});var t={AE:!0,AS:!0,AT:!1,CS:!0,DA:!0,DS:!0,DT:!0,FL:!1,FD:!1,IS:!0,LO:!0,LT:!0,OB:!1,OD:!1,OF:!1,OW:!1,PN:!0,SH:!0,SL:!1,SQ:!1,SS:!1,ST:!0,TM:!0,UI:!0,UL:!1,UN:void 0,UR:!0,US:!1,UT:!0};return e.isStringVr=function(e){return t[e]},e.isPrivateTag=function(e){var t=parseInt(e[4]),n=t%2===1;return n},e.parsePN=function(e){if(void 0!==e){var t=e.split("^");return{familyName:t[0],givenName:t[1],middleName:t[2],prefix:t[3],suffix:t[4]}}},e}(e),e=function(e){"use strict";void 0===e&&(e={});var t=!1;return e.readEncapsulatedPixelData=function(n,i,r){if(t||(t=!0,console&&console.log&&console.log("WARNING: dicomParser.readEncapsulatedPixelData() has been deprecated")),void 0===n)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'dataSet'";if(void 0===i)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'element'";if(void 0===r)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'frame'";if("x7fe00010"!==i.tag)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to non pixel data tag (expected tag = x7fe00010'";if(i.encapsulatedPixelData!==!0)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(i.hadUndefinedLength!==!0)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===i.basicOffsetTable)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===i.fragments)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(r<0)throw"dicomParser.readEncapsulatedPixelData: parameter 'frame' must be >= 0";return 0!==i.basicOffsetTable.length?e.readEncapsulatedImageFrame(n,i,r):e.readEncapsulatedPixelDataFromFragments(n,i,0,i.fragments.length)},e}(e),e=function(e){"use strict";return void 0===e&&(e={}),e.alloc=function(e,t){if("undefined"!=typeof i&&e instanceof i)return i.alloc(t);if(e instanceof Uint8Array)return new Uint8Array(t);throw"dicomParser.alloc: unknown type for byteArray"},e}(e),e=function(e){"use strict";return void 0===e&&(e={}),e.bigEndianByteArrayParser={readUint16:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readUint16: position cannot be less than 0";if(t+2>e.length)throw"bigEndianByteArrayParser.readUint16: attempt to read past end of buffer";return(e[t]<<8)+e[t+1]},readInt16:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readInt16: position cannot be less than 0";if(t+2>e.length)throw"bigEndianByteArrayParser.readInt16: attempt to read past end of buffer";var n=(e[t]<<8)+e[t+1];return 32768&n&&(n=n-65535-1),n},readUint32:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readUint32: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readUint32: attempt to read past end of buffer";var n=256*(256*(256*e[t]+e[t+1])+e[t+2])+e[t+3];return n},readInt32:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readInt32: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readInt32: attempt to read past end of buffer";var n=(e[t]<<24)+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3];return n},readFloat:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readFloat: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readFloat: attempt to read past end of buffer";var n=new Uint8Array(4);n[3]=e[t],n[2]=e[t+1],n[1]=e[t+2],n[0]=e[t+3];var i=new Float32Array(n.buffer);return i[0]},readDouble:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readDouble: position cannot be less than 0";if(t+8>e.length)throw"bigEndianByteArrayParser.readDouble: attempt to read past end of buffer";var n=new Uint8Array(8);n[7]=e[t],n[6]=e[t+1],n[5]=e[t+2],n[4]=e[t+3],n[3]=e[t+4],n[2]=e[t+5],n[1]=e[t+6],n[0]=e[t+7];var i=new Float64Array(n.buffer);return i[0]}},e}(e),e=function(e){"use strict";return void 0===e&&(e={}),e.readFixedString=function(e,t,n){if(n<0)throw"dicomParser.readFixedString - length cannot be less than 0";if(t+n>e.length)throw"dicomParser.readFixedString: attempt to read past end of buffer";for(var i,r="",o=0;o<n;o++){if(i=e[t+o],0===i)return t+=n,r;r+=String.fromCharCode(i)}return r},e}(e),e=function(e){"use strict";return void 0===e&&(e={}),e.ByteStream=function(e,t,n){if(void 0===e)throw"dicomParser.ByteStream: missing required parameter 'byteArrayParser'";if(void 0===t)throw"dicomParser.ByteStream: missing required parameter 'byteArray'";if(t instanceof Uint8Array==!1&&t instanceof i==!1)throw"dicomParser.ByteStream: parameter byteArray is not of type Uint8Array or Buffer";if(n<0)throw"dicomParser.ByteStream: parameter 'position' cannot be less than 0";if(n>=t.length)throw"dicomParser.ByteStream: parameter 'position' cannot be greater than or equal to 'byteArray' length";this.byteArrayParser=e,this.byteArray=t,this.position=n?n:0,this.warnings=[]},e.ByteStream.prototype.seek=function(e){if(this.position+e<0)throw"dicomParser.ByteStream.prototype.seek: cannot seek to position < 0";this.position+=e},e.ByteStream.prototype.readByteStream=function(t){if(this.position+t>this.byteArray.length)throw"dicomParser.ByteStream.prototype.readByteStream: readByteStream - buffer overread";var n=e.sharedCopy(this.byteArray,this.position,t);return this.position+=t,new e.ByteStream(this.byteArrayParser,n)},e.ByteStream.prototype.readUint16=function(){var e=this.byteArrayParser.readUint16(this.byteArray,this.position);return this.position+=2,e},e.ByteStream.prototype.readUint32=function(){var e=this.byteArrayParser.readUint32(this.byteArray,this.position);return this.position+=4,e},e.ByteStream.prototype.readFixedString=function(t){var n=e.readFixedString(this.byteArray,this.position,t);return this.position+=t,n},e}(e),e=function(e){"use strict";function t(e,t){return void 0!==e.parser?e.parser:t}return void 0===e&&(e={}),e.DataSet=function(e,t,n){this.byteArrayParser=e,this.byteArray=t,this.elements=n},e.DataSet.prototype.uint16=function(e,n){var i=this.elements[e];if(n=void 0!==n?n:0,i&&0!==i.length)return t(i,this.byteArrayParser).readUint16(this.byteArray,i.dataOffset+2*n)},e.DataSet.prototype.int16=function(e,n){var i=this.elements[e];if(n=void 0!==n?n:0,i&&0!==i.length)return t(i,this.byteArrayParser).readInt16(this.byteArray,i.dataOffset+2*n)},e.DataSet.prototype.uint32=function(e,n){var i=this.elements[e];if(n=void 0!==n?n:0,i&&0!==i.length)return t(i,this.byteArrayParser).readUint32(this.byteArray,i.dataOffset+4*n)},e.DataSet.prototype.int32=function(e,n){var i=this.elements[e];if(n=void 0!==n?n:0,i&&0!==i.length)return t(i,this.byteArrayParser).readInt32(this.byteArray,i.dataOffset+4*n)},e.DataSet.prototype.float=function(e,n){var i=this.elements[e];if(n=void 0!==n?n:0,i&&0!==i.length)return t(i,this.byteArrayParser).readFloat(this.byteArray,i.dataOffset+4*n)},e.DataSet.prototype.double=function(e,n){var i=this.elements[e];if(n=void 0!==n?n:0,i&&0!==i.length)return t(i,this.byteArrayParser).readDouble(this.byteArray,i.dataOffset+8*n)},e.DataSet.prototype.numStringValues=function(t){var n=this.elements[t];if(n&&n.length>0){var i=e.readFixedString(this.byteArray,n.dataOffset,n.length),r=i.match(/\\/g);return null===r?1:r.length+1}},e.DataSet.prototype.string=function(t,n){var i=this.elements[t];if(i&&i.length>0){var r=e.readFixedString(this.byteArray,i.dataOffset,i.length);if(n>=0){var o=r.split("\\");return o[n].trim()}return r.trim()}},e.DataSet.prototype.text=function(t,n){var i=this.elements[t];if(i&&i.length>0){var r=e.readFixedString(this.byteArray,i.dataOffset,i.length);if(n>=0){var o=r.split("\\");return o[n].replace(/ +$/,"")}return r.replace(/ +$/,"")}},e.DataSet.prototype.floatString=function(e,t){var n=this.elements[e];if(n&&n.length>0){t=void 0!==t?t:0;var i=this.string(e,t);if(void 0!==i)return parseFloat(i)}},e.DataSet.prototype.intString=function(e,t){var n=this.elements[e];if(n&&n.length>0){t=void 0!==t?t:0;var i=this.string(e,t);if(void 0!==i)return parseInt(i)}},e}(e),e=function(e){"use strict";return void 0===e&&(e={}),e.findAndSetUNElementLength=function(e,t){if(void 0===e)throw"dicomParser.findAndSetUNElementLength: missing required parameter 'byteStream'";for(var n=8,i=e.byteArray.length-n;e.position<=i;){var r;if(r=e.readUint16(),65534===r){var o;if(o=e.readUint16(),57565===o){var a;return a=e.readUint32(),0!==a&&e.warnings("encountered non zero length following item delimiter at position"+e.position-4+" while reading element of undefined length with tag ' + element.tag"),void(t.length=e.position-t.dataOffset)}}}t.length=e.byteArray.length-t.dataOffset,e.seek(e.byteArray.length-e.position)},e}(e),e=function(e){"use strict";return void 0===e&&(e={}),e.findEndOfEncapsulatedElement=function(t,n,i){if(void 0===t)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'byteStream'";if(void 0===n)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'element'";n.encapsulatedPixelData=!0,n.basicOffsetTable=[],n.fragments=[];var r=e.readTag(t);if("xfffee000"!==r)throw"dicomParser.findEndOfEncapsulatedElement: basic offset table not found";for(var o=t.readUint32(),a=o/4,s=0;s<a;s++){var l=t.readUint32();n.basicOffsetTable.push(l)}for(var u=t.position;t.position<t.byteArray.length;){var c=e.readTag(t),h=t.readUint32();if("xfffee0dd"===c)return t.seek(h),void(n.length=t.position-n.dataOffset);if("xfffee000"!==c)return i&&i.push("unexpected tag "+c+" while searching for end of pixel data element with undefined length"),h>t.byteArray.length-t.position&&(h=t.byteArray.length-t.position),n.fragments.push({offset:t.position-u-8,position:t.position,length:h}),t.seek(h),void(n.length=t.position-n.dataOffset);n.fragments.push({offset:t.position-u-8,position:t.position,length:h}),t.seek(h)}i&&i.push("pixel data element "+n.tag+" missing sequence delimiter tag xfffee0dd")},e}(e),e=function(e){"use strict";return void 0===e&&(e={}),e.findItemDelimitationItemAndSetElementLength=function(e,t){if(void 0===e)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";for(var n=8,i=e.byteArray.length-n;e.position<=i;){var r=e.readUint16();if(65534===r){var o=e.readUint16();if(57357===o){var a=e.readUint32();return 0!==a&&e.warnings("encountered non zero length following item delimiter at position"+e.position-4+" while reading element of undefined length with tag ' + element.tag"),void(t.length=e.position-t.dataOffset)}}}t.length=e.byteArray.length-t.dataOffset,e.seek(e.byteArray.length-e.position)},e}(e),e=function(e){"use strict";return void 0===e&&(e={}),e.littleEndianByteArrayParser={readUint16:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readUint16: position cannot be less than 0";if(t+2>e.length)throw"littleEndianByteArrayParser.readUint16: attempt to read past end of buffer";return e[t]+256*e[t+1]},readInt16:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readInt16: position cannot be less than 0";if(t+2>e.length)throw"littleEndianByteArrayParser.readInt16: attempt to read past end of buffer";var n=e[t]+(e[t+1]<<8);return 32768&n&&(n=n-65535-1),n},readUint32:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readUint32: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readUint32: attempt to read past end of buffer";var n=e[t]+256*e[t+1]+256*e[t+2]*256+256*e[t+3]*256*256;return n},readInt32:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readInt32: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readInt32: attempt to read past end of buffer";var n=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return n},readFloat:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readFloat: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readFloat: attempt to read past end of buffer";var n=new Uint8Array(4);n[0]=e[t],n[1]=e[t+1],n[2]=e[t+2],n[3]=e[t+3];var i=new Float32Array(n.buffer);return i[0]},readDouble:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readDouble: position cannot be less than 0";if(t+8>e.length)throw"littleEndianByteArrayParser.readDouble: attempt to read past end of buffer";var n=new Uint8Array(8);n[0]=e[t],n[1]=e[t+1],n[2]=e[t+2],n[3]=e[t+3],n[4]=e[t+4],n[5]=e[t+5],n[6]=e[t+6],n[7]=e[t+7];var i=new Float64Array(n.buffer);return i[0]}},e}(e),e=function(e){"use strict";return void 0===e&&(e={}),e.parseDicomDataSetExplicit=function(t,n,i,r){if(i=void 0===i?n.byteArray.length:i,r=r||{},void 0===n)throw"dicomParser.parseDicomDataSetExplicit: missing required parameter 'byteStream'";if(i<n.position||i>n.byteArray.length)throw"dicomParser.parseDicomDataSetExplicit: invalid value for parameter 'maxPosition'";for(var o=t.elements;n.position<i;){var a=e.readDicomElementExplicit(n,t.warnings,r.untilTag);if(o[a.tag]=a,a.tag===r.untilTag)return}if(n.position>i)throw"dicomParser:parseDicomDataSetExplicit: buffer overrun"},e.parseDicomDataSetImplicit=function(t,n,i,r){if(i=void 0===i?t.byteArray.length:i,r=r||{},void 0===n)throw"dicomParser.parseDicomDataSetImplicit: missing required parameter 'byteStream'";if(i<n.position||i>n.byteArray.length)throw"dicomParser.parseDicomDataSetImplicit: invalid value for parameter 'maxPosition'";for(var o=t.elements;n.position<i;){var a=e.readDicomElementImplicit(n,r.untilTag,r.vrCallback);if(o[a.tag]=a,a.tag===r.untilTag)return}},e}(e),e=function(e){"use strict";function t(e){return"OB"===e||"OW"===e||"SQ"===e||"OF"===e||"UT"===e||"UN"===e?4:2}return void 0===e&&(e={}),e.readDicomElementExplicit=function(n,i,r){if(void 0===n)throw"dicomParser.readDicomElementExplicit: missing required parameter 'byteStream'";var o={tag:e.readTag(n),vr:n.readFixedString(2)},a=t(o.vr);return 2===a?(o.length=n.readUint16(),o.dataOffset=n.position):(n.seek(2),o.length=n.readUint32(),o.dataOffset=n.position),4294967295===o.length&&(o.hadUndefinedLength=!0),o.tag===r?o:"SQ"===o.vr?(e.readSequenceItemsExplicit(n,o,i),o):4294967295===o.length?"x7fe00010"===o.tag?(e.findEndOfEncapsulatedElement(n,o,i),o):"UN"===o.vr?(e.findAndSetUNElementLength(n,o),o):(e.readSequenceItemsImplicit(n,o),o):(n.seek(o.length),o)},e}(e),e=function(e){"use strict";function t(t,n,i){if("undefined"!=typeof i)return"SQ"===i(t.tag);if(n.position+4<=n.byteArray.length){var r=e.readTag(n);return n.seek(-4),"xfffee000"===r||"xfffee0dd"===r}return n.warnings.push("eof encountered before finding sequence item tag or sequence delimiter tag in peeking to determine VR"),!1}return void 0===e&&(e={}),e.readDicomElementImplicit=function(n,i,r){if(void 0===n)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";var o={tag:e.readTag(n),length:n.readUint32(),dataOffset:n.position};return 4294967295===o.length&&(o.hadUndefinedLength=!0),o.tag===i?o:t(o,n,r)?(e.readSequenceItemsImplicit(n,o),o):o.hadUndefinedLength?(e.findItemDelimitationItemAndSetElementLength(n,o),o):(n.seek(o.length),o)},e}(e),e=function(e){"use strict";function t(e,t){for(var n=0;n<e.length;n++)if(e[n].offset===t)return n}function n(e,t,n,i){if(e===t.length-1)return n.length-i;for(var r=t[e+1],o=i+1;o<n.length;o++)if(n[o].offset===r)return o-i;throw"dicomParser.calculateNumberOfFragmentsForFrame: could not find fragment with offset matching basic offset table"}return void 0===e&&(e={}),e.readEncapsulatedImageFrame=function(i,r,o,a,s){if(a=a||r.basicOffsetTable,s=s||r.fragments,void 0===i)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'dataSet'";if(void 0===r)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'pixelDataElement'";if(void 0===o)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'frameIndex'";if(void 0===a)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' does not have basicOffsetTable";if("x7fe00010"!==r.tag)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010'";if(r.encapsulatedPixelData!==!0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(r.hadUndefinedLength!==!0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have undefined length";if(void 0===r.fragments)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have fragments";if(0===a.length)throw"dicomParser.readEncapsulatedImageFrame: basicOffsetTable has zero entries";if(o<0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be >= 0";if(o>=a.length)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be < basicOffsetTable.length";var l=a[o],u=t(s,l);if(void 0===u)throw"dicomParser.readEncapsulatedImageFrame: unable to find fragment that matches basic offset table entry";var c=n(o,a,s,u);return e.readEncapsulatedPixelDataFromFragments(i,r,u,c,s)},e}(e),e=function(e){"use strict";function t(e,t,n){for(var i=0,r=t;r<t+n;r++)i+=e[r].length;return i}return void 0===e&&(e={}),e.readEncapsulatedPixelDataFromFragments=function(n,i,r,o,a){if(o=o||1,a=a||i.fragments,void 0===n)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'dataSet'";if(void 0===i)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'pixelDataElement'";if(void 0===r)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'startFragmentIndex'";if(void 0===o)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'numFragments'";if("x7fe00010"!==i.tag)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010'";if(i.encapsulatedPixelData!==!0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(i.hadUndefinedLength!==!0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";
if(void 0===i.basicOffsetTable)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===i.fragments)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(i.fragments.length<=0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(r<0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be >= 0";if(r>=i.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be < number of fragments";if(o<1)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'numFragments' must be > 0";if(r+o>i.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragment' + 'numFragments' < number of fragments";var s=new e.ByteStream(n.byteArrayParser,n.byteArray,i.dataOffset),l=e.readSequenceItem(s);if("xfffee000"!==l.tag)throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";s.seek(l.length);var u=s.position,c=8;if(1===o)return e.sharedCopy(s.byteArray,u+a[r].offset+c,a[r].length);for(var h=t(a,r,o),f=e.alloc(s.byteArray,h),d=0,p=r;p<r+o;p++)for(var m=u+a[p].offset+c,_=0;_<a[p].length;_++)f[d++]=s.byteArray[m++];return f},e}(e),e=function(e){return void 0===e&&(e={}),e.readPart10Header=function(t,n){function i(){o.seek(128);var e=o.readFixedString(4);if("DICM"!==e)throw"dicomParser.readPart10Header: DICM prefix not found at location 132 - this is not a valid DICOM P10 file."}function r(){i();for(var t=[],n={};o.position<o.byteArray.length;){var r=o.position,a=e.readDicomElementExplicit(o,t);if(a.tag>"x0002ffff"){o.position=r;break}a.parser=e.littleEndianByteArrayParser,n[a.tag]=a}var s=new e.DataSet(o.byteArrayParser,o.byteArray,n);return s.warnings=o.warnings,s.position=o.position,s}if(void 0===t)throw"dicomParser.readPart10Header: missing required parameter 'byteArray'";var o=new e.ByteStream(e.littleEndianByteArrayParser,t);return r()},e}(e),e=function(e){"use strict";function t(t,n){for(var i={};t.position<t.byteArray.length;){var r=e.readDicomElementExplicit(t,n);if(i[r.tag]=r,"xfffee00d"===r.tag)return new e.DataSet(t.byteArrayParser,t.byteArray,i)}return n.push("eof encountered before finding item delimiter tag while reading sequence item of undefined length"),new e.DataSet(t.byteArrayParser,t.byteArray,i)}function n(n,i){var r=e.readSequenceItem(n);return 4294967295===r.length?(r.hadUndefinedLength=!0,r.dataSet=t(n,i),r.length=n.position-r.dataOffset):(r.dataSet=new e.DataSet(n.byteArrayParser,n.byteArray,{}),e.parseDicomDataSetExplicit(r.dataSet,n,n.position+r.length)),r}function i(t,i,r){for(;t.position+4<=t.byteArray.length;){var o=e.readTag(t);if(t.seek(-4),"xfffee0dd"===o)return i.length=t.position-i.dataOffset,t.seek(8),i;var a=n(t,r);i.items.push(a)}r.push("eof encountered before finding sequence delimitation tag while reading sequence of undefined length"),i.length=t.position-i.dataOffset}function r(e,t,i){for(var r=t.dataOffset+t.length;e.position<r;){var o=n(e,i);t.items.push(o)}}return void 0===e&&(e={}),e.readSequenceItemsExplicit=function(e,t,n){if(void 0===e)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'element'";t.items=[],4294967295===t.length?i(e,t,n):r(e,t,n)},e}(e),e=function(e){"use strict";function t(t,n){for(var i={};t.position<t.byteArray.length;){var r=e.readDicomElementImplicit(t,void 0,n);if(i[r.tag]=r,"xfffee00d"===r.tag)return new e.DataSet(t.byteArrayParser,t.byteArray,i)}return t.warnings.push("eof encountered before finding sequence item delimiter in sequence item of undefined length"),new e.DataSet(t.byteArrayParser,t.byteArray,i)}function n(n,i){var r=e.readSequenceItem(n);return 4294967295===r.length?(r.hadUndefinedLength=!0,r.dataSet=t(n,i),r.length=n.position-r.dataOffset):(r.dataSet=new e.DataSet(n.byteArrayParser,n.byteArray,{}),e.parseDicomDataSetImplicit(r.dataSet,n,n.position+r.length,{vrCallback:i})),r}function i(t,i,r){for(;t.position+4<=t.byteArray.length;){var o=e.readTag(t);if(t.seek(-4),"xfffee0dd"===o)return i.length=t.position-i.dataOffset,t.seek(8),i;var a=n(t,r);i.items.push(a)}t.warnings.push("eof encountered before finding sequence delimiter in sequence of undefined length"),i.length=t.byteArray.length-i.dataOffset}function r(e,t,i){for(var r=t.dataOffset+t.length;e.position<r;){var o=n(e,i);t.items.push(o)}}return void 0===e&&(e={}),e.readSequenceItemsImplicit=function(e,t,n){if(void 0===e)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'element'";t.items=[],4294967295===t.length?i(e,t,n):r(e,t,n)},e}(e),e=function(e){"use strict";return void 0===e&&(e={}),e.readSequenceItem=function(t){if(void 0===t)throw"dicomParser.readSequenceItem: missing required parameter 'byteStream'";var n={tag:e.readTag(t),length:t.readUint32(),dataOffset:t.position};if("xfffee000"!==n.tag){var i=t.position;throw"dicomParser.readSequenceItem: item tag (FFFE,E000) not found at offset "+i}return n},e}(e),e=function(e){"use strict";return void 0===e&&(e={}),e.readTag=function(e){if(void 0===e)throw"dicomParser.readTag: missing required parameter 'byteStream'";var t=256*e.readUint16()*256,n=e.readUint16(),i="x"+("00000000"+(t+n).toString(16)).substr(-8);return i},e}(e),e=function(e){"use strict";return void 0===e&&(e={}),e.sharedCopy=function(e,t,n){if("undefined"!=typeof i&&e instanceof i)return e.slice(t,t+n);if(e instanceof Uint8Array)return new Uint8Array(e.buffer,e.byteOffset+t,n);throw"dicomParser.from: unknown type for byteArray"},e}(e),e=function(e){"use strict";return void 0===e&&(e={}),e.version="1.7.3",e}(e);return e})}).call(this,t("buffer").Buffer)},{buffer:19,zlib:17}],26:[function(e,t,n){n.read=function(e,t,n,i,r){var o,a,s=8*r-i-1,l=(1<<s)-1,u=l>>1,c=-7,h=n?r-1:0,f=n?-1:1,d=e[t+h];for(h+=f,o=d&(1<<-c)-1,d>>=-c,c+=s;c>0;o=256*o+e[t+h],h+=f,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=i;c>0;a=256*a+e[t+h],h+=f,c-=8);if(0===o)o=1-u;else{if(o===l)return a?NaN:(d?-1:1)*(1/0);a+=Math.pow(2,i),o-=u}return(d?-1:1)*a*Math.pow(2,o-i)},n.write=function(e,t,n,i,r,o){var a,s,l,u=8*o-r-1,c=(1<<u)-1,h=c>>1,f=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,d=i?0:o-1,p=i?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=c):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),t+=a+h>=1?f/l:f*Math.pow(2,1-h),t*l>=2&&(a++,l/=2),a+h>=c?(s=0,a=c):a+h>=1?(s=(t*l-1)*Math.pow(2,r),a+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,r),a=0));r>=8;e[n+d]=255&s,d+=p,s/=256,r-=8);for(a=a<<r|s,u+=r;u>0;e[n+d]=255&a,d+=p,a/=256,u-=8);e[n+d-p]|=128*m}},{}],27:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],28:[function(e,t,n){t.exports=function(e){return!(null==e||!(e._isBuffer||e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)))}},{}],29:[function(e,t,n){var i={}.toString;t.exports=Array.isArray||function(e){return"[object Array]"==i.call(e)}},{}],30:[function(e,t,n){"use strict";var i=i||{};i.lossless=i.lossless||{},i.lossless.ComponentSpec=i.lossless.ComponentSpec||function(){this.hSamp=0,this.quantTableSel=0,this.vSamp=0};var r=typeof t;"undefined"!==r&&t.exports&&(t.exports=i.lossless.ComponentSpec)},{}],31:[function(e,t,n){"use strict";var i=i||{};i.lossless=i.lossless||{},i.lossless.DataStream=i.lossless.DataStream||function(e,t,n){this.buffer=new DataView(e,t,n),this.index=0},i.lossless.DataStream.prototype.get16=function(){var e=this.buffer.getUint16(this.index,!1);return this.index+=2,e},i.lossless.DataStream.prototype.get8=function(){var e=this.buffer.getUint8(this.index);return this.index+=1,e};var r=typeof t;"undefined"!==r&&t.exports&&(t.exports=i.lossless.DataStream)},{}],32:[function(e,t,n){"use strict";var i=i||{};i.lossless=i.lossless||{},i.lossless.DataStream=i.lossless.DataStream||("undefined"!=typeof e?e("./data-stream.js"):null),i.lossless.HuffmanTable=i.lossless.HuffmanTable||("undefined"!=typeof e?e("./huffman-table.js"):null),i.lossless.QuantizationTable=i.lossless.QuantizationTable||("undefined"!=typeof e?e("./quantization-table.js"):null),i.lossless.ScanHeader=i.lossless.ScanHeader||("undefined"!=typeof e?e("./scan-header.js"):null),i.lossless.FrameHeader=i.lossless.FrameHeader||("undefined"!=typeof e?e("./frame-header.js"):null),i.lossless.Utils=i.lossless.Utils||("undefined"!=typeof e?e("./utils.js"):null),i.lossless.Decoder=i.lossless.Decoder||function(e,t){this.buffer=e,this.frame=new i.lossless.FrameHeader,this.huffTable=new i.lossless.HuffmanTable,this.quantTable=new i.lossless.QuantizationTable,this.scan=new i.lossless.ScanHeader,this.DU=i.lossless.Utils.createArray(10,4,64),this.HuffTab=i.lossless.Utils.createArray(4,2,12800),this.IDCT_Source=[],this.nBlock=[],this.acTab=i.lossless.Utils.createArray(10,1),this.dcTab=i.lossless.Utils.createArray(10,1),this.qTab=i.lossless.Utils.createArray(10,1),this.marker=0,this.markerIndex=0,this.numComp=0,this.restartInterval=0,this.selection=0,this.xDim=0,this.yDim=0,this.xLoc=0,this.yLoc=0,this.numBytes=0,this.outputData=null,this.restarting=!1,this.mask=0,"undefined"!=typeof t&&(this.numBytes=t)},i.lossless.Decoder.IDCT_P=[0,5,40,16,45,2,7,42,21,56,8,61,18,47,1,4,41,23,58,13,32,24,37,10,63,17,44,3,6,43,20,57,15,34,29,48,53,26,39,9,60,19,46,22,59,12,33,31,50,55,25,36,11,62,14,35,28,49,52,27,38,30,51,54],i.lossless.Decoder.TABLE=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],i.lossless.Decoder.MAX_HUFFMAN_SUBTREE=50,i.lossless.Decoder.MSB=2147483648,i.lossless.Decoder.RESTART_MARKER_BEGIN=65488,i.lossless.Decoder.RESTART_MARKER_END=65495,i.lossless.Decoder.prototype.decompress=function(e,t,n){return this.decode(e,t,n).buffer},i.lossless.Decoder.prototype.decode=function(e,t,n,r){var o,a,s,l,u=0,c=[],h=[],f=[];if("undefined"!=typeof e&&(this.buffer=e),"undefined"!=typeof r&&(this.numBytes=r),this.stream=new i.lossless.DataStream(this.buffer,t,n),this.buffer=null,this.xLoc=0,this.yLoc=0,o=this.stream.get16(),65496!==o)throw new Error("Not a JPEG file");for(o=this.stream.get16();o>>4!==4092||65476===o;){switch(o){case 65476:this.huffTable.read(this.stream,this.HuffTab);break;case 65484:throw new Error("Program doesn't support arithmetic coding. (format throw new IOException)");case 65499:this.quantTable.read(this.stream,i.lossless.Decoder.TABLE);break;case 65501:this.restartInterval=this.readNumber();break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:this.readApp();break;case 65534:this.readComment();break;default:if(o>>8!==255)throw new Error("ERROR: format throw new IOException! (decode)")}o=this.stream.get16()}if(o<65472||o>65479)throw new Error("ERROR: could not handle arithmetic code!");this.frame.read(this.stream),o=this.stream.get16();do{for(;65498!==o;){switch(o){case 65476:this.huffTable.read(this.stream,this.HuffTab);break;case 65484:throw new Error("Program doesn't support arithmetic coding. (format throw new IOException)");case 65499:this.quantTable.read(this.stream,i.lossless.Decoder.TABLE);break;case 65501:this.restartInterval=this.readNumber();break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:this.readApp();break;case 65534:this.readComment();break;default:if(o>>8!==255)throw new Error("ERROR: format throw new IOException! (Parser.decode)")}o=this.stream.get16()}switch(this.precision=this.frame.precision,this.components=this.frame.components,this.numBytes||(this.numBytes=parseInt(Math.ceil(this.precision/8))),1==this.numBytes?this.mask=255:this.mask=65535,this.scan.read(this.stream),this.numComp=this.scan.numComp,this.selection=this.scan.selection,1===this.numBytes?3===this.numComp?(this.getter=this.getValueRGB,this.setter=this.setValueRGB,this.output=this.outputRGB):(this.getter=this.getValue8,this.setter=this.setValue8,this.output=this.outputSingle):(this.getter=this.getValue16,this.setter=this.setValue16,this.output=this.outputSingle),this.selection){case 2:this.selector=this.select2;break;case 3:this.selector=this.select3;break;case 4:this.selector=this.select4;break;case 5:this.selector=this.select5;break;case 6:this.selector=this.select6;break;case 7:this.selector=this.select7;break;default:this.selector=this.select1}for(this.scanComps=this.scan.components,this.quantTables=this.quantTable.quantTables,a=0;a<this.numComp;a+=1)s=this.scanComps[a].scanCompSel,this.qTab[a]=this.quantTables[this.components[s].quantTableSel],this.nBlock[a]=this.components[s].vSamp*this.components[s].hSamp,this.dcTab[a]=this.HuffTab[this.scanComps[a].dcTabSel][0],this.acTab[a]=this.HuffTab[this.scanComps[a].acTabSel][1];for(this.xDim=this.frame.dimX,this.yDim=this.frame.dimY,this.outputData=new DataView(new ArrayBuffer(this.xDim*this.yDim*this.numBytes*this.numComp)),u+=1;;){for(h[0]=0,f[0]=0,a=0;a<10;a+=1)c[a]=1<<this.precision-1;if(0===this.restartInterval){for(o=this.decodeUnit(c,h,f);0===o&&this.xLoc<this.xDim&&this.yLoc<this.yDim;)this.output(c),o=this.decodeUnit(c,h,f);break}for(l=0;l<this.restartInterval&&(this.restarting=0==l,o=this.decodeUnit(c,h,f),this.output(c),0===o);l+=1);if(0===o&&(0!==this.markerIndex?(o=65280|this.marker,this.markerIndex=0):o=this.stream.get16()),!(o>=i.lossless.Decoder.RESTART_MARKER_BEGIN&&o<=i.lossless.Decoder.RESTART_MARKER_END))break}65500===o&&1===u&&(this.readNumber(),o=this.stream.get16())}while(65497!==o&&this.xLoc<this.xDim&&this.yLoc<this.yDim&&0===u);return this.outputData},i.lossless.Decoder.prototype.decodeUnit=function(e,t,n){return 1==this.numComp?this.decodeSingle(e,t,n):3==this.numComp?this.decodeRGB(e,t,n):-1},i.lossless.Decoder.prototype.select1=function(e){return this.getPreviousX(e)},i.lossless.Decoder.prototype.select2=function(e){return this.getPreviousY(e)},i.lossless.Decoder.prototype.select3=function(e){return this.getPreviousXY(e)},i.lossless.Decoder.prototype.select4=function(e){return this.getPreviousX(e)+this.getPreviousY(e)-this.getPreviousXY(e)},i.lossless.Decoder.prototype.select5=function(e){return this.getPreviousX(e)+(this.getPreviousY(e)-this.getPreviousXY(e)>>1)},i.lossless.Decoder.prototype.select6=function(e){return this.getPreviousY(e)+(this.getPreviousX(e)-this.getPreviousXY(e)>>1)},i.lossless.Decoder.prototype.select7=function(e){return(this.getPreviousX(e)+this.getPreviousY(e))/2},i.lossless.Decoder.prototype.decodeRGB=function(e,t,n){var r,o,a,s,l,u,c,h;for(e[0]=this.selector(0),e[1]=this.selector(1),e[2]=this.selector(2),l=0;l<this.numComp;l+=1)for(s=this.qTab[l],o=this.acTab[l],a=this.dcTab[l],u=0;u<this.nBlock[l];u+=1){for(c=0;c<this.IDCT_Source.length;c+=1)this.IDCT_Source[c]=0;if(r=this.getHuffmanValue(a,t,n),r>=65280)return r;for(e[l]=this.IDCT_Source[0]=e[l]+this.getn(n,r,t,n),this.IDCT_Source[0]*=s[0],h=1;h<64;h+=1){if(r=this.getHuffmanValue(o,t,n),r>=65280)return r;if(h+=r>>4,0===(15&r)){if(r>>4===0)break}else this.IDCT_Source[i.lossless.Decoder.IDCT_P[h]]=this.getn(n,15&r,t,n)*s[h]}}return 0},i.lossless.Decoder.prototype.decodeSingle=function(e,t,n){var r,o,a,s;for(this.restarting?(this.restarting=!1,e[0]=1<<this.frame.precision-1):e[0]=this.selector(),o=0;o<this.nBlock[0];o+=1){if(r=this.getHuffmanValue(this.dcTab[0],t,n),r>=65280)return r;if(a=this.getn(e,r,t,n),s=a>>8,s>=i.lossless.Decoder.RESTART_MARKER_BEGIN&&s<=i.lossless.Decoder.RESTART_MARKER_END)return s;e[0]+=a}return 0},i.lossless.Decoder.prototype.getHuffmanValue=function(e,t,n){var r,o,a;if(a=65535,n[0]<8?(t[0]<<=8,o=this.stream.get8(),255===o&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),t[0]|=o):n[0]-=8,r=e[t[0]>>n[0]],0!==(r&i.lossless.Decoder.MSB)){if(0!==this.markerIndex)return this.markerIndex=0,65280|this.marker;t[0]&=a>>16-n[0],t[0]<<=8,o=this.stream.get8(),255===o&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),t[0]|=o,r=e[256*(255&r)+(t[0]>>n[0])],n[0]+=8}if(n[0]+=8-(r>>8),n[0]<0)throw new Error("index="+n[0]+" temp="+t[0]+" code="+r+" in HuffmanValue()");return n[0]<this.markerIndex?(this.markerIndex=0,65280|this.marker):(t[0]&=a>>16-n[0],255&r)},i.lossless.Decoder.prototype.getn=function(e,t,n,i){var r,o,a,s,l;if(o=1,a=-1,s=65535,0===t)return 0;if(16===t)return e[0]>=0?-32768:32768;if(i[0]-=t,i[0]>=0){if(i[0]<this.markerIndex&&!this.isLastPixel())return this.markerIndex=0,(65280|this.marker)<<8;r=n[0]>>i[0],n[0]&=s>>16-i[0]}else{if(n[0]<<=8,l=this.stream.get8(),255===l&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),n[0]|=l,i[0]+=8,i[0]<0){if(0!==this.markerIndex)return this.markerIndex=0,(65280|this.marker)<<8;n[0]<<=8,l=this.stream.get8(),255===l&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),n[0]|=l,i[0]+=8}if(i[0]<0)throw new Error("index="+i[0]+" in getn()");if(i[0]<this.markerIndex)return this.markerIndex=0,(65280|this.marker)<<8;r=n[0]>>i[0],n[0]&=s>>16-i[0]}return r<o<<t-1&&(r+=(a<<t)+1),r},i.lossless.Decoder.prototype.getPreviousX=function(e){return this.xLoc>0?this.getter(this.yLoc*this.xDim+this.xLoc-1,e):this.yLoc>0?this.getPreviousY(e):1<<this.frame.precision-1},i.lossless.Decoder.prototype.getPreviousXY=function(e){return this.xLoc>0&&this.yLoc>0?this.getter((this.yLoc-1)*this.xDim+this.xLoc-1,e):this.getPreviousY(e)},i.lossless.Decoder.prototype.getPreviousY=function(e){return this.yLoc>0?this.getter((this.yLoc-1)*this.xDim+this.xLoc,e):this.getPreviousX(e)},i.lossless.Decoder.prototype.isLastPixel=function(){return this.xLoc===this.xDim-1&&this.yLoc===this.yDim-1},i.lossless.Decoder.prototype.outputSingle=function(e){this.xLoc<this.xDim&&this.yLoc<this.yDim&&(this.setter(this.yLoc*this.xDim+this.xLoc,this.mask&e[0]),this.xLoc+=1,this.xLoc>=this.xDim&&(this.yLoc+=1,this.xLoc=0))},i.lossless.Decoder.prototype.outputRGB=function(e){var t=this.yLoc*this.xDim+this.xLoc;this.xLoc<this.xDim&&this.yLoc<this.yDim&&(this.setter(t,e[0],0),this.setter(t,e[1],1),this.setter(t,e[2],2),this.xLoc+=1,this.xLoc>=this.xDim&&(this.yLoc+=1,this.xLoc=0))},i.lossless.Decoder.prototype.setValue16=function(e,t){this.outputData.setInt16(2*e,t,!0)},i.lossless.Decoder.prototype.getValue16=function(e){return this.outputData.getInt16(2*e,!0)},i.lossless.Decoder.prototype.setValue8=function(e,t){this.outputData.setInt8(e,t)},i.lossless.Decoder.prototype.getValue8=function(e){return this.outputData.getInt8(e)},i.lossless.Decoder.prototype.setValueRGB=function(e,t,n){this.outputData.setUint8(3*e+n,t)},i.lossless.Decoder.prototype.getValueRGB=function(e,t){return this.outputData.getUint8(3*e+t)},i.lossless.Decoder.prototype.readApp=function(){var e=0,t=this.stream.get16();for(e+=2;e<t;)this.stream.get8(),e+=1;return t},i.lossless.Decoder.prototype.readComment=function(){var e,t="",n=0;for(e=this.stream.get16(),n+=2;n<e;)t+=this.stream.get8(),n+=1;return t},i.lossless.Decoder.prototype.readNumber=function(){var e=this.stream.get16();if(4!==e)throw new Error("ERROR: Define number format throw new IOException [Ld!=4]");return this.stream.get16()};var r=typeof t;"undefined"!==r&&t.exports&&(t.exports=i.lossless.Decoder)},{"./data-stream.js":31,"./frame-header.js":33,"./huffman-table.js":34,"./quantization-table.js":36,"./scan-header.js":38,"./utils.js":39}],33:[function(e,t,n){"use strict";var i=i||{};i.lossless=i.lossless||{},i.lossless.ComponentSpec=i.lossless.ComponentSpec||("undefined"!=typeof e?e("./component-spec.js"):null),i.lossless.DataStream=i.lossless.DataStream||("undefined"!=typeof e?e("./data-stream.js"):null),i.lossless.FrameHeader=i.lossless.FrameHeader||function(){this.components=[],this.dimX=0,this.dimY=0,this.numComp=0,this.precision=0},i.lossless.FrameHeader.prototype.read=function(e){var t,n,r,o,a=0;for(t=e.get16(),a+=2,this.precision=e.get8(),a+=1,this.dimY=e.get16(),a+=2,this.dimX=e.get16(),a+=2,this.numComp=e.get8(),a+=1,n=1;n<=this.numComp;n+=1){if(a>t)throw new Error("ERROR: frame format error");if(r=e.get8(),a+=1,a>=t)throw new Error("ERROR: frame format error [c>=Lf]");o=e.get8(),a+=1,this.components[r]||(this.components[r]=new i.lossless.ComponentSpec),this.components[r].hSamp=o>>4,this.components[r].vSamp=15&o,this.components[r].quantTableSel=e.get8(),a+=1}if(a!==t)throw new Error("ERROR: frame format error [Lf!=count]");return 1};var r=typeof t;"undefined"!==r&&t.exports&&(t.exports=i.lossless.FrameHeader)},{"./component-spec.js":30,"./data-stream.js":31}],34:[function(e,t,n){"use strict";var i=i||{};i.lossless=i.lossless||{},i.lossless.DataStream=i.lossless.DataStream||("undefined"!=typeof e?e("./data-stream.js"):null),i.lossless.Utils=i.lossless.Utils||("undefined"!=typeof e?e("./utils.js"):null),i.lossless.HuffmanTable=i.lossless.HuffmanTable||function(){this.l=i.lossless.Utils.createArray(4,2,16),this.th=[],this.v=i.lossless.Utils.createArray(4,2,16,200),this.tc=i.lossless.Utils.createArray(4,2),this.tc[0][0]=0,this.tc[1][0]=0,this.tc[2][0]=0,this.tc[3][0]=0,this.tc[0][1]=0,this.tc[1][1]=0,this.tc[2][1]=0,this.tc[3][1]=0,this.th[0]=0,this.th[1]=0,this.th[2]=0,this.th[3]=0},i.lossless.HuffmanTable.MSB=2147483648,i.lossless.HuffmanTable.prototype.read=function(e,t){var n,i,r,o,a,s,l=0;for(n=e.get16(),l+=2;l<n;){if(i=e.get8(),l+=1,r=15&i,r>3)throw new Error("ERROR: Huffman table ID > 3");if(o=i>>4,o>2)throw new Error("ERROR: Huffman table [Table class > 2 ]");for(this.th[r]=1,this.tc[r][o]=1,a=0;a<16;a+=1)this.l[r][o][a]=e.get8(),l+=1;for(a=0;a<16;a+=1)for(s=0;s<this.l[r][o][a];s+=1){if(l>n)throw new Error("ERROR: Huffman table format error [count>Lh]");this.v[r][o][a][s]=e.get8(),l+=1}}if(l!==n)throw new Error("ERROR: Huffman table format error [count!=Lf]");for(a=0;a<4;a+=1)for(s=0;s<2;s+=1)0!==this.tc[a][s]&&this.buildHuffTable(t[a][s],this.l[a][s],this.v[a][s]);return 1},i.lossless.HuffmanTable.prototype.buildHuffTable=function(e,t,n){var r,o,a,s,l,u;for(o=256,a=0,s=0;s<8;s+=1)for(l=0;l<t[s];l+=1)for(u=0;u<o>>s+1;u+=1)e[a]=n[s][l]|s+1<<8,a+=1;for(s=1;a<256;s+=1,a+=1)e[a]=s|i.lossless.HuffmanTable.MSB;for(r=1,a=0,s=8;s<16;s+=1)for(l=0;l<t[s];l+=1){for(u=0;u<o>>s-7;u+=1)e[256*r+a]=n[s][l]|s+1<<8,a+=1;if(a>=256){if(a>256)throw new Error("ERROR: Huffman table error(1)!");a=0,r+=1}}};var r=typeof t;"undefined"!==r&&t.exports&&(t.exports=i.lossless.HuffmanTable)},{"./data-stream.js":31,"./utils.js":39}],35:[function(e,t,n){"use strict";var i=i||{};i.lossless=i.lossless||{},i.lossless.ComponentSpec=i.lossless.ComponentSpec||("undefined"!=typeof e?e("./component-spec.js"):null),i.lossless.DataStream=i.lossless.DataStream||("undefined"!=typeof e?e("./data-stream.js"):null),i.lossless.Decoder=i.lossless.Decoder||("undefined"!=typeof e?e("./decoder.js"):null),i.lossless.FrameHeader=i.lossless.FrameHeader||("undefined"!=typeof e?e("./frame-header.js"):null),i.lossless.HuffmanTable=i.lossless.HuffmanTable||("undefined"!=typeof e?e("./huffman-table.js"):null),i.lossless.QuantizationTable=i.lossless.QuantizationTable||("undefined"!=typeof e?e("./quantization-table.js"):null),i.lossless.ScanComponent=i.lossless.ScanComponent||("undefined"!=typeof e?e("./scan-component.js"):null),i.lossless.ScanHeader=i.lossless.ScanHeader||("undefined"!=typeof e?e("./scan-header.js"):null),i.lossless.Utils=i.lossless.Utils||("undefined"!=typeof e?e("./utils.js"):null);var r=typeof t;"undefined"!==r&&t.exports&&(t.exports=i)},{"./component-spec.js":30,"./data-stream.js":31,"./decoder.js":32,"./frame-header.js":33,"./huffman-table.js":34,"./quantization-table.js":36,"./scan-component.js":37,"./scan-header.js":38,"./utils.js":39}],36:[function(e,t,n){"use strict";var i=i||{};i.lossless=i.lossless||{},i.lossless.DataStream=i.lossless.DataStream||("undefined"!=typeof e?e("./data-stream.js"):null),i.lossless.Utils=i.lossless.Utils||("undefined"!=typeof e?e("./utils.js"):null),i.lossless.QuantizationTable=i.lossless.QuantizationTable||function(){this.precision=[],this.tq=[],this.quantTables=i.lossless.Utils.createArray(4,64),this.tq[0]=0,this.tq[1]=0,this.tq[2]=0,this.tq[3]=0},i.lossless.QuantizationTable.enhanceQuantizationTable=function(e,t){var n;for(n=0;n<8;n+=1)e[t[0+n]]*=90,e[t[32+n]]*=90,e[t[16+n]]*=118,e[t[48+n]]*=49,e[t[40+n]]*=71,e[t[8+n]]*=126,e[t[56+n]]*=25,e[t[24+n]]*=106;for(n=0;n<8;n+=1)e[t[0+8*n]]*=90,e[t[4+8*n]]*=90,e[t[2+8*n]]*=118,e[t[6+8*n]]*=49,e[t[5+8*n]]*=71,e[t[1+8*n]]*=126,e[t[7+8*n]]*=25,e[t[3+8*n]]*=106;for(n=0;n<64;n+=1)e[n]>>=6},i.lossless.QuantizationTable.prototype.read=function(e,t){var n,r,o,a,s=0;for(n=e.get16(),s+=2;s<n;){if(r=e.get8(),s+=1,o=15&r,o>3)throw new Error("ERROR: Quantization table ID > 3");if(this.precision[o]=r>>4,0===this.precision[o])this.precision[o]=8;else{if(1!==this.precision[o])throw new Error("ERROR: Quantization table precision error");this.precision[o]=16}if(this.tq[o]=1,8===this.precision[o]){for(a=0;a<64;a+=1){if(s>n)throw new Error("ERROR: Quantization table format error");this.quantTables[o][a]=e.get8(),s+=1}i.lossless.QuantizationTable.enhanceQuantizationTable(this.quantTables[o],t)}else{for(a=0;a<64;a+=1){if(s>n)throw new Error("ERROR: Quantization table format error");this.quantTables[o][a]=e.get16(),s+=2}i.lossless.QuantizationTable.enhanceQuantizationTable(this.quantTables[o],t)}}if(s!==n)throw new Error("ERROR: Quantization table error [count!=Lq]");return 1};var r=typeof t;"undefined"!==r&&t.exports&&(t.exports=i.lossless.QuantizationTable)},{"./data-stream.js":31,"./utils.js":39}],37:[function(e,t,n){"use strict";var i=i||{};i.lossless=i.lossless||{},i.lossless.ScanComponent=i.lossless.ScanComponent||function(){this.acTabSel=0,this.dcTabSel=0,this.scanCompSel=0};var r=typeof t;"undefined"!==r&&t.exports&&(t.exports=i.lossless.ScanComponent)},{}],38:[function(e,t,n){"use strict";var i=i||{};i.lossless=i.lossless||{},i.lossless.DataStream=i.lossless.DataStream||("undefined"!=typeof e?e("./data-stream.js"):null),i.lossless.ScanComponent=i.lossless.ScanComponent||("undefined"!=typeof e?e("./scan-component.js"):null),i.lossless.ScanHeader=i.lossless.ScanHeader||function(){this.ah=0,this.al=0,this.numComp=0,this.selection=0,this.spectralEnd=0,this.components=[]},i.lossless.ScanHeader.prototype.read=function(e){var t,n,r,o=0;for(t=e.get16(),o+=2,this.numComp=e.get8(),o+=1,n=0;n<this.numComp;n+=1){if(this.components[n]=new i.lossless.ScanComponent,o>t)throw new Error("ERROR: scan header format error");this.components[n].scanCompSel=e.get8(),o+=1,r=e.get8(),o+=1,this.components[n].dcTabSel=r>>4,this.components[n].acTabSel=15&r}if(this.selection=e.get8(),o+=1,this.spectralEnd=e.get8(),o+=1,r=e.get8(),this.ah=r>>4,this.al=15&r,o+=1,o!==t)throw new Error("ERROR: scan header format error [count!=Ns]");return 1};var r=typeof t;"undefined"!==r&&t.exports&&(t.exports=i.lossless.ScanHeader)},{"./data-stream.js":31,"./scan-component.js":37}],39:[function(e,t,n){"use strict";var i=i||{};i.lossless=i.lossless||{},i.lossless.Utils=i.lossless.Utils||{},i.lossless.Utils.createArray=function(e){var t=new Array(e||0),n=e;if(arguments.length>1)for(var r=Array.prototype.slice.call(arguments,1);n--;)t[e-1-n]=i.lossless.Utils.createArray.apply(this,r);return t},i.lossless.Utils.makeCRCTable=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t},i.lossless.Utils.crc32=function(e){for(var t=i.lossless.Utils.crcTable||(i.lossless.Utils.crcTable=i.lossless.Utils.makeCRCTable()),n=-1,r=0;r<e.byteLength;r++)n=n>>>8^t[255&(n^e.getUint8(r))];return(n^-1)>>>0};var r=typeof t;"undefined"!==r&&t.exports&&(t.exports=i.lossless.Utils)},{}],40:[function(e,t,n){"use strict";function i(e){return e<0?-e:0===e?0:e}t.exports=i},{}],41:[function(e,t,n){"use strict";t.exports=Math.ceil},{}],42:[function(e,t,n){"use strict";function i(e){for(var t,n="";e>0;)t=e/2,e=r(t),n=t===e?"0"+n:"1"+n;return n}var r=e("math-floor");t.exports=i},{"math-floor":45}],43:[function(e,t,n){"use strict";function i(e){var t,n,i,p,m,_,g;if(n=e<0||1/e===o?"1":"0",e===r||e===o)return p=c("1",8),i=c("0",23),n+p+i;if(e!==e)return p=c("1",8),i="1"+c("0",22),n+p+i;if(0===e)return p=c("0",8),i=c("0",23),n+p+i;if(e=a(e),m=s(e),_=e-m,m=h(m),_=f(_),m)p=m.length-1;else{for(g=0;g<_.length;g++)if("1"===_[g]){t=g+1;break}p=-t}return i=m+_,p<0?(p<=-d&&(t=d-1),i=i.substring(t)):i=i.substring(1),p=h(p+d),p=u(p,8,"0"),i=l(i,23,"0").substring(0,23),n+p+i}var r=e("const-pinf-float32"),o=e("const-ninf-float32"),a=e("math-abs"),s=e("math-floor"),l=e("utils-right-pad-string"),u=e("utils-left-pad-string"),c=e("utils-repeat-string"),h=e("./div2.js"),f=e("./mult2.js"),d=127;t.exports=i},{"./div2.js":42,"./mult2.js":44,"const-ninf-float32":22,"const-pinf-float32":23,"math-abs":40,"math-floor":45,"utils-left-pad-string":78,"utils-repeat-string":79,"utils-right-pad-string":80}],44:[function(e,t,n){"use strict";function i(e){var t,n,i,a;if(t="",0===e)return t;for(a=r,i=0;i<r&&(n=2*e,n>=1?(e=n-1,t+="1",a===r&&(a=i)):(e=n,t+="0"),!(1===n||i-a>o));i++);return t}var r=149,o=24;t.exports=i},{}],45:[function(e,t,n){"use strict";t.exports=Math.floor},{}],46:[function(e,t,n){"use strict";var i=i||{};i.NIFTI1=i.NIFTI1||("undefined"!=typeof e?e("./nifti1.js"):null),i.NIFTI2=i.NIFTI2||("undefined"!=typeof e?e("./nifti2.js"):null),i.Utils=i.Utils||("undefined"!=typeof e?e("./utilities.js"):null);var r=r||("undefined"!=typeof e?e("pako"):null);i.isNIFTI1=function(e){var t,n,r,o;return t=new DataView(e),n=t.getUint8(i.NIFTI1.MAGIC_NUMBER_LOCATION),r=t.getUint8(i.NIFTI1.MAGIC_NUMBER_LOCATION+1),o=t.getUint8(i.NIFTI1.MAGIC_NUMBER_LOCATION+2),!(n!==i.NIFTI1.MAGIC_NUMBER[0]||r!==i.NIFTI1.MAGIC_NUMBER[1]||o!==i.NIFTI1.MAGIC_NUMBER[2])},i.isNIFTI2=function(e){var t,n,r,o;return t=new DataView(e),n=t.getUint8(i.NIFTI2.MAGIC_NUMBER_LOCATION),r=t.getUint8(i.NIFTI2.MAGIC_NUMBER_LOCATION+1),o=t.getUint8(i.NIFTI2.MAGIC_NUMBER_LOCATION+2),!(n!==i.NIFTI2.MAGIC_NUMBER[0]||r!==i.NIFTI2.MAGIC_NUMBER[1]||o!==i.NIFTI2.MAGIC_NUMBER[2])},i.isNIFTI=function(e){return i.isNIFTI1(e)||i.isNIFTI2(e)},i.isCompressed=function(e){var t,n,r;if(e){if(t=new DataView(e),n=t.getUint8(0),r=t.getUint8(1),n===i.Utils.GUNZIP_MAGIC_COOKIE1)return!0;if(r===i.Utils.GUNZIP_MAGIC_COOKIE2)return!0}return!1},i.decompress=function(e){return r.inflate(e).buffer},i.readHeader=function(e){var t=null;return i.isCompressed(e)&&(e=i.decompress(e)),i.isNIFTI1(e)?t=new i.NIFTI1:i.isNIFTI2(e)&&(t=new i.NIFTI2),t?t.readHeader(e):console.error("That file does not appear to be NIFTI!"),t},i.hasExtension=function(e){return 0!=e.extensionFlag[0]},i.readImage=function(e,t){var n=e.vox_offset,i=1,r=1;e.dims[4]&&(i=e.dims[4]),e.dims[5]&&(r=e.dims[5]);var o=e.dims[1]*e.dims[2]*e.dims[3]*i*r*(e.numBitsPerVoxel/8);return t.slice(n,n+o)},i.readExtension=function(e,t){var n=e.getExtensionLocation(),i=e.extensionSize;return t.slice(n,n+i)},i.readExtensionData=function(e,t){var n=e.getExtensionLocation(),i=e.extensionSize;return t.slice(n+8,n+i-8)};var o=typeof t;"undefined"!==o&&t.exports&&(t.exports=i)},{"./nifti1.js":47,"./nifti2.js":48,"./utilities.js":49,pako:51}],47:[function(e,t,n){"use strict";var i=i||{};i.Utils=i.Utils||("undefined"!=typeof e?e("./utilities.js"):null),i.NIFTI1=i.NIFTI1||function(){this.littleEndian=!1,this.dim_info=0,this.dims=[],this.intent_p1=0,this.intent_p2=0,this.intent_p3=0,
this.intent_code=0,this.datatypeCode=0,this.numBitsPerVoxel=0,this.slice_start=0,this.slice_end=0,this.slice_code=0,this.pixDims=[],this.vox_offset=0,this.scl_slope=1,this.scl_inter=0,this.xyzt_units=0,this.cal_max=0,this.cal_min=0,this.slice_duration=0,this.toffset=0,this.description="",this.aux_file="",this.intent_name="",this.qform_code=0,this.sform_code=0,this.quatern_b=0,this.quatern_c=0,this.quatern_d=0,this.qoffset_x=0,this.qoffset_y=0,this.qoffset_z=0,this.affine=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],this.magic=0,this.isHDR=!1,this.extensionFlag=[0,0,0,0],this.extensionSize=0,this.extensionCode=0},i.NIFTI1.TYPE_NONE=0,i.NIFTI1.TYPE_BINARY=1,i.NIFTI1.TYPE_UINT8=2,i.NIFTI1.TYPE_INT16=4,i.NIFTI1.TYPE_INT32=8,i.NIFTI1.TYPE_FLOAT32=16,i.NIFTI1.TYPE_COMPLEX64=32,i.NIFTI1.TYPE_FLOAT64=64,i.NIFTI1.TYPE_RGB24=128,i.NIFTI1.TYPE_INT8=256,i.NIFTI1.TYPE_UINT16=512,i.NIFTI1.TYPE_UINT32=768,i.NIFTI1.TYPE_INT64=1024,i.NIFTI1.TYPE_UINT64=1280,i.NIFTI1.TYPE_FLOAT128=1536,i.NIFTI1.TYPE_COMPLEX128=1792,i.NIFTI1.TYPE_COMPLEX256=2048,i.NIFTI1.XFORM_UNKNOWN=0,i.NIFTI1.XFORM_SCANNER_ANAT=1,i.NIFTI1.XFORM_ALIGNED_ANAT=2,i.NIFTI1.XFORM_TALAIRACH=3,i.NIFTI1.XFORM_MNI_152=4,i.NIFTI1.SPATIAL_UNITS_MASK=7,i.NIFTI1.TEMPORAL_UNITS_MASK=56,i.NIFTI1.UNITS_UNKNOWN=0,i.NIFTI1.UNITS_METER=1,i.NIFTI1.UNITS_MM=2,i.NIFTI1.UNITS_MICRON=3,i.NIFTI1.UNITS_SEC=8,i.NIFTI1.UNITS_MSEC=16,i.NIFTI1.UNITS_USEC=24,i.NIFTI1.UNITS_HZ=32,i.NIFTI1.UNITS_PPM=40,i.NIFTI1.UNITS_RADS=48,i.NIFTI1.MAGIC_COOKIE=348,i.NIFTI1.MAGIC_NUMBER_LOCATION=344,i.NIFTI1.MAGIC_NUMBER=[110,43,49],i.NIFTI1.MAGIC_NUMBER2=[110,105,49],i.NIFTI1.EXTENSION_HEADER_SIZE=8,i.NIFTI1.prototype.readHeader=function(e){var t,n,r,o,a=new DataView(e),s=i.Utils.getIntAt(a,0,this.littleEndian);if(s!==i.NIFTI1.MAGIC_COOKIE&&(this.littleEndian=!0,s=i.Utils.getIntAt(a,0,this.littleEndian)),s!==i.NIFTI1.MAGIC_COOKIE)throw new Error("This does not appear to be a NIFTI file!");for(this.dim_info=i.Utils.getByteAt(a,39),t=0;t<8;t+=1)o=40+2*t,this.dims[t]=i.Utils.getShortAt(a,o,this.littleEndian);for(this.intent_p1=i.Utils.getFloatAt(a,56,this.littleEndian),this.intent_p2=i.Utils.getFloatAt(a,60,this.littleEndian),this.intent_p3=i.Utils.getFloatAt(a,64,this.littleEndian),this.intent_code=i.Utils.getShortAt(a,68,this.littleEndian),this.datatypeCode=i.Utils.getShortAt(a,70,this.littleEndian),this.numBitsPerVoxel=i.Utils.getShortAt(a,72,this.littleEndian),this.slice_start=i.Utils.getShortAt(a,74,this.littleEndian),t=0;t<8;t+=1)o=76+4*t,this.pixDims[t]=i.Utils.getFloatAt(a,o,this.littleEndian);for(this.vox_offset=i.Utils.getFloatAt(a,108,this.littleEndian),this.scl_slope=i.Utils.getFloatAt(a,112,this.littleEndian),this.scl_inter=i.Utils.getFloatAt(a,116,this.littleEndian),this.slice_end=i.Utils.getShortAt(a,120,this.littleEndian),this.slice_code=i.Utils.getByteAt(a,122),this.xyzt_units=i.Utils.getByteAt(a,123),this.cal_max=i.Utils.getFloatAt(a,124,this.littleEndian),this.cal_min=i.Utils.getFloatAt(a,128,this.littleEndian),this.slice_duration=i.Utils.getFloatAt(a,132,this.littleEndian),this.toffset=i.Utils.getFloatAt(a,136,this.littleEndian),this.description=i.Utils.getStringAt(a,148,228),this.aux_file=i.Utils.getStringAt(a,228,252),this.qform_code=i.Utils.getShortAt(a,252,this.littleEndian),this.sform_code=i.Utils.getShortAt(a,254,this.littleEndian),this.quatern_b=i.Utils.getFloatAt(a,256,this.littleEndian),this.quatern_c=i.Utils.getFloatAt(a,260,this.littleEndian),this.quatern_d=i.Utils.getFloatAt(a,264,this.littleEndian),this.qoffset_x=i.Utils.getFloatAt(a,268,this.littleEndian),this.qoffset_y=i.Utils.getFloatAt(a,272,this.littleEndian),this.qoffset_z=i.Utils.getFloatAt(a,276,this.littleEndian),n=0;n<3;n+=1)for(r=0;r<4;r+=1)o=280+4*(4*n+r),this.affine[n][r]=i.Utils.getFloatAt(a,o,this.littleEndian);this.affine[3][0]=0,this.affine[3][1]=0,this.affine[3][2]=0,this.affine[3][3]=1,this.intent_name=i.Utils.getStringAt(a,328,344),this.magic=i.Utils.getStringAt(a,344,348),this.isHDR=this.magic===i.NIFTI1.MAGIC_NUMBER2,a.byteLength>i.NIFTI1.MAGIC_COOKIE&&(this.extensionFlag[0]=i.Utils.getByteAt(a,348),this.extensionFlag[1]=i.Utils.getByteAt(a,349),this.extensionFlag[2]=i.Utils.getByteAt(a,350),this.extensionFlag[3]=i.Utils.getByteAt(a,351),this.extensionFlag[0]&&(this.extensionSize=this.getExtensionSize(a),this.extensionCode=this.getExtensionCode(a)))},i.NIFTI1.prototype.toFormattedString=function(){var e=i.Utils.formatNumber,t="";return t+="Dim Info = "+this.dim_info+"\n",t+="Image Dimensions (1-8): "+this.dims[0]+", "+this.dims[1]+", "+this.dims[2]+", "+this.dims[3]+", "+this.dims[4]+", "+this.dims[5]+", "+this.dims[6]+", "+this.dims[7]+"\n",t+="Intent Parameters (1-3): "+this.intent_p1+", "+this.intent_p2+", "+this.intent_p3+"\n",t+="Intent Code = "+this.intent_code+"\n",t+="Datatype = "+this.datatypeCode+" ("+this.getDatatypeCodeString(this.datatypeCode)+")\n",t+="Bits Per Voxel = "+this.numBitsPerVoxel+"\n",t+="Slice Start = "+this.slice_start+"\n",t+="Voxel Dimensions (1-8): "+e(this.pixDims[0])+", "+e(this.pixDims[1])+", "+e(this.pixDims[2])+", "+e(this.pixDims[3])+", "+e(this.pixDims[4])+", "+e(this.pixDims[5])+", "+e(this.pixDims[6])+", "+e(this.pixDims[7])+"\n",t+="Image Offset = "+this.vox_offset+"\n",t+="Data Scale:  Slope = "+e(this.scl_slope)+"  Intercept = "+e(this.scl_inter)+"\n",t+="Slice End = "+this.slice_end+"\n",t+="Slice Code = "+this.slice_code+"\n",t+="Units Code = "+this.xyzt_units+" ("+this.getUnitsCodeString(i.NIFTI1.SPATIAL_UNITS_MASK&this.xyzt_units)+", "+this.getUnitsCodeString(i.NIFTI1.TEMPORAL_UNITS_MASK&this.xyzt_units)+")\n",t+="Display Range:  Max = "+e(this.cal_max)+"  Min = "+e(this.cal_min)+"\n",t+="Slice Duration = "+this.slice_duration+"\n",t+="Time Axis Shift = "+this.toffset+"\n",t+='Description: "'+this.description+'"\n',t+='Auxiliary File: "'+this.aux_file+'"\n',t+="Q-Form Code = "+this.qform_code+" ("+this.getTransformCodeString(this.qform_code)+")\n",t+="S-Form Code = "+this.sform_code+" ("+this.getTransformCodeString(this.sform_code)+")\n",t+="Quaternion Parameters:  b = "+e(this.quatern_b)+"  c = "+e(this.quatern_c)+"  d = "+e(this.quatern_d)+"\n",t+="Quaternion Offsets:  x = "+this.qoffset_x+"  y = "+this.qoffset_y+"  z = "+this.qoffset_z+"\n",t+="S-Form Parameters X: "+e(this.affine[0][0])+", "+e(this.affine[0][1])+", "+e(this.affine[0][2])+", "+e(this.affine[0][3])+"\n",t+="S-Form Parameters Y: "+e(this.affine[1][0])+", "+e(this.affine[1][1])+", "+e(this.affine[1][2])+", "+e(this.affine[1][3])+"\n",t+="S-Form Parameters Z: "+e(this.affine[2][0])+", "+e(this.affine[2][1])+", "+e(this.affine[2][2])+", "+e(this.affine[2][3])+"\n",t+='Intent Name: "'+this.intent_name+'"\n',this.extensionFlag[0]&&(t+="Extension: Size = "+this.extensionSize+"  Code = "+this.extensionCode+"\n"),t},i.NIFTI1.prototype.getDatatypeCodeString=function(e){return e===i.NIFTI1.TYPE_UINT8?"1-Byte Unsigned Integer":e===i.NIFTI1.TYPE_INT16?"2-Byte Signed Integer":e===i.NIFTI1.TYPE_INT32?"4-Byte Signed Integer":e===i.NIFTI1.TYPE_FLOAT32?"4-Byte Float":e===i.NIFTI1.TYPE_FLOAT64?"8-Byte Float":e===i.NIFTI1.TYPE_RGB24?"RGB":e===i.NIFTI1.TYPE_INT8?"1-Byte Signed Integer":e===i.NIFTI1.TYPE_UINT16?"2-Byte Unsigned Integer":e===i.NIFTI1.TYPE_UINT32?"4-Byte Unsigned Integer":e===i.NIFTI1.TYPE_INT64?"8-Byte Signed Integer":e===i.NIFTI1.TYPE_UINT64?"8-Byte Unsigned Integer":"Unknown"},i.NIFTI1.prototype.getTransformCodeString=function(e){return e===i.NIFTI1.XFORM_SCANNER_ANAT?"Scanner":e===i.NIFTI1.XFORM_ALIGNED_ANAT?"Aligned":e===i.NIFTI1.XFORM_TALAIRACH?"Talairach":e===i.NIFTI1.XFORM_MNI_152?"MNI":"Unknown"},i.NIFTI1.prototype.getUnitsCodeString=function(e){return e===i.NIFTI1.UNITS_METER?"Meters":e===i.NIFTI1.UNITS_MM?"Millimeters":e===i.NIFTI1.UNITS_MICRON?"Microns":e===i.NIFTI1.UNITS_SEC?"Seconds":e===i.NIFTI1.UNITS_MSEC?"Milliseconds":e===i.NIFTI1.UNITS_USEC?"Microseconds":e===i.NIFTI1.UNITS_HZ?"Hz":e===i.NIFTI1.UNITS_PPM?"PPM":e===i.NIFTI1.UNITS_RADS?"Rads":"Unknown"},i.NIFTI1.prototype.getQformMat=function(){return this.convertNiftiQFormToNiftiSForm(this.quatern_b,this.quatern_c,this.quatern_d,this.qoffset_x,this.qoffset_y,this.qoffset_z,this.pixDims[1],this.pixDims[2],this.pixDims[3],this.pixDims[0])},i.NIFTI1.prototype.convertNiftiQFormToNiftiSForm=function(e,t,n,i,r,o,a,s,l,u){var c,h,f,d,p=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],m=e,_=t,g=n;return p[3][0]=p[3][1]=p[3][2]=0,p[3][3]=1,c=1-(m*m+_*_+g*g),c<1e-7?(c=1/Math.sqrt(m*m+_*_+g*g),m*=c,_*=c,g*=c,c=0):c=Math.sqrt(c),h=a>0?a:1,f=s>0?s:1,d=l>0?l:1,u<0&&(d=-d),p[0][0]=(c*c+m*m-_*_-g*g)*h,p[0][1]=2*(m*_-c*g)*f,p[0][2]=2*(m*g+c*_)*d,p[1][0]=2*(m*_+c*g)*h,p[1][1]=(c*c+_*_-m*m-g*g)*f,p[1][2]=2*(_*g-c*m)*d,p[2][0]=2*(m*g-c*_)*h,p[2][1]=2*(_*g+c*m)*f,p[2][2]=(c*c+g*g-_*_-m*m)*d,p[0][3]=i,p[1][3]=r,p[2][3]=o,p},i.NIFTI1.prototype.convertNiftiSFormToNEMA=function(e){var t,n,i,r,o,a,s,l,u,c,h,f,d,p,m,_,g,y,v,b,w,x,k,E,S,I,T,P,A,D,O,M,C,R;if(m=0,T=[[0,0,0],[0,0,0],[0,0,0]],P=[[0,0,0],[0,0,0],[0,0,0]],t=e[0][0],n=e[0][1],i=e[0][2],r=e[1][0],o=e[1][1],a=e[1][2],s=e[2][0],l=e[2][1],u=e[2][2],c=Math.sqrt(t*t+r*r+s*s),0===c)return null;if(t/=c,r/=c,s/=c,c=Math.sqrt(n*n+o*o+l*l),0===c)return null;if(n/=c,o/=c,l/=c,c=t*n+r*o+s*l,Math.abs(c)>1e-4){if(n-=c*t,o-=c*r,l-=c*s,c=Math.sqrt(n*n+o*o+l*l),0===c)return null;n/=c,o/=c,l/=c}if(c=Math.sqrt(i*i+a*a+u*u),0===c?(i=r*l-s*o,a=s*n-l*t,u=t*o-r*n):(i/=c,a/=c,u/=c),c=t*i+r*a+s*u,Math.abs(c)>1e-4){if(i-=c*t,a-=c*r,u-=c*s,c=Math.sqrt(i*i+a*a+u*u),0===c)return null;i/=c,a/=c,u/=c}if(c=n*i+o*a+l*u,Math.abs(c)>1e-4){if(i-=c*n,a-=c*o,u-=c*l,c=Math.sqrt(i*i+a*a+u*u),0===c)return null;i/=c,a/=c,u/=c}if(T[0][0]=t,T[0][1]=n,T[0][2]=i,T[1][0]=r,T[1][1]=o,T[1][2]=a,T[2][0]=s,T[2][1]=l,T[2][2]=u,h=this.nifti_mat33_determ(T),0===h)return null;for(I=-666,v=x=k=E=1,b=2,w=3,d=1;d<=3;d+=1)for(p=1;p<=3;p+=1)if(d!==p)for(m=1;m<=3;m+=1)if(d!==m&&p!==m)for(P[0][0]=P[0][1]=P[0][2]=P[1][0]=P[1][1]=P[1][2]=P[2][0]=P[2][1]=P[2][2]=0,_=-1;_<=1;_+=2)for(g=-1;g<=1;g+=2)for(y=-1;y<=1;y+=2)P[0][d-1]=_,P[1][p-1]=g,P[2][m-1]=y,f=this.nifti_mat33_determ(P),f*h>0&&(S=this.nifti_mat33_mul(P,T),c=S[0][0]+S[1][1]+S[2][2],c>I&&(I=c,v=d,b=p,w=m,x=_,k=g,E=y));switch(A=D=O=M=C=R=0,v*x){case 1:A="X",M="+";break;case-1:A="X",M="-";break;case 2:A="Y",M="+";break;case-2:A="Y",M="-";break;case 3:A="Z",M="+";break;case-3:A="Z",M="-"}switch(b*k){case 1:D="X",C="+";break;case-1:D="X",C="-";break;case 2:D="Y",C="+";break;case-2:D="Y",C="-";break;case 3:D="Z",C="+";break;case-3:D="Z",C="-"}switch(w*E){case 1:O="X",R="+";break;case-1:O="X",R="-";break;case 2:O="Y",R="+";break;case-2:O="Y",R="-";break;case 3:O="Z",R="+";break;case-3:O="Z",R="-"}return A+D+O+M+C+R},i.NIFTI1.prototype.nifti_mat33_mul=function(e,t){var n,i,r=[[0,0,0],[0,0,0],[0,0,0]];for(n=0;n<3;n+=1)for(i=0;i<3;i+=1)r[n][i]=e[n][0]*t[0][i]+e[n][1]*t[1][i]+e[n][2]*t[2][i];return r},i.NIFTI1.prototype.nifti_mat33_determ=function(e){var t,n,i,r,o,a,s,l,u;return t=e[0][0],n=e[0][1],i=e[0][2],r=e[1][0],o=e[1][1],a=e[1][2],s=e[2][0],l=e[2][1],u=e[2][2],t*o*u-t*l*a-r*n*u+r*l*i+s*n*a-s*o*i},i.NIFTI1.prototype.getExtensionLocation=function(){return i.NIFTI1.MAGIC_COOKIE+4},i.NIFTI1.prototype.getExtensionSize=function(e){return i.Utils.getIntAt(e,this.getExtensionLocation(),this.littleEndian)},i.NIFTI1.prototype.getExtensionCode=function(e){return i.Utils.getIntAt(e,this.getExtensionLocation()+4,this.littleEndian)};var r=typeof t;"undefined"!==r&&t.exports&&(t.exports=i.NIFTI1)},{"./utilities.js":49}],48:[function(e,t,n){"use strict";var i=i||{};i.Utils=i.Utils||("undefined"!=typeof e?e("./utilities.js"):null),i.NIFTI1=i.NIFTI1||("undefined"!=typeof e?e("./nifti1.js"):null),i.NIFTI2=i.NIFTI2||function(){this.littleEndian=!1,this.dim_info=0,this.dims=[],this.intent_p1=0,this.intent_p2=0,this.intent_p3=0,this.intent_code=0,this.datatypeCode=0,this.numBitsPerVoxel=0,this.slice_start=0,this.slice_end=0,this.slice_code=0,this.pixDims=[],this.vox_offset=0,this.scl_slope=1,this.scl_inter=0,this.xyzt_units=0,this.cal_max=0,this.cal_min=0,this.slice_duration=0,this.toffset=0,this.description="",this.aux_file="",this.intent_name="",this.qform_code=0,this.sform_code=0,this.quatern_b=0,this.quatern_c=0,this.quatern_d=0,this.qoffset_x=0,this.qoffset_y=0,this.qoffset_z=0,this.affine=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],this.magic=0,this.extensionFlag=[0,0,0,0]},i.NIFTI2.MAGIC_COOKIE=540,i.NIFTI2.MAGIC_NUMBER_LOCATION=4,i.NIFTI2.MAGIC_NUMBER=[110,43,50,0,13,10,26,10],i.NIFTI2.prototype.readHeader=function(e){var t,n,r,o,a=new DataView(e),s=i.Utils.getIntAt(a,0,this.littleEndian);if(s!==i.NIFTI2.MAGIC_COOKIE&&(this.littleEndian=!0,s=i.Utils.getIntAt(a,0,this.littleEndian)),s!==i.NIFTI2.MAGIC_COOKIE)throw new Error("This does not appear to be a NIFTI file!");for(this.datatypeCode=i.Utils.getShortAt(a,12,this.littleEndian),this.numBitsPerVoxel=i.Utils.getShortAt(a,14,this.littleEndian),t=0;t<8;t+=1)o=16+8*t,this.dims[t]=i.Utils.getLongAt(a,o,this.littleEndian);for(this.intent_p1=i.Utils.getDoubleAt(a,80,this.littleEndian),this.intent_p2=i.Utils.getDoubleAt(a,88,this.littleEndian),this.intent_p3=i.Utils.getDoubleAt(a,96,this.littleEndian),t=0;t<8;t+=1)o=104+8*t,this.pixDims[t]=i.Utils.getDoubleAt(a,o,this.littleEndian);for(this.vox_offset=i.Utils.getLongAt(a,168,this.littleEndian),this.scl_slope=i.Utils.getDoubleAt(a,176,this.littleEndian),this.scl_inter=i.Utils.getDoubleAt(a,184,this.littleEndian),this.cal_max=i.Utils.getDoubleAt(a,192,this.littleEndian),this.cal_min=i.Utils.getDoubleAt(a,200,this.littleEndian),this.slice_duration=i.Utils.getDoubleAt(a,208,this.littleEndian),this.toffset=i.Utils.getDoubleAt(a,216,this.littleEndian),this.slice_start=i.Utils.getLongAt(a,224,this.littleEndian),this.slice_end=i.Utils.getLongAt(a,232,this.littleEndian),this.description=i.Utils.getStringAt(a,240,320),this.aux_file=i.Utils.getStringAt(a,320,344),this.qform_code=i.Utils.getIntAt(a,344,this.littleEndian),this.sform_code=i.Utils.getIntAt(a,348,this.littleEndian),this.quatern_b=i.Utils.getDoubleAt(a,352,this.littleEndian),this.quatern_c=i.Utils.getDoubleAt(a,360,this.littleEndian),this.quatern_d=i.Utils.getDoubleAt(a,368,this.littleEndian),this.qoffset_x=i.Utils.getDoubleAt(a,376,this.littleEndian),this.qoffset_y=i.Utils.getDoubleAt(a,384,this.littleEndian),this.qoffset_z=i.Utils.getDoubleAt(a,392,this.littleEndian),n=0;n<3;n+=1)for(r=0;r<4;r+=1)o=400+8*(4*n+r),this.affine[n][r]=i.Utils.getDoubleAt(a,o,this.littleEndian);this.affine[3][0]=0,this.affine[3][1]=0,this.affine[3][2]=0,this.affine[3][3]=1,this.slice_code=i.Utils.getIntAt(a,496,this.littleEndian),this.xyzt_units=i.Utils.getIntAt(a,500,this.littleEndian),this.intent_code=i.Utils.getIntAt(a,504,this.littleEndian),this.intent_name=i.Utils.getStringAt(a,508,524),this.dim_info=i.Utils.getByteAt(a,524),a.byteLength>i.NIFTI2.MAGIC_COOKIE&&(this.extensionFlag[0]=i.Utils.getByteAt(a,540),this.extensionFlag[1]=i.Utils.getByteAt(a,541),this.extensionFlag[2]=i.Utils.getByteAt(a,542),this.extensionFlag[3]=i.Utils.getByteAt(a,543),this.extensionFlag[0]&&(this.extensionSize=this.getExtensionSize(a),this.extensionCode=this.getExtensionCode(a)))},i.NIFTI2.prototype.toFormattedString=function(){var e=i.Utils.formatNumber,t="";return t+="Datatype = "+ +this.datatypeCode+" ("+this.getDatatypeCodeString(this.datatypeCode)+")\n",t+="Bits Per Voxel =  = "+this.numBitsPerVoxel+"\n",t+="Image Dimensions (1-8): "+this.dims[0]+", "+this.dims[1]+", "+this.dims[2]+", "+this.dims[3]+", "+this.dims[4]+", "+this.dims[5]+", "+this.dims[6]+", "+this.dims[7]+"\n",t+="Intent Parameters (1-3): "+this.intent_p1+", "+this.intent_p2+", "+this.intent_p3+"\n",t+="Voxel Dimensions (1-8): "+e(this.pixDims[0])+", "+e(this.pixDims[1])+", "+e(this.pixDims[2])+", "+e(this.pixDims[3])+", "+e(this.pixDims[4])+", "+e(this.pixDims[5])+", "+e(this.pixDims[6])+", "+e(this.pixDims[7])+"\n",t+="Image Offset = "+this.vox_offset+"\n",t+="Data Scale:  Slope = "+e(this.scl_slope)+"  Intercept = "+e(this.scl_inter)+"\n",t+="Display Range:  Max = "+e(this.cal_max)+"  Min = "+e(this.cal_min)+"\n",t+="Slice Duration = "+this.slice_duration+"\n",t+="Time Axis Shift = "+this.toffset+"\n",t+="Slice Start = "+this.slice_start+"\n",t+="Slice End = "+this.slice_end+"\n",t+='Description: "'+this.description+'"\n',t+='Auxiliary File: "'+this.aux_file+'"\n',t+="Q-Form Code = "+this.qform_code+" ("+this.getTransformCodeString(this.qform_code)+")\n",t+="S-Form Code = "+this.sform_code+" ("+this.getTransformCodeString(this.sform_code)+")\n",t+="Quaternion Parameters:  b = "+e(this.quatern_b)+"  c = "+e(this.quatern_c)+"  d = "+e(this.quatern_d)+"\n",t+="Quaternion Offsets:  x = "+this.qoffset_x+"  y = "+this.qoffset_y+"  z = "+this.qoffset_z+"\n",t+="S-Form Parameters X: "+e(this.affine[0][0])+", "+e(this.affine[0][1])+", "+e(this.affine[0][2])+", "+e(this.affine[0][3])+"\n",t+="S-Form Parameters Y: "+e(this.affine[1][0])+", "+e(this.affine[1][1])+", "+e(this.affine[1][2])+", "+e(this.affine[1][3])+"\n",t+="S-Form Parameters Z: "+e(this.affine[2][0])+", "+e(this.affine[2][1])+", "+e(this.affine[2][2])+", "+e(this.affine[2][3])+"\n",t+="Slice Code = "+this.slice_code+"\n",t+="Units Code = "+this.xyzt_units+" ("+this.getUnitsCodeString(i.NIFTI1.SPATIAL_UNITS_MASK&this.xyzt_units)+", "+this.getUnitsCodeString(i.NIFTI1.TEMPORAL_UNITS_MASK&this.xyzt_units)+")\n",t+="Intent Code = "+this.intent_code+"\n",t+='Intent Name: "'+this.intent_name+'"\n',t+="Dim Info = "+this.dim_info+"\n"},i.NIFTI2.prototype.getExtensionLocation=function(){return i.NIFTI2.MAGIC_COOKIE+4},i.NIFTI2.prototype.getExtensionSize=i.NIFTI1.prototype.getExtensionSize,i.NIFTI2.prototype.getExtensionCode=i.NIFTI1.prototype.getExtensionCode,i.NIFTI2.prototype.getDatatypeCodeString=i.NIFTI1.prototype.getDatatypeCodeString,i.NIFTI2.prototype.getTransformCodeString=i.NIFTI1.prototype.getTransformCodeString,i.NIFTI2.prototype.getUnitsCodeString=i.NIFTI1.prototype.getUnitsCodeString,i.NIFTI2.prototype.getQformMat=i.NIFTI1.prototype.getQformMat,i.NIFTI2.prototype.convertNiftiQFormToNiftiSForm=i.NIFTI1.prototype.convertNiftiQFormToNiftiSForm,i.NIFTI2.prototype.convertNiftiSFormToNEMA=i.NIFTI1.prototype.convertNiftiSFormToNEMA,i.NIFTI2.prototype.nifti_mat33_mul=i.NIFTI1.prototype.nifti_mat33_mul,i.NIFTI2.prototype.nifti_mat33_determ=i.NIFTI1.prototype.nifti_mat33_determ;var r=typeof t;"undefined"!==r&&t.exports&&(t.exports=i.NIFTI2)},{"./nifti1.js":47,"./utilities.js":49}],49:[function(e,t,n){"use strict";var i=i||{};i.Utils=i.Utils||{},i.Utils.crcTable=null,i.Utils.GUNZIP_MAGIC_COOKIE1=31,i.Utils.GUNZIP_MAGIC_COOKIE2=139,i.Utils.getStringAt=function(e,t,n){var i,r,o="";for(i=t;i<n;i+=1)r=e.getUint8(i),0!==r&&(o+=String.fromCharCode(r));return o},i.Utils.getByteAt=function(e,t){return e.getInt8(t)},i.Utils.getShortAt=function(e,t,n){return e.getInt16(t,n)},i.Utils.getIntAt=function(e,t,n){return e.getInt32(t,n)},i.Utils.getFloatAt=function(e,t,n){return e.getFloat32(t,n)},i.Utils.getDoubleAt=function(e,t,n){return e.getFloat64(t,n)},i.Utils.getLongAt=function(e,t,n){var r,o=[],a=0;for(r=0;r<8;r+=1)o[r]=i.Utils.getByteAt(e,t+r,n);for(r=o.length-1;r>=0;r--)a=256*a+o[r];return a},i.Utils.toArrayBuffer=function(e){var t,n,i;for(t=new ArrayBuffer(e.length),n=new Uint8Array(t),i=0;i<e.length;i+=1)n[i]=e[i];return t},i.Utils.isString=function(e){return"string"==typeof e||e instanceof String},i.Utils.formatNumber=function(e,t){var n=0;return n=i.Utils.isString(e)?Number(e):e,n=t?n.toPrecision(5):n.toPrecision(7),parseFloat(n)},i.Utils.makeCRCTable=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t},i.Utils.crc32=function(e){for(var t=i.Utils.crcTable||(i.Utils.crcTable=i.Utils.makeCRCTable()),n=-1,r=0;r<e.byteLength;r++)n=n>>>8^t[255&(n^e.getUint8(r))];return(n^-1)>>>0};var r=typeof t;"undefined"!==r&&t.exports&&(t.exports=i.Utils)},{}],50:[function(e,t,n){"use strict";function i(e){return e.replace("\\","\\\\").replace("\n","\\n")}function r(e){return e.split("\\\\").map(function(e){return e.replace("\\n","\n")}).join("\\")}function o(e,t,n,i){var r,o=l(e);switch(e){case"data":case"buffer":case"keys":case"version":break;case"content":case"number":case"sampleUnits":case"space":r=o+": "+t;break;case"blockSize":case"lineSkip":case"byteSkip":case"dimension":case"spaceDimension":O("number"==typeof t||t instanceof Number,"Field "+e+" should at least contain a number!"),r=o+": "+t;break;case"min":case"max":case"oldMin":case"oldMax":O("number"==typeof t||t instanceof Number,"Field "+e+" should contain a number!"),r=o+": "+t;break;case"spaceOrigin":O(t.length===i,"Field "+e+" should be a list with length equal to the space dimension!"),t.forEach(function(t){O("number"==typeof t||t instanceof Number,"Field "+e+" should be a list of numbers!")}),r=o+": ("+t.join(",")+")";break;case"labels":case"units":case"spaceUnits":O(void 0!==t.length&&t.length==n,"Field "+e+" should be a list with length equal to the dimension!"),t.forEach(function(t){O("string"==typeof t||t instanceof String,"Field "+e+" should be a list of numbers!")}),r=o+": "+t.map(d).join(" ");break;case"sizes":O(void 0!==t.length&&t.length==n,"Field "+e+" should be a list with length equal to the dimension!"),t.forEach(function(t){O("number"==typeof t||t instanceof Number,"Field "+e+" should be a list of numbers!")}),r=o+": "+t.join(" ");break;case"spacings":case"thicknesses":case"axisMins":case"axisMaxs":O(void 0!==t.length&&t.length==n,"Field "+e+" should be a list with length equal to the dimension!"),t.forEach(function(t){O("number"==typeof t||t instanceof Number,"Field "+e+" should be a list of numbers!")}),r=o+": "+t.join(" ");break;case"spaceDirections":O(void 0!==t.length&&t.length===n,"Field "+e+" should be a list with length equal to the dimension!"),t.forEach(function(t){O(null===t||void 0!==t.length&&t.length===i,"The elements of field "+e+" should be lists with length equal to the space dimension!"),null!==t&&t.forEach(function(t){O("number"==typeof t||t instanceof Number,"The elements of field "+e+" should be lists of numbers!")})}),r=o+": "+t.map(function(e){return null===e?"none":"("+e.join(",")+")"}).join(" ");break;case"measurementFrame":O(void 0!==t.length&&t.length===i,"Field "+e+" should be a list with length equal to the space dimension!"),t.forEach(function(t){O(null===t||void 0!==t.length&&t.length===i,"The elements of field "+e+" should be lists with length equal to the space dimension!"),null!==t&&t.forEach(function(t){O("number"==typeof t||t instanceof Number,"The elements of field "+e+" should be lists of numbers!")})}),r=o+": "+t.map(function(e){return null===e?"none":"("+e.join(",")+")"}).join(" ");break;case"type":O("string"==typeof t||t instanceof String,"Field "+e+" should contain a string!"),r=o+": "+t;break;case"encoding":O("string"==typeof t||t instanceof String,"Field "+e+" should contain a string!"),r=o+": "+t;break;case"endian":O("string"==typeof t||t instanceof String,"Field "+e+" should contain a string!"),r=o+": "+t;break;case"dataFile":t.length||t.files&&"subdim"in t||(r=o+": "+b(t));break;case"centers":O(void 0!==t.length&&t.length==n,"Field "+e+" should be a list with length equal to the dimension!"),r=o+": "+t.map(k).join(" ");break;case"kinds":O(void 0!==t.length&&t.length==n,"Field "+e+" should be a list with length equal to the dimension!"),r=o+": "+t.map(k).join(" ");break;default:console.warn("Unrecognized NRRD field: "+e+", skipping.")}return r}function a(e,t){switch(e){case"content":case"number":case"sampleUnits":break;case"dimension":case"blockSize":case"lineSkip":case"byteSkip":case"spaceDimension":t=u(t);break;case"min":case"max":case"oldMin":case"oldMax":t=c(t);break;case"spaceOrigin":t=h(t);break;case"labels":case"units":case"spaceUnits":t=p(t,f);break;case"sizes":t=p(t,u);break;case"spacings":case"thicknesses":case"axisMins":case"axisMaxs":t=p(t,c);break;case"spaceDirections":case"measurementFrame":t=p(t,h);break;case"type":t=m(t);break;case"encoding":t=_(t);break;case"endian":t=y(t);break;case"dataFile":t=v(t);break;case"centers":t=p(t,w);break;case"kinds":t=p(t,x);break;case"space":t=g(t);break;default:console.warn("Unrecognized NRRD field: "+e)}return t}function s(e){return e=e.toLowerCase(),e in F?F[e]:e}function l(e){return e in z?z[e]:e}function u(e){var t=parseInt(e,10);if(Number.isNaN(t))throw new Error("Malformed NRRD integer: "+e);return t}function c(e){if(e=e.toLowerCase(),e.indexOf("nan")>=0)return NaN;if(e.indexOf("-inf")>=0)return-(1/0);if(e.indexOf("inf")>=0)return 1/0;var t=parseFloat(e);if(Number.isNaN(t))throw new Error("Malformed NRRD float: "+e);return t}function h(e){if("none"==e)return null;if(e.length<2||"("!==e[0]||")"!==e[e.length-1])throw new Error("Malformed NRRD vector: "+e);return e.slice(1,-1).split(",").map(c)}function f(e){if(length<2||'"'!=e[0]||'"'!=e[e.length-1])throw new Error("Invalid NRRD quoted string: "+e);return e.slice(1,-1).replace('\\"','"')}function d(e){return'"'+e.replace('"','\\"')+'"'}function p(e,t){return e.split(B).map(t)}function m(e){switch(e.toLowerCase()){case"signed char":case"int8":case"int8_t":return"int8";case"uchar":case"unsigned char":case"uint8":case"uint8_t":return"uint8";case"short":case"short int":case"signed short":case"signed short int":case"int16":case"int16_t":return"int16";case"ushort":case"unsigned short":case"unsigned short int":case"uint16":case"uint16_t":return"uint16";case"int":case"signed int":case"int32":case"int32_t":return"int32";case"uint":case"unsigned int":case"uint32":case"uint32_t":return"uint32";case"longlong":case"long long":case"long long int":case"signed long long":case"signed long long int":case"int64":case"int64_t":return"int64";case"ulonglong":case"unsigned long long":case"unsigned long long int":case"uint64":case"uint64_t":return"uint64";case"float":return"float";case"double":return"double";case"block":return"block";default:return console.warn("Unrecognized NRRD type: "+e),e}}function _(e){switch(e.toLowerCase()){case"raw":return"raw";case"txt":case"text":case"ascii":return"ascii";case"hex":return"hex";case"gz":case"gzip":return"gzip";case"bz2":case"bzip2":return"bzip2";default:return console.warn("Unrecognized NRRD encoding: "+e),e}}function g(e){switch(e.toLowerCase()){case"right-anterior-superior":case"ras":return"right-anterior-superior";case"left-anterior-superior":case"las":return"left-anterior-superior";case"left-posterior-superior":case"lps":return"left-posterior-superior";case"right-anterior-superior-time":case"rast":return"right-anterior-superior-time";case"left-anterior-superior-time":case"last":return"left-anterior-superior-time";case"left-posterior-superior-time":case"lpst":return"left-posterior-superior-time";case"scanner-xyz":return"scanner-xyz";case"scanner-xyz-time":return"scanner-xyz-time";case"3d-right-handed":return"3D-right-handed";case"3d-left-handed":return"3D-left-handed";case"3d-right-handed-time":return"3D-right-handed-time";case"3d-left-handed-time":return"3D-left-handed-time";default:return console.warn("Unrecognized space: "+e),e}}function y(e){switch(e.toLowerCase()){case"little":return"little";case"big":return"big";default:return console.warn("Unrecognized NRRD endianness: "+e),e}}function v(e){var t=U.exec(e);return t?5==t.length&&t[4]?{format:e.substring(0,t.index),min:u(t[1]),max:u(t[2]),step:u(t[3]),subdim:u(t[4])}:{format:e.substring(0,t.index),min:u(t[1]),max:u(t[2]),step:u(t[3])}:e}function b(e){if("string"==typeof e||e instanceof String)return e;if("format"in e&&"min"in e&&"max"in e&&"step"in e)return"subdim"in e?e.format+" "+e.min+" "+e.max+" "+e.step+" "+e.subdim:e.format+" "+e.min+" "+e.max+" "+e.step;throw new Error("Unrecognized data file format!")}function w(e){switch(e.toLowerCase()){case"cell":return"cell";case"node":return"node";case"???":case"none":return null;default:return console.warn("Unrecognized NRRD center: "+e),e}}function x(e){var t=e.toLowerCase();return t in N?N[t]:(console.warn("Unrecognized NRRD kind: "+e),e)}function k(e){return null===e?"???":e}function E(e,t,n,i){function r(t){if(e.byteLength<u*t)throw new Error("NRRD file does not contain enough data!")}var o,a,s,l,u=1;for(o=0;o<n.length;o++){if(n[o]<=0)throw new Error("Sizes should be a list of positive (>0) integers!");u*=n[o]}if("block"==t)return e.slice(0,u*i.blockSize);if("int8"==t||"uint8"==t||i.endian==j)switch(t){case"int8":return r(1),new Int8Array(e.slice(0,u));case"uint8":return r(1),new Uint8Array(e.slice(0,u));case"int16":return r(2),new Int16Array(e.slice(0,2*u));case"uint16":return r(2),new Uint16Array(e.slice(0,2*u));case"int32":return r(4),new Int32Array(e.slice(0,4*u));case"uint32":return r(4),new Uint32Array(e.slice(0,4*u));case"float":return r(4),new Float32Array(e.slice(0,4*u));case"double":return r(8),new Float64Array(e.slice(0,8*u));default:return void console.warn("Unsupported NRRD type: "+t+", returning raw buffer.")}else{switch(i.endian){case"big":l=!1;break;case"little":l=!0;break;default:return void console.warn("Unsupported endianness in NRRD file: "+i.endian)}switch(s=new DataView(e),t){case"int8":for(a=new Int8Array(u),o=0;o<u;o++)a[o]=s.getInt8(o);return a;case"uint8":for(a=new Uint8Array(u),o=0;o<u;o++)a[o]=s.getUint8(o);return a;case"int16":for(a=new Int16Array(u),o=0;o<u;o++)a[o]=s.getInt16(2*o);return a;case"uint16":for(a=new Uint16Array(u),o=0;o<u;o++)a[o]=s.getUint16(2*o);return a;case"int32":for(a=new Int32Array(u),o=0;o<u;o++)a[o]=s.getInt32(4*o);return a;case"uint32":for(a=new Uint32Array(u),o=0;o<u;o++)a[o]=s.getUint32(4*o);return a;case"float":for(a=new Float32Array(u),o=0;o<u;o++)a[o]=s.getFloat32(4*o);return a;case"double":for(a=new Float64Array(u),o=0;o<u;o++)a[o]=s.getFloat64(8*o);return a;default:return void console.warn("Unsupported NRRD type: "+t+", returning raw buffer.")}}}function S(e,t,n){var i,r,o,a,s=1;for(i=0;i<n.length;i++){if(n[i]<=0)throw new Error("Sizes should be a list of positive (>0) integers!");s*=n[i]}if(r=new Uint8Array(e),o=String.fromCharCode.apply(null,r),a=o.split(V),a.length<s)throw new Error("Not enough data in NRRD file!");switch(a.length>s&&(""===a[0]&&(a=a.slice(1)),a=a.slice(0,s)),t){case"int8":return new Int8Array(a.map(u));case"uint8":return new Uint8Array(a.map(u));case"int16":return new Int16Array(a.map(u));case"uint16":return new Uint16Array(a.map(u));case"int32":return new Int32Array(a.map(u));case"uint32":return new Uint32Array(a.map(u));case"float":return new Float32Array(a.map(c));case"double":return new Float64Array(a.map(c));default:return void console.warn("Unsupported NRRD type: "+t+".")}}function I(e){switch(e){case"int8":return 1;case"uint8":return 1;case"int16":return 2;case"uint16":return 2;case"int32":return 4;case"uint32":return 4;case"int64":return 8;case"uint64":return 8;case"float":return 4;case"double":return 8;default:throw new Error("Do not know the size of NRRD type: "+e)}}function T(e){if(void 0===e.dimension)throw new Error("Dimension missing from NRRD file!");if(void 0===e.type)throw new Error("Type missing from NRRD file!");if(void 0===e.encoding)throw new Error("Encoding missing from NRRD file!");if(void 0===e.sizes)throw new Error("Sizes missing from NRRD file!");if("block"!=e.type&&"int8"!=e.type&&"uint8"!=e.type&&"ascii"!=e.encoding&&void 0===e.endian)throw new Error("Endianness missing from NRRD file!");if("block"==e.type&&void 0===e.blockSize)throw new Error("Missing block size in NRRD file!");if(0===e.dimension)throw new Error("Zero-dimensional NRRD file?");if(e.dimension!=e.sizes.length)throw new Error("Length of 'sizes' is different from 'dimension' in an NRRD file!");if(e.spacings&&e.dimension!=e.spacings.length)throw new Error("Length of 'spacings' is different from 'dimension' in an NRRD file!");if(e.thicknesses&&e.dimension!=e.thicknesses.length)throw new Error("Length of 'thicknesses' is different from 'dimension' in an NRRD file!");if(e.axisMins&&e.dimension!=e.axisMins.length)throw new Error("Length of 'axis mins' is different from 'dimension' in an NRRD file!");if(e.axisMaxs&&e.dimension!=e.axisMaxs.length)throw new Error("Length of 'axis maxs' is different from 'dimension' in an NRRD file!");
if(e.centers&&e.dimension!=e.centers.length)throw new Error("Length of 'centers' is different from 'dimension' in an NRRD file!");if(e.labels&&e.dimension!=e.labels.length)throw new Error("Length of 'labels' is different from 'dimension' in an NRRD file!");if(e.units&&e.dimension!=e.units.length)throw new Error("Length of 'units' is different from 'dimension' in an NRRD file!");if(e.kinds&&e.dimension!=e.kinds.length)throw new Error("Length of 'kinds' is different from 'dimension' in an NRRD file!");if(!(void 0!==e.data&&0!==e.data.length||void 0!==e.buffer&&0!==e.buffer.byteLength||void 0!==e.dataFile))throw new Error("NRRD file has neither inline or external data!")}function P(e,t){switch(t){case"int8":return new Int8Array(e);case"uint8":return new Uint8Array(e);case"int16":return new Int16Array(e);case"uint16":return new Uint16Array(e);case"int32":return new Int32Array(e);case"uint32":return new Uint32Array(e);case"float":return new Float32Array(e);case"double":return new Float64Array(e);default:throw new Error("Cannot cast to NRRD type: "+t)}}function A(e,t,n){var i,r,o,a=I(t),s=new ArrayBuffer(e.length*a);switch(n){case"big":r=!1;break;case"little":r=!0;break;default:return void console.warn("Unsupported endianness in NRRD file: "+n)}switch(o=new DataView(s),t){case"int8":for(i=0;i<e.length;i++)o.setInt8(i,e[i],r);return s;case"uint8":for(i=0;i<e.length;i++)o.setUint8(i,e[i],r);return s;case"int16":for(i=0;i<e.length;i++)o.setInt16(2*i,e[i],r);return s;case"uint16":for(i=0;i<e.length;i++)o.setUint16(2*i,e[i],r);return s;case"int32":for(i=0;i<e.length;i++)o.setInt32(4*i,e[i],r);return s;case"uint32":for(i=0;i<e.length;i++)o.setUint32(4*i,e[i],r);return s;case"float":for(i=0;i<e.length;i++)o.setFloat32(4*i,e[i],r);return s;case"double":for(i=0;i<e.length;i++)o.setFloat64(8*i,e[i],r);return s;default:return void console.warn("Cannot serialize NRRD type: "+t+".")}}function D(e){var t,n,i,r,o=new Array(e.length);for(t=0;t<e.length;t++)o[t]=""+e[t];for(n=o.join(" "),i=new ArrayBuffer(n.length),r=new Uint8Array(i),t=0;t<r.length;t++)r[t]=n.charCodeAt(t);return i}var O=e("assert"),M=/[ \f\t\v]*\r?\n/,C=/^NRRD\d{4}$/,R=/^([^:]*)(:[ =])(.*)$/,L=/^LIST(?: (\d+))?$/;t.exports.serialize=function(e){var t,n,r,a,s,l,u,c,h,f,d=1,p={},g=[];for(a in e)p[a]=e[a];if(void 0===p.sizes)throw new Error("Sizes missing from NRRD file!");if(void 0===p.dimension&&(p.dimension=p.sizes.length),p.data instanceof Int8Array?s="int8":p.data instanceof Uint8Array?s="uint8":p.data instanceof Int16Array?s="int16":p.data instanceof Uint16Array?s="uint16":p.data instanceof Int32Array?s="int32":p.data instanceof Uint32Array?s="uint32":p.data instanceof Float32Array?s="float":p.data instanceof Float64Array&&(s="double"),void 0===p.type&&void 0!==s)p.type=s;else{if(void 0===p.type)throw new Error("Type of data is not given and cannot be inferred!");("string"==typeof p.type||p.type instanceof String)&&(p.type=m(p.type))}void 0===p.encoding?p.encoding="raw":("string"==typeof p.encoding||p.encoding instanceof String)&&(p.encoding=_(p.encoding)),p.data&&"block"!=p.type&&"int8"!=p.type&&"uint8"!=p.type&&"ascii"!=p.encoding?p.endian=j:"block"==p.type||"int8"==p.type||"uint8"==p.type||"ascii"==p.encoding?p.endian=void 0:("string"==typeof p.endian||p.endian instanceof String)&&(p.endian=y(p.endian));var v=void 0;if(void 0!==p.spaceDimension)v=p.spaceDimension;else if(void 0!==p.space)switch(p.space){case"right-anterior-superior":case"RAS":v=3;break;case"left-anterior-superior":case"LAS":v=3;break;case"left-posterior-superior":case"LPS":v=3;break;case"right-anterior-superior-time":case"RAST":v=4;break;case"left-anterior-superior-time":case"LAST":v=4;break;case"left-posterior-superior-time":case"LPST":v=4;break;case"scanner-xyz":v=3;break;case"scanner-xyz-time":v=4;break;case"3D-right-handed":v=3;break;case"3D-left-handed":v=3;break;case"3D-right-handed-time":v=4;break;case"3D-left-handed-time":v=4;break;default:console.warn("Unrecognized space: "+p.space)}for(T(p),t=0;t<p.sizes.length;t++){if(p.sizes[t]<=0)throw new Error("Sizes should be a list of positive (>0) integers!");d*=p.sizes[t]}if(p.data){if(p.data.length<d)throw new Error("Missing data to serialize!")}else if(p.buffer){if("raw"==p.encoding&&(l="block"==p.type&&void 0!==p.blockSize?p.blockSize:I(p.type),p.buffer.byteLength<d*l))throw new Error("Missing data to serialize!")}else if(!p.dataFile)throw new Error("Will not serialize an empty NRRD file!");if(p.data)switch(p.encoding){case"raw":p.type==s&&p.endian==j?u=p.data.buffer.slice(p.data.byteOffset,p.data.byteOffset+p.data.byteLength):p.endian==j?(u=P(p.data,p.type),u=u.buffer.slice(u.byteOffset,u.byteOffset+u.byteLength)):u=A(p.data,p.type,p.endian);break;case"ascii":u=D(p.type==s?p.data:P(p.data,p.type));break;default:throw new Error("Unsupported NRRD encoding: "+p.encoding)}else p.buffer&&(u=p.buffer);g.push("NRRD0005"),g.push("# Generated by nrrd-js");var b=["dimension","spaceDimension","space"];for(t=0;t<b.length;t++)a=b[t],void 0!==p[a]&&(h=o(a,p[a],p.dimension,v),void 0!==h&&g.push(h));for(a in p)void 0!==p[a]&&(b.indexOf(a)>=0||(h=o(a,p[a],p.dimension,v),void 0!==h&&g.push(h)));if(p.keys)for(a in p.keys){if(a.indexOf(":=")>=0)throw new Error("The combination ':=' is not allowed in an NRRD key!");g.push(a+":="+i(p[a]))}if(p.dataFile&&p.dataFile.length?(g.push("data file: LIST"),Array.prototype.push.apply(g,p.dataFile)):p.dataFile&&p.dataFile.files&&"subdim"in p.dataFile&&(g.push("data file: LIST "+p.dataFile.subdim),Array.prototype.push.apply(g,p.dataFile.files)),!u||"dataFile"in p)for(g.push(""),f=g.join("\n"),n=new ArrayBuffer(f.length),r=new Uint8Array(n),t=0;t<f.length;t++)r[t]=f.charCodeAt(t);else{for(g.push(""),g.push(""),f=g.join("\n"),n=new ArrayBuffer(f.length+u.byteLength),r=new Uint8Array(n),t=0;t<f.length;t++)r[t]=f.charCodeAt(t);c=new Uint8Array(u),r.set(c,f.length)}return n},t.exports.parse=function(e){var t,n,i,o,l,c,h={data:void 0,buffer:void 0,keys:{},version:void 0},f=new Uint8Array(e);for(f.buffer!==e&&(e=f.buffer),t=2;t<f.length;)if(10==f[t]){if(10==f[t-1]||13==f[t-1]&&10==f[t-2]){i=t+1;break}t++}else 13==f[t]?t++:t+=2;if(void 0===i?n=String.fromCharCode.apply(null,f):(n=String.fromCharCode.apply(null,f.subarray(0,i)),h.buffer=e.slice(i)),o=n.split(M),o=o.filter(function(e){return e.length>0&&"#"!=e[0]}),!C.test(o[0]))throw new Error("File is not an NRRD file!");for(h.version=parseInt(o[0].substring(4,8),10),h.version>5&&console.warn("Reading an unsupported version of the NRRD format; things may go haywire."),t=1;t<o.length;t++)if(l=R.exec(o[t]))if(": "==l[2])l[1]=s(l[1]),"dataFile"==l[1]&&(c=L.exec(l[3]))?(2==c.length&&c[1]?h[l[1]]={files:o.slice(t+1),subdim:u(c[1])}:h[l[1]]=o.slice(t+1),o.length=t):h[l[1]]=a(l[1],l[3]);else{if(":="!=l[2])throw new Error("Logic error in NRRD parser.");h.keys[l[1]]=r(l[3])}else console.warn("Unrecognized line in NRRD header: "+o[t]);if(T(h),"dataFile"in h)console.warn("No support for external data yet!");else switch(h.encoding){case"raw":h.data=E(h.buffer,h.type,h.sizes,{endian:h.endian,blockSize:h.blockSize});break;case"ascii":h.data=S(h.buffer,h.type,h.sizes);break;default:console.warn("Unsupported NRRD encoding: "+h.encoding)}return h};var F={"block size":"blockSize",blocksize:"blockSize","old min":"oldMin",oldmin:"oldMin","old max":"oldMax",oldmax:"oldMax","data file":"dataFile",datafile:"dataFile","line skip":"lineSkip",lineskip:"lineSkip","byte skip":"byteSkip",byteskip:"byteSkip","sample units":"sampleUnits",sampleunits:"sampleUnits","axis mins":"axisMins","axis maxs":"axisMaxs",centers:"centers",centerings:"centers","space dimension":"spaceDimension","space units":"spaceUnits","space origin":"spaceOrigin","space directions":"spaceDirections","measurement frame":"measurementFrame"},z=function(){var e,t={};for(e in F)t[F[e]]=e;return t}(),B=/[ \t]+/,U=/ (-?\d+) (-?\d+) (-?\d+)(?: (\d+))?$/,N={domain:"domain",space:"space",time:"time",list:"list",point:"point",vector:"vector","covariant-vector":"covariant-vector",normal:"normal",stub:"stub",scalar:"scalar",complex:"complex","2-vector":"2-vector","3-color":"3-color","rgb-color":"RGB-color","hsv-color":"HSV-color","xyz-color":"XYZ-color","4-color":"4-color","rgba-color":"RGBA-color","3-vector":"3-vector","3-gradient":"3-gradient","3-normal":"3-normal","4-vector":"4-vector",quaternion:"quaternion","2d-symmetric-matrix":"2D-symmetric-matrix","2d-masked-symmetric-matrix":"2D-masked-symmetric-matrix","2d-matrix":"2D-matrix","2d-masked-matrix":"2D-masked-matrix","3d-symmetric-matrix":"3D-symmetric-matrix","3d-masked-symmetric-matrix":"3D-masked-symmetric-matrix","3d-matrix":"3D-matrix","3d-masked-matrix":"3D-masked-matrix","???":null,none:null},j=function(){var e=new ArrayBuffer(4),t=new Uint32Array(e),n=new Uint8Array(e);return t[0]=16909060,1==n[0]&&2==n[1]&&3==n[2]&&4==n[3]?"big":4==n[0]&&3==n[1]&&2==n[2]&&1==n[3]?"little":void console.warn("Unrecognized system endianness!")}(),V=/[ \t\n\r\v\f]+/},{assert:3}],51:[function(e,t,n){"use strict";var i=e("./lib/utils/common").assign,r=e("./lib/deflate"),o=e("./lib/inflate"),a=e("./lib/zlib/constants"),s={};i(s,r,o,a),t.exports=s},{"./lib/deflate":52,"./lib/inflate":53,"./lib/utils/common":54,"./lib/zlib/constants":57}],52:[function(e,t,n){"use strict";function i(e){if(!(this instanceof i))return new i(e);this.options=l.assign({level:y,method:b,chunkSize:16384,windowBits:15,memLevel:8,strategy:v,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var n=s.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==m)throw new Error(c[n]);if(t.header&&s.deflateSetHeader(this.strm,t.header),t.dictionary){var r;if(r="string"==typeof t.dictionary?u.string2buf(t.dictionary):"[object ArrayBuffer]"===f.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,n=s.deflateSetDictionary(this.strm,r),n!==m)throw new Error(c[n]);this._dict_set=!0}}function r(e,t){var n=new i(t);if(n.push(e,!0),n.err)throw n.msg;return n.result}function o(e,t){return t=t||{},t.raw=!0,r(e,t)}function a(e,t){return t=t||{},t.gzip=!0,r(e,t)}var s=e("./zlib/deflate"),l=e("./utils/common"),u=e("./utils/strings"),c=e("./zlib/messages"),h=e("./zlib/zstream"),f=Object.prototype.toString,d=0,p=4,m=0,_=1,g=2,y=-1,v=0,b=8;i.prototype.push=function(e,t){var n,i,r=this.strm,o=this.options.chunkSize;if(this.ended)return!1;i=t===~~t?t:t===!0?p:d,"string"==typeof e?r.input=u.string2buf(e):"[object ArrayBuffer]"===f.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;do{if(0===r.avail_out&&(r.output=new l.Buf8(o),r.next_out=0,r.avail_out=o),n=s.deflate(r,i),n!==_&&n!==m)return this.onEnd(n),this.ended=!0,!1;0!==r.avail_out&&(0!==r.avail_in||i!==p&&i!==g)||("string"===this.options.to?this.onData(u.buf2binstring(l.shrinkBuf(r.output,r.next_out))):this.onData(l.shrinkBuf(r.output,r.next_out)))}while((r.avail_in>0||0===r.avail_out)&&n!==_);return i===p?(n=s.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===m):i!==g||(this.onEnd(m),r.avail_out=0,!0)},i.prototype.onData=function(e){this.chunks.push(e)},i.prototype.onEnd=function(e){e===m&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Deflate=i,n.deflate=r,n.deflateRaw=o,n.gzip=a},{"./utils/common":54,"./utils/strings":55,"./zlib/deflate":59,"./zlib/messages":64,"./zlib/zstream":66}],53:[function(e,t,n){"use strict";function i(e){if(!(this instanceof i))return new i(e);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0===(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var n=a.inflateInit2(this.strm,t.windowBits);if(n!==u.Z_OK)throw new Error(c[n]);this.header=new f,a.inflateGetHeader(this.strm,this.header)}function r(e,t){var n=new i(t);if(n.push(e,!0),n.err)throw n.msg;return n.result}function o(e,t){return t=t||{},t.raw=!0,r(e,t)}var a=e("./zlib/inflate"),s=e("./utils/common"),l=e("./utils/strings"),u=e("./zlib/constants"),c=e("./zlib/messages"),h=e("./zlib/zstream"),f=e("./zlib/gzheader"),d=Object.prototype.toString;i.prototype.push=function(e,t){var n,i,r,o,c,h,f=this.strm,p=this.options.chunkSize,m=this.options.dictionary,_=!1;if(this.ended)return!1;i=t===~~t?t:t===!0?u.Z_FINISH:u.Z_NO_FLUSH,"string"==typeof e?f.input=l.binstring2buf(e):"[object ArrayBuffer]"===d.call(e)?f.input=new Uint8Array(e):f.input=e,f.next_in=0,f.avail_in=f.input.length;do{if(0===f.avail_out&&(f.output=new s.Buf8(p),f.next_out=0,f.avail_out=p),n=a.inflate(f,u.Z_NO_FLUSH),n===u.Z_NEED_DICT&&m&&(h="string"==typeof m?l.string2buf(m):"[object ArrayBuffer]"===d.call(m)?new Uint8Array(m):m,n=a.inflateSetDictionary(this.strm,h)),n===u.Z_BUF_ERROR&&_===!0&&(n=u.Z_OK,_=!1),n!==u.Z_STREAM_END&&n!==u.Z_OK)return this.onEnd(n),this.ended=!0,!1;f.next_out&&(0!==f.avail_out&&n!==u.Z_STREAM_END&&(0!==f.avail_in||i!==u.Z_FINISH&&i!==u.Z_SYNC_FLUSH)||("string"===this.options.to?(r=l.utf8border(f.output,f.next_out),o=f.next_out-r,c=l.buf2string(f.output,r),f.next_out=o,f.avail_out=p-o,o&&s.arraySet(f.output,f.output,r,o,0),this.onData(c)):this.onData(s.shrinkBuf(f.output,f.next_out)))),0===f.avail_in&&0===f.avail_out&&(_=!0)}while((f.avail_in>0||0===f.avail_out)&&n!==u.Z_STREAM_END);return n===u.Z_STREAM_END&&(i=u.Z_FINISH),i===u.Z_FINISH?(n=a.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===u.Z_OK):i!==u.Z_SYNC_FLUSH||(this.onEnd(u.Z_OK),f.avail_out=0,!0)},i.prototype.onData=function(e){this.chunks.push(e)},i.prototype.onEnd=function(e){e===u.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Inflate=i,n.inflate=r,n.inflateRaw=o,n.ungzip=r},{"./utils/common":54,"./utils/strings":55,"./zlib/constants":57,"./zlib/gzheader":60,"./zlib/inflate":62,"./zlib/messages":64,"./zlib/zstream":66}],54:[function(e,t,n){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;n.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var i in n)n.hasOwnProperty(i)&&(e[i]=n[i])}}return e},n.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var r={arraySet:function(e,t,n,i,r){if(t.subarray&&e.subarray)return void e.set(t.subarray(n,n+i),r);for(var o=0;o<i;o++)e[r+o]=t[n+o]},flattenChunks:function(e){var t,n,i,r,o,a;for(i=0,t=0,n=e.length;t<n;t++)i+=e[t].length;for(a=new Uint8Array(i),r=0,t=0,n=e.length;t<n;t++)o=e[t],a.set(o,r),r+=o.length;return a}},o={arraySet:function(e,t,n,i,r){for(var o=0;o<i;o++)e[r+o]=t[n+o]},flattenChunks:function(e){return[].concat.apply([],e)}};n.setTyped=function(e){e?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,r)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,o))},n.setTyped(i)},{}],55:[function(e,t,n){"use strict";function i(e,t){if(t<65537&&(e.subarray&&a||!e.subarray&&o))return String.fromCharCode.apply(null,r.shrinkBuf(e,t));for(var n="",i=0;i<t;i++)n+=String.fromCharCode(e[i]);return n}var r=e("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch(e){o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){a=!1}for(var s=new r.Buf8(256),l=0;l<256;l++)s[l]=l>=252?6:l>=248?5:l>=240?4:l>=224?3:l>=192?2:1;s[254]=s[254]=1,n.string2buf=function(e){var t,n,i,o,a,s=e.length,l=0;for(o=0;o<s;o++)n=e.charCodeAt(o),55296===(64512&n)&&o+1<s&&(i=e.charCodeAt(o+1),56320===(64512&i)&&(n=65536+(n-55296<<10)+(i-56320),o++)),l+=n<128?1:n<2048?2:n<65536?3:4;for(t=new r.Buf8(l),a=0,o=0;a<l;o++)n=e.charCodeAt(o),55296===(64512&n)&&o+1<s&&(i=e.charCodeAt(o+1),56320===(64512&i)&&(n=65536+(n-55296<<10)+(i-56320),o++)),n<128?t[a++]=n:n<2048?(t[a++]=192|n>>>6,t[a++]=128|63&n):n<65536?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|63&n):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|63&n);return t},n.buf2binstring=function(e){return i(e,e.length)},n.binstring2buf=function(e){for(var t=new r.Buf8(e.length),n=0,i=t.length;n<i;n++)t[n]=e.charCodeAt(n);return t},n.buf2string=function(e,t){var n,r,o,a,l=t||e.length,u=new Array(2*l);for(r=0,n=0;n<l;)if(o=e[n++],o<128)u[r++]=o;else if(a=s[o],a>4)u[r++]=65533,n+=a-1;else{for(o&=2===a?31:3===a?15:7;a>1&&n<l;)o=o<<6|63&e[n++],a--;a>1?u[r++]=65533:o<65536?u[r++]=o:(o-=65536,u[r++]=55296|o>>10&1023,u[r++]=56320|1023&o)}return i(u,r)},n.utf8border=function(e,t){var n;for(t=t||e.length,t>e.length&&(t=e.length),n=t-1;n>=0&&128===(192&e[n]);)n--;return n<0?t:0===n?t:n+s[e[n]]>t?n:t}},{"./common":54}],56:[function(e,t,n){arguments[4][6][0].apply(n,arguments)},{dup:6}],57:[function(e,t,n){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],58:[function(e,t,n){"use strict";function i(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}function r(e,t,n,i){var r=o,a=i+n;e^=-1;for(var s=i;s<a;s++)e=e>>>8^r[255&(e^t[s])];return e^-1}var o=i();t.exports=r},{}],59:[function(e,t,n){"use strict";function i(e,t){return e.msg=R[t],t}function r(e){return(e<<1)-(e>4?9:0)}function o(e){for(var t=e.length;--t>=0;)e[t]=0}function a(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(D.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function s(e,t){O._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,a(e.strm)}function l(e,t){e.pending_buf[e.pending++]=t}function u(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function c(e,t,n,i){var r=e.avail_in;return r>i&&(r=i),0===r?0:(e.avail_in-=r,D.arraySet(t,e.input,e.next_in,r,n),1===e.state.wrap?e.adler=M(e.adler,t,r,n):2===e.state.wrap&&(e.adler=C(e.adler,t,r,n)),e.next_in+=r,e.total_in+=r,r)}function h(e,t){var n,i,r=e.max_chain_length,o=e.strstart,a=e.prev_length,s=e.nice_match,l=e.strstart>e.w_size-he?e.strstart-(e.w_size-he):0,u=e.window,c=e.w_mask,h=e.prev,f=e.strstart+ce,d=u[o+a-1],p=u[o+a];e.prev_length>=e.good_match&&(r>>=2),s>e.lookahead&&(s=e.lookahead);do if(n=t,u[n+a]===p&&u[n+a-1]===d&&u[n]===u[o]&&u[++n]===u[o+1]){o+=2,n++;do;while(u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&o<f);if(i=ce-(f-o),o=f-ce,i>a){if(e.match_start=t,a=i,i>=s)break;d=u[o+a-1],p=u[o+a]}}while((t=h[t&c])>l&&0!==--r);return a<=e.lookahead?a:e.lookahead}function f(e){var t,n,i,r,o,a=e.w_size;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=a+(a-he)){D.arraySet(e.window,e.window,a,a,0),e.match_start-=a,e.strstart-=a,e.block_start-=a,n=e.hash_size,t=n;do i=e.head[--t],e.head[t]=i>=a?i-a:0;while(--n);n=a,t=n;do i=e.prev[--t],e.prev[t]=i>=a?i-a:0;while(--n);r+=a}if(0===e.strm.avail_in)break;if(n=c(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=n,e.lookahead+e.insert>=ue)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+ue-1])&e.hash_mask,e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<ue)););}while(e.lookahead<he&&0!==e.strm.avail_in)}function d(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(f(e),0===e.lookahead&&t===L)return be;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var i=e.block_start+n;if((0===e.strstart||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,s(e,!1),0===e.strm.avail_out))return be;if(e.strstart-e.block_start>=e.w_size-he&&(s(e,!1),0===e.strm.avail_out))return be}return e.insert=0,t===B?(s(e,!0),0===e.strm.avail_out?xe:ke):e.strstart>e.block_start&&(s(e,!1),0===e.strm.avail_out)?be:be}function p(e,t){for(var n,i;;){if(e.lookahead<he){if(f(e),e.lookahead<he&&t===L)return be;if(0===e.lookahead)break}if(n=0,e.lookahead>=ue&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ue-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-he&&(e.match_length=h(e,n)),e.match_length>=ue)if(i=O._tr_tally(e,e.strstart-e.match_start,e.match_length-ue),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=ue){e.match_length--;do e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ue-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(0!==--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=O._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(s(e,!1),0===e.strm.avail_out))return be}return e.insert=e.strstart<ue-1?e.strstart:ue-1,t===B?(s(e,!0),0===e.strm.avail_out?xe:ke):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?be:we}function m(e,t){for(var n,i,r;;){if(e.lookahead<he){if(f(e),e.lookahead<he&&t===L)return be;if(0===e.lookahead)break}if(n=0,e.lookahead>=ue&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ue-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=ue-1,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-he&&(e.match_length=h(e,n),e.match_length<=5&&(e.strategy===Z||e.match_length===ue&&e.strstart-e.match_start>4096)&&(e.match_length=ue-1)),e.prev_length>=ue&&e.match_length<=e.prev_length){r=e.strstart+e.lookahead-ue,i=O._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-ue),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=r&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ue-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(0!==--e.prev_length);if(e.match_available=0,e.match_length=ue-1,e.strstart++,i&&(s(e,!1),0===e.strm.avail_out))return be}else if(e.match_available){if(i=O._tr_tally(e,0,e.window[e.strstart-1]),i&&s(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return be}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=O._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<ue-1?e.strstart:ue-1,t===B?(s(e,!0),0===e.strm.avail_out?xe:ke):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?be:we}function _(e,t){for(var n,i,r,o,a=e.window;;){if(e.lookahead<=ce){if(f(e),e.lookahead<=ce&&t===L)return be;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=ue&&e.strstart>0&&(r=e.strstart-1,i=a[r],i===a[++r]&&i===a[++r]&&i===a[++r])){o=e.strstart+ce;do;while(i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&r<o);e.match_length=ce-(o-r),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=ue?(n=O._tr_tally(e,1,e.match_length-ue),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=O._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(s(e,!1),0===e.strm.avail_out))return be}return e.insert=0,t===B?(s(e,!0),0===e.strm.avail_out?xe:ke):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?be:we}function g(e,t){for(var n;;){if(0===e.lookahead&&(f(e),0===e.lookahead)){if(t===L)return be;break}if(e.match_length=0,n=O._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(s(e,!1),0===e.strm.avail_out))return be}return e.insert=0,t===B?(s(e,!0),0===e.strm.avail_out?xe:ke):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?be:we}function y(e,t,n,i,r){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=r}function v(e){e.window_size=2*e.w_size,o(e.head),e.max_lazy_match=A[e.level].max_lazy,e.good_match=A[e.level].good_length,e.nice_match=A[e.level].nice_length,e.max_chain_length=A[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=ue-1,e.match_available=0,e.ins_h=0}function b(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Q,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new D.Buf16(2*se),this.dyn_dtree=new D.Buf16(2*(2*oe+1)),this.bl_tree=new D.Buf16(2*(2*ae+1)),o(this.dyn_ltree),o(this.dyn_dtree),o(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new D.Buf16(le+1),this.heap=new D.Buf16(2*re+1),o(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new D.Buf16(2*re+1),o(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function w(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=K,t=e.state,t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?de:ye,e.adler=2===t.wrap?0:1,t.last_flush=L,O._tr_init(t),N):i(e,V)}function x(e){var t=w(e);return t===N&&v(e.state),t}function k(e,t){return e&&e.state?2!==e.state.wrap?V:(e.state.gzhead=t,N):V}function E(e,t,n,r,o,a){if(!e)return V;var s=1;if(t===G&&(t=6),r<0?(s=0,r=-r):r>15&&(s=2,r-=16),o<1||o>$||n!==Q||r<8||r>15||t<0||t>9||a<0||a>X)return i(e,V);8===r&&(r=9);var l=new b;return e.state=l,l.strm=e,l.wrap=s,l.gzhead=null,l.w_bits=r,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=o+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+ue-1)/ue),l.window=new D.Buf8(2*l.w_size),l.head=new D.Buf16(l.hash_size),l.prev=new D.Buf16(l.w_size),l.lit_bufsize=1<<o+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new D.Buf8(l.pending_buf_size),l.d_buf=l.lit_bufsize>>1,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=a,l.method=n,x(e)}function S(e,t){return E(e,t,Q,ee,te,J)}function I(e,t){var n,s,c,h;if(!e||!e.state||t>U||t<0)return e?i(e,V):V;if(s=e.state,!e.output||!e.input&&0!==e.avail_in||s.status===ve&&t!==B)return i(e,0===e.avail_out?q:V);if(s.strm=e,n=s.last_flush,s.last_flush=t,s.status===de)if(2===s.wrap)e.adler=0,l(s,31),l(s,139),l(s,8),s.gzhead?(l(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),l(s,255&s.gzhead.time),l(s,s.gzhead.time>>8&255),l(s,s.gzhead.time>>16&255),l(s,s.gzhead.time>>24&255),l(s,9===s.level?2:s.strategy>=Y||s.level<2?4:0),l(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(l(s,255&s.gzhead.extra.length),l(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(e.adler=C(e.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=pe):(l(s,0),l(s,0),l(s,0),l(s,0),l(s,0),l(s,9===s.level?2:s.strategy>=Y||s.level<2?4:0),l(s,Ee),s.status=ye);else{var f=Q+(s.w_bits-8<<4)<<8,d=-1;d=s.strategy>=Y||s.level<2?0:s.level<6?1:6===s.level?2:3,f|=d<<6,0!==s.strstart&&(f|=fe),f+=31-f%31,s.status=ye,u(s,f),0!==s.strstart&&(u(s,e.adler>>>16),u(s,65535&e.adler)),e.adler=1}if(s.status===pe)if(s.gzhead.extra){for(c=s.pending;s.gzindex<(65535&s.gzhead.extra.length)&&(s.pending!==s.pending_buf_size||(s.gzhead.hcrc&&s.pending>c&&(e.adler=C(e.adler,s.pending_buf,s.pending-c,c)),a(e),c=s.pending,s.pending!==s.pending_buf_size));)l(s,255&s.gzhead.extra[s.gzindex]),s.gzindex++;s.gzhead.hcrc&&s.pending>c&&(e.adler=C(e.adler,s.pending_buf,s.pending-c,c)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=me)}else s.status=me;if(s.status===me)if(s.gzhead.name){c=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>c&&(e.adler=C(e.adler,s.pending_buf,s.pending-c,c)),a(e),c=s.pending,s.pending===s.pending_buf_size)){h=1;break}h=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,l(s,h)}while(0!==h);s.gzhead.hcrc&&s.pending>c&&(e.adler=C(e.adler,s.pending_buf,s.pending-c,c)),0===h&&(s.gzindex=0,s.status=_e)}else s.status=_e;if(s.status===_e)if(s.gzhead.comment){c=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>c&&(e.adler=C(e.adler,s.pending_buf,s.pending-c,c)),a(e),c=s.pending,s.pending===s.pending_buf_size)){h=1;break}h=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,l(s,h)}while(0!==h);s.gzhead.hcrc&&s.pending>c&&(e.adler=C(e.adler,s.pending_buf,s.pending-c,c)),0===h&&(s.status=ge)}else s.status=ge;if(s.status===ge&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&a(e),s.pending+2<=s.pending_buf_size&&(l(s,255&e.adler),l(s,e.adler>>8&255),e.adler=0,s.status=ye)):s.status=ye),0!==s.pending){if(a(e),0===e.avail_out)return s.last_flush=-1,N}else if(0===e.avail_in&&r(t)<=r(n)&&t!==B)return i(e,q);if(s.status===ve&&0!==e.avail_in)return i(e,q);if(0!==e.avail_in||0!==s.lookahead||t!==L&&s.status!==ve){var p=s.strategy===Y?g(s,t):s.strategy===W?_(s,t):A[s.level].func(s,t);if(p!==xe&&p!==ke||(s.status=ve),p===be||p===xe)return 0===e.avail_out&&(s.last_flush=-1),N;if(p===we&&(t===F?O._tr_align(s):t!==U&&(O._tr_stored_block(s,0,0,!1),t===z&&(o(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),a(e),0===e.avail_out))return s.last_flush=-1,N}return t!==B?N:s.wrap<=0?j:(2===s.wrap?(l(s,255&e.adler),l(s,e.adler>>8&255),l(s,e.adler>>16&255),l(s,e.adler>>24&255),l(s,255&e.total_in),l(s,e.total_in>>8&255),l(s,e.total_in>>16&255),l(s,e.total_in>>24&255)):(u(s,e.adler>>>16),u(s,65535&e.adler)),a(e),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?N:j)}function T(e){var t;return e&&e.state?(t=e.state.status,t!==de&&t!==pe&&t!==me&&t!==_e&&t!==ge&&t!==ye&&t!==ve?i(e,V):(e.state=null,t===ye?i(e,H):N)):V}function P(e,t){var n,i,r,a,s,l,u,c,h=t.length;if(!e||!e.state)return V;if(n=e.state,a=n.wrap,2===a||1===a&&n.status!==de||n.lookahead)return V;for(1===a&&(e.adler=M(e.adler,t,h,0)),n.wrap=0,h>=n.w_size&&(0===a&&(o(n.head),n.strstart=0,n.block_start=0,n.insert=0),c=new D.Buf8(n.w_size),D.arraySet(c,t,h-n.w_size,n.w_size,0),t=c,h=n.w_size),s=e.avail_in,l=e.next_in,u=e.input,e.avail_in=h,e.next_in=0,e.input=t,f(n);n.lookahead>=ue;){i=n.strstart,r=n.lookahead-(ue-1);do n.ins_h=(n.ins_h<<n.hash_shift^n.window[i+ue-1])&n.hash_mask,n.prev[i&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=i,i++;while(--r);n.strstart=i,n.lookahead=ue-1,f(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=ue-1,n.match_available=0,e.next_in=l,e.input=u,e.avail_in=s,n.wrap=a,N}var A,D=e("../utils/common"),O=e("./trees"),M=e("./adler32"),C=e("./crc32"),R=e("./messages"),L=0,F=1,z=3,B=4,U=5,N=0,j=1,V=-2,H=-3,q=-5,G=-1,Z=1,Y=2,W=3,X=4,J=0,K=2,Q=8,$=9,ee=15,te=8,ne=29,ie=256,re=ie+1+ne,oe=30,ae=19,se=2*re+1,le=15,ue=3,ce=258,he=ce+ue+1,fe=32,de=42,pe=69,me=73,_e=91,ge=103,ye=113,ve=666,be=1,we=2,xe=3,ke=4,Ee=3;A=[new y(0,0,0,0,d),new y(4,4,8,4,p),new y(4,5,16,8,p),new y(4,6,32,32,p),new y(4,4,16,16,m),new y(8,16,32,32,m),new y(8,16,128,128,m),new y(8,32,128,256,m),new y(32,128,258,1024,m),new y(32,258,258,4096,m)],
n.deflateInit=S,n.deflateInit2=E,n.deflateReset=x,n.deflateResetKeep=w,n.deflateSetHeader=k,n.deflate=I,n.deflateEnd=T,n.deflateSetDictionary=P,n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":54,"./adler32":56,"./crc32":58,"./messages":64,"./trees":65}],60:[function(e,t,n){"use strict";function i(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}t.exports=i},{}],61:[function(e,t,n){arguments[4][10][0].apply(n,arguments)},{dup:10}],62:[function(e,t,n){"use strict";function i(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function r(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new y.Buf16(320),this.work=new y.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function o(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=z,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new y.Buf32(me),t.distcode=t.distdyn=new y.Buf32(_e),t.sane=1,t.back=-1,A):M}function a(e){var t;return e&&e.state?(t=e.state,t.wsize=0,t.whave=0,t.wnext=0,o(e)):M}function s(e,t){var n,i;return e&&e.state?(i=e.state,t<0?(n=0,t=-t):(n=(t>>4)+1,t<48&&(t&=15)),t&&(t<8||t>15)?M:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,a(e))):M}function l(e,t){var n,i;return e?(i=new r,e.state=i,i.window=null,n=s(e,t),n!==A&&(e.state=null),n):M}function u(e){return l(e,ye)}function c(e){if(ve){var t;for(_=new y.Buf32(512),g=new y.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(x(E,e.lens,0,288,_,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;x(S,e.lens,0,32,g,0,e.work,{bits:5}),ve=!1}e.lencode=_,e.lenbits=9,e.distcode=g,e.distbits=5}function h(e,t,n,i){var r,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new y.Buf8(o.wsize)),i>=o.wsize?(y.arraySet(o.window,t,n-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):(r=o.wsize-o.wnext,r>i&&(r=i),y.arraySet(o.window,t,n-i,r,o.wnext),i-=r,i?(y.arraySet(o.window,t,n-i,i,0),o.wnext=i,o.whave=o.wsize):(o.wnext+=r,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=r))),0}function f(e,t){var n,r,o,a,s,l,u,f,d,p,m,_,g,me,_e,ge,ye,ve,be,we,xe,ke,Ee,Se,Ie=0,Te=new y.Buf8(4),Pe=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return M;n=e.state,n.mode===W&&(n.mode=X),s=e.next_out,o=e.output,u=e.avail_out,a=e.next_in,r=e.input,l=e.avail_in,f=n.hold,d=n.bits,p=l,m=u,ke=A;e:for(;;)switch(n.mode){case z:if(0===n.wrap){n.mode=X;break}for(;d<16;){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}if(2&n.wrap&&35615===f){n.check=0,Te[0]=255&f,Te[1]=f>>>8&255,n.check=b(n.check,Te,2,0),f=0,d=0,n.mode=B;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&f)<<8)+(f>>8))%31){e.msg="incorrect header check",n.mode=fe;break}if((15&f)!==F){e.msg="unknown compression method",n.mode=fe;break}if(f>>>=4,d-=4,xe=(15&f)+8,0===n.wbits)n.wbits=xe;else if(xe>n.wbits){e.msg="invalid window size",n.mode=fe;break}n.dmax=1<<xe,e.adler=n.check=1,n.mode=512&f?Z:W,f=0,d=0;break;case B:for(;d<16;){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}if(n.flags=f,(255&n.flags)!==F){e.msg="unknown compression method",n.mode=fe;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=fe;break}n.head&&(n.head.text=f>>8&1),512&n.flags&&(Te[0]=255&f,Te[1]=f>>>8&255,n.check=b(n.check,Te,2,0)),f=0,d=0,n.mode=U;case U:for(;d<32;){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}n.head&&(n.head.time=f),512&n.flags&&(Te[0]=255&f,Te[1]=f>>>8&255,Te[2]=f>>>16&255,Te[3]=f>>>24&255,n.check=b(n.check,Te,4,0)),f=0,d=0,n.mode=N;case N:for(;d<16;){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}n.head&&(n.head.xflags=255&f,n.head.os=f>>8),512&n.flags&&(Te[0]=255&f,Te[1]=f>>>8&255,n.check=b(n.check,Te,2,0)),f=0,d=0,n.mode=j;case j:if(1024&n.flags){for(;d<16;){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}n.length=f,n.head&&(n.head.extra_len=f),512&n.flags&&(Te[0]=255&f,Te[1]=f>>>8&255,n.check=b(n.check,Te,2,0)),f=0,d=0}else n.head&&(n.head.extra=null);n.mode=V;case V:if(1024&n.flags&&(_=n.length,_>l&&(_=l),_&&(n.head&&(xe=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),y.arraySet(n.head.extra,r,a,_,xe)),512&n.flags&&(n.check=b(n.check,r,_,a)),l-=_,a+=_,n.length-=_),n.length))break e;n.length=0,n.mode=H;case H:if(2048&n.flags){if(0===l)break e;_=0;do xe=r[a+_++],n.head&&xe&&n.length<65536&&(n.head.name+=String.fromCharCode(xe));while(xe&&_<l);if(512&n.flags&&(n.check=b(n.check,r,_,a)),l-=_,a+=_,xe)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=q;case q:if(4096&n.flags){if(0===l)break e;_=0;do xe=r[a+_++],n.head&&xe&&n.length<65536&&(n.head.comment+=String.fromCharCode(xe));while(xe&&_<l);if(512&n.flags&&(n.check=b(n.check,r,_,a)),l-=_,a+=_,xe)break e}else n.head&&(n.head.comment=null);n.mode=G;case G:if(512&n.flags){for(;d<16;){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}if(f!==(65535&n.check)){e.msg="header crc mismatch",n.mode=fe;break}f=0,d=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=W;break;case Z:for(;d<32;){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}e.adler=n.check=i(f),f=0,d=0,n.mode=Y;case Y:if(0===n.havedict)return e.next_out=s,e.avail_out=u,e.next_in=a,e.avail_in=l,n.hold=f,n.bits=d,O;e.adler=n.check=1,n.mode=W;case W:if(t===T||t===P)break e;case X:if(n.last){f>>>=7&d,d-=7&d,n.mode=ue;break}for(;d<3;){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}switch(n.last=1&f,f>>>=1,d-=1,3&f){case 0:n.mode=J;break;case 1:if(c(n),n.mode=ne,t===P){f>>>=2,d-=2;break e}break;case 2:n.mode=$;break;case 3:e.msg="invalid block type",n.mode=fe}f>>>=2,d-=2;break;case J:for(f>>>=7&d,d-=7&d;d<32;){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}if((65535&f)!==(f>>>16^65535)){e.msg="invalid stored block lengths",n.mode=fe;break}if(n.length=65535&f,f=0,d=0,n.mode=K,t===P)break e;case K:n.mode=Q;case Q:if(_=n.length){if(_>l&&(_=l),_>u&&(_=u),0===_)break e;y.arraySet(o,r,a,_,s),l-=_,a+=_,u-=_,s+=_,n.length-=_;break}n.mode=W;break;case $:for(;d<14;){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}if(n.nlen=(31&f)+257,f>>>=5,d-=5,n.ndist=(31&f)+1,f>>>=5,d-=5,n.ncode=(15&f)+4,f>>>=4,d-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=fe;break}n.have=0,n.mode=ee;case ee:for(;n.have<n.ncode;){for(;d<3;){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}n.lens[Pe[n.have++]]=7&f,f>>>=3,d-=3}for(;n.have<19;)n.lens[Pe[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,Ee={bits:n.lenbits},ke=x(k,n.lens,0,19,n.lencode,0,n.work,Ee),n.lenbits=Ee.bits,ke){e.msg="invalid code lengths set",n.mode=fe;break}n.have=0,n.mode=te;case te:for(;n.have<n.nlen+n.ndist;){for(;Ie=n.lencode[f&(1<<n.lenbits)-1],_e=Ie>>>24,ge=Ie>>>16&255,ye=65535&Ie,!(_e<=d);){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}if(ye<16)f>>>=_e,d-=_e,n.lens[n.have++]=ye;else{if(16===ye){for(Se=_e+2;d<Se;){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}if(f>>>=_e,d-=_e,0===n.have){e.msg="invalid bit length repeat",n.mode=fe;break}xe=n.lens[n.have-1],_=3+(3&f),f>>>=2,d-=2}else if(17===ye){for(Se=_e+3;d<Se;){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}f>>>=_e,d-=_e,xe=0,_=3+(7&f),f>>>=3,d-=3}else{for(Se=_e+7;d<Se;){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}f>>>=_e,d-=_e,xe=0,_=11+(127&f),f>>>=7,d-=7}if(n.have+_>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=fe;break}for(;_--;)n.lens[n.have++]=xe}}if(n.mode===fe)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=fe;break}if(n.lenbits=9,Ee={bits:n.lenbits},ke=x(E,n.lens,0,n.nlen,n.lencode,0,n.work,Ee),n.lenbits=Ee.bits,ke){e.msg="invalid literal/lengths set",n.mode=fe;break}if(n.distbits=6,n.distcode=n.distdyn,Ee={bits:n.distbits},ke=x(S,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,Ee),n.distbits=Ee.bits,ke){e.msg="invalid distances set",n.mode=fe;break}if(n.mode=ne,t===P)break e;case ne:n.mode=ie;case ie:if(l>=6&&u>=258){e.next_out=s,e.avail_out=u,e.next_in=a,e.avail_in=l,n.hold=f,n.bits=d,w(e,m),s=e.next_out,o=e.output,u=e.avail_out,a=e.next_in,r=e.input,l=e.avail_in,f=n.hold,d=n.bits,n.mode===W&&(n.back=-1);break}for(n.back=0;Ie=n.lencode[f&(1<<n.lenbits)-1],_e=Ie>>>24,ge=Ie>>>16&255,ye=65535&Ie,!(_e<=d);){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}if(ge&&0===(240&ge)){for(ve=_e,be=ge,we=ye;Ie=n.lencode[we+((f&(1<<ve+be)-1)>>ve)],_e=Ie>>>24,ge=Ie>>>16&255,ye=65535&Ie,!(ve+_e<=d);){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}f>>>=ve,d-=ve,n.back+=ve}if(f>>>=_e,d-=_e,n.back+=_e,n.length=ye,0===ge){n.mode=le;break}if(32&ge){n.back=-1,n.mode=W;break}if(64&ge){e.msg="invalid literal/length code",n.mode=fe;break}n.extra=15&ge,n.mode=re;case re:if(n.extra){for(Se=n.extra;d<Se;){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}n.length+=f&(1<<n.extra)-1,f>>>=n.extra,d-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=oe;case oe:for(;Ie=n.distcode[f&(1<<n.distbits)-1],_e=Ie>>>24,ge=Ie>>>16&255,ye=65535&Ie,!(_e<=d);){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}if(0===(240&ge)){for(ve=_e,be=ge,we=ye;Ie=n.distcode[we+((f&(1<<ve+be)-1)>>ve)],_e=Ie>>>24,ge=Ie>>>16&255,ye=65535&Ie,!(ve+_e<=d);){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}f>>>=ve,d-=ve,n.back+=ve}if(f>>>=_e,d-=_e,n.back+=_e,64&ge){e.msg="invalid distance code",n.mode=fe;break}n.offset=ye,n.extra=15&ge,n.mode=ae;case ae:if(n.extra){for(Se=n.extra;d<Se;){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}n.offset+=f&(1<<n.extra)-1,f>>>=n.extra,d-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=fe;break}n.mode=se;case se:if(0===u)break e;if(_=m-u,n.offset>_){if(_=n.offset-_,_>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=fe;break}_>n.wnext?(_-=n.wnext,g=n.wsize-_):g=n.wnext-_,_>n.length&&(_=n.length),me=n.window}else me=o,g=s-n.offset,_=n.length;_>u&&(_=u),u-=_,n.length-=_;do o[s++]=me[g++];while(--_);0===n.length&&(n.mode=ie);break;case le:if(0===u)break e;o[s++]=n.length,u--,n.mode=ie;break;case ue:if(n.wrap){for(;d<32;){if(0===l)break e;l--,f|=r[a++]<<d,d+=8}if(m-=u,e.total_out+=m,n.total+=m,m&&(e.adler=n.check=n.flags?b(n.check,o,m,s-m):v(n.check,o,m,s-m)),m=u,(n.flags?f:i(f))!==n.check){e.msg="incorrect data check",n.mode=fe;break}f=0,d=0}n.mode=ce;case ce:if(n.wrap&&n.flags){for(;d<32;){if(0===l)break e;l--,f+=r[a++]<<d,d+=8}if(f!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=fe;break}f=0,d=0}n.mode=he;case he:ke=D;break e;case fe:ke=C;break e;case de:return R;case pe:default:return M}return e.next_out=s,e.avail_out=u,e.next_in=a,e.avail_in=l,n.hold=f,n.bits=d,(n.wsize||m!==e.avail_out&&n.mode<fe&&(n.mode<ue||t!==I))&&h(e,e.output,e.next_out,m-e.avail_out)?(n.mode=de,R):(p-=e.avail_in,m-=e.avail_out,e.total_in+=p,e.total_out+=m,n.total+=m,n.wrap&&m&&(e.adler=n.check=n.flags?b(n.check,o,m,e.next_out-m):v(n.check,o,m,e.next_out-m)),e.data_type=n.bits+(n.last?64:0)+(n.mode===W?128:0)+(n.mode===ne||n.mode===K?256:0),(0===p&&0===m||t===I)&&ke===A&&(ke=L),ke)}function d(e){if(!e||!e.state)return M;var t=e.state;return t.window&&(t.window=null),e.state=null,A}function p(e,t){var n;return e&&e.state?(n=e.state,0===(2&n.wrap)?M:(n.head=t,t.done=!1,A)):M}function m(e,t){var n,i,r,o=t.length;return e&&e.state?(n=e.state,0!==n.wrap&&n.mode!==Y?M:n.mode===Y&&(i=1,i=v(i,t,o,0),i!==n.check)?C:(r=h(e,t,o,o))?(n.mode=de,R):(n.havedict=1,A)):M}var _,g,y=e("../utils/common"),v=e("./adler32"),b=e("./crc32"),w=e("./inffast"),x=e("./inftrees"),k=0,E=1,S=2,I=4,T=5,P=6,A=0,D=1,O=2,M=-2,C=-3,R=-4,L=-5,F=8,z=1,B=2,U=3,N=4,j=5,V=6,H=7,q=8,G=9,Z=10,Y=11,W=12,X=13,J=14,K=15,Q=16,$=17,ee=18,te=19,ne=20,ie=21,re=22,oe=23,ae=24,se=25,le=26,ue=27,ce=28,he=29,fe=30,de=31,pe=32,me=852,_e=592,ge=15,ye=ge,ve=!0;n.inflateReset=a,n.inflateReset2=s,n.inflateResetKeep=o,n.inflateInit=u,n.inflateInit2=l,n.inflate=f,n.inflateEnd=d,n.inflateGetHeader=p,n.inflateSetDictionary=m,n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":54,"./adler32":56,"./crc32":58,"./inffast":61,"./inftrees":63}],63:[function(e,t,n){"use strict";var i=e("../utils/common"),r=15,o=852,a=592,s=0,l=1,u=2,c=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],h=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],f=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],d=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,n,p,m,_,g,y){var v,b,w,x,k,E,S,I,T,P=y.bits,A=0,D=0,O=0,M=0,C=0,R=0,L=0,F=0,z=0,B=0,U=null,N=0,j=new i.Buf16(r+1),V=new i.Buf16(r+1),H=null,q=0;for(A=0;A<=r;A++)j[A]=0;for(D=0;D<p;D++)j[t[n+D]]++;for(C=P,M=r;M>=1&&0===j[M];M--);if(C>M&&(C=M),0===M)return m[_++]=20971520,m[_++]=20971520,y.bits=1,0;for(O=1;O<M&&0===j[O];O++);for(C<O&&(C=O),F=1,A=1;A<=r;A++)if(F<<=1,F-=j[A],F<0)return-1;if(F>0&&(e===s||1!==M))return-1;for(V[1]=0,A=1;A<r;A++)V[A+1]=V[A]+j[A];for(D=0;D<p;D++)0!==t[n+D]&&(g[V[t[n+D]]++]=D);if(e===s?(U=H=g,E=19):e===l?(U=c,N-=257,H=h,q-=257,E=256):(U=f,H=d,E=-1),B=0,D=0,A=O,k=_,R=C,L=0,w=-1,z=1<<C,x=z-1,e===l&&z>o||e===u&&z>a)return 1;for(var G=0;;){G++,S=A-L,g[D]<E?(I=0,T=g[D]):g[D]>E?(I=H[q+g[D]],T=U[N+g[D]]):(I=96,T=0),v=1<<A-L,b=1<<R,O=b;do b-=v,m[k+(B>>L)+b]=S<<24|I<<16|T|0;while(0!==b);for(v=1<<A-1;B&v;)v>>=1;if(0!==v?(B&=v-1,B+=v):B=0,D++,0===--j[A]){if(A===M)break;A=t[n+g[D]]}if(A>C&&(B&x)!==w){for(0===L&&(L=C),k+=O,R=A-L,F=1<<R;R+L<M&&(F-=j[R+L],!(F<=0));)R++,F<<=1;if(z+=1<<R,e===l&&z>o||e===u&&z>a)return 1;w=B&x,m[w]=C<<24|R<<16|k-_|0}}return 0!==B&&(m[k+B]=A-L<<24|64<<16|0),y.bits=C,0}},{"../utils/common":54}],64:[function(e,t,n){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],65:[function(e,t,n){"use strict";function i(e){for(var t=e.length;--t>=0;)e[t]=0}function r(e,t,n,i,r){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=r,this.has_stree=e&&e.length}function o(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function a(e){return e<256?le[e]:le[256+(e>>>7)]}function s(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function l(e,t,n){e.bi_valid>X-n?(e.bi_buf|=t<<e.bi_valid&65535,s(e,e.bi_buf),e.bi_buf=t>>X-e.bi_valid,e.bi_valid+=n-X):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function u(e,t,n){l(e,n[2*t],n[2*t+1])}function c(e,t){var n=0;do n|=1&e,e>>>=1,n<<=1;while(--t>0);return n>>>1}function h(e){16===e.bi_valid?(s(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}function f(e,t){var n,i,r,o,a,s,l=t.dyn_tree,u=t.max_code,c=t.stat_desc.static_tree,h=t.stat_desc.has_stree,f=t.stat_desc.extra_bits,d=t.stat_desc.extra_base,p=t.stat_desc.max_length,m=0;for(o=0;o<=W;o++)e.bl_count[o]=0;for(l[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<Y;n++)i=e.heap[n],o=l[2*l[2*i+1]+1]+1,o>p&&(o=p,m++),l[2*i+1]=o,i>u||(e.bl_count[o]++,a=0,i>=d&&(a=f[i-d]),s=l[2*i],e.opt_len+=s*(o+a),h&&(e.static_len+=s*(c[2*i+1]+a)));if(0!==m){do{for(o=p-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[p]--,m-=2}while(m>0);for(o=p;0!==o;o--)for(i=e.bl_count[o];0!==i;)r=e.heap[--n],r>u||(l[2*r+1]!==o&&(e.opt_len+=(o-l[2*r+1])*l[2*r],l[2*r+1]=o),i--)}}function d(e,t,n){var i,r,o=new Array(W+1),a=0;for(i=1;i<=W;i++)o[i]=a=a+n[i-1]<<1;for(r=0;r<=t;r++){var s=e[2*r+1];0!==s&&(e[2*r]=c(o[s]++,s))}}function p(){var e,t,n,i,o,a=new Array(W+1);for(n=0,i=0;i<V-1;i++)for(ce[i]=n,e=0;e<1<<te[i];e++)ue[n++]=i;for(ue[n-1]=i,o=0,i=0;i<16;i++)for(he[i]=o,e=0;e<1<<ne[i];e++)le[o++]=i;for(o>>=7;i<G;i++)for(he[i]=o<<7,e=0;e<1<<ne[i]-7;e++)le[256+o++]=i;for(t=0;t<=W;t++)a[t]=0;for(e=0;e<=143;)ae[2*e+1]=8,e++,a[8]++;for(;e<=255;)ae[2*e+1]=9,e++,a[9]++;for(;e<=279;)ae[2*e+1]=7,e++,a[7]++;for(;e<=287;)ae[2*e+1]=8,e++,a[8]++;for(d(ae,q+1,a),e=0;e<G;e++)se[2*e+1]=5,se[2*e]=c(e,5);fe=new r(ae,te,H+1,q,W),de=new r(se,ne,0,G,W),pe=new r(new Array(0),ie,0,Z,J)}function m(e){var t;for(t=0;t<q;t++)e.dyn_ltree[2*t]=0;for(t=0;t<G;t++)e.dyn_dtree[2*t]=0;for(t=0;t<Z;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*K]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function _(e){e.bi_valid>8?s(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function g(e,t,n,i){_(e),i&&(s(e,n),s(e,~n)),M.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}function y(e,t,n,i){var r=2*t,o=2*n;return e[r]<e[o]||e[r]===e[o]&&i[t]<=i[n]}function v(e,t,n){for(var i=e.heap[n],r=n<<1;r<=e.heap_len&&(r<e.heap_len&&y(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!y(t,i,e.heap[r],e.depth));)e.heap[n]=e.heap[r],n=r,r<<=1;e.heap[n]=i}function b(e,t,n){var i,r,o,s,c=0;if(0!==e.last_lit)do i=e.pending_buf[e.d_buf+2*c]<<8|e.pending_buf[e.d_buf+2*c+1],r=e.pending_buf[e.l_buf+c],c++,0===i?u(e,r,t):(o=ue[r],u(e,o+H+1,t),s=te[o],0!==s&&(r-=ce[o],l(e,r,s)),i--,o=a(i),u(e,o,n),s=ne[o],0!==s&&(i-=he[o],l(e,i,s)));while(c<e.last_lit);u(e,K,t)}function w(e,t){var n,i,r,o=t.dyn_tree,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,l=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=Y,n=0;n<l;n++)0!==o[2*n]?(e.heap[++e.heap_len]=u=n,e.depth[n]=0):o[2*n+1]=0;for(;e.heap_len<2;)r=e.heap[++e.heap_len]=u<2?++u:0,o[2*r]=1,e.depth[r]=0,e.opt_len--,s&&(e.static_len-=a[2*r+1]);for(t.max_code=u,n=e.heap_len>>1;n>=1;n--)v(e,o,n);r=l;do n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],v(e,o,1),i=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=i,o[2*r]=o[2*n]+o[2*i],e.depth[r]=(e.depth[n]>=e.depth[i]?e.depth[n]:e.depth[i])+1,o[2*n+1]=o[2*i+1]=r,e.heap[1]=r++,v(e,o,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],f(e,t),d(o,u,e.bl_count)}function x(e,t,n){var i,r,o=-1,a=t[1],s=0,l=7,u=4;for(0===a&&(l=138,u=3),t[2*(n+1)+1]=65535,i=0;i<=n;i++)r=a,a=t[2*(i+1)+1],++s<l&&r===a||(s<u?e.bl_tree[2*r]+=s:0!==r?(r!==o&&e.bl_tree[2*r]++,e.bl_tree[2*Q]++):s<=10?e.bl_tree[2*$]++:e.bl_tree[2*ee]++,s=0,o=r,0===a?(l=138,u=3):r===a?(l=6,u=3):(l=7,u=4))}function k(e,t,n){var i,r,o=-1,a=t[1],s=0,c=7,h=4;for(0===a&&(c=138,h=3),i=0;i<=n;i++)if(r=a,a=t[2*(i+1)+1],!(++s<c&&r===a)){if(s<h){do u(e,r,e.bl_tree);while(0!==--s)}else 0!==r?(r!==o&&(u(e,r,e.bl_tree),s--),u(e,Q,e.bl_tree),l(e,s-3,2)):s<=10?(u(e,$,e.bl_tree),l(e,s-3,3)):(u(e,ee,e.bl_tree),l(e,s-11,7));s=0,o=r,0===a?(c=138,h=3):r===a?(c=6,h=3):(c=7,h=4)}}function E(e){var t;for(x(e,e.dyn_ltree,e.l_desc.max_code),x(e,e.dyn_dtree,e.d_desc.max_code),w(e,e.bl_desc),t=Z-1;t>=3&&0===e.bl_tree[2*re[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}function S(e,t,n,i){var r;for(l(e,t-257,5),l(e,n-1,5),l(e,i-4,4),r=0;r<i;r++)l(e,e.bl_tree[2*re[r]+1],3);k(e,e.dyn_ltree,t-1),k(e,e.dyn_dtree,n-1)}function I(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return R;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return L;for(t=32;t<H;t++)if(0!==e.dyn_ltree[2*t])return L;return R}function T(e){me||(p(),me=!0),e.l_desc=new o(e.dyn_ltree,fe),e.d_desc=new o(e.dyn_dtree,de),e.bl_desc=new o(e.bl_tree,pe),e.bi_buf=0,e.bi_valid=0,m(e)}function P(e,t,n,i){l(e,(z<<1)+(i?1:0),3),g(e,t,n,!0)}function A(e){l(e,B<<1,3),u(e,K,ae),h(e)}function D(e,t,n,i){var r,o,a=0;e.level>0?(e.strm.data_type===F&&(e.strm.data_type=I(e)),w(e,e.l_desc),w(e,e.d_desc),a=E(e),r=e.opt_len+3+7>>>3,o=e.static_len+3+7>>>3,o<=r&&(r=o)):r=o=n+5,n+4<=r&&t!==-1?P(e,t,n,i):e.strategy===C||o===r?(l(e,(B<<1)+(i?1:0),3),b(e,ae,se)):(l(e,(U<<1)+(i?1:0),3),S(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),b(e,e.dyn_ltree,e.dyn_dtree)),m(e),i&&_(e)}function O(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(ue[n]+H+1)]++,e.dyn_dtree[2*a(t)]++),e.last_lit===e.lit_bufsize-1}var M=e("../utils/common"),C=4,R=0,L=1,F=2,z=0,B=1,U=2,N=3,j=258,V=29,H=256,q=H+1+V,G=30,Z=19,Y=2*q+1,W=15,X=16,J=7,K=256,Q=16,$=17,ee=18,te=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],ne=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],ie=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],re=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],oe=512,ae=new Array(2*(q+2));i(ae);var se=new Array(2*G);i(se);var le=new Array(oe);i(le);var ue=new Array(j-N+1);i(ue);var ce=new Array(V);i(ce);var he=new Array(G);i(he);var fe,de,pe,me=!1;n._tr_init=T,n._tr_stored_block=P,n._tr_flush_block=D,n._tr_tally=O,n._tr_align=A},{"../utils/common":54}],66:[function(e,t,n){arguments[4][15][0].apply(n,arguments)},{dup:15}],67:[function(e,t,n){(function(e){"use strict";function n(t,n,i,r){if("function"!=typeof t)throw new TypeError('"callback" argument must be a function');var o,a,s=arguments.length;switch(s){case 0:case 1:return e.nextTick(t);case 2:return e.nextTick(function(){t.call(null,n)});case 3:return e.nextTick(function(){t.call(null,n,i)});case 4:return e.nextTick(function(){t.call(null,n,i,r)});default:for(o=new Array(s-1),a=0;a<o.length;)o[a++]=arguments[a];return e.nextTick(function(){t.apply(null,o)})}}!e.version||0===e.version.indexOf("v0.")||0===e.version.indexOf("v1.")&&0!==e.version.indexOf("v1.8.")?t.exports=n:t.exports=e.nextTick}).call(this,e("_process"))},{_process:68}],68:[function(e,t,n){function i(){f&&c&&(f=!1,c.length?h=c.concat(h):d=-1,h.length&&r())}function r(){if(!f){var e=s(i);f=!0;for(var t=h.length;t;){for(c=h,h=[];++d<t;)c&&c[d].run();d=-1,t=h.length}c=null,f=!1,l(e)}}function o(e,t){this.fun=e,this.array=t}function a(){}var s,l,u=t.exports={};!function(){try{s=setTimeout}catch(e){s=function(){throw new Error("setTimeout is not defined")}}try{l=clearTimeout}catch(e){l=function(){throw new Error("clearTimeout is not defined")}}}();var c,h=[],f=!1,d=-1;u.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];h.push(new o(e,t)),1!==h.length||f||s(r,0)},o.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={},u.on=a,u.addListener=a,u.once=a,u.off=a,u.removeListener=a,u.removeAllListeners=a,u.emit=a,u.binding=function(e){throw new Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(e){throw new Error("process.chdir is not supported")},u.umask=function(){return 0}},{}],69:[function(e,t,n){"use strict";function i(e){return this instanceof i?(u.call(this,e),c.call(this,e),e&&e.readable===!1&&(this.readable=!1),e&&e.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,e&&e.allowHalfOpen===!1&&(this.allowHalfOpen=!1),void this.once("end",r)):new i(e)}function r(){this.allowHalfOpen||this._writableState.ended||s(o,this)}function o(e){e.end()}var a=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};t.exports=i;var s=e("process-nextick-args"),l=e("core-util-is");l.inherits=e("inherits");var u=e("./_stream_readable"),c=e("./_stream_writable");l.inherits(i,u);for(var h=a(c.prototype),f=0;f<h.length;f++){var d=h[f];i.prototype[d]||(i.prototype[d]=c.prototype[d])}},{"./_stream_readable":70,"./_stream_writable":72,"core-util-is":24,inherits:27,"process-nextick-args":67}],70:[function(e,t,n){(function(n){"use strict";function i(e,t,n){return B?e.prependListener(t,n):void(e._events&&e._events[t]?T(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n))}function r(t,n){z=z||e("./_stream_duplex"),t=t||{},this.objectMode=!!t.objectMode,n instanceof z&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var i=t.highWaterMark,r=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:r,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(F||(F=e("string_decoder/").StringDecoder),this.decoder=new F(t.encoding),this.encoding=t.encoding)}function o(t){return z=z||e("./_stream_duplex"),this instanceof o?(this._readableState=new r(t,this),this.readable=!0,t&&"function"==typeof t.read&&(this._read=t.read),void P.call(this)):new o(t)}function a(e,t,n,i,r){var o=c(t,n);if(o)e.emit("error",o);else if(null===n)t.reading=!1,h(e,t);else if(t.objectMode||n&&n.length>0)if(t.ended&&!r){var a=new Error("stream.push() after EOF");e.emit("error",a)}else if(t.endEmitted&&r){var l=new Error("stream.unshift() after end event");e.emit("error",l)}else{var u;!t.decoder||r||i||(n=t.decoder.write(n),u=!t.objectMode&&0===n.length),r||(t.reading=!1),u||(t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&f(e))),p(e,t)}else r||(t.reading=!1);return s(t)}function s(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}function l(e){return e>=U?e=U:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}function u(e,t){return 0===t.length&&t.ended?0:t.objectMode?0===e?0:1:null===e||isNaN(e)?t.flowing&&t.buffer.length?t.buffer[0].length:t.length:e<=0?0:(e>t.highWaterMark&&(t.highWaterMark=l(e)),e>t.length?t.ended?t.length:(t.needReadable=!0,0):e)}function c(e,t){var n=null;return O.isBuffer(t)||"string"==typeof t||null===t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}function h(e,t){if(!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,f(e)}}function f(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(L("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?I(d,e):d(e))}function d(e){L("emit readable"),e.emit("readable"),b(e)}function p(e,t){t.readingMore||(t.readingMore=!0,I(m,e,t))}function m(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(L("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function _(e){return function(){var t=e._readableState;L("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&D(e,"data")&&(t.flowing=!0,b(e))}}function g(e){L("readable nexttick read 0"),e.read(0)}function y(e,t){t.resumeScheduled||(t.resumeScheduled=!0,I(v,e,t))}function v(e,t){t.reading||(L("resume read 0"),e.read(0)),t.resumeScheduled=!1,e.emit("resume"),b(e),t.flowing&&!t.reading&&e.read(0)}function b(e){var t=e._readableState;if(L("flow",t.flowing),t.flowing)do var n=e.read();while(null!==n&&t.flowing)}function w(e,t){var n,i=t.buffer,r=t.length,o=!!t.decoder,a=!!t.objectMode;if(0===i.length)return null;if(0===r)n=null;else if(a)n=i.shift();else if(!e||e>=r)n=o?i.join(""):1===i.length?i[0]:O.concat(i,r),i.length=0;else if(e<i[0].length){var s=i[0];n=s.slice(0,e),i[0]=s.slice(e)}else if(e===i[0].length)n=i.shift();else{n=o?"":M.allocUnsafe(e);for(var l=0,u=0,c=i.length;u<c&&l<e;u++){var h=i[0],f=Math.min(e-l,h.length);o?n+=h.slice(0,f):h.copy(n,l,0,f),f<h.length?i[0]=h.slice(f):i.shift(),l+=f}}return n}function x(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,I(k,t,e))}function k(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function E(e,t){for(var n=0,i=e.length;n<i;n++)t(e[n],n)}function S(e,t){for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1}t.exports=o;var I=e("process-nextick-args"),T=e("isarray");o.ReadableState=r;var P,A=e("events").EventEmitter,D=function(e,t){return e.listeners(t).length};!function(){try{P=e("stream")}catch(e){}finally{P||(P=e("events").EventEmitter)}}();var O=e("buffer").Buffer,M=e("buffer-shims"),C=e("core-util-is");C.inherits=e("inherits");var R=e("util"),L=void 0;L=R&&R.debuglog?R.debuglog("stream"):function(){};var F;C.inherits(o,P);var z,z,B="function"==typeof A.prototype.prependListener;o.prototype.push=function(e,t){var n=this._readableState;return n.objectMode||"string"!=typeof e||(t=t||n.defaultEncoding,t!==n.encoding&&(e=M.from(e,t),t="")),a(this,n,e,t,!1)},o.prototype.unshift=function(e){var t=this._readableState;return a(this,t,e,"",!0)},o.prototype.isPaused=function(){return this._readableState.flowing===!1},o.prototype.setEncoding=function(t){return F||(F=e("string_decoder/").StringDecoder),this._readableState.decoder=new F(t),this._readableState.encoding=t,this};var U=8388608;o.prototype.read=function(e){L("read",e);var t=this._readableState,n=e;if(("number"!=typeof e||e>0)&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return L("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?x(this):f(this),null;if(e=u(e,t),0===e&&t.ended)return 0===t.length&&x(this),null;var i=t.needReadable;L("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&(i=!0,L("length less than watermark",i)),(t.ended||t.reading)&&(i=!1,L("reading or ended",i)),i&&(L("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1),i&&!t.reading&&(e=u(n,t));var r;return r=e>0?w(e,t):null,null===r&&(t.needReadable=!0,e=0),t.length-=e,0!==t.length||t.ended||(t.needReadable=!0),n!==e&&t.ended&&0===t.length&&x(this),null!==r&&this.emit("data",r),r},o.prototype._read=function(e){this.emit("error",new Error("not implemented"))},o.prototype.pipe=function(e,t){function r(e){L("onunpipe"),e===f&&a()}function o(){L("onend"),e.end()}function a(){L("cleanup"),e.removeListener("close",u),e.removeListener("finish",c),e.removeListener("drain",g),e.removeListener("error",l),e.removeListener("unpipe",r),f.removeListener("end",o),f.removeListener("end",a),f.removeListener("data",s),y=!0,!d.awaitDrain||e._writableState&&!e._writableState.needDrain||g()}function s(t){L("ondata");var n=e.write(t);!1===n&&((1===d.pipesCount&&d.pipes===e||d.pipesCount>1&&S(d.pipes,e)!==-1)&&!y&&(L("false write response, pause",f._readableState.awaitDrain),f._readableState.awaitDrain++),f.pause())}function l(t){L("onerror",t),h(),e.removeListener("error",l),0===D(e,"error")&&e.emit("error",t)}function u(){e.removeListener("finish",c),h()}function c(){L("onfinish"),e.removeListener("close",u),h()}function h(){L("unpipe"),f.unpipe(e)}var f=this,d=this._readableState;switch(d.pipesCount){case 0:d.pipes=e;break;case 1:d.pipes=[d.pipes,e];break;default:d.pipes.push(e)}d.pipesCount+=1,L("pipe count=%d opts=%j",d.pipesCount,t);var p=(!t||t.end!==!1)&&e!==n.stdout&&e!==n.stderr,m=p?o:a;d.endEmitted?I(m):f.once("end",m),e.on("unpipe",r);var g=_(f);e.on("drain",g);var y=!1;return f.on("data",s),i(e,"error",l),e.once("close",u),e.once("finish",c),e.emit("pipe",f),d.flowing||(L("pipe resume"),f.resume()),e},o.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this),this);if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var r=0;r<i;r++)n[r].emit("unpipe",this);return this}var o=S(t.pipes,e);return o===-1?this:(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this),this)},o.prototype.on=function(e,t){var n=P.prototype.on.call(this,e,t);if("data"===e&&!1!==this._readableState.flowing&&this.resume(),"readable"===e&&!this._readableState.endEmitted){var i=this._readableState;i.readableListening||(i.readableListening=!0,i.emittedReadable=!1,
i.needReadable=!0,i.reading?i.length&&f(this,i):I(g,this))}return n},o.prototype.addListener=o.prototype.on,o.prototype.resume=function(){var e=this._readableState;return e.flowing||(L("resume"),e.flowing=!0,y(this,e)),this},o.prototype.pause=function(){return L("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(L("pause"),this._readableState.flowing=!1,this.emit("pause")),this},o.prototype.wrap=function(e){var t=this._readableState,n=!1,i=this;e.on("end",function(){if(L("wrapped end"),t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&i.push(e)}i.push(null)}),e.on("data",function(r){if(L("wrapped data"),t.decoder&&(r=t.decoder.write(r)),(!t.objectMode||null!==r&&void 0!==r)&&(t.objectMode||r&&r.length)){var o=i.push(r);o||(n=!0,e.pause())}});for(var r in e)void 0===this[r]&&"function"==typeof e[r]&&(this[r]=function(t){return function(){return e[t].apply(e,arguments)}}(r));var o=["error","close","destroy","pause","resume"];return E(o,function(t){e.on(t,i.emit.bind(i,t))}),i._read=function(t){L("wrapped _read",t),n&&(n=!1,e.resume())},i},o._fromList=w}).call(this,e("_process"))},{"./_stream_duplex":69,_process:68,buffer:19,"buffer-shims":21,"core-util-is":24,events:20,inherits:27,isarray:29,"process-nextick-args":67,"string_decoder/":74,util:4}],71:[function(e,t,n){"use strict";function i(e){this.afterTransform=function(t,n){return r(e,t,n)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function r(e,t,n){var i=e._transformState;i.transforming=!1;var r=i.writecb;if(!r)return e.emit("error",new Error("no writecb in Transform class"));i.writechunk=null,i.writecb=null,null!==n&&void 0!==n&&e.push(n),r(t);var o=e._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&e._read(o.highWaterMark)}function o(e){if(!(this instanceof o))return new o(e);s.call(this,e),this._transformState=new i(this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.once("prefinish",function(){"function"==typeof this._flush?this._flush(function(e){a(t,e)}):a(t)})}function a(e,t){if(t)return e.emit("error",t);var n=e._writableState,i=e._transformState;if(n.length)throw new Error("Calling transform done when ws.length != 0");if(i.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}t.exports=o;var s=e("./_stream_duplex"),l=e("core-util-is");l.inherits=e("inherits"),l.inherits(o,s),o.prototype.push=function(e,t){return this._transformState.needTransform=!1,s.prototype.push.call(this,e,t)},o.prototype._transform=function(e,t,n){throw new Error("Not implemented")},o.prototype._write=function(e,t,n){var i=this._transformState;if(i.writecb=n,i.writechunk=e,i.writeencoding=t,!i.transforming){var r=this._readableState;(i.needTransform||r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}},o.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0}},{"./_stream_duplex":69,"core-util-is":24,inherits:27}],72:[function(e,t,n){(function(n){"use strict";function i(){}function r(e,t,n){this.chunk=e,this.encoding=t,this.callback=n,this.next=null}function o(t,n){D=D||e("./_stream_duplex"),t=t||{},this.objectMode=!!t.objectMode,n instanceof D&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var i=t.highWaterMark,r=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:r,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var o=t.decodeStrings===!1;this.decodeStrings=!o,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){p(n,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new x(this)}function a(t){return D=D||e("./_stream_duplex"),this instanceof a||this instanceof D?(this._writableState=new o(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev)),void I.call(this)):new a(t)}function s(e,t){var n=new Error("write after end");e.emit("error",n),k(t,n)}function l(e,t,n,i){var r=!0,o=!1;return null===n?o=new TypeError("May not write null values to stream"):P.isBuffer(n)||"string"==typeof n||void 0===n||t.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(e.emit("error",o),k(i,o),r=!1),r}function u(e,t,n){return e.objectMode||e.decodeStrings===!1||"string"!=typeof t||(t=A.from(t,n)),t}function c(e,t,n,i,o){n=u(t,n,i),P.isBuffer(n)&&(i="buffer");var a=t.objectMode?1:n.length;t.length+=a;var s=t.length<t.highWaterMark;if(s||(t.needDrain=!0),t.writing||t.corked){var l=t.lastBufferedRequest;t.lastBufferedRequest=new r(n,i,o),l?l.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else h(e,t,!1,a,n,i,o);return s}function h(e,t,n,i,r,o,a){t.writelen=i,t.writecb=a,t.writing=!0,t.sync=!0,n?e._writev(r,t.onwrite):e._write(r,o,t.onwrite),t.sync=!1}function f(e,t,n,i,r){--t.pendingcb,n?k(r,i):r(i),e._writableState.errorEmitted=!0,e.emit("error",i)}function d(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function p(e,t){var n=e._writableState,i=n.sync,r=n.writecb;if(d(n),t)f(e,n,i,t,r);else{var o=y(n);o||n.corked||n.bufferProcessing||!n.bufferedRequest||g(e,n),i?E(m,e,n,o,r):m(e,n,o,r)}}function m(e,t,n,i){n||_(e,t),t.pendingcb--,i(),b(e,t)}function _(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function g(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var i=t.bufferedRequestCount,r=new Array(i),o=t.corkedRequestsFree;o.entry=n;for(var a=0;n;)r[a]=n,n=n.next,a+=1;h(e,t,!0,t.length,r,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new x(t)}else{for(;n;){var s=n.chunk,l=n.encoding,u=n.callback,c=t.objectMode?1:s.length;if(h(e,t,!1,c,s,l,u),n=n.next,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequestCount=0,t.bufferedRequest=n,t.bufferProcessing=!1}function y(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function v(e,t){t.prefinished||(t.prefinished=!0,e.emit("prefinish"))}function b(e,t){var n=y(t);return n&&(0===t.pendingcb?(v(e,t),t.finished=!0,e.emit("finish")):v(e,t)),n}function w(e,t,n){t.ending=!0,b(e,t),n&&(t.finished?k(n):e.once("finish",n)),t.ended=!0,e.writable=!1}function x(e){var t=this;this.next=null,this.entry=null,this.finish=function(n){var i=t.entry;for(t.entry=null;i;){var r=i.callback;e.pendingcb--,r(n),i=i.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}}t.exports=a;var k=e("process-nextick-args"),E=!n.browser&&["v0.10","v0.9."].indexOf(n.version.slice(0,5))>-1?setImmediate:k;a.WritableState=o;var S=e("core-util-is");S.inherits=e("inherits");var I,T={deprecate:e("util-deprecate")};!function(){try{I=e("stream")}catch(e){}finally{I||(I=e("events").EventEmitter)}}();var P=e("buffer").Buffer,A=e("buffer-shims");S.inherits(a,I);var D;o.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(o.prototype,"buffer",{get:T.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")})}catch(e){}}();var D;a.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},a.prototype.write=function(e,t,n){var r=this._writableState,o=!1;return"function"==typeof t&&(n=t,t=null),P.isBuffer(e)?t="buffer":t||(t=r.defaultEncoding),"function"!=typeof n&&(n=i),r.ended?s(this,n):l(this,r,e,n)&&(r.pendingcb++,o=c(this,r,e,t,n)),o},a.prototype.cork=function(){var e=this._writableState;e.corked++},a.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||g(this,e))},a.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},a.prototype._write=function(e,t,n){n(new Error("not implemented"))},a.prototype._writev=null,a.prototype.end=function(e,t,n){var i=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!==e&&void 0!==e&&this.write(e,t),i.corked&&(i.corked=1,this.uncork()),i.ending||i.finished||w(this,i,n)}}).call(this,e("_process"))},{"./_stream_duplex":69,_process:68,buffer:19,"buffer-shims":21,"core-util-is":24,events:20,inherits:27,"process-nextick-args":67,"util-deprecate":75}],73:[function(e,t,n){t.exports=e("./lib/_stream_transform.js")},{"./lib/_stream_transform.js":71}],74:[function(e,t,n){function i(e){if(e&&!l(e))throw new Error("Unknown encoding: "+e)}function r(e){return e.toString(this.encoding)}function o(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function a(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}var s=e("buffer").Buffer,l=s.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},u=n.StringDecoder=function(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),i(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=o;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=a;break;default:return void(this.write=r)}this.charBuffer=new s(6),this.charReceived=0,this.charLength=0};u.prototype.write=function(e){for(var t="";this.charLength;){var n=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,n),this.charReceived+=n,this.charReceived<this.charLength)return"";e=e.slice(n,e.length),t=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var i=t.charCodeAt(t.length-1);if(!(i>=55296&&i<=56319)){if(this.charReceived=this.charLength=0,0===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var r=e.length;this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,r),r-=this.charReceived),t+=e.toString(this.encoding,0,r);var r=t.length-1,i=t.charCodeAt(r);if(i>=55296&&i<=56319){var o=this.surrogateSize;return this.charLength+=o,this.charReceived+=o,this.charBuffer.copy(this.charBuffer,o,0,o),e.copy(this.charBuffer,0,0,o),t.substring(0,r)}return t},u.prototype.detectIncompleteChar=function(e){for(var t=e.length>=3?3:e.length;t>0;t--){var n=e[e.length-t];if(1==t&&n>>5==6){this.charLength=2;break}if(t<=2&&n>>4==14){this.charLength=3;break}if(t<=3&&n>>3==30){this.charLength=4;break}}this.charReceived=t},u.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var n=this.charReceived,i=this.charBuffer,r=this.encoding;t+=i.slice(0,n).toString(r)}return t}},{buffer:19}],75:[function(e,t,n){(function(e){function n(e,t){function n(){if(!r){if(i("throwDeprecation"))throw new Error(t);i("traceDeprecation")?console.trace(t):console.warn(t),r=!0}return e.apply(this,arguments)}if(i("noDeprecation"))return e;var r=!1;return n}function i(t){try{if(!e.localStorage)return!1}catch(e){return!1}var n=e.localStorage[t];return null!=n&&"true"===String(n).toLowerCase()}t.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],76:[function(e,t,n){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],77:[function(e,t,n){(function(t,i){function r(e,t){var i={seen:[],stylize:a};return arguments.length>=3&&(i.depth=arguments[2]),arguments.length>=4&&(i.colors=arguments[3]),m(t)?i.showHidden=t:t&&n._extend(i,t),w(i.showHidden)&&(i.showHidden=!1),w(i.depth)&&(i.depth=2),w(i.colors)&&(i.colors=!1),w(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=o),l(i,e,i.depth)}function o(e,t){var n=r.styles[t];return n?"["+r.colors[n][0]+"m"+e+"["+r.colors[n][1]+"m":e}function a(e,t){return e}function s(e){var t={};return e.forEach(function(e,n){t[e]=!0}),t}function l(e,t,i){if(e.customInspect&&t&&I(t.inspect)&&t.inspect!==n.inspect&&(!t.constructor||t.constructor.prototype!==t)){var r=t.inspect(i,e);return v(r)||(r=l(e,r,i)),r}var o=u(e,t);if(o)return o;var a=Object.keys(t),m=s(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(t)),S(t)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return c(t);if(0===a.length){if(I(t)){var _=t.name?": "+t.name:"";return e.stylize("[Function"+_+"]","special")}if(x(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(E(t))return e.stylize(Date.prototype.toString.call(t),"date");if(S(t))return c(t)}var g="",y=!1,b=["{","}"];if(p(t)&&(y=!0,b=["[","]"]),I(t)){var w=t.name?": "+t.name:"";g=" [Function"+w+"]"}if(x(t)&&(g=" "+RegExp.prototype.toString.call(t)),E(t)&&(g=" "+Date.prototype.toUTCString.call(t)),S(t)&&(g=" "+c(t)),0===a.length&&(!y||0==t.length))return b[0]+g+b[1];if(i<0)return x(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special");e.seen.push(t);var k;return k=y?h(e,t,i,m,a):a.map(function(n){return f(e,t,i,m,n,y)}),e.seen.pop(),d(k,g,b)}function u(e,t){if(w(t))return e.stylize("undefined","undefined");if(v(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return y(t)?e.stylize(""+t,"number"):m(t)?e.stylize(""+t,"boolean"):_(t)?e.stylize("null","null"):void 0}function c(e){return"["+Error.prototype.toString.call(e)+"]"}function h(e,t,n,i,r){for(var o=[],a=0,s=t.length;a<s;++a)O(t,String(a))?o.push(f(e,t,n,i,String(a),!0)):o.push("");return r.forEach(function(r){r.match(/^\d+$/)||o.push(f(e,t,n,i,r,!0))}),o}function f(e,t,n,i,r,o){var a,s,u;if(u=Object.getOwnPropertyDescriptor(t,r)||{value:t[r]},u.get?s=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(s=e.stylize("[Setter]","special")),O(i,r)||(a="["+r+"]"),s||(e.seen.indexOf(u.value)<0?(s=_(n)?l(e,u.value,null):l(e,u.value,n-1),s.indexOf("\n")>-1&&(s=o?s.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+s.split("\n").map(function(e){return"   "+e}).join("\n"))):s=e.stylize("[Circular]","special")),w(a)){if(o&&r.match(/^\d+$/))return s;a=JSON.stringify(""+r),a.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+s}function d(e,t,n){var i=0,r=e.reduce(function(e,t){return i++,t.indexOf("\n")>=0&&i++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0);return r>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}function p(e){return Array.isArray(e)}function m(e){return"boolean"==typeof e}function _(e){return null===e}function g(e){return null==e}function y(e){return"number"==typeof e}function v(e){return"string"==typeof e}function b(e){return"symbol"==typeof e}function w(e){return void 0===e}function x(e){return k(e)&&"[object RegExp]"===P(e)}function k(e){return"object"==typeof e&&null!==e}function E(e){return k(e)&&"[object Date]"===P(e)}function S(e){return k(e)&&("[object Error]"===P(e)||e instanceof Error)}function I(e){return"function"==typeof e}function T(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function P(e){return Object.prototype.toString.call(e)}function A(e){return e<10?"0"+e.toString(10):e.toString(10)}function D(){var e=new Date,t=[A(e.getHours()),A(e.getMinutes()),A(e.getSeconds())].join(":");return[e.getDate(),L[e.getMonth()],t].join(" ")}function O(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var M=/%[sdj%]/g;n.format=function(e){if(!v(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(r(arguments[n]));return t.join(" ")}for(var n=1,i=arguments,o=i.length,a=String(e).replace(M,function(e){if("%%"===e)return"%";if(n>=o)return e;switch(e){case"%s":return String(i[n++]);case"%d":return Number(i[n++]);case"%j":try{return JSON.stringify(i[n++])}catch(e){return"[Circular]"}default:return e}}),s=i[n];n<o;s=i[++n])a+=_(s)||!k(s)?" "+s:" "+r(s);return a},n.deprecate=function(e,r){function o(){if(!a){if(t.throwDeprecation)throw new Error(r);t.traceDeprecation?console.trace(r):console.error(r),a=!0}return e.apply(this,arguments)}if(w(i.process))return function(){return n.deprecate(e,r).apply(this,arguments)};if(t.noDeprecation===!0)return e;var a=!1;return o};var C,R={};n.debuglog=function(e){if(w(C)&&(C=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!R[e])if(new RegExp("\\b"+e+"\\b","i").test(C)){var i=t.pid;R[e]=function(){var t=n.format.apply(n,arguments);console.error("%s %d: %s",e,i,t)}}else R[e]=function(){};return R[e]},n.inspect=r,r.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},r.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=p,n.isBoolean=m,n.isNull=_,n.isNullOrUndefined=g,n.isNumber=y,n.isString=v,n.isSymbol=b,n.isUndefined=w,n.isRegExp=x,n.isObject=k,n.isDate=E,n.isError=S,n.isFunction=I,n.isPrimitive=T,n.isBuffer=e("./support/isBuffer");var L=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];n.log=function(){console.log("%s - %s",D(),n.format.apply(n,arguments))},n.inherits=e("inherits"),n._extend=function(e,t){if(!t||!k(t))return e;for(var n=Object.keys(t),i=n.length;i--;)e[n[i]]=t[n[i]];return e}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":76,_process:68,inherits:27}],78:[function(e,t,n){"use strict";function i(e,t,n){var i,u;if(!r(e))throw new TypeError("invalid input argument. First argument must be a string. Value: `"+e+"`.");if(!o(t))throw new TypeError("invalid input argument. Second argument must be a nonnegative integer. Value: `"+t+"`.");if(arguments.length>2){if(u=n,!r(u))throw new TypeError("invalid input argument. Third argument must be a string. Value: `"+u+"`.");if(0===u.length)throw new RangeError("invalid input argument. Pad string must not be an empty string.")}else u=" ";if(t>l)throw new RangeError("invalid input argument. Output string length exceeds maximum allowed string length.");return i=(t-e.length)/u.length,i<=0?e:(i=a(i),s(u,i)+e)}var r=e("validate.io-string-primitive"),o=e("validate.io-nonnegative-integer"),a=e("math-ceil"),s=e("utils-repeat-string"),l=9007199254740991;t.exports=i},{"math-ceil":41,"utils-repeat-string":79,"validate.io-nonnegative-integer":82,"validate.io-string-primitive":84}],79:[function(e,t,n){"use strict";function i(e,t){var n,i;if(!r(e))throw new TypeError("invalid input argument. First argument must be a string. Value: `"+e+"`.");if(!o(t))throw new TypeError("invalid input argument. Second argument must be a nonnegative integer. Value: `"+t+"`.");if(0===e.length||0===t)return"";if(e.length*t>a)throw new RangeError("invalid input argument. Output string length exceeds maximum allowed string length.");for(n="",i=t;1===(1&i)&&(n+=e),i>>>=1,0!==i;)e+=e;return n}var r=e("validate.io-string-primitive"),o=e("validate.io-nonnegative-integer"),a=9007199254740991;t.exports=i},{"validate.io-nonnegative-integer":82,"validate.io-string-primitive":84}],80:[function(e,t,n){"use strict";function i(e,t,n){var i,u;if(!r(e))throw new TypeError("invalid input argument. First argument must be a string. Value: `"+e+"`.");if(!o(t))throw new TypeError("invalid input argument. Second argument must be a nonnegative integer. Value: `"+t+"`.");if(arguments.length>2){if(u=n,!r(u))throw new TypeError("invalid input argument. Third argument must be a string. Value: `"+u+"`.");if(0===u.length)throw new RangeError("invalid input argument. Pad string must not be an empty string.")}else u=" ";if(t>l)throw new RangeError("invalid input argument. Output string length exceeds maximum allowed string length.");return i=(t-e.length)/u.length,i<=0?e:(i=a(i),e+s(u,i))}var r=e("validate.io-string-primitive"),o=e("validate.io-nonnegative-integer"),a=e("math-ceil"),s=e("utils-repeat-string"),l=9007199254740991;t.exports=i},{"math-ceil":41,"utils-repeat-string":79,"validate.io-nonnegative-integer":82,"validate.io-string-primitive":84}],81:[function(e,t,n){"use strict";function i(e){return r(e)&&e%1===0}var r=e("validate.io-number");t.exports=i},{"validate.io-number":83}],82:[function(e,t,n){"use strict";function i(e){return r(e)&&e>=0}var r=e("validate.io-integer");t.exports=i},{"validate.io-integer":81}],83:[function(e,t,n){"use strict";function i(e){return("number"==typeof e||"[object Number]"===Object.prototype.toString.call(e))&&e.valueOf()===e.valueOf()}t.exports=i},{}],84:[function(e,t,n){"use strict";function i(e){return"string"==typeof e}t.exports=i},{}],85:[function(e,t,n){t.exports={name:"ami.js",version:"0.0.14",main:"src/ami.js",keywords:["ami","ami.js","three.js","webgl","dicom","nifti","awesome","medical","imaging","xtk","nrrd","vtk","stl","trk"],author:{name:"Nicolas Rannou",email:"nicolas@eunate.ch",url:"https://eunate.ch"},license:"Apache-2.0",repository:{type:"git",url:"https://fnndsc.github.io/ami"},config:{threeVersion:"r83",amiCDN:"https://cdnjs.cloudflare.com/ajax/libs/ami.js/",gaKey:"UA-39303022-3",transforms:"-t [babelify --presets [ es2015 ] ]"},dependencies:{"dicom-parser":"1.7.3","image-JPEG2000":"OHIF/image-JPEG2000#master","jpeg-lossless-decoder-js":"1.2.3","math-float32-to-binary-string":"^1.0.0","nrrd-js":"^0.2.1","nifti-reader-js":"v0.5.3",pako:"1.0.1"},scripts:{"dist:prepare":"node ./scripts/$npm_package_config_mode.js --dist","dist:watchAmi":"watchify -d src/ami $npm_package_config_transforms --standalone AMI -o dist/build/ami.js -v","dist:watch":"watchify $npm_package_config_target -d $npm_package_config_transforms -o dist/$npm_package_config_target -v",dist:"npm run dist:prepare --ami.js:mode=$npm_package_config_mode && (live-server dist --open=$npm_package_config_open & npm run dist:watch --ami.js:target=$npm_package_config_target)",example:"npm run clean && node ./scripts/router.js examples ",lesson:"npm run clean && mkdir dist/build && touch dist/build/ami.js && node ./scripts/router.js lessons ",demo:"node ./scripts/lessons.js --demo",lint:"eslint **/*.js --quiet","build:examples":"npm run dist:prepare --ami.js:mode=examples && find examples -name '*.js' -print0 | xargs -0 -n1 -I{} bash -c \"echo Building {}; browserify {} -d -v $npm_package_config_transforms > dist/{} \"","build:ami":"browserify src/ami.js -d -v $npm_package_config_transforms --standalone AMI > build/ami.js && uglifyjs build/ami.js -o build/ami.min.js",build:"npm run clean && cp index.html dist/index.html && npm run build:examples && npm run doc",clean:"rm -rf dist/*",test:"karma start",doc:"jsdoc -p -r -R README.md -c jsdoc.conf -d dist/doc src",ami:"npm run lint && npm run demo && npm run build:ami && npm run test",deploy:"npm run build && gh-pages -d dist"},devDependencies:{browserify:"^13.1.0","uglify-js":"^2.7.3","live-server":"^1.1.0","babel-cli":"latest",shelljs:"latest","gh-pages":"latest",eslint:"latest","eslint-config-google":"latest","babel-polyfill":"^6.13.0","babel-preset-es2015":"^6.13.2",babelify:"7.3.0",glslify:"5.1.0",jsdoc:"jsdoc3/jsdoc#master",karma:"latest",phantomjs:"latest","karma-browserify":"latest","karma-jasmine":"latest","karma-phantomjs-launcher":"latest","karma-spec-reporter":"latest","jasmine-core":"latest",watchify:"3.7.0"},engines:{node:">=6.9.0"},browserify:{transform:["babelify"]}}},{}],86:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var r=e("./cameras/cameras"),o=i(r),a=e("./controls/controls"),s=i(a),l=e("./core/core"),u=i(l),c=e("./geometries/geometries"),h=i(c),f=e("./helpers/helpers"),d=i(f),p=e("./loaders/loaders"),m=i(p),_=e("./models/models"),g=i(_),y=e("./parsers/parsers"),v=i(y),b=e("./shaders/shaders"),w=i(b),x=e("./widgets/widgets"),k=i(x),E=e("../package.json");n.default={Cameras:o.default,Controls:s.default,Core:u.default,Geometries:h.default,Helpers:d.default,Loaders:m.default,Models:g.default,Parsers:v.default,Shaders:w.default,Widgets:k.default},window.console.log("AMI "+E.version+" ( ThreeJS "+E.config.threeVersion+")")},{"../package.json":85,"./cameras/cameras":87,"./controls/controls":89,"./core/core":94,"./geometries/geometries":98,"./helpers/helpers":103,"./loaders/loaders":118,"./models/models":122,"./parsers/parsers":127,"./shaders/shaders":141,"./widgets/widgets":150}],87:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var r=e("./cameras.orthographic"),o=i(r);n.default={Orthographic:o.default}},{"./cameras.orthographic":88}],88:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":s(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":s(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=e("../core/core.intersections"),c=i(u),h=e("../core/core.validators"),f=i(h),d=function(e){function t(e,n,i,a,s,l){r(this,t);var u=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i,a,s,l));return u._front=null,u._back=null,u._directions=[new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1)],u._directionsLabel=["A","P","L","R","I","S"],u._orientation="default",u._convention="radio",u._stackOrientation=0,u._right=null,u._up=null,u._direction=null,u._controls=null,u._box=null,u._canvas={width:null,height:null},u._fromFront=!0,u._angle=0,u}return a(t,e),l(t,[{key:"init",value:function(e,t,n,i,r,o){if(console.warn("cameras.orthographic.init(...) is deprecated. Use .cosines, .controls, .box and .canvas instead."),!(f.default.vector3(e)&&f.default.vector3(t)&&f.default.vector3(n)&&f.default.box(r)&&i))return window.console.log("Invalid input provided."),!1;this._right=e,this._up=this._adjustTopDirection(e,t),this._direction=(new THREE.Vector3).crossVectors(this._right,this._up),this._controls=i,this._box=r,this._canvas=o;var a={position:this._box.center,direction:this._direction},s=this._orderIntersections(c.default.rayBox(a,this._box),this._direction);this._front=s[0],this._back=s[1],this.up.set(this._up.x,this._up.y,this._up.z),this._updateCanvas(),this._updatePositionAndTarget(this._front,this._back),this._updateMatrices(),this._updateDirections()}},{key:"update",value:function(){if("default"===this._orientation)switch(this._getMaxIndex(this._directions[2])){case 0:this._orientation="sagittal";break;case 1:this._orientation="coronal";break;case 2:this._orientation="axial";break;default:this._orientation="free"}if("free"===this._orientation)this._right=this._directions[0],this._up=this._directions[1],this._direction=this._directions[2];else{var e=this.leftDirection(),t=this._directions[e],n=this.posteriorDirection(),i=this._directions[n],r=this.superiorDirection(),o=this._directions[r];if("radio"===this._convention)switch(this._orientation){case"axial":i.y>0&&i.negate(),o.z<0&&o.negate(),this._right=t,this._up=i,this._direction=o;break;case"coronal":o.z<0&&o.negate(),i.y<0&&i.negate(),this._right=t,this._up=o,this._direction=i;break;case"sagittal":o.z<0&&o.negate(),t.x>0&&t.negate(),this._right=i,this._up=o,this._direction=t;break;default:console.warn('"'+this._orientation+'" orientation is not valid. (choices: axial, coronal, sagittal)')}else if("neuro"===this._convention)switch(this._orientation){case"axial":i.y>0&&i.negate(),o.z>0&&o.negate(),this._right=t,this._up=i,this._direction=o;break;case"coronal":o.z<0&&o.negate(),i.y>0&&i.negate(),this._right=t,this._up=o,this._direction=i;break;case"sagittal":o.z<0&&o.negate(),t.x>0&&t.negate(),this._right=i,this._up=o,this._direction=t;break;default:console.warn('"'+this._orientation+'" orientation is not valid. (choices: axial, coronal, sagittal)')}else console.warn(this._convention+" is not valid (choices: radio, neuro)")}var a={position:this._box.center,direction:this._direction},s=this._orderIntersections(c.default.rayBox(a,this._box),this._direction);this._front=s[0],this._back=s[1],this.up.set(this._up.x,this._up.y,this._up.z),this._updateCanvas(),this._updatePositionAndTarget(this._front,this._back),this._updateMatrices(),this._updateDirections()}},{key:"leftDirection",value:function(){return this._findMaxIndex(this._directions,0)}},{key:"posteriorDirection",value:function(){return this._findMaxIndex(this._directions,1)}},{key:"superiorDirection",value:function(){return this._findMaxIndex(this._directions,2)}},{key:"invertRows",value:function(){this.up.multiplyScalar(-1),this.invertColumns(),this._updateDirections()}},{key:"invertColumns",value:function(){this.center();var e=this._oppositePosition(this.position);this._updatePositionAndTarget(e,this.position.clone()),this._updateMatrices(),this._fromFront=!this._fromFront;var t=1;this._fromFront||(t=-1),this._angle%=360,this._angle=360-this._angle,this._updateDirections()}},{key:"center",value:function(){this._fromFront?this._updatePositionAndTarget(this._front,this._back):this._updatePositionAndTarget(this._back,this._front),this._updateMatrices(),this._updateDirections()}},{key:"rotate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.center();var t=90,n=1;this._fromFront||(n=-1),null===e?(t*=-n,this._angle+=90):(t=360-n*(e-this._angle),this._angle=e),this._angle%=360;var i=(new THREE.Matrix4).makeRotationAxis(this._direction,t*Math.PI/180);this.up.applyMatrix4(i),this._updateMatrices(),this._updateDirections()}},{key:"fitBox",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1.5,n=1;switch(e){case 0:n=t*this._computeZoom(this._canvas.width,this._right);break;case 1:n=t*this._computeZoom(this._canvas.height,this._up);break;case 2:n=t*Math.min(this._computeZoom(this._canvas.width,this._right),this._computeZoom(this._canvas.height,this._up))}return!!n&&(this.zoom=n,void this.center())}},{key:"_adjustTopDirection",value:function(e,t){var n=(this._getMaxIndex(e),
this._getMaxIndex(t));return(2===n&&t.getComponent(n)<0||1===n&&t.getComponent(n)>0||0===n&&t.getComponent(n)>0)&&t.negate(),t}},{key:"_getMaxIndex",value:function(e){return 1===Math.abs(Math.round(e.x))?0:1===Math.abs(Math.round(e.y))?1:1===Math.abs(Math.round(e.z))?2:void 0}},{key:"_findMaxIndex",value:function(e,t){for(var n=this._getMaxIndices(e),i=0;i<n.length;i++)if(n[i]===t)return i}},{key:"_getMaxIndices",value:function(e){var t=[];return t.push(this._getMaxIndex(e[0])),t.push(this._getMaxIndex(e[1])),t.push(this._getMaxIndex(e[2])),t}},{key:"_orderIntersections",value:function(e,t){var n=e[0].dot(t)<e[1].dot(t);return n?e:[e[1],e[0]]}},{key:"_updateCanvas",value:function(){var e=2;this.left=-this._canvas.width/e,this.right=this._canvas.width/e,this.top=this._canvas.height/e,this.bottom=-this._canvas.height/e,this._updateMatrices(),this.controls.handleResize()}},{key:"_oppositePosition",value:function(e){var t=e.clone();t.sub(this._box.center);var n=(new THREE.Matrix4).makeRotationAxis(this.up,Math.PI);return t.applyMatrix4(n),t.add(this._box.center),t}},{key:"_computeZoom",value:function(e,t){if(!(e&&e>0))return window.console.log("Invalid dimension provided."),window.console.log(e),!1;var n={position:this._box.center.clone(),direction:t},i=c.default.rayBox(n,this._box);return i.length<2?(window.console.log("Can not adjust the camera ( < 2 intersections)."),window.console.log(n),window.console.log(this._box),!1):e/i[0].distanceTo(i[1])}},{key:"_updatePositionAndTarget",value:function(e,t){this.position.set(e.x,e.y,e.z),this.lookAt(t.x,t.y,t.z),this._controls.target.set(t.x,t.y,t.z)}},{key:"_updateMatrices",value:function(){this._controls.update(),this.updateProjectionMatrix(),this.updateMatrixWorld()}},{key:"_updateLabels",value:function(){this._directionsLabel=[this._vector2Label(this._up),this._vector2Label(this._up.clone().negate()),this._vector2Label(this._right),this._vector2Label(this._right.clone().negate()),this._vector2Label(this._direction),this._vector2Label(this._direction.clone().negate())]}},{key:"_vector2Label",value:function(e){for(var t=this._getMaxIndex(e),n=e.clone().divideScalar(Math.abs(e.getComponent(t))),i=.2,r="",o=0;o<3;o++)0===o&&(n.getComponent(o)+i>=1?r+="L":n.getComponent(o)-i<=-1&&(r+="R")),1===o&&(n.getComponent(o)+i>=1?r+="P":n.getComponent(o)-i<=-1&&(r+="A")),2===o&&(n.getComponent(o)+i>=1?r+="S":n.getComponent(o)-i<=-1&&(r+="I"));return r}},{key:"_updateDirections",value:function(){this._up=this.up.clone();var e=new THREE.Vector3(0,0,-1),t=e.applyMatrix4(this.matrixWorld);this._direction=t.sub(this.position).normalize(),this._right=(new THREE.Vector3).crossVectors(this._direction,this.up),this._updateLabels()}},{key:"controls",set:function(e){this._controls=e},get:function(){return this._controls}},{key:"box",set:function(e){this._box=e},get:function(){return this._box}},{key:"canvas",set:function(e){this._canvas=e,this._updateCanvas()},get:function(){return this._canvas}},{key:"angle",set:function(e){this.rotate(e)},get:function(){return this._angle}},{key:"directions",set:function(e){this._directions=e},get:function(){return this._directions}},{key:"convention",set:function(e){this._convention=e},get:function(){return this._convention}},{key:"orientation",set:function(e){this._orientation=e},get:function(){return this._orientation}},{key:"directionsLabel",set:function(e){this._directionsLabel=e},get:function(){return this._directionsLabel}},{key:"stackOrientation",set:function(e){if(this._stackOrientation=e,0===this._stackOrientation)this._orientation="default";else{var t=this._getMaxIndex(this._directions[(this._stackOrientation+2)%3]);0===t?this._orientation="sagittal":1===t?this._orientation="coronal":2===t&&(this._orientation="axial")}},get:function(){if("default"===this._orientation)this._stackOrientation=0;else{var e=this._getMaxIndex(this._direction);e===this._getMaxIndex(this._directions[2])?this._stackOrientation=0:e===this._getMaxIndex(this._directions[0])?this._stackOrientation=1:e===this._getMaxIndex(this._directions[1])&&(this._stackOrientation=2)}return this._stackOrientation}}]),t}(THREE.OrthographicCamera);n.default=d},{"../core/core.intersections":93,"../core/core.validators":97}],89:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var r=e("./controls.trackball"),o=i(r),a=e("./controls.trackballortho"),s=i(a);n.default={Trackball:o.default,TrackballOrtho:s.default}},{"./controls.trackball":90,"./controls.trackballortho":91}],90:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var s=function(e){function t(e,n){function o(e){m.enabled!==!1&&(window.removeEventListener("keydown",o),b=v,v===_.NONE&&(e.keyCode!==m.keys[_.ROTATE]||m.noRotate?e.keyCode!==m.keys[_.ZOOM]||m.noZoom?e.keyCode!==m.keys[_.PAN]||m.noPan||(v=_.PAN):v=_.ZOOM:v=_.ROTATE))}function a(e){m.enabled!==!1&&(v=b,window.addEventListener("keydown",o,!1))}function s(e){m.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),v===_.NONE&&(v=e.button),v!==_.ROTATE||m.noRotate?v!==_.ZOOM||m.noZoom?v!==_.PAN||m.noPan?v!==_.CUSTOM||m.noCustom||(M.copy(z(e.pageX,e.pageY)),C.copy(D)):(D.copy(z(e.pageX,e.pageY)),O.copy(D)):(I.copy(z(e.pageX,e.pageY)),T.copy(I)):(k.copy(B(e.pageX,e.pageY)),x.copy(k)),document.addEventListener("mousemove",l,!1),document.addEventListener("mouseup",u,!1),m.dispatchEvent(L))}function l(e){m.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),v!==_.ROTATE||m.noRotate?v!==_.ZOOM||m.noZoom?v!==_.PAN||m.noPan?v!==_.CUSTOM||m.noCustom||C.copy(z(e.pageX,e.pageY)):O.copy(z(e.pageX,e.pageY)):T.copy(z(e.pageX,e.pageY)):(x.copy(k),k.copy(B(e.pageX,e.pageY))))}function u(e){m.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),m.forceState===-1&&(v=_.NONE),document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",u),m.dispatchEvent(F))}function c(e){if(m.enabled!==!1){e.preventDefault(),e.stopPropagation();var t=0;e.wheelDelta?t=e.wheelDelta/40:e.detail&&(t=-e.detail/3),v!==_.CUSTOM?I.y+=.01*t:v===_.CUSTOM&&(M.y+=.01*t),m.dispatchEvent(L),m.dispatchEvent(F)}}function h(e){if(m.enabled!==!1){if(m.forceState===-1)switch(e.touches.length){case 1:v=_.TOUCH_ROTATE,k.copy(B(e.touches[0].pageX,e.touches[0].pageY)),x.copy(k);break;case 2:v=_.TOUCH_ZOOM;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;A=P=Math.sqrt(t*t+n*n);var i=(e.touches[0].pageX+e.touches[1].pageX)/2,r=(e.touches[0].pageY+e.touches[1].pageY)/2;D.copy(z(i,r)),O.copy(D);break;default:v=_.NONE}else switch(v){case 0:v=_.TOUCH_ROTATE,k.copy(B(e.touches[0].pageX,e.touches[0].pageY)),x.copy(k);break;case 1:case 4:if(e.touches.length>=2){v=_.TOUCH_ZOOM;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;A=P=Math.sqrt(t*t+n*n)}else v=_.ZOOM,I.copy(z(e.touches[0].pageX,e.touches[0].pageY)),T.copy(I);break;case 2:case 5:if(e.touches.length>=2){v=_.TOUCH_PAN;var i=(e.touches[0].pageX+e.touches[1].pageX)/2,r=(e.touches[0].pageY+e.touches[1].pageY)/2;D.copy(z(i,r)),O.copy(D)}else v=_.PAN,D.copy(z(e.touches[0].pageX,e.touches[0].pageY)),O.copy(D);break;case 99:v=_.CUSTOM;var i=(e.touches[0].pageX+e.touches[1].pageX)/2,r=(e.touches[0].pageY+e.touches[1].pageY)/2;M.copy(z(i,r)),C.copy(M);break;default:v=_.NONE}m.dispatchEvent(L)}}function f(e){if(m.enabled!==!1)if(e.preventDefault(),e.stopPropagation(),m.forceState===-1)switch(e.touches.length){case 1:x.copy(k),k.copy(B(e.touches[0].pageX,e.touches[0].pageY));break;case 2:var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;A=Math.sqrt(t*t+n*n);var i=(e.touches[0].pageX+e.touches[1].pageX)/2,r=(e.touches[0].pageY+e.touches[1].pageY)/2;O.copy(z(i,r));break;default:v=_.NONE}else switch(v){case 0:x.copy(k),k.copy(B(e.touches[0].pageX,e.touches[0].pageY));break;case 1:T.copy(z(e.touches[0].pageX,e.touches[0].pageY));break;case 2:O.copy(z(e.touches[0].pageX,e.touches[0].pageY));break;case 4:var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;A=Math.sqrt(t*t+n*n);break;case 5:var i=(e.touches[0].pageX+e.touches[1].pageX)/2,r=(e.touches[0].pageY+e.touches[1].pageY)/2;O.copy(z(i,r));break;case 99:var i=(e.touches[0].pageX+e.touches[1].pageX)/2,r=(e.touches[0].pageY+e.touches[1].pageY)/2;C.copy(z(i,r));break;default:v=_.NONE}}function d(e){if(m.enabled!==!1){if(m.forceState===-1){switch(e.touches.length){case 1:x.copy(k),k.copy(B(e.touches[0].pageX,e.touches[0].pageY));break;case 2:P=A=0;var t=(e.touches[0].pageX+e.touches[1].pageX)/2,n=(e.touches[0].pageY+e.touches[1].pageY)/2;O.copy(z(t,n)),D.copy(O)}v=_.NONE}else switch(v){case 0:x.copy(k),k.copy(B(e.touches[0].pageX,e.touches[0].pageY));break;case 1:case 2:break;case 4:P=A=0,v=_.ZOOM;break;case 5:if(e.touches.length>=2){var t=(e.touches[0].pageX+e.touches[1].pageX)/2,n=(e.touches[0].pageY+e.touches[1].pageY)/2;O.copy(z(t,n)),D.copy(O)}v=_.PAN;break;case 99:var t=(e.touches[0].pageX+e.touches[1].pageX)/2,n=(e.touches[0].pageY+e.touches[1].pageY)/2;C.copy(z(t,n)),M.copy(C);break;default:v=_.NONE}m.dispatchEvent(F)}}i(this,t);var p=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),m=p,_={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM:4,TOUCH_PAN:5,CUSTOM:99};p.object=e,p.domElement=void 0!==n?n:document,p.enabled=!0,p.screen={left:0,top:0,width:0,height:0},p.rotateSpeed=1,p.zoomSpeed=1.2,p.panSpeed=.3,p.noRotate=!1,p.noZoom=!1,p.noPan=!1,p.noCustom=!1,p.forceState=-1,p.staticMoving=!1,p.dynamicDampingFactor=.2,p.minDistance=0,p.maxDistance=1/0,p.keys=[65,83,68],p.target=new THREE.Vector3;var g=1e-6,y=new THREE.Vector3,v=_.NONE,b=_.NONE,w=new THREE.Vector3,x=new THREE.Vector2,k=new THREE.Vector2,E=new THREE.Vector3,S=0,I=new THREE.Vector2,T=new THREE.Vector2,P=0,A=0,D=new THREE.Vector2,O=new THREE.Vector2,M=new THREE.Vector2,C=new THREE.Vector2;p.target0=p.target.clone(),p.position0=p.object.position.clone(),p.up0=p.object.up.clone();var R={type:"change"},L={type:"start"},F={type:"end"};p.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}},p.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)};var z=function(){var e=new THREE.Vector2;return function(t,n){return e.set((t-m.screen.left)/m.screen.width,(n-m.screen.top)/m.screen.height),e}}(),B=function(){var e=new THREE.Vector2;return function(t,n){return e.set((t-.5*m.screen.width-m.screen.left)/(.5*m.screen.width),(m.screen.height+2*(m.screen.top-n))/m.screen.width),e}}();return p.rotateCamera=function(){var e=new THREE.Vector3,t=new THREE.Quaternion,n=new THREE.Vector3,i=new THREE.Vector3,r=new THREE.Vector3,o=new THREE.Vector3,a=void 0;return function(){o.set(k.x-x.x,k.y-x.y,0),a=o.length(),a?(w.copy(m.object.position).sub(m.target),n.copy(w).normalize(),i.copy(m.object.up).normalize(),r.crossVectors(i,n).normalize(),i.setLength(k.y-x.y),r.setLength(k.x-x.x),o.copy(i.add(r)),e.crossVectors(o,w).normalize(),a*=m.rotateSpeed,t.setFromAxisAngle(e,a),w.applyQuaternion(t),m.object.up.applyQuaternion(t),E.copy(e),S=a):!m.staticMoving&&S&&(S*=Math.sqrt(1-m.dynamicDampingFactor),w.copy(m.object.position).sub(m.target),t.setFromAxisAngle(E,S),w.applyQuaternion(t),m.object.up.applyQuaternion(t)),x.copy(k)}}(),p.zoomCamera=function(){var e=void 0;v===_.TOUCH_ZOOM?(e=P/A,P=A,w.multiplyScalar(e)):(e=1+(T.y-I.y)*m.zoomSpeed,1!==e&&e>0&&(w.multiplyScalar(e),m.staticMoving?I.copy(T):I.y+=(T.y-I.y)*this.dynamicDampingFactor))},p.panCamera=function(){var e=new THREE.Vector2,t=new THREE.Vector3,n=new THREE.Vector3;return function(){e.copy(O).sub(D),e.lengthSq()&&(e.multiplyScalar(w.length()*m.panSpeed),n.copy(w).cross(m.object.up).setLength(e.x),n.add(t.copy(m.object.up).setLength(e.y)),m.object.position.add(n),m.target.add(n),m.staticMoving?D.copy(O):D.add(e.subVectors(O,D).multiplyScalar(m.dynamicDampingFactor)))}}(),p.checkDistances=function(){m.noZoom&&m.noPan||(w.lengthSq()>m.maxDistance*m.maxDistance&&m.object.position.addVectors(m.target,w.setLength(m.maxDistance)),w.lengthSq()<m.minDistance*m.minDistance&&m.object.position.addVectors(m.target,w.setLength(m.minDistance)))},p.update=function(){w.subVectors(m.object.position,m.target),m.noRotate||m.rotateCamera(),m.noZoom||m.zoomCamera(),m.noPan||m.panCamera(),m.noCustom||m.custom(M,C),m.object.position.addVectors(m.target,w),m.checkDistances(),m.object.lookAt(m.target),y.distanceToSquared(m.object.position)>g&&(m.dispatchEvent(R),y.copy(m.object.position))},p.reset=function(){v=_.NONE,b=_.NONE,m.target.copy(m.target0),m.object.position.copy(m.position0),m.object.up.copy(m.up0),w.subVectors(m.object.position,m.target),m.object.lookAt(m.target),m.dispatchEvent(R),y.copy(m.object.position)},p.setState=function(e){m.forceState=e,b=e,v=e},p.custom=function(e,t){},p.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),p.domElement.addEventListener("mousedown",s,!1),p.domElement.addEventListener("mousewheel",c,!1),p.domElement.addEventListener("DOMMouseScroll",c,!1),p.domElement.addEventListener("touchstart",h,!1),p.domElement.addEventListener("touchend",d,!1),p.domElement.addEventListener("touchmove",f,!1),window.addEventListener("keydown",o,!1),window.addEventListener("keyup",a,!1),p.handleResize(),p.update(),p}return o(t,e),t}(THREE.EventDispatcher);n.default=s},{}],91:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var s=function(e){function t(e,n){function o(e){g.enabled!==!1&&(window.removeEventListener("keydown",o),x=w,w===y.NONE&&(e.keyCode!==g.keys[y.ROTATE]||g.noRotate?e.keyCode!==g.keys[y.ZOOM]||g.noZoom?e.keyCode!==g.keys[y.PAN]||g.noPan||(w=y.PAN):w=y.ZOOM:w=y.ROTATE))}function a(e){g.enabled!==!1&&(w=x,window.addEventListener("keydown",o,!1))}function s(e){g.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),w===y.NONE&&(w=e.button),(w!==y.ROTATE||g.noRotate)&&(w!==y.ZOOM||g.noZoom?w!==y.PAN||g.noPan||(P.copy(C(e.pageX,e.pageY)),A.copy(P)):(E.copy(C(e.pageX,e.pageY)),S.copy(E))),document.addEventListener("mousemove",l,!1),document.addEventListener("mouseup",u,!1),g.dispatchEvent(O))}function l(e){g.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),(w!==y.ROTATE||g.noRotate)&&(w!==y.ZOOM||g.noZoom?w!==y.PAN||g.noPan||A.copy(C(e.pageX,e.pageY)):S.copy(C(e.pageX,e.pageY))))}function u(e){g.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),w=y.NONE,document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",u),g.dispatchEvent(M))}function c(e){if(g.enabled!==!1){e.preventDefault(),e.stopPropagation();var t=0;e.wheelDelta?t=e.wheelDelta/40:e.detail&&(t=-e.detail/3),g.dispatchEvent({type:"OnScroll",delta:t}),g.dispatchEvent(O),g.dispatchEvent(M)}}function h(e){if(g.enabled!==!1){switch(e.touches.length){case 1:w=y.TOUCH_ROTATE;break;case 2:w=y.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;T=I=Math.sqrt(t*t+n*n);var i=(e.touches[0].pageX+e.touches[1].pageX)/2,r=(e.touches[0].pageY+e.touches[1].pageY)/2;P.copy(C(i,r)),A.copy(P);break;default:w=y.NONE}g.dispatchEvent(O)}}function f(e){if(g.enabled!==!1)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:break;case 2:var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;T=Math.sqrt(t*t+n*n);var i=(e.touches[0].pageX+e.touches[1].pageX)/2,r=(e.touches[0].pageY+e.touches[1].pageY)/2;A.copy(C(i,r));break;default:w=y.NONE}}function d(e){if(g.enabled!==!1){switch(e.touches.length){case 1:break;case 2:I=T=0;var t=(e.touches[0].pageX+e.touches[1].pageX)/2,n=(e.touches[0].pageY+e.touches[1].pageY)/2;A.copy(C(t,n)),P.copy(A)}w=y.NONE,g.dispatchEvent(M)}}function p(e){e.preventDefault()}var m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{NONE:-1,ROTATE:1,ZOOM:2,PAN:0,SCROLL:4,TOUCH_ROTATE:4,TOUCH_ZOOM_PAN:5};i(this,t);var _=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),g=_,y=m;_.object=e,_.domElement=void 0!==n?n:document,_.enabled=!0,_.screen={left:0,top:0,width:0,height:0},_.radius=0,_.zoomSpeed=1.2,_.noZoom=!1,_.noPan=!1,_.staticMoving=!1,_.dynamicDampingFactor=.2,_.keys=[65,83,68],_.target=new THREE.Vector3;var v=1e-6,b=!0,w=y.NONE,x=y.NONE,k=new THREE.Vector3,E=new THREE.Vector2,S=new THREE.Vector2,I=0,T=0,P=new THREE.Vector2,A=new THREE.Vector2;_.target0=_.target.clone(),_.position0=_.object.position.clone(),_.up0=_.object.up.clone(),_.left0=_.object.left,_.right0=_.object.right,_.top0=_.object.top,_.bottom0=_.object.bottom;var D={type:"change"},O={type:"start"},M={type:"end"};_.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}this.radius=.5*Math.min(this.screen.width,this.screen.height),this.left0=this.object.left,this.right0=this.object.right,this.top0=this.object.top,this.bottom0=this.object.bottom},_.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)};var C=function(){var e=new THREE.Vector2;return function(t,n){return e.set((t-g.screen.left)/g.screen.width,(n-g.screen.top)/g.screen.height),e}}();return _.zoomCamera=function(){if(w===y.TOUCH_ZOOM_PAN){var e=T/I;I=T,g.object.zoom*=e,b=!0}else{var e=1+(S.y-E.y)*g.zoomSpeed;Math.abs(e-1)>v&&e>0&&(g.object.zoom/=e,g.staticMoving?E.copy(S):E.y+=(S.y-E.y)*this.dynamicDampingFactor,b=!0)}},_.panCamera=function(){var e=new THREE.Vector2,t=new THREE.Vector3,n=new THREE.Vector3;return function(){if(e.copy(A).sub(P),e.lengthSq()){var i=(g.object.right-g.object.left)/g.object.zoom,r=(g.object.top-g.object.bottom)/g.object.zoom;e.x*=i,e.y*=r,n.copy(k).cross(g.object.up).setLength(e.x),n.add(t.copy(g.object.up).setLength(e.y)),g.object.position.add(n),g.target.add(n),g.staticMoving?P.copy(A):P.add(e.subVectors(A,P).multiplyScalar(g.dynamicDampingFactor)),b=!0}}}(),_.update=function(){k.subVectors(g.object.position,g.target),g.noZoom||(g.zoomCamera(),b&&g.object.updateProjectionMatrix()),g.noPan||g.panCamera(),g.object.position.addVectors(g.target,k),g.object.lookAt(g.target),b&&(g.dispatchEvent(D),b=!1)},_.reset=function(){w=y.NONE,x=y.NONE,g.target.copy(g.target0),g.object.position.copy(g.position0),g.object.up.copy(g.up0),k.subVectors(g.object.position,g.target),g.object.left=g.left0,g.object.right=g.right0,g.object.top=g.top0,g.object.bottom=g.bottom0,g.object.lookAt(g.target),g.dispatchEvent(D),b=!1},_.dispose=function(){this.domElement.removeEventListener("contextmenu",p,!1),this.domElement.removeEventListener("mousedown",s,!1),this.domElement.removeEventListener("mousewheel",c,!1),this.domElement.removeEventListener("MozMousePixelScroll",c,!1),this.domElement.removeEventListener("touchstart",h,!1),this.domElement.removeEventListener("touchend",d,!1),this.domElement.removeEventListener("touchmove",f,!1),document.removeEventListener("mousemove",l,!1),document.removeEventListener("mouseup",u,!1),window.removeEventListener("keydown",o,!1),window.removeEventListener("keyup",a,!1)},_.domElement.addEventListener("contextmenu",p,!1),_.domElement.addEventListener("mousedown",s,!1),_.domElement.addEventListener("mousewheel",c,!1),_.domElement.addEventListener("MozMousePixelScroll",c,!1),_.domElement.addEventListener("touchstart",h,!1),_.domElement.addEventListener("touchend",d,!1),_.domElement.addEventListener("touchmove",f,!1),window.addEventListener("keydown",o,!1),window.addEventListener("keyup",a,!1),_.handleResize(),_.update(),_}return o(t,e),t}(THREE.EventDispatcher);n.default=s},{}],92:[function(e,t,n){"use strict";function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=function(){function e(){r(this,e)}return o(e,null,[{key:"cielab2XYZ",value:function(e,t,n){var i=95.047,r=100,o=108.883,a=(e+16)/116,s=t/500+a,l=a-n/200;return a=Math.pow(a,3)>.008856?Math.pow(a,3):(a-16/116)/7.787,s=Math.pow(s,3)>.008856?Math.pow(s,3):(s-16/116)/7.787,l=Math.pow(l,3)>.008856?Math.pow(l,3):(l-16/116)/7.787,[i*s,r*a,o*l]}},{key:"xyz2RGB",value:function(e,t,n){e/=100,t/=100,n/=100;var i=3.2406*e+t*-1.5372+n*-.4986,r=e*-.9689+1.8758*t+.0415*n,o=.0557*e+t*-.204+1.057*n;return i>.0031308?i=1.055*Math.pow(i,1/2.4)-.055:i*=12.92,r>.0031308?r=1.055*Math.pow(r,1/2.4)-.055:r*=12.92,o>.0031308?o=1.055*Math.pow(o,1/2.4)-.055:o*=12.92,i*=255,r*=255,o*=255,[i,r,o]}},{key:"cielab2RGB",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!(e>=0&&e<=100))return null;var r=this.cielab2XYZ(e,t,n);return this.xyz2RGB.apply(this,i(r))}}]),e}();n.default=a},{}],93:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=e("./core.utils"),s=i(a),l=e("./core.validators"),u=i(l),c=function(){function e(){r(this,e)}return o(e,null,[{key:"aabbPlane",value:function(e,t){var n=[];if(!this.validateAabb(e)||!this.validatePlane(t))return window.console.log("Invalid aabb or plane provided."),!1;var i=new THREE.Matrix4;i.getInverse(e.toAABB);var r=t.direction.clone().applyMatrix4(e.toAABB),o=new THREE.Vector3(0,0,0).applyMatrix4(e.toAABB),a=this.posdir(t.position.clone().applyMatrix4(e.toAABB),new THREE.Vector3(r.x-o.x,r.y-o.y,r.z-o.z).normalize()),l=s.default.bbox(e.center,e.halfDimensions),u=new THREE.Vector3(new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1)),c=this.posdir(new THREE.Vector3(e.center.x-e.halfDimensions.x,e.center.y-e.halfDimensions.y,e.center.z-e.halfDimensions.z),u.x);this.rayPlaneInBBox(c,a,l,n),c.direction=u.y,this.rayPlaneInBBox(c,a,l,n),c.direction=u.z,this.rayPlaneInBBox(c,a,l,n);var h=this.posdir(new THREE.Vector3(e.center.x+e.halfDimensions.x,e.center.y+e.halfDimensions.y,e.center.z+e.halfDimensions.z),u.x);this.rayPlaneInBBox(h,a,l,n),h.direction=u.y,this.rayPlaneInBBox(h,a,l,n),h.direction=u.z,this.rayPlaneInBBox(h,a,l,n);var f=this.posdir(new THREE.Vector3(e.center.x+e.halfDimensions.x,e.center.y-e.halfDimensions.y,e.center.z-e.halfDimensions.z),u.y);this.rayPlaneInBBox(f,a,l,n),f.direction=u.z,this.rayPlaneInBBox(f,a,l,n);var d=this.posdir(new THREE.Vector3(e.center.x-e.halfDimensions.x,e.center.y+e.halfDimensions.y,e.center.z-e.halfDimensions.z),u.x);this.rayPlaneInBBox(d,a,l,n),d.direction=u.z,this.rayPlaneInBBox(d,a,l,n);var p=this.posdir(new THREE.Vector3(e.center.x-e.halfDimensions.x,e.center.y-e.halfDimensions.y,e.center.z+e.halfDimensions.z),u.x);return this.rayPlaneInBBox(p,a,l,n),p.direction=u.y,this.rayPlaneInBBox(p,a,l,n),n.map(function(e){return e.applyMatrix4(i)}),n}},{key:"rayPlane",value:function(e,t){if(0!==e.direction.dot(t.direction)){var n=(t.direction.x*(t.position.x-e.position.x)+t.direction.y*(t.position.y-e.position.y)+t.direction.z*(t.position.z-e.position.z))/(t.direction.x*e.direction.x+t.direction.y*e.direction.y+t.direction.z*e.direction.z),i=new THREE.Vector3(e.position.x+n*e.direction.x,e.position.y+n*e.direction.y,e.position.z+n*e.direction.z);return i}return null}},{key:"rayBox",value:function(e,t){var n=[],i=s.default.bbox(t.center,t.halfDimensions),r=this.posdir(new THREE.Vector3(i.min.x,t.center.y,t.center.z),new THREE.Vector3(-1,0,0));return this.rayPlaneInBBox(e,r,i,n),r=this.posdir(new THREE.Vector3(i.max.x,t.center.y,t.center.z),new THREE.Vector3(1,0,0)),this.rayPlaneInBBox(e,r,i,n),r=this.posdir(new THREE.Vector3(t.center.x,i.min.y,t.center.z),new THREE.Vector3(0,-1,0)),this.rayPlaneInBBox(e,r,i,n),r=this.posdir(new THREE.Vector3(t.center.x,i.max.y,t.center.z),new THREE.Vector3(0,1,0)),this.rayPlaneInBBox(e,r,i,n),r=this.posdir(new THREE.Vector3(t.center.x,t.center.y,i.min.z),new THREE.Vector3(0,0,-1)),this.rayPlaneInBBox(e,r,i,n),r=this.posdir(new THREE.Vector3(t.center.x,t.center.y,i.max.z),new THREE.Vector3(0,0,1)),this.rayPlaneInBBox(e,r,i,n),n}},{key:"rayPlaneInBBox",value:function(e,t,n,i){var r=this.rayPlane(e,t);r&&this.inBBox(r,n)&&(i.find(this.findIntersection(r))||i.push(r))}},{key:"findIntersection",value:function(e){return function(t,n,i){return e.x===t.x&&e.y===t.y&&e.z===t.z}}},{key:"inBBox",value:function(e,t){var n=1e-4;return!!(e&&e.x>=t.min.x-n&&e.y>=t.min.y-n&&e.z>=t.min.z-n&&e.x<=t.max.x+n&&e.y<=t.max.y+n&&e.z<=t.max.z+n)}},{key:"posdir",value:function(e,t){return{position:e,direction:t}}},{key:"validatePlane",value:function(e){return null===e?(window.console.log("Invalid plane."),window.console.log(e),!1):u.default.vector3(e.position)?!!u.default.vector3(e.direction)||(window.console.log("Invalid plane.direction."),window.console.log(e.direction),!1):(window.console.log("Invalid plane.position."),window.console.log(e.position),!1)}},{key:"validateAabb",value:function(e){return null===e?(window.console.log("Invalid aabb."),window.console.log(e),!1):u.default.matrix4(e.toAABB)?u.default.vector3(e.center)?!!(u.default.vector3(e.halfDimensions)&&e.halfDimensions.x>=0&&e.halfDimensions.y>=0&&e.halfDimensions.z>=0)||(window.console.log("Invalid aabb.halfDimensions."),window.console.log(e.halfDimensions),!1):(window.console.log("Invalid aabb.center."),window.console.log(e.center),!1):(window.console.log("Invalid aabb.toAABB: "),window.console.log(e.toAABB),!1)}}]),e}();n.default=c},{"./core.utils":96,"./core.validators":97}],94:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var r=e("./core.colors"),o=i(r),a=e("./core.intersections"),s=i(a),l=e("./core.pack"),u=(i(l),e("./core.validators")),c=i(u),h=e("./core.utils"),f=i(h);n.default={Colors:o.default,Intersections:s.default,Utils:f.default,Validators:c.default}},{"./core.colors":92,"./core.intersections":93,"./core.pack":95,"./core.utils":96,"./core.validators":97}],95:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function e(){i(this,e)};n.default=r},{}],96:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=e("./core.validators"),s=i(a),l=function(){function e(){r(this,e)}return o(e,null,[{key:"bbox",value:function(e,t){if(!s.default.vector3(e)||!s.default.vector3(t))return window.console.log("Invalid center or plane halfDimensions."),!1;if(!(t.x>=0&&t.y>=0&&t.z>=0))return window.console.log("halfDimensions must be >= 0."),window.console.log(t),!1;var n=e.clone().sub(t),i=e.clone().add(t);return{min:n,max:i}}},{key:"minMaxPixelData",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=[65535,-32768],n=e.length,i=0;i<n;i++){var r=e[i];t[0]=Math.min(t[0],r),t[1]=Math.max(t[1],r)}return t}}]),e}();n.default=l},{"./core.validators":97}],97:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(){i(this,e)}return r(e,null,[{key:"matrix4",value:function(e){return!(null===e||"undefined"==typeof e||!e.hasOwnProperty("elements")||16!==e.elements.length||"function"!=typeof e.identity||"function"!=typeof e.copy||"function"!=typeof e.determinant)}},{key:"vector3",value:function(e){return!(!(null!==e&&"undefined"!=typeof e&&e.hasOwnProperty("x")&&e.hasOwnProperty("y")&&e.hasOwnProperty("z"))||e.hasOwnProperty("w"))}},{key:"box",value:function(e){return!!(null!==e&&"undefined"!=typeof e&&e.hasOwnProperty("center")&&this.vector3(e.center)&&e.hasOwnProperty("halfDimensions")&&this.vector3(e.halfDimensions)&&e.halfDimensions.x>=0&&e.halfDimensions.y>=0&&e.halfDimensions.z>=0)}},{key:"ray",value:function(e){return!!(null!==e&&"undefined"!=typeof e&&e.hasOwnProperty("position")&&this.vector3(e.position)&&e.hasOwnProperty("direction")&&this.vector3(e.direction))}}]),e}();n.default=o},{}],98:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var r=e("./geometries.slice"),o=i(r),a=e("./geometries.voxel"),s=i(a);n.default={Slice:o.default,Voxel:s.default}},{"./geometries.slice":99,"./geometries.voxel":100}],99:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!t||"object"!==("undefined"==typeof t?"undefined":s(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":s(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=e("../../src/core/core.intersections"),c=i(u),h=function(e){function t(e,n,i,a){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new THREE.Matrix4;r(this,t);var l={halfDimensions:e,center:n,toAABB:s},u={position:i,direction:a},h=c.default.aabbPlane(l,u);if(h.length<3)throw window.console.log("WARNING: Less than 3 intersections between AABB and Plane."),window.console.log("AABB"),window.console.log(l),window.console.log("Plane"),window.console.log(u),window.console.log("exiting..."),"geometries.slice has less than 3 intersections, can not create a valid geometry.";var f=t.orderIntersections(h,a),d=t.shape(f),p=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,d));return p.type="SliceGeometry",p.vertices=f,p.verticesNeedUpdate=!0,p}return a(t,e),l(t,null,[{key:"shape",value:function e(t){var e=new THREE.Shape;e.moveTo(t[0].xy.x,t[0].xy.y);for(var n=1;n<t.length;n++)e.lineTo(t[n].xy.x,t[n].xy.y);return e.lineTo(t[0].xy.x,t[0].xy.y),e}},{key:"centerOfMass",value:function e(t){for(var e=new THREE.Vector3(0,0,0),n=0;n<t.length;n++)e.x+=t[n].x,e.y+=t[n].y,e.z+=t[n].z;return e.divideScalar(t.length),e}},{key:"orderIntersections",value:function(e,n){for(var i=t.centerOfMass(e),r=new THREE.Vector3(e[0].x-i.x,e[0].y-i.y,e[0].z-i.z).normalize(),o=new THREE.Vector3(0,0,0).crossVectors(r,n).normalize(),a=[],s=0;s<e.length;s++){var l=new THREE.Vector3(e[s].x,e[s].y,e[s].z);l.direction=new THREE.Vector3(e[s].x-i.x,e[s].y-i.y,e[s].z-i.z).normalize();var u=r.dot(l.direction),c=o.dot(l.direction);l.xy={x:u,y:c};var h=Math.atan2(c,u)*(180/Math.PI);l.angle=h,a.push(l)}return a.sort(function(e,t){return e.angle-t.angle}),a}}]),t}(THREE.ShapeGeometry);n.default=h},{"../../src/core/core.intersections":93}],100:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),l=function(e){function t(e){i(this,t);var n=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,1,1,1));return n._location=e,n.applyMatrix((new THREE.Matrix4).makeTranslation(n._location.x,n._location.y,n._location.z)),n.verticesNeedUpdate=!0,n}return o(t,e),s(t,[{key:"resetVertices",value:function(){this.vertices[0].set(.5,.5,.5),this.vertices[1].set(.5,.5,-.5),this.vertices[2].set(.5,-.5,.5),this.vertices[3].set(.5,-.5,-.5),this.vertices[4].set(-.5,.5,-.5),this.vertices[5].set(-.5,.5,.5),this.vertices[6].set(-.5,-.5,-.5),this.vertices[7].set(-.5,-.5,.5)}},{key:"location",set:function(e){this._location=e,this.vertices[0].set(.5,.5,.5),this.vertices[1].set(.5,.5,-.5),this.vertices[2].set(.5,-.5,.5),this.vertices[3].set(.5,-.5,-.5),this.vertices[4].set(-.5,.5,-.5),this.vertices[5].set(-.5,.5,.5),this.vertices[6].set(-.5,-.5,-.5),this.vertices[7].set(-.5,-.5,.5),this.applyMatrix((new THREE.Matrix4).makeTranslation(this._location.x,this._location.y,this._location.z)),this.verticesNeedUpdate=!0},get:function(){return this._location}}]),t}(THREE.BoxGeometry);n.default=l},{}],101:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),l=function(e){function t(e){i(this,t);var n=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n._helpersSlice=e,n._visible=!0,n._color=16711680,n._material=null,n._geometry=null,n._mesh=null,n._create(),n}return o(t,e),s(t,[{key:"_create",value:function(){if(this._material||(this._material=new THREE.LineBasicMaterial({color:this._color,linewidth:1})),this._helpersSlice.geometry.vertices){this._geometry=new THREE.Geometry;for(var e=0;e<this._helpersSlice.geometry.vertices.length;e++)this._geometry.vertices.push(this._helpersSlice.geometry.vertices[e]);this._geometry.vertices.push(this._helpersSlice.geometry.vertices[0]),this._mesh=new THREE.Line(this._geometry,this._material),"IJK"===this._helpersSlice.aabbSpace&&this._mesh.applyMatrix(this._helpersSlice.stack.ijk2LPS),this._mesh.visible=this._visible,this.add(this._mesh)}}},{key:"_update",value:function(){this._mesh&&(this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh=null),this._create()}},{key:"helpersSlice",set:function(e){this._helpersSlice=e,this._update()},get:function(){return this._helpersSlice}},{key:"visible",set:function(e){this._visible=e,this._mesh&&(this._mesh.visible=this._visible)},get:function(){return this._visible}},{key:"color",set:function(e){this._color=e,this._material&&this._material.color.set(this._color)},get:function(){return this._color}}]),t}(THREE.Object3D);n.default=l},{}],102:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),l=function(e){function t(e){i(this,t);var n=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n._stack=e,n._visible=!0,n._color=16777215,n._material=null,n._geometry=null,n._mesh=null,n._create(),n}return o(t,e),s(t,[{key:"_create",value:function(){var e=this._stack.dimensionsIJK,t=this._stack.halfDimensionsIJK,n=new THREE.Vector3(-.5,-.5,-.5);this._geometry=new THREE.BoxGeometry(e.x,e.y,e.z),this._geometry.applyMatrix((new THREE.Matrix4).makeTranslation(t.x+n.x,t.y+n.y,t.z+n.z));var i=new THREE.Mesh(this._geometry,new THREE.MeshBasicMaterial(16711680));this._mesh=new THREE.BoxHelper(i,this._color),this._material=this._mesh.material,this._mesh.applyMatrix(this._stack.ijk2LPS),this._mesh.visible=this._visible,this.add(this._mesh)}},{key:"_update",value:function(){this._mesh&&(this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.geometry=null,this._mesh.material.dispose(),this._mesh.material=null,this._mesh=null),this._create()}},{key:"visible",set:function(e){this._visible=e,this._mesh&&(this._mesh.visible=this._visible)},get:function(){return this._visible}},{key:"color",set:function(e){this._color=e,this._material&&this._material.color.set(this._color)},get:function(){return this._color}}]),t}(THREE.Object3D);n.default=l},{}],103:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var r=e("./helpers.border"),o=i(r),a=e("./helpers.boundingbox"),s=i(a),l=e("./helpers.lut"),u=i(l),c=e("./helpers.progressbar"),h=i(c),f=e("./helpers.slice"),d=i(f),p=e("./helpers.stack"),m=i(p),_=e("./helpers.volumerendering"),g=i(_),y=e("./helpers.voxel"),v=i(y),b=e("./x/helpers.x"),w=i(b);n.default={Border:o.default,BoundingBox:s.default,Lut:u.default,ProgressBar:h.default,Slice:d.default,Stack:m.default,VolumeRendering:g.default,Voxel:v.default,X:w.default}},{"./helpers.border":101,"./helpers.boundingbox":102,"./helpers.lut":104,"./helpers.progressbar":106,"./helpers.slice":107,"./helpers.stack":108,"./helpers.volumerendering":109,"./helpers.voxel":110,"./x/helpers.x":112}],104:[function(e,t,n){"use strict";function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"linear",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[[0,0,0,0],[1,1,1,1]],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[[0,0],[1,1]],l=arguments.length>5&&void 0!==arguments[5]&&arguments[5];r(this,e),this._containerID=t,this._discrete=l,this._color=a,this._lut=n,this._luts=i({},n,a),this._opacity=s,this._lutO=o,this._lutsO=i({},o,s),this.initCanvas(),this.paintCanvas()}return o(e,[{key:"initCanvas",value:function(){this._canvasContainer=this.initCanvasContainer(this._containerID),this._canvasBg=this.createCanvas(),this._canvasContainer.appendChild(this._canvasBg),this._canvas=this.createCanvas(),this._canvasContainer.appendChild(this._canvas)}},{key:"initCanvasContainer",value:function(e){var t=document.getElementById(e);return t.style.width="256 px",t.style.height="128 px",t.style.border="1px solid #F9F9F9",t}},{key:"createCanvas",value:function(){var e=document.createElement("canvas");return e.height=16,e.width=256,e}},{key:"paintCanvas",value:function(){var e=this._canvas.getContext("2d");if(e.clearRect(0,0,this._canvas.width,this._canvas.height),e.globalCompositeOperation="source-over",this._discrete){e.lineWidth=2*this._canvas.height;for(var t=0;t<this._color.length;t++){var n=this._color[t][0],i=1;t<this._color.length-1&&(i=this._color[t+1][0]);var r=0;t>0&&(r=this._color[t-1][0]);var o=r+(n-r)/2,a=n+(i-n)/2,s=this._color[t],l=this._opacity[t]?this._opacity[t][1]:1;e.beginPath(),e.strokeStyle="rgba( "+Math.round(255*s[1])+", "+Math.round(255*s[2])+", "+Math.round(255*s[3])+", "+l+")",e.moveTo(o*this._canvas.width,0),e.lineTo(a*this._canvas.width,0),e.stroke(),e.closePath()}}else{for(var u=e.createLinearGradient(0,0,this._canvas.width,this._canvas.height),c=0;c<this._color.length;c++)u.addColorStop(this._color[c][0],"rgba( "+Math.round(255*this._color[c][1])+", "+Math.round(255*this._color[c][2])+", "+Math.round(255*this._color[c][3])+", 1)");e.fillStyle=u,e.fillRect(0,0,this._canvas.width,this._canvas.height)}if(!this._discrete){e.globalCompositeOperation="destination-in";for(var h=e.createLinearGradient(0,0,this._canvas.width,this._canvas.height),f=0;f<this._opacity.length;f++)h.addColorStop(this._opacity[f][0],"rgba(255, 255, 255, "+this._opacity[f][1]+")");e.fillStyle=h,e.fillRect(0,0,this._canvas.width,this._canvas.height)}}},{key:"lutsAvailable",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"color",t=[],n=this._luts;"color"!==e&&(n=this._lutsO);for(var i in n)t.push(i);return t}},{key:"texture",get:function(){var e=new THREE.Texture(this._canvas);return e.mapping=THREE.UVMapping,e.wrapS=e.wrapT=THREE.ClampToEdgeWrapping,e.magFilter=e.minFilter=THREE.NearestFilter,e.premultiplyAlpha=!0,e.needsUpdate=!0,e}},{key:"lut",set:function(e){this._color=this._luts[e],this._lut=e,this.paintCanvas()},get:function(){return this._lut}},{key:"luts",set:function(e){this._luts=e},get:function(){return this._luts}},{key:"lutO",set:function(e){this._opacity=this._lutsO[e],this._lutO=e,this.paintCanvas()},get:function(){return this._lutO}},{key:"lutsO",set:function(e){this._lutsO=e},get:function(){return this._lutsO}},{key:"discrete",set:function(e){this._discrete=e,this.paintCanvas()},get:function(){return this._discrete}}],[{key:"presetLuts",value:function(){return{default:[[0,0,0,0],[1,1,1,1]],spectrum:[[0,0,0,0],[.1,0,0,1],[.33,0,1,1],[.5,0,1,0],[.66,1,1,0],[.9,1,0,0],[1,1,1,1]],hot_and_cold:[[0,0,0,1],[.15,0,1,1],[.3,0,1,0],[.45,0,0,0],[.5,0,0,0],[.55,0,0,0],[.7,1,1,0],[.85,1,0,0],[1,1,1,1]],gold:[[0,0,0,0],[.13,.19,.03,0],[.25,.39,.12,0],[.38,.59,.26,0],[.5,.8,.46,.08],[.63,.99,.71,.21],[.75,.99,.88,.34],[.88,.99,.99,.48],[1,.9,.95,.61]],red:[[0,.75,0,0],[.5,1,.5,0],[.95,1,1,0],[1,1,1,1]],green:[[0,0,.75,0],[.5,.5,1,0],[.95,1,1,0],[1,1,1,1]],blue:[[0,0,0,1],[.5,0,.5,1],[.95,0,1,1],[1,1,1,1]],walking_dead:[[0,.1,1,1],[1,1,1,1]],random:[[0,0,0,0],[.27,.18,.18,.18],[.41,1,1,1],[.7,1,0,0],[1,1,1,1]]}}},{key:"presetLutsO",value:function(){return{linear:[[0,0],[1,1]],lowpass:[[0,.8],[.2,.6],[.3,.1],[1,0]],bandpass:[[0,0],[.4,.8],[.6,.8],[1,0]],highpass:[[0,0],[.7,.1],[.8,.6],[1,.8]],flat:[[0,.7],[1,1]],random:[[0,0],[.38,0],[.55,1],[.72,1],[1,.05]]}}}]),e}();n.default=a},{}],105:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),l=function(e){return function(e){function t(){return i(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),s(t,[{key:"_createMaterial",value:function(e){var t=new this._shadersFragment(this._uniforms),n=new this._shadersVertex,i={uniforms:this._uniforms,vertexShader:n.compute(),fragmentShader:t.compute()},r=Object.assign(e,i);this._material=new THREE.ShaderMaterial(r),this._material.needsUpdate=!0}},{key:"_updateMaterial",value:function(){var e=new this._shadersFragment(this._uniforms),t=new this._shadersVertex;this._material.vertexShader=t.compute(),this._material.fragmentShader=e.compute(),this._material.needsUpdate=!0}},{key:"_prepareTexture",value:function(){this._textures=[];for(var e=0;e<this._stack._rawData.length;e++){var t=new THREE.DataTexture(this._stack.rawData[e],this._stack.textureSize,this._stack.textureSize,this._stack.textureType,THREE.UnsignedByteType,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.NearestFilter,THREE.NearestFilter);t.needsUpdate=!0,t.flipY=!0,this._textures.push(t)}}}]),t}(e)};n.default=l},{}],106:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(t){i(this,e),this._container=t,this._modes={load:{name:"load",color:"#FFF56F"},parse:{name:"parse",color:"#2196F3"}},this.requestAnimationFrameID=null,this._mode=null,this._value=null,this._total=null,this.init()}return r(e,[{key:"free",value:function(){var e=this._container.getElementsByClassName("progress container");e.length>0&&e[0].parentNode.removeChild(e[0]),e=null,window.cancelAnimationFrame(this.requestAnimationFrameID)}},{key:"init",value:function(){var e=this._domContainer();for(var t in this._modes)if(this._modes.hasOwnProperty(t)){var n=this._domBar(this._modes[t]);e.appendChild(n),n=null}this._container.appendChild(e),e=null,this.updateUI()}},{key:"update",value:function(e,t,n){this._mode=n,this._value=e,0===t?(this._total=e,this._value=Math.random()*e):this._total=t}},{key:"updateUI",value:function(){var e=this;if(this.requestAnimationFrameID=requestAnimationFrame(function(){e.updateUI()}),!(this._modes.hasOwnProperty(this._mode)&&this._modes[this._mode].hasOwnProperty("name")&&this._modes[this._mode].hasOwnProperty("color")))return!1;var t=Math.round(this._value/this._total*100),n=this._modes[this._mode].color,i=this._container.getElementsByClassName("progress "+this._modes[this._mode].name);i.length>0&&(i[0].style.borderColor=n,i[0].style.width=t+"%"),i=null}},{key:"_domContainer",value:function(){var e=document.createElement("div");return e.classList.add("progress"),e.classList.add("container"),e.style.width="100%",e.style.height="8px",e.style.position="absolute",e.style.backgroundColor="rgba(158, 158, 158, 0.5)",e.style.top="0",e.style.zIndex="1",e}},{key:"_domBar",value:function(e){if(!e.hasOwnProperty("name")||!e.hasOwnProperty("color"))return window.console.log("Invalid mode provided."),window.console.log(e),!1;var t=document.createElement("div");return t.classList.add(e.name),t.classList.add("progress"),t.style.border="2px solid "+e.color,t.style.width="0%",t}}]),e}();n.default=o},{}],107:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":s(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":s(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=e("../../src/geometries/geometries.slice"),c=i(u),h=e("../../src/shaders/shaders.data.uniform"),f=i(h),d=e("../../src/shaders/shaders.data.vertex"),p=i(d),m=e("../../src/shaders/shaders.data.fragment"),_=i(m),g=e("../../src/helpers/helpers.material.mixin"),y=i(g),v=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new THREE.Vector3(0,0,0),a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new THREE.Vector3(0,0,1),s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"IJK";r(this,t);var l=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return l._stack=e,l._invert=l._stack.invert,l._lut="none",l._lutTexture=null,l._intensityAuto=!0,l._interpolation=1,l._index=n,l._windowWidth=null,l._windowCenter=null,l._rescaleSlope=null,l._rescaleIntercept=null,l._planePosition=i,l._planeDirection=a,l._aaBBspace=s,l._material=null,l._textures=[],l._shadersFragment=_.default,l._shadersVertex=p.default,l._uniforms=f.default.uniforms(),l._geometry=null,l._mesh=null,l._visible=!0,l._init(),l._create(),l}return a(t,e),l(t,[{key:"_init",value:function(){if(this._stack&&this._stack._prepared&&this._stack._packed)if("IJK"===this._aaBBspace)this._halfDimensions=this._stack.halfDimensionsIJK,this._center=new THREE.Vector3(this._stack.halfDimensionsIJK.x-.5,this._stack.halfDimensionsIJK.y-.5,this._stack.halfDimensionsIJK.z-.5),this._toAABB=new THREE.Matrix4;else{var e=this._stack.AABBox();this._halfDimensions=e.clone().multiplyScalar(.5),this._center=this._stack.centerAABBox(),this._toAABB=this._stack.lps2AABB}}},{key:"_create",value:function(){if(this._stack&&this._stack.prepared&&this._stack.packed){try{this._geometry=new c.default(this._halfDimensions,this._center,this._planePosition,this._planeDirection,this._toAABB)}catch(e){return window.console.log(e),void window.console.log("invalid slice geometry - exiting...")}this._geometry.vertices&&(this._material||(this._uniforms.uTextureSize.value=this._stack.textureSize,this._uniforms.uDataDimensions.value=[this._stack.dimensionsIJK.x,this._stack.dimensionsIJK.y,this._stack.dimensionsIJK.z],this._uniforms.uWorldToData.value=this._stack.lps2IJK,this._uniforms.uNumberOfChannels.value=this._stack.numberOfChannels,this._uniforms.uPixelType.value=this._stack.pixelType,this._uniforms.uBitsAllocated.value=this._stack.bitsAllocated,this._uniforms.uPackedPerPixel.value=this._stack.packedPerPixel,this._prepareTexture(),this._uniforms.uTextureContainer.value=this._textures,this._createMaterial({side:THREE.DoubleSide})),this.updateIntensitySettings(),this.updateIntensitySettingsUniforms(),this._mesh=new THREE.Mesh(this._geometry,this._material),"IJK"===this._aaBBspace&&this._mesh.applyMatrix(this._stack.ijk2LPS),this._mesh.visible=this._visible,this.add(this._mesh))}}},{key:"updateIntensitySettings",value:function(){this._intensityAuto?(this.updateIntensitySetting("windowCenter"),this.updateIntensitySetting("windowWidth"),this.updateIntensitySetting("rescaleSlope"),this.updateIntensitySetting("rescaleIntercept")):(null===this._windowCenter&&(this._windowCenter=this._stack.windowCenter),null===this.__windowWidth&&(this._windowWidth=this._stack.windowWidth),null===this._rescaleSlope&&(this._rescaleSlope=this._stack.rescaleSlope),null===this._rescaleIntercept&&(this._rescaleIntercept=this._stack.rescaleIntercept))}},{key:"updateIntensitySettingsUniforms",value:function(){var e=0;this._stack._minMax[0]<0&&(e-=this._stack._minMax[0]),this._uniforms.uRescaleSlopeIntercept.value=[this._rescaleSlope,this._rescaleIntercept],this._uniforms.uWindowCenterWidth.value=[e+this._windowCenter,this._windowWidth],this._uniforms.uInvert.value=this._invert===!0?1:0,this._uniforms.uInterpolation.value=this._interpolation,"none"===this._lut?this._uniforms.uLut.value=0:(this._uniforms.uLut.value=1,this._uniforms.uTextureLUT.value=this._lutTexture)}},{key:"updateIntensitySetting",value:function(e){this._stack.frame[this._index]&&this._stack.frame[this._index][e]?this["_"+e]=this._stack.frame[this._index][e]:this["_"+e]=this._stack[e]}},{key:"_update",value:function(){this._mesh&&(this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.geometry=null,this._mesh=null),this._create()}},{key:"stack",get:function(){return this._stack},set:function(e){this._stack=e}},{key:"windowWidth",get:function(){return this._windowWidth},set:function(e){this._windowWidth=e,this.updateIntensitySettingsUniforms()}},{key:"windowCenter",get:function(){return this._windowCenter},set:function(e){this._windowCenter=e,this.updateIntensitySettingsUniforms()}},{key:"rescaleSlope",get:function(){return this._rescaleSlope},set:function(e){this._rescaleSlope=e,this.updateIntensitySettingsUniforms()}},{key:"rescaleIntercept",get:function(){return this._rescaleIntercept},set:function(e){this._rescaleIntercept=e,this.updateIntensitySettingsUniforms()}},{key:"invert",get:function(){return this._invert},set:function(e){this._invert=e,this.updateIntensitySettingsUniforms()}},{key:"lut",get:function(){return this._lut},set:function(e){this._lut=e}},{key:"lutTexture",get:function(){return this._lutTexture},set:function(e){this._lutTexture=e,this.updateIntensitySettingsUniforms()}},{key:"intensityAuto",get:function(){return this._intensityAuto},set:function(e){this._intensityAuto=e,this.updateIntensitySettings(),this.updateIntensitySettingsUniforms()}},{key:"interpolation",get:function(){return this._interpolation},set:function(e){this._interpolation=e,this.updateIntensitySettingsUniforms(),this._updateMaterial()}},{key:"index",get:function(){return this._index},set:function(e){this._index=e,this._update()}},{key:"planePosition",set:function(e){this._planePosition=e,this._update()},get:function(){return this._planePosition}},{key:"planeDirection",set:function(e){this._planeDirection=e,this._update()},get:function(){return this._planeDirection}},{key:"halfDimensions",set:function(e){this._halfDimensions=e},get:function(){return this._halfDimensions}},{key:"center",set:function(e){this._center=e},get:function(){return this._center}},{key:"aabbSpace",set:function(e){this._aaBBspace=e,this._init()},get:function(){return this._aaBBspace}},{key:"mesh",set:function(e){this._mesh=e},get:function(){return this._mesh}},{key:"geometry",set:function(e){this._geometry=e},get:function(){return this._geometry}}]),t}((0,y.default)(THREE.Object3D));n.default=v},{"../../src/geometries/geometries.slice":99,"../../src/helpers/helpers.material.mixin":105,"../../src/shaders/shaders.data.fragment":138,"../../src/shaders/shaders.data.uniform":139,"../../src/shaders/shaders.data.vertex":140}],108:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":s(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":s(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=e("../../src/helpers/helpers.border"),c=i(u),h=e("../../src/helpers/helpers.boundingbox"),f=i(h),d=e("../../src/helpers/helpers.slice"),p=i(d),m=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n._stack=e,n._bBox=null,n._slice=null,n._border=null,n._dummy=null,n._orientation=0,n._index=0,n._uniforms=null,n._autoWindowLevel=!1,n._outOfBounds=!1,n._orientationMaxIndex=0,n._create(),n}return a(t,e),l(t,[{key:"_create",value:function(){this._stack?(this._prepareStack(),this._prepareBBox(),this._prepareSlice(),this._prepareBorder()):window.console.log("no stack to be prepared...")}},{key:"_computeOrientationMaxIndex",value:function(){var e=this._stack.dimensionsIJK;switch(this._orientationMaxIndex=0,this._orientation){case 0:this._orientationMaxIndex=e.z-1;break;case 1:this._orientationMaxIndex=e.x-1;break;case 2:this._orientationMaxIndex=e.y-1}}},{key:"_isIndexOutOfBounds",value:function(){this._computeOrientationMaxIndex(),this._index>=this._orientationMaxIndex||this._index<0?this._outOfBounds=!0:this._outOfBounds=!1}},{key:"_prepareStack",value:function(){this._stack.prepared||this._stack.prepare(),this._stack.packed||this._stack.pack()}},{key:"_prepareBBox",value:function(){this._bBox=new f.default(this._stack),this.add(this._bBox)}},{key:"_prepareBorder",value:function(){this._border=new c.default(this._slice),this.add(this._border)}},{key:"_prepareSlice",value:function(){var e=this._stack.halfDimensionsIJK;this._index=this._prepareSliceIndex(e);var t=this._prepareSlicePosition(e,this._index),n=this._prepareDirection(this._orientation);this._slice=new p.default(this._stack,this._index,t,n),this.add(this._slice)}},{key:"_prepareSliceIndex",value:function(e){var t=0;switch(this._orientation){case 0:t=Math.floor(e.z);break;case 1:t=Math.floor(e.x);break;case 2:t=Math.floor(e.y)}return t}},{key:"_prepareSlicePosition",value:function(e,t){var n=new THREE.Vector3(0,0,0);switch(this._orientation){case 0:n=new THREE.Vector3(Math.floor(e.x),Math.floor(e.y),t);break;case 1:n=new THREE.Vector3(t,Math.floor(e.y),Math.floor(e.z));break;case 2:n=new THREE.Vector3(Math.floor(e.x),t,Math.floor(e.z))}return n}},{key:"_prepareDirection",value:function(e){var t=new THREE.Vector3(0,0,1);switch(e){case 0:t=new THREE.Vector3(0,0,1);break;case 1:t=new THREE.Vector3(1,0,0);break;case 2:t=new THREE.Vector3(0,1,0)}return t}},{key:"stack",get:function(){return this._stack}},{key:"bbox",get:function(){return this._bBox}},{key:"slice",get:function(){return this._slice}},{key:"border",get:function(){return this._border}},{key:"index",get:function(){return this._index},set:function(e){
this._index=e,this._slice.index=e;var t=this._stack.halfDimensionsIJK;this._slice.planePosition=this._prepareSlicePosition(t,this._index),this._border.helpersSlice=this._slice,this._isIndexOutOfBounds()}},{key:"orientation",set:function(e){this._orientation=e,this._computeOrientationMaxIndex(),this._slice.planeDirection=this._prepareDirection(this._orientation),this._border.helpersSlice=this._slice},get:function(){return this._orientation}},{key:"outOfBounds",set:function(e){this._outOfBounds=e},get:function(){return this._outOfBounds}},{key:"orientationMaxIndex",set:function(e){this._orientationMaxIndex=e},get:function(){return this._orientationMaxIndex}}]),t}(THREE.Object3D);n.default=m},{"../../src/helpers/helpers.border":101,"../../src/helpers/helpers.boundingbox":102,"../../src/helpers/helpers.slice":107}],109:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":s(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":s(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=e("../../src/shaders/shaders.vr.uniform"),c=i(u),h=e("../../src/shaders/shaders.vr.vertex"),f=i(h),d=e("../../src/shaders/shaders.vr.fragment"),p=i(d),m=e("../../src/helpers/helpers.material.mixin"),_=i(m),g=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n._stack=e,n._textures=[],n._shadersFragment=p.default,n._shadersVertex=f.default,n._uniforms=c.default.uniforms(),n._material=null,n._geometry=null,n._interpolation=1,n._create(),n}return a(t,e),l(t,[{key:"_create",value:function(){this._prepareStack(),this._prepareTexture(),this._prepareMaterial(),this._prepareGeometry(),this._mesh=new THREE.Mesh(this._geometry,this._material),this.add(this._mesh)}},{key:"_prepareStack",value:function(){this._stack.prepared||this._stack.prepare(),this._stack.packed||this._stack.pack()}},{key:"_prepareMaterial",value:function(){var e=0;this._stack._minMax[0]<0&&(e=this._stack._minMax[0]),this._uniforms=c.default.uniforms(),this._uniforms.uWorldBBox.value=this._stack.worldBoundingBox(),this._uniforms.uTextureSize.value=this._stack.textureSize,this._uniforms.uTextureContainer.value=this._textures,this._uniforms.uWorldToData.value=this._stack.lps2IJK,this._uniforms.uNumberOfChannels.value=this._stack.numberOfChannels,this._uniforms.uPixelType.value=this._stack.pixelType,this._uniforms.uBitsAllocated.value=this._stack.bitsAllocated,this._uniforms.uPackedPerPixel.value=this._stack.packedPerPixel,this._uniforms.uWindowCenterWidth.value=[e+this._stack.windowCenter,.8*this._stack.windowWidth],this._uniforms.uRescaleSlopeIntercept.value=[this._stack.rescaleSlope,this._stack.rescaleIntercept],this._uniforms.uDataDimensions.value=[this._stack.dimensionsIJK.x,this._stack.dimensionsIJK.y,this._stack.dimensionsIJK.z],this._uniforms.uInterpolation.value=this._interpolation,this._createMaterial({side:THREE.FrontSide,transparent:!0})}},{key:"_prepareGeometry",value:function(){var e=this._stack.worldBoundingBox(),t=this._stack.worldCenter();this._geometry=new THREE.BoxGeometry(e[1]-e[0],e[3]-e[2],e[5]-e[4]),this._geometry.applyMatrix((new THREE.Matrix4).makeTranslation(t.x,t.y,t.z))}},{key:"uniforms",get:function(){return this._uniforms},set:function(e){this._uniforms=e}},{key:"stack",get:function(){return this._stack},set:function(e){this._stack=e}},{key:"interpolation",get:function(){return this._interpolation},set:function(e){this._interpolation=e,this._uniforms.uInterpolation.value=this._interpolation,this._updateMaterial()}}]),t}((0,_.default)(THREE.Object3D));n.default=g},{"../../src/helpers/helpers.material.mixin":105,"../../src/shaders/shaders.vr.fragment":145,"../../src/shaders/shaders.vr.uniform":146,"../../src/shaders/shaders.vr.vertex":147}],110:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":s(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":s(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=e("../../src/geometries/geometries.voxel"),c=i(u),h=e("../../src/models/models.stack"),f=i(h),d=e("../../src/models/models.voxel"),p=i(d),m=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;r(this,t);var i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i._stack=n,i._worldCoordinates=e,i._voxel=new p.default,i._voxel.id=i.id,i._voxel.worldCoordinates=i._worldCoordinates,i._stack&&i._stack.prepared&&i._worldCoordinates&&i.updateVoxel(i._worldCoordinates),i._mesh=null,i._geometry=null,i._material=null,i._selected=!1,i._active=!1,i._hover=!1,i._distance=null,i._showVoxel=!0,i._showDomSVG=!0,i._showDomMeasurements=!0,i._color="#00B0FF",i._svgPointer='<svg width="40" height="40"                       viewBox="0 0 140 140" version="1.1"                       xmlns="http://www.w3.org/2000/svg">                                             <path d="M70,70                                L30,30                                A10,10 0 1 1 10,10                               A10,10 0 1 1 30,30" />                                            </svg>',i.createMesh(),i}return a(t,e),l(t,[{key:"updateVoxel",value:function(e){this._voxel.worldCoordinates=e,this._voxel.dataCoordinates=f.default.worldToData(this._stack,this._voxel.worldCoordinates);var t=f.default.value(this._stack,this._voxel.dataCoordinates);this._voxel.value=f.default.valueRescaleSlopeIntercept(t,this._stack.rescaleSlope,this._stack.rescaleIntercept)}},{key:"updateVoxelScreenCoordinates",value:function(e,n){this._voxel.screenCoordinates=t.worldToScreen(this._worldCoordinates,e,n)}},{key:"createMesh",value:function(){var e=f.default.worldToData(this._stack,this._worldCoordinates);this._geometry=new c.default(e),this._material=new THREE.MeshBasicMaterial({wireframe:!0,wireframeLinewidth:2}),this._material.color.set(this._color),this._mesh=new THREE.Mesh(this._geometry,this._material),this._mesh.applyMatrix(this._stack.ijk2LPS),this._mesh.visible=this._showVoxel,this.add(this._mesh)}},{key:"createDom",value:function(){var e=this._createDiv("VJSVoxelMeasurements",this.id,"VJSVoxelMeasurements"),t=this._createDiv("VJSVoxelProbeWorld",this.id,"VJSVoxelProbeWorld");e.appendChild(t);var n=this._createDiv("VJSVoxelProbeData",this.id,"VJSVoxelProbeData");e.appendChild(n);var i=this._createDiv("VJSVoxelProbeValue",this.id,"VJSVoxelProbeValue");e.appendChild(i);var r=this._createDiv("VJSVoxelProbeSVG",this.id,"VJSVoxelProbeSVG");r.innerHTML=this._svgPointer;var o=this._createDiv("VJSWidgetVoxelProbe",this.id,"VJSWidgetVoxelProbe");return o.appendChild(r),o.appendChild(e),o}},{key:"updateDom",value:function(e){null===document.getElementById("VJSVoxelProbeWorld"+this.id)&&e.appendChild(this.createDom());var t=document.getElementById("VJSVoxelProbeWorld"+this.id),n=this._voxel.worldCoordinates.x.toFixed(2)+" : "+this._voxel.worldCoordinates.y.toFixed(2)+" : "+this._voxel.worldCoordinates.z.toFixed(2);t.innerHTML="LPS: "+n;var i=document.getElementById("VJSVoxelProbeData"+this.id),r=this._voxel.dataCoordinates.x+" : "+this._voxel.dataCoordinates.y+" : "+this._voxel.dataCoordinates.z;i.innerHTML="IJK: "+r;var o=document.getElementById("VJSVoxelProbeValue"+this.id),a=this._voxel.value;o.innerHTML="Value: "+a;var s=document.getElementById("VJSWidgetVoxelProbe"+this.id);s.style.top=this._voxel.screenCoordinates.y,s.style.left=this._voxel.screenCoordinates.x,this.updateDomClass(s)}},{key:"updateDomClass",value:function(){var e=document.getElementById("VJSWidgetVoxelProbe"+this.id);this._active===!0?e.classList.add("VJSVoxelProbeActive"):e.classList.remove("VJSVoxelProbeActive"),this._hover===!0?e.classList.add("VJSVoxelProbeHover"):e.classList.remove("VJSVoxelProbeHover"),this._selected===!0?e.classList.add("VJSVoxelProbeSelect"):e.classList.remove("VJSVoxelProbeSelect"),this.updateDomElementDisplay("VJSVoxelMeasurements"+this.id,this._showDomMeasurements),this.updateDomElementDisplay("VJSVoxelProbeSVG"+this.id,this._showDomSVG)}},{key:"updateDomElementDisplay",value:function(e,t){t?document.getElementById(e).style.display="block":document.getElementById(e).style.display="none"}},{key:"removeTest",value:function(){var e=document.getElementById("VJSWidgetVoxelProbe"+this.id);e.parentNode&&e.parentNode.removeChild(e),this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.material.dispose(),this._mesh=null}},{key:"_createDiv",value:function(e,t,n){var i=document.createElement("div");return i.setAttribute("id",e+t),i.setAttribute("class",n),i}},{key:"color",set:function(e){this._color=e,this._material&&this._material.color.set(this._color);var t=document.getElementById("VJSVoxelMeasurements"+this.id);t&&(t.style.borderColor=this._color.replace("0x","#")),t=document.querySelector("#VJSVoxelProbeSVG"+this.id+"> svg > path"),t&&(t.style.stroke=this._color.replace("0x","#"))},get:function(){return this._color}},{key:"worldCoordinates",set:function(e){this._worldCoordinates=e,this._voxel._worldCoordinates=e,this.updateVoxel(this._worldCoordinates),this._mesh&&this._mesh.geometry&&(this._mesh.geometry.location=this._voxel.dataCoordinates)},get:function(){return this._worldCoordinates}},{key:"voxel",get:function(){return this._voxel},set:function(e){this._voxel=e}},{key:"showVoxel",set:function(e){this._showVoxel=e,this._mesh&&(this._mesh.visible=this._showVoxel)},get:function(){return this._showVoxel}},{key:"showDomSVG",set:function(e){this._showDomSVG=e,this.updateDomClass()},get:function(){return this._showDomSVG}},{key:"showDomMeasurements",set:function(e){this._showDomMeasurements=e,this.updateDomClass()},get:function(){return this._showDomMeasurements}},{key:"distance",set:function(e){this._distance=e},get:function(){return this._distance}},{key:"selected",set:function(e){this._selected=e},get:function(){return this._selected}},{key:"hover",set:function(e){this._hover=e},get:function(){return this._hover}},{key:"active",set:function(e){this._active=e},get:function(){return this._active}}],[{key:"worldToScreen",value:function(e,t,n){var i=e.clone();return i.project(t),i.x=Math.round((i.x+1)*n.offsetWidth/2),i.y=Math.round((-i.y+1)*n.offsetHeight/2),i.z=0,i}}]),t}(THREE.Object3D);n.default=m},{"../../src/geometries/geometries.voxel":100,"../../src/models/models.stack":124,"../../src/models/models.voxel":125}],111:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(){i(this,e)}return r(e,[{key:"_create",value:function(){}},{key:"_update",value:function(){}}]),e}();n.default=o},{}],112:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var r=e("./helpers.x.interactor"),o=i(r),a=e("./helpers.x.mesh"),s=i(a),l=e("./helpers.x.renderer3d"),u=i(l),c=e("./helpers.x.renderer2d"),h=i(c),f=e("./helpers.x.volume"),d=i(f);n.default={Interactor:o.default,Mesh:s.default,Renderer3D:u.default,Renderer2D:h.default,Volume:d.default}},{"./helpers.x.interactor":111,"./helpers.x.mesh":113,"./helpers.x.renderer2d":114,"./helpers.x.renderer3d":115,"./helpers.x.volume":116}],113:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(){i(this,e),this._file=null,this._3jsVTK_loader=new THREE.VTKLoader,this._mesh=null,this._materialColor=15277667,this._RAStoLPS=null,this._material=new THREE.MeshLambertMaterial({shading:THREE.SmoothShading,color:this._materialColor,side:THREE.DoubleSide})}return r(e,[{key:"load",value:function(){var e=this;return this.file?new Promise(function(t,n){e._3jsVTK_loader.load(e.file,function(n){n.computeVertexNormals(),e._mesh=new THREE.Mesh(n,e._material),e._RAStoLPS=new THREE.Matrix4,e._RAStoLPS.set(-1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1),e._mesh.applyMatrix(e._RAStoLPS),t(e._mesh)},function(){},function(t){console.log(t),n({message:"Couldn't load file: "+e.file+".",error:t})})}):Promise.reject({message:"File is not defined: "+this.file+"."})}},{key:"file",get:function(){return this._file},set:function(e){this._file=e}},{key:"materialColor",get:function(){return this._materialColor},set:function(e){this._materialColor=e}}]),e}();n.default=o},{}],114:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=e("../../cameras/cameras.orthographic"),s=i(a),l=e("../../controls/controls.trackballortho"),u=i(l),c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"r2d",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";r(this,e),this._container=null,this._renderer=null,this._camera=null,this._controls=null,this._orientation=n,this._scene=null,this._object=null,this._initRenderer(t),this._initCamera(),this._initScene(),this._initControls(),this._onScroll=this._onScroll.bind(this),this._onWindowResize=this._onWindowResize.bind(this),this.addEventListeners()}return o(e,[{key:"add",value:function(e){this._object=e,this._scene.add(this._object),this._setupCamera(this._object.stack),this._orientCamera(this._object,this._orientation)}},{key:"addEventListeners",value:function(){this._controls.addEventListener("OnScroll",this._onScroll,!1),window.addEventListener("resize",this._onWindowResize,!1)}},{key:"removeEventListeners",value:function(){this._controls.removeEventListener("OnScroll",this._onScroll,!1),window.removeEventListener("resize",this._onWindowResize,!1)}},{key:"animate",value:function(){this._controls.update(),this._renderer.render(this._scene,this._camera),requestAnimationFrame(this.animate.bind(this))}},{key:"_initRenderer",value:function(e){this._container=document.getElementById(e),this._renderer=new THREE.WebGLRenderer({antialias:!0}),this._renderer.setSize(this._container.clientWidth,this._container.clientHeight),this._renderer.setClearColor(2171169,1),this._renderer.setPixelRatio(window.devicePixelRatio),this._container.appendChild(this._renderer.domElement)}},{key:"_initCamera",value:function(){this._camera=new s.default(this._container.clientWidth/-2,this._container.clientWidth/2,this._container.clientHeight/2,this._container.clientHeight/-2,1,1e3)}},{key:"_initScene",value:function(){this._scene=new THREE.Scene}},{key:"_initControls",value:function(){this._controls=new u.default(this._camera,this._container),this._controls.staticMoving=!0,this._controls.noRotate=!0,this._camera.controls=this._controls}},{key:"_setupCamera",value:function(e){var t=e.worldBoundingBox(),n=new THREE.Vector3(t[1]-t[0],t[3]-t[2],t[5]-t[4]),i={center:e.worldCenter().clone(),halfDimensions:new THREE.Vector3(n.x+10,n.y+10,n.z+10)},r={width:this._container.clientWidth,height:this._container.clientHeight};this._camera.directions=[e.xCosine,e.yCosine,e.zCosine],this._camera.box=i,this._camera.canvas=r,this._camera.update(),this._camera.fitBox(2)}},{key:"_orientCamera",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";this._camera.orientation=t,this._camera.update(),this._camera.fitBox(2),e.orientation=this._camera.stackOrientation}},{key:"_onWindowResize",value:function(){this._camera.canvas={width:this._container.clientWidth,height:this._container.clientHeight},this._camera.fitBox(2),this._renderer.setSize(this._container.clientWidth,this._container.clientHeight)}},{key:"_onScroll",value:function(e){if(e.delta>0){if(this._object.index>=this._object.orientationMaxIndex)return!1;this._object.index+=1}else{if(this._object.index<=0)return!1;this._object.index-=1}}}]),e}();n.default=c},{"../../cameras/cameras.orthographic":88,"../../controls/controls.trackballortho":91}],115:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=e("../../controls/controls.trackball"),s=i(a),l=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"r3d";r(this,e),this._container=null,this._renderer=null,this._camera=null,this._controls=null,this._scene=null,this._initRenderer(t),this._initCamera(),this._initScene(),this._initControls(),this._onWindowResize=this._onWindowResize.bind(this),this.addEventListeners()}return o(e,[{key:"add",value:function(e){this._scene.add(e)}},{key:"addEventListeners",value:function(){window.addEventListener("resize",this._onWindowResize,!1)}},{key:"removeEventListeners",value:function(){window.removeEventListener("resize",this._onWindowResize,!1)}},{key:"center",value:function(e){this._camera.lookAt(e.x,e.y,e.z),this._camera.updateProjectionMatrix(),this._controls.target.set(e.x,e.y,e.z)}},{key:"animate",value:function(){this._controls.update(),this._renderer.render(this._scene,this._camera),requestAnimationFrame(this.animate.bind(this))}},{key:"_onWindowResize",value:function(){this._camera.aspect=this._container.clientWidth/this._container.clientHeight,this._camera.updateProjectionMatrix(),this._renderer.setSize(this._container.clientWidth,this._container.clientHeight)}},{key:"_initRenderer",value:function(e){this._container=document.getElementById(e),this._renderer=new THREE.WebGLRenderer({antialias:!0}),this._renderer.setSize(this._container.clientWidth,this._container.clientHeight),this._renderer.setClearColor(4342338,1),this._renderer.setPixelRatio(window.devicePixelRatio),this._container.appendChild(this._renderer.domElement)}},{key:"_initCamera",value:function(){this._camera=new THREE.PerspectiveCamera(45,this._container.clientWidth/this._container.clientHeight,1,1e7),this._camera.position.x=250,this._camera.position.y=250,this._camera.position.z=250}},{key:"_initScene",value:function(){this._scene=new THREE.Scene,this._scene.add(new THREE.AmbientLight(3487029));var e=new THREE.DirectionalLight(16777215,1);e.position.set(200,200,1e3).normalize(),this._scene.add(e);var t=new THREE.DirectionalLight(16777215,1);t.position.set(-200,-200,-1e3).normalize(),this._scene.add(t)}},{key:"_initControls",value:function(){this._controls=new s.default(this._camera,this._container),this._controls.rotateSpeed=1.4,this._controls.zoomSpeed=1.2,this._controls.panSpeed=.8}},{key:"container",set:function(e){this._container=e},get:function(){return this._container}}]),e}();n.default=l},{"../../controls/controls.trackball":90}],116:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":s(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":s(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var l="function"==typeof Symbol&&"symbol"===s(Symbol.iterator)?function(e){return"undefined"==typeof e?"undefined":s(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":"undefined"==typeof e?"undefined":s(e)},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),c=e("../helpers.stack"),h=i(c),f=e("../../loaders/loaders.volume"),d=i(f),p=function(e){function t(){r(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._file=null,e._progressbarContainer=null,e._stack=null,e._centerLPS=null,e._xSlice=null,e._ySlice=null,e._zSlice=null,e}return a(t,e),u(t,[{key:"_createSlice",value:function(e){if(this._stack){var t=new h.default(this._stack);t.orientation=e,0===e?(t.border.color=16007990,this._xSlice=t):1===e?(t.bbox.visible=!1,t.border.color=5025616,this._ySlice=t):(t.bbox.visible=!1,t.border.color=2201331,this._zSlice=t),this._centerLPS=t.stack.worldCenter()}}},{key:"load",value:function(){var e=this;if(this.file){var t=function(){var t=new d.default(e._progressbarContainer);return{v:t.load(e.file).then(function(){return new Promise(function(n,i){if(t.data.length<=0)return i({message:"No data loaded: "+t.data+"."});var r=t.data[0].mergeSeries(t.data)[0];return t.free(),e._stack=r.stack[0],e._createSlice(0),e.add(e._xSlice),e._createSlice(1),e.add(e._ySlice),e._createSlice(2),e.add(e._zSlice),n(e)})}).catch(function(e){t.free(),window.console.log("Something went wrong loading the volume..."),window.console.log(e)})}}();if("object"===("undefined"==typeof t?"undefined":l(t)))return t.v}return Promise.reject({message:"File not defined: "+this.file+"."})}},{key:"file",get:function(){return this._file},set:function(e){this._file=e}},{key:"progressbarContainer",set:function(e){this._progressbarContainer=e}},{key:"centerLPS",get:function(){return this._centerLPS}},{key:"stack",get:function(){return this._stack}}]),t}(THREE.Object3D);n.default=p},{"../../loaders/loaders.volume":119,"../helpers.stack":108}],117:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=e("../../src/helpers/helpers.progressbar"),s=i(a),l=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.default;r(this,e),this._loaded=-1,this._totalLoaded=-1,this._parsed=-1,this._totalParsed=-1,this._data=[],this._container=t,this._progressBar=null,this._container&&n&&(this._progressBar=new n(this._container))}return o(e,[{key:"free",value:function(){this._container=null,this._helpersProgressBar=null,this._progressBar&&(this._progressBar.free(),this._progressBar=null)}},{key:"fetch",value:function(e){var t=this;return new Promise(function(n,i){var r=new XMLHttpRequest;r.open("GET",e),r.crossOrigin=!0,r.responseType="arraybuffer",r.onload=function(o){if(200===r.status){t._loaded=o.loaded,t._totalLoaded=o.total,t._progressBar&&t._progressBar.update(t._loaded,t._totalLoaded,"load");var a=r.response,s={url:e,buffer:a};n(s)}else i(r.statusText)},r.onerror=function(){i(r.statusText)},r.onprogress=function(e){t._loaded=e.loaded,t._totalLoaded=e.total,t._progressBar&&t._progressBar.update(t._loaded,t._totalLoaded,"load")},r.send()})}},{key:"parse",value:function(e){return new Promise(function(e,t){e(null)})}},{key:"loadSequence",value:function(e){var t=this;return this.fetch(e).then(function(e){return t.parse(e)}).then(function(e){t._data.push(e)}).catch(function(e){window.console.log("oops... something went wrong..."),window.console.log(e)})}},{key:"load",value:function(e){var t=this;Array.isArray(e)||(e=[e]);var n=[];return e.forEach(function(e){n.push(t.loadSequence(e))}),Promise.all(n)}},{key:"data",set:function(e){this._data=e},get:function(){return this._data}}]),e}();n.default=l},{"../../src/helpers/helpers.progressbar":106}],118:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var r=e("./loaders.volume"),o=i(r);n.default={Volume:o.default}},{"./loaders.volume":119}],119:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":s(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":s(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=e("./loaders.base"),c=i(u),h=e("../../src/models/models.series"),f=i(h),d=e("../../src/models/models.stack"),p=i(d),m=e("../../src/models/models.frame"),_=i(m),g=e("../../src/parsers/parsers.dicom"),y=i(g),v=e("../../src/parsers/parsers.nifti"),b=i(v),w=e("../../src/parsers/parsers.nrrd"),x=i(w),k=e("pako"),E=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),l(t,[{key:"parse",value:function(e){var t=this;return this._progressBar&&this._progressBar.update(0,100,"parse"),new Promise(function(n,i){window.setTimeout(function(){n(new Promise(function(n,i){var r=e;r.gzcompressed=!1,r.filename="",r.extension="",r.filename=e.url.split("/").pop(),r.gzcompressed=!1;var o=r.filename.split(".");if(o.length<=1?r.extension="":r.extension=r.filename.split(".").pop(),"gz"===r.extension){r.gzcompressed=!0,r.extension=r.filename.split(".gz").shift().split(".").pop();var a=k.inflate(r.buffer);r.buffer=a.buffer}var s=t._parser(r.extension);s||i(r.filename+" can not be parsed.");var l=null;try{l=new s(r,0)}catch(e){window.console.log(e),i(e)}var u=new f.default;u.seriesInstanceUID=l.seriesInstanceUID(),u.numberOfFrames=l.numberOfFrames(),u.numberOfFrames||(u.numberOfFrames=1),u.numberOfChannels=l.numberOfChannels(),u.modality=l.modality(),"SEG"===u.modality&&(u.segmentationType=l.segmentationType(),u.segmentationSegments=l.segmentationSegments());var c=new p.default;c.numberOfChannels=l.numberOfChannels(),c.pixelRepresentation=l.pixelRepresentation(),c.pixelType=l.pixelType(),c.invert=l.invert(),c.modality=u.modality,"SEG"===c.modality&&(c.segmentationType=u.segmentationType,c.segmentationSegments=u.segmentationSegments),u.stack.push(c),setTimeout(t.parseFrame(u,c,e.url,0,l,n,i),0)}))},10)})}},{key:"parseFrame",value:function(e,t,n,i,r,o,a){var s=new _.default;s.sopInstanceUID=r.sopInstanceUID(i),s.url=n,s.rows=r.rows(i),s.columns=r.columns(i),s.numberOfChannels=t.numberOfChannels,s.pixelRepresentation=t.pixelRepresentation,s.pixelType=t.pixelType,s.pixelData=r.extractPixelData(i),s.pixelSpacing=r.pixelSpacing(i),s.sliceThickness=r.sliceThickness(i),s.imageOrientation=r.imageOrientation(i),s.rightHanded=r.rightHanded(),t.rightHanded=s.rightHanded,null===s.imageOrientation&&(s.imageOrientation=[1,0,0,0,1,0]),s.imagePosition=r.imagePosition(i),null===s.imagePosition&&(s.imagePosition=[0,0,i]),s.dimensionIndexValues=r.dimensionIndexValues(i),s.bitsAllocated=r.bitsAllocated(i),s.instanceNumber=r.instanceNumber(i),s.windowCenter=r.windowCenter(i),s.windowWidth=r.windowWidth(i),s.rescaleSlope=r.rescaleSlope(i),s.rescaleIntercept=r.rescaleIntercept(i),s.minMax=r.minMaxPixelData(s.pixelData),"SEG"===e.modality&&(s.referencedSegmentNumber=r.referencedSegmentNumber(i)),t.frame.push(s),this._parsed=i+1,this._totalParsed=e.numberOfFrames,this._progressBar&&this._progressBar.update(this._parsed,this._totalParsed,"parse"),this._parsed===this._totalParsed?o(e):setTimeout(this.parseFrame(e,t,n,this._parsed,r,o,a),0)}},{key:"_parser",value:function(e){var t=null;switch(e.toUpperCase()){case"NII":case"NII_":t=b.default;break;case"DCM":case"DICOM":case"IMA":case"":t=y.default;break;case"NRRD":t=x.default;break;default:return window.console.log("unsupported extension: "+e),!1}return t}}]),t}(c.default);n.default=E},{"../../src/models/models.frame":121,"../../src/models/models.series":123,"../../src/models/models.stack":124,"../../src/parsers/parsers.dicom":126,"../../src/parsers/parsers.nifti":128,"../../src/parsers/parsers.nrrd":129,"./loaders.base":117,pako:51}],120:[function(e,t,n){"use strict";function i(e,t){
if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(){i(this,e),this._id=-1}return r(e,[{key:"mergeModels",value:function(e,t){if(!this._validateModelArray(e)||!this._validateModelArray(t))return window.console.log("invalid inputs provided."),!1;for(var n=0;n<t.length;n++)for(var i=0;i<e.length&&!e[i].merge(t[n]);i++)i===e.length-1&&e.push(t[n]);return!0}},{key:"merge",value:function(e){return!!this.validate(e)&&this._id===e._id}},{key:"validate",value:function(e){return!(!e||null===e||"function"!=typeof e.merge)}},{key:"_validateModelArray",value:function(e){if(null===e||Array!==e.constructor)return window.console.log("invalid model array provided."),!1;for(var t=0;t<e.length;t++)if(!e[t]||null===e[t]||"function"!=typeof e[t].validate||!e[t].validate(e[t]))return!1;return!0}}]),e}();n.default=o},{}],121:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":s(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":s(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=function e(t,n,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},c=e("../../src/models/models.base"),h=i(c),f=function(e){function t(){r(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._sopInstanceUID=null,e._url=null,e._stackID=-1,e._rows=0,e._columns=0,e._dimensionIndexValues=[],e._imagePosition=null,e._imageOrientation=null,e._rightHanded=!0,e._sliceThickness=1,e._spacingBetweenSlices=null,e._pixelRepresentation=0,e._pixelType=0,e._pixelSpacing=null,e._pixelAspectRatio=null,e._pixelData=null,e._instanceNumber=null,e._windowCenter=null,e._windowWidth=null,e._rescaleSlope=null,e._rescaleIntercept=null,e._bitsAllocated=8,e._minMax=null,e._dist=null,e._referencedSegmentNumber=-1,e}return a(t,e),l(t,[{key:"validate",value:function(e){return!!(u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"validate",this).call(this,e)&&"function"==typeof e.cosines&&"function"==typeof e.spacingXY&&e.hasOwnProperty("_sopInstanceUID")&&e.hasOwnProperty("_dimensionIndexValues")&&e.hasOwnProperty("_imageOrientation")&&e.hasOwnProperty("_imagePosition"))}},{key:"merge",value:function(e){return!!this.validate(e)&&!!(this._compareArrays(this._dimensionIndexValues,e.dimensionIndexValues)&&this._compareArrays(this._imageOrientation,e.imageOrientation)&&this._compareArrays(this._imagePosition,e.imagePosition)&&this._instanceNumber===e.instanceNumber&&this._sopInstanceUID===e.sopInstanceUID)}},{key:"cosines",value:function e(){var e=[new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1)];if(this._imageOrientation&&6===this._imageOrientation.length){var t=new THREE.Vector3(this._imageOrientation[0],this._imageOrientation[1],this._imageOrientation[2]),n=new THREE.Vector3(this._imageOrientation[3],this._imageOrientation[4],this._imageOrientation[5]);t.length()>0&&n.length()>0&&(e[0]=t,e[1]=n,e[2]=new THREE.Vector3(0,0,0).crossVectors(e[0],e[1]).normalize())}else window.console.log("No valid image orientation for frame"),window.console.log(this),window.console.log("Returning default orientation.");return this._rightHanded||e[2].negate(),e}},{key:"spacingXY",value:function e(){var e=[1,1];return this.pixelSpacing?(e[0]=this.pixelSpacing[0],e[1]=this.pixelSpacing[1]):this.pixelAspectRatio&&(e[0]=1,e[1]=1*this.pixelAspectRatio[1]/this.pixelAspectRatio[0]),e}},{key:"value",value:function(e,t){return this.pixelData[e+this._columns*t]}},{key:"_compareArrays",value:function(e,t){return e===t||!(!e||!t||e.join()!==t.join())}},{key:"rows",get:function(){return this._rows},set:function(e){this._rows=e}},{key:"columns",get:function(){return this._columns},set:function(e){this._columns=e}},{key:"spacingBetweenSlices",get:function(){return this._spacingBetweenSlices},set:function(e){this._spacingBetweenSlices=e}},{key:"sliceThickness",get:function(){return this._sliceThickness},set:function(e){this._sliceThickness=e}},{key:"imagePosition",get:function(){return this._imagePosition},set:function(e){this._imagePosition=e}},{key:"imageOrientation",get:function(){return this._imageOrientation},set:function(e){this._imageOrientation=e}},{key:"windowWidth",get:function(){return this._windowWidth},set:function(e){this._windowWidth=e}},{key:"windowCenter",get:function(){return this._windowCenter},set:function(e){this._windowCenter=e}},{key:"rescaleSlope",get:function(){return this._rescaleSlope},set:function(e){this._rescaleSlope=e}},{key:"rescaleIntercept",get:function(){return this._rescaleIntercept},set:function(e){this._rescaleIntercept=e}},{key:"bitsAllocated",get:function(){return this._bitsAllocated},set:function(e){this._bitsAllocated=e}},{key:"dist",get:function(){return this._dist},set:function(e){this._dist=e}},{key:"pixelSpacing",get:function(){return this._pixelSpacing},set:function(e){this._pixelSpacing=e}},{key:"pixelAspectRatio",get:function(){return this._pixelAspectRatio},set:function(e){this._pixelAspectRatio=e}},{key:"minMax",get:function(){return this._minMax},set:function(e){this._minMax=e}},{key:"dimensionIndexValues",get:function(){return this._dimensionIndexValues},set:function(e){this._dimensionIndexValues=e}},{key:"instanceNumber",get:function(){return this._instanceNumber},set:function(e){this._instanceNumber=e}},{key:"pixelData",get:function(){return this._pixelData},set:function(e){this._pixelData=e}},{key:"sopInstanceUID",set:function(e){this._sopInstanceUID=e},get:function(){return this._sopInstanceUID}},{key:"pixelRepresentation",get:function(){return this._pixelRepresentation},set:function(e){this._pixelRepresentation=e}},{key:"pixelType",get:function(){return this._pixelType},set:function(e){this._pixelType=e}},{key:"url",get:function(){return this._url},set:function(e){this._url=e}},{key:"referencedSegmentNumber",get:function(){return this._referencedSegmentNumber},set:function(e){this._referencedSegmentNumber=e}},{key:"rightHanded",get:function(){return this._rightHanded},set:function(e){this._rightHanded=e}}]),t}(h.default);n.default=f},{"../../src/models/models.base":120}],122:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var r=e("./models.frame"),o=i(r),a=e("./models.stack"),s=i(a),l=e("./models.series"),u=i(l),c=e("./models.voxel"),h=i(c);n.default={Frame:o.default,Stack:s.default,Series:u.default,Voxel:h.default}},{"./models.frame":121,"./models.series":123,"./models.stack":124,"./models.voxel":125}],123:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":s(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":s(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=function e(t,n,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},c=e("../../src/models/models.base"),h=i(c),f=function(e){function t(){r(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._concatenationUID=-1,e._seriesInstanceUID=-1,e._seriesNumber=-1,e._modality="Modality not set",e._dimensionIndexSequence=[],e._numberOfFrames=0,e._numberOfChannels=1,e._segmentationType=null,e._segmentationSegments=[],e._stack=[],e}return a(t,e),l(t,[{key:"validate",value:function(e){return!!(u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"validate",this).call(this,e)&&"function"==typeof e.mergeSeries&&e.hasOwnProperty("_seriesInstanceUID")&&e.hasOwnProperty("_numberOfFrames")&&e.hasOwnProperty("_numberOfChannels")&&e.hasOwnProperty("_stack")&&"undefined"!=typeof e._stack&&Array===e._stack.constructor)}},{key:"merge",value:function(e){return!!this.validate(e)&&(this._seriesInstanceUID===e.seriesInstanceUID&&this.mergeModels(this._stack,e.stack))}},{key:"mergeSeries",value:function(e){var t=[this];return this.mergeModels(t,e),t}},{key:"seriesInstanceUID",set:function(e){this._seriesInstanceUID=e},get:function(){return this._seriesInstanceUID}},{key:"numberOfFrames",set:function(e){this._numberOfFrames=e},get:function(){return this._numberOfFrames}},{key:"numberOfChannels",set:function(e){this._numberOfChannels=e},get:function(){return this._numberOfChannels}},{key:"stack",set:function(e){this._stack=e},get:function(){return this._stack}},{key:"modality",set:function(e){this._modality=e},get:function(){return this._modality}},{key:"segmentationType",set:function(e){this._segmentationType=e},get:function(){return this._segmentationType}},{key:"segmentationSegments",set:function(e){this._segmentationSegments=e},get:function(){return this._segmentationSegments}}]),t}(h.default);n.default=f},{"../../src/models/models.base":120}],124:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":l(t))&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":l(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),c=e("../../src/core/core.colors"),h=i(c),f=e("../../src/core/core.utils"),d=i(f),p=e("../../src/models/models.base"),m=i(p),_=e("math-float32-to-binary-string"),g=function(e){function t(){o(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._uid=null,e._stackID=-1,e._frame=[],e._numberOfFrames=0,e._rows=0,e._columns=0,e._numberOfChannels=1,e._bitsAllocated=8,e._pixelType=0,e._pixelRepresentation=0,e._textureSize=4096,e._nbTextures=7,e._rawData=[],e._windowCenter=0,e._windowWidth=0,e._rescaleSlope=1,e._rescaleIntercept=0,e._minMax=[65535,-32768],e._ijk2LPS=null,e._lps2IJK=null,e._aabb2LPS=null,e._lps2AABB=null,e._dimensionsIJK=null,e._halfDimensionsIJK=null,e._spacing=new THREE.Vector3(1,1,1),e._spacingBetweenSlices=0,e._sliceThickness=0,e._origin=null,e._rightHanded=!0,e._xCosine=new THREE.Vector3(1,0,0),e._yCosine=new THREE.Vector3(0,1,0),e._zCosine=new THREE.Vector3(0,0,1),e._prepared=!1,e._packed=!1,e._packedPerPixel=1,e._modality="Modality not set",e._segmentationType=null,e._segmentationSegments=[],e._segmentationDefaultColor=[63,174,128],e._frameSegment=[],e._segmentationLUT=[],e._segmentationLUTO=[],e._invert=!1,e}return s(t,e),u(t,[{key:"prepareSegmentation",value:function(){this._frameSegment=this._frame;var e=[];this.computeCosines(),this._frame.map(this._computeDistanceArrayMap.bind(null,this._zCosine)),this._frame.sort(this._sortDistanceArraySort);for(var t=-1,n=0;n<this._frame.length;n++){if(e[t]&&e[t]._dist==this._frame[n]._dist)for(var i=0;i<e[t]._rows*e[t]._columns;i++)e[t]._pixelData[i]+=this._frame[n].pixelData[i]*this._frame[n]._referencedSegmentNumber;else{e.push(this._frame[n]),t++;for(var o=0;o<e[t]._rows*e[t]._columns;o++)e[t]._pixelData[o]*=this._frame[n]._referencedSegmentNumber}e[t].minMax=d.default.minMaxPixelData(e[t]._pixelData)}for(var a={},s=0,l=0;l<this._segmentationSegments.length;l++){s=Math.max(s,parseInt(this._segmentationSegments[l].segmentNumber,10));var u=this._segmentationSegments[l].recommendedDisplayCIELab;null===u?a[this._segmentationSegments[l].segmentNumber]=this._segmentationDefaultColor:a[this._segmentationSegments[l].segmentNumber]=h.default.cielab2RGB.apply(h.default,r(u))}for(var c=0;c<=s;c++){var f=c/s,p=c?1:0,m=[0,0,0];a.hasOwnProperty(c.toString())&&(m=a[c.toString()]),m[0]/=255,m[1]/=255,m[2]/=255,this._segmentationLUT.push([f].concat(r(m))),this._segmentationLUTO.push([f,p])}this._frame=e}},{key:"prepare",value:function(){if("SEG"===this._modality&&this.prepareSegmentation(),!(this._frame&&this._frame.length>0))return window.console.log("_frame doesn't contain anything...."),window.console.log(this._frame),!1;this._numberOfFrames=this._frame.length,this._rows=this._frame[0].rows,this._columns=this._frame[0].columns,this._dimensionsIJK=new THREE.Vector3(this._columns,this._rows,this._numberOfFrames),this._halfDimensionsIJK=new THREE.Vector3(this._dimensionsIJK.x/2,this._dimensionsIJK.y/2,this._dimensionsIJK.z/2),this._spacingBetweenSlices=this._frame[0].spacingBetweenSlices,this._sliceThickness=this._frame[0].sliceThickness,this.computeCosines(),this.orderFrames(),this.computeSpacing(),this._frame[0].imagePosition||(this._frame[0].imagePosition=[0,0,0]),this._frame[0].imageOrientation||(this._frame[0].imageOrientation=[1,0,0,0,1,0]),this._origin=this._vector3FromArray(this._frame[0].imagePosition,0),this.computeIJK2LPS(),this.computeLPS2AABB(),this._rescaleSlope=this._frame[0].rescaleSlope||1,this._rescaleIntercept=this._frame[0].rescaleIntercept||0,this.computeMinMaxIntensities(),this._minMax[0]=t.valueRescaleSlopeIntercept(this._minMax[0],this._rescaleSlope,this._rescaleIntercept),this._minMax[1]=t.valueRescaleSlopeIntercept(this._minMax[1],this._rescaleSlope,this._rescaleIntercept);var e=this._frame[0].windowWidth||this._minMax[1]-this._minMax[0];this._windowWidth=this._rescaleSlope*e+this._rescaleIntercept;var n=this._frame[0].windowCenter||this._minMax[0]+e/2;this._windowCenter=this._rescaleSlope*n+this._rescaleIntercept,this._bitsAllocated=this._frame[0].bitsAllocated,this._prepared=!0}},{key:"packEchos",value:function(){for(var e=4,t=[],n=0;n<this._frame.length;n+=e){for(var i=this._frame[n],r=0;r<this._rows*this._columns;r++){for(var o=1;o<e;o++)i.pixelData[r]+=this._frame[n+o].pixelData[r];i.pixelData[r]/=e}t.push(i)}this._frame=t,this._numberOfFrames=this._frame.length,this._dimensionsIJK=new THREE.Vector3(this._columns,this._rows,this._numberOfFrames),this._halfDimensionsIJK=new THREE.Vector3(this._dimensionsIJK.x/2,this._dimensionsIJK.y/2,this._dimensionsIJK.z/2)}},{key:"computeCosines",value:function(){if(this._frame&&this._frame[0]){var e=this._frame[0].cosines();this._xCosine=e[0],this._yCosine=e[1],this._zCosine=e[2]}}},{key:"orderFrames",value:function(){this._frame[0].dimensionIndexValues?this._frame.sort(this._orderFrameOnDimensionIndicesArraySort):this._frame[0].imagePosition&&this._frame[0].imageOrientation&&this._frame[1]&&this._frame[1].imagePosition&&this._frame[1].imageOrientation&&this._frame[0].imagePosition.join()!==this._frame[1].imagePosition.join()?(this._frame.map(this._computeDistanceArrayMap.bind(null,this._zCosine)),this._frame.sort(this._sortDistanceArraySort)):null!==this._frame[0].instanceNumber&&this._frame[1]&&null!==this._frame[1].instanceNumber&&this._frame[0].instanceNumber!==this._frame[1].instanceNumber?this._frame.sort(this._sortInstanceNumberArraySort):this._frame[0].sopInstanceUID&&this._frame[1]&&this._frame[1].sopInstanceUID&&this._frame[0].sopInstanceUID!==this._frame[1].sopInstanceUID?this._frame.sort(this._sortSopInstanceUIDArraySort):window.console.log("do not know how to order the frames...")}},{key:"computeSpacing",value:function(){this.xySpacing(),this.zSpacing()}},{key:"zSpacing",value:function(){this._numberOfFrames>1&&(this._spacingBetweenSlices?this._spacing.z=this._spacingBetweenSlices:this._frame[0].pixelSpacing&&this._frame[0].pixelSpacing[2]?this._spacing.z=this._frame[0].pixelSpacing[2]:(this._frame.map(this._computeDistanceArrayMap.bind(null,this._zCosine)),this._frame.sort(this._sortDistanceArraySort),this._spacing.z=this._frame[1].dist-this._frame[0].dist)),0===this._spacing.z&&(this._spacing.z=1)}},{key:"xySpacing",value:function(){if(this._frame&&this._frame[0]){var e=this._frame[0].spacingXY();this._spacing.x=e[0],this._spacing.y=e[1]}}},{key:"computeMinMaxIntensities",value:function(){for(var e=0;e<this._frame.length;e++)this._minMax[0]=Math.min(this._minMax[0],this._frame[e].minMax[0]),this._minMax[1]=Math.max(this._minMax[1],this._frame[e].minMax[1])}},{key:"computeIJK2LPS",value:function(){this._ijk2LPS=new THREE.Matrix4,this._ijk2LPS.set(this._xCosine.x*this._spacing.x,this._yCosine.x*this._spacing.y,this._zCosine.x*this._spacing.z,this._origin.x,this._xCosine.y*this._spacing.x,this._yCosine.y*this._spacing.y,this._zCosine.y*this._spacing.z,this._origin.y,this._xCosine.z*this._spacing.x,this._yCosine.z*this._spacing.y,this._zCosine.z*this._spacing.z,this._origin.z,0,0,0,1),this._lps2IJK=new THREE.Matrix4,this._lps2IJK.getInverse(this._ijk2LPS)}},{key:"computeLPS2AABB",value:function(){this._aabb2LPS=new THREE.Matrix4,this._aabb2LPS.set(this._xCosine.x,this._yCosine.x,this._zCosine.x,this._origin.x,this._xCosine.y,this._yCosine.y,this._zCosine.y,this._origin.y,this._xCosine.z,this._yCosine.z,this._zCosine.z,this._origin.z,0,0,0,1),this._lps2AABB=new THREE.Matrix4,this._lps2AABB.getInverse(this._aabb2LPS)}},{key:"merge",value:function(e){return this._stackID===e.stackID&&this.mergeModels(this._frame,e.frame)}},{key:"pack",value:function(){var e=this._dimensionsIJK.x*this._dimensionsIJK.y*this._dimensionsIJK.z;16===this._bitsAllocated&&1===this._numberOfChannels&&(this._packedPerPixel=2);var t=this._textureSize*this._textureSize,n=Math.ceil(e/(t*this._packedPerPixel)),i=0,r=this._packedPerPixel*t;r>e&&(r=e);for(var o=0;o<n;o++){var a=this._packTo8Bits(this._bitsAllocated,this._pixelType,this._numberOfChannels,this._frame,this._textureSize,i,r);this._textureType=a.textureType,this._rawData.push(a.data),i+=this._packedPerPixel*t,r+=this._packedPerPixel*t,r>e&&(r=e)}this._packed=!0}},{key:"_packTo8Bits",value:function(e,t,n,i,r,o,a){var s={textureType:null,data:null},l=0;this._minMax[0]<0&&(l-=this._minMax[0]);var u=0,c=0,h=0,f=i[0].rows*i[0].columns;if(8===e&&1===n||1===e){for(var d=new Uint8Array(r*r*1),p=o;p<a;p++)c=~~(p/f),h=p%f,d[u]=l+i[c].pixelData[h],u++;s.textureType=THREE.LuminanceFormat,s.data=d}else if(16===e&&1===n){for(var m=new Uint8Array(r*r*4),g=0,y=0,v=o;v<a;v++){c=~~(v/f),h=v%f;var b=l+i[c].pixelData[h];m[4*g+2*y]=255&b,m[4*g+2*y+1]=b>>>8&255,u++,g=Math.floor(u/2),y=u%2}s.textureType=THREE.RGBAFormat,s.data=m}else if(32===e&&1===n&&0===t){for(var w=new Uint8Array(r*r*4),x=o;x<a;x++){c=~~(x/f),h=x%f;var k=l+i[c].pixelData[h];w[4*u]=255&k,w[4*u+1]=k>>>8&255,w[4*u+2]=k>>>8&255,w[4*u+3]=k>>>8&255,u++}s.textureType=THREE.RGBAFormat,s.data=w}else if(32===e&&1===n&&1===t){for(var E=new Uint8Array(r*r*4),S=o;S<a;S++){c=~~(S/f),h=S%f;var I=l+i[c].pixelData[h],T=_(I),P=T.match(/.{1,8}/g);E[4*u]=parseInt(P[0],2),E[4*u+1]=parseInt(P[1],2),E[4*u+2]=parseInt(P[2],2),E[4*u+3]=parseInt(P[3],2),u++}s.textureType=THREE.RGBAFormat,s.data=E}else if(8===e&&3===n){for(var A=new Uint8Array(r*r*3),D=o;D<a;D++)c=~~(D/f),h=D%f,A[3*u]=i[c].pixelData[3*h],A[3*u+1]=i[c].pixelData[3*h+1],A[3*u+2]=i[c].pixelData[3*h+2],u++;s.textureType=THREE.RGBFormat,s.data=A}return s}},{key:"worldCenter",value:function(){var e=this._halfDimensionsIJK.clone().addScalar(-.5).applyMatrix4(this._ijk2LPS);return e}},{key:"worldBoundingBox",value:function(){for(var e=[Number.MAX_VALUE,Number.MIN_VALUE,Number.MAX_VALUE,Number.MIN_VALUE,Number.MAX_VALUE,Number.MIN_VALUE],t=0;t<=this._dimensionsIJK.x;t+=this._dimensionsIJK.x)for(var n=0;n<=this._dimensionsIJK.y;n+=this._dimensionsIJK.y)for(var i=0;i<=this._dimensionsIJK.z;i+=this._dimensionsIJK.z){var r=new THREE.Vector3(t,n,i).applyMatrix4(this._ijk2LPS);e=[Math.min(e[0],r.x),Math.max(e[1],r.x),Math.min(e[2],r.y),Math.max(e[3],r.y),Math.min(e[4],r.z),Math.max(e[5],r.z)]}return e}},{key:"AABBox",value:function(){var e=(new THREE.Vector3).addScalar(-.5).applyMatrix4(this._ijk2LPS).applyMatrix4(this._lps2AABB),t=this._dimensionsIJK.clone().addScalar(-.5).applyMatrix4(this._ijk2LPS).applyMatrix4(this._lps2AABB),n=new THREE.Vector3(Math.abs(e.x-t.x),Math.abs(e.y-t.y),Math.abs(e.z-t.z));return n}},{key:"centerAABBox",value:function(){var e=this.worldCenter();return e.applyMatrix4(this._lps2AABB),e}},{key:"_vector3FromArray",value:function(e,t){return new THREE.Vector3(e[t],e[t+1],e[t+2])}},{key:"_orderFrameOnDimensionIndicesArraySort",value:function(e,t){if("dimensionIndexValues"in e&&"[object Array]"===Object.prototype.toString.call(e.dimensionIndexValues)&&"dimensionIndexValues"in t&&"[object Array]"===Object.prototype.toString.call(t.dimensionIndexValues))for(var n=0;n<e.dimensionIndexValues.length;n++){if(parseInt(e.dimensionIndexValues[n],10)>parseInt(t.dimensionIndexValues[n],10))return 1;if(parseInt(e.dimensionIndexValues[n],10)<parseInt(t.dimensionIndexValues[n],10))return-1}else window.console.log("One of the frames doesn't have a dimensionIndexValues array."),window.console.log(e),window.console.log(t);return 0}},{key:"_computeDistanceArrayMap",value:function(e,t){return t.dist=t.imagePosition[0]*e.x+t.imagePosition[1]*e.y+t.imagePosition[2]*e.z,t}},{key:"_sortDistanceArraySort",value:function(e,t){return e.dist-t.dist}},{key:"_sortInstanceNumberArraySort",value:function(e,t){return e.instanceNumber-t.instanceNumber}},{key:"_sortSopInstanceUIDArraySort",value:function(e,t){return e.sopInstanceUID-t.sopInstanceUID}},{key:"numberOfChannels",set:function(e){this._numberOfChannels=e},get:function(){return this._numberOfChannels}},{key:"frame",set:function(e){this._frame=e},get:function(){return this._frame}},{key:"prepared",set:function(e){this._prepared=e},get:function(){return this._prepared}},{key:"packed",set:function(e){this._packed=e},get:function(){return this._packed}},{key:"packedPerPixel",set:function(e){this._packedPerPixel=e},get:function(){return this._packedPerPixel}},{key:"dimensionsIJK",set:function(e){this._dimensionsIJK=e},get:function(){return this._dimensionsIJK}},{key:"halfDimensionsIJK",set:function(e){this._halfDimensionsIJK=e},get:function(){return this._halfDimensionsIJK}},{key:"ijk2LPS",set:function(e){this._ijk2LPS=e},get:function(){return this._ijk2LPS}},{key:"lps2IJK",set:function(e){this._lps2IJK=e},get:function(){return this._lps2IJK}},{key:"lps2AABB",set:function(e){this._lps2AABB=e},get:function(){return this._lps2AABB}},{key:"textureSize",set:function(e){this._textureSize=e},get:function(){return this._textureSize}},{key:"textureType",set:function(e){this._textureType=e},get:function(){return this._textureType}},{key:"bitsAllocated",set:function(e){this._bitsAllocated=e},get:function(){return this._bitsAllocated}},{key:"rawData",set:function(e){this._rawData=e},get:function(){return this._rawData}},{key:"windowWidth",get:function(){return this._windowWidth},set:function(e){this._windowWidth=e}},{key:"windowCenter",get:function(){return this._windowCenter},set:function(e){this._windowCenter=e}},{key:"rescaleSlope",get:function(){return this._rescaleSlope},set:function(e){this._rescaleSlope=e}},{key:"rescaleIntercept",get:function(){return this._rescaleIntercept},set:function(e){this._rescaleIntercept=e}},{key:"xCosine",get:function(){return this._xCosine},set:function(e){this._xCosine=e}},{key:"yCosine",get:function(){return this._yCosine},set:function(e){this._yCosine=e}},{key:"zCosine",get:function(){return this._zCosine},set:function(e){this._zCosine=e}},{key:"minMax",get:function(){return this._minMax},set:function(e){this._minMax=e}},{key:"stackID",get:function(){return this._stackID},set:function(e){this._stackID=e}},{key:"pixelType",get:function(){return this._pixelType},set:function(e){this._pixelType=e}},{key:"pixelRepresentation",get:function(){return this._pixelRepresentation},set:function(e){this._pixelRepresentation=e}},{key:"invert",set:function(e){this._invert=e},get:function(){return this._invert}},{key:"modality",set:function(e){this._modality=e},get:function(){return this._modality}},{key:"rightHanded",get:function(){return this._rightHanded},set:function(e){this._rightHanded=e}},{key:"segmentationSegments",set:function(e){this._segmentationSegments=e},get:function(){return this._segmentationSegments}},{key:"segmentationType",set:function(e){this._segmentationType=e},get:function(){return this._segmentationType}},{key:"segmentationLUT",set:function(e){this._segmentationLUT=e},get:function(){return this._segmentationLUT}},{key:"segmentationLUTO",set:function(e){this._segmentationLUTO=e},get:function(){return this._segmentationLUTO}}],[{key:"worldToData",value:function(e,t){var n=(new THREE.Vector3).copy(t).applyMatrix4(e._lps2IJK);return n.addScalar(.5).floor(),n}},{key:"value",value:function(e,t){return t.z>=0&&t.z<e._frame.length?e._frame[t.z].value(t.x,t.y):null}},{key:"valueRescaleSlopeIntercept",value:function(e,t,n){return e*t+n}},{key:"indexInDimensions",value:function(e,t){return e.x>=0&&e.y>=0&&e.z>=0&&e.x<t.x&&e.y<t.y&&e.z<t.z}}]),t}(m.default);n.default=g},{"../../src/core/core.colors":92,"../../src/core/core.utils":96,"../../src/models/models.base":120,"math-float32-to-binary-string":43}],125:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(){i(this,e),this._id=-1,this._worldCoordinates=null,this._dataCoordinates=null,this._screenCoordinates=null,this._value=null}return r(e,[{key:"worldCoordinates",set:function(e){this._worldCoordinates=e},get:function(){return this._worldCoordinates}},{key:"dataCoordinates",set:function(e){this._dataCoordinates=e},get:function(){return this._dataCoordinates}},{key:"screenCoordinates",set:function(e){this._screenCoordinates=e},get:function(){return this._screenCoordinates}},{key:"value",set:function(e){this._value=e},get:function(){return this._value}},{key:"id",set:function(e){this._id=e},get:function(){return this._id}}]),e}();n.default=o},{}],126:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":s(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":s(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=e("./parsers.volume"),c=i(u),h=e("dicom-parser"),f=e("jpeg-lossless-decoder-js"),d=e("../../external/scripts/jpeg"),p=e("../../external/scripts/jpx"),m=function(e){function t(e,n){r(this,t);var i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));i._id=n,i._arrayBuffer=e.buffer;var a=new Uint8Array(i._arrayBuffer);i._dataSet=null;try{i._dataSet=h.parseDicom(a)}catch(e){throw window.console.log(e),"parsers.dicom could not parse the file"}return i}return a(t,e),l(t,[{key:"seriesInstanceUID",value:function(){return this._dataSet.string("x0020000e")}},{key:"studyInstanceUID",value:function(){return this._dataSet.string("x0020000d")}},{key:"modality",value:function(){return this._dataSet.string("x00080060")}},{key:"segmentationType",value:function(){return this._dataSet.string("x00620001")}},{key:"segmentationSegments",value:function e(){for(var e=[],t=this._dataSet.elements.x00620002,n=0;n<t.items.length;n++){var i=this._recommendedDisplayCIELab(t.items[n]),r=this._segmentationCode(t.items[n]),o=t.items[n].dataSet.uint16("x00620004"),a=t.items[n].dataSet.string("x00620005"),s=t.items[n].dataSet.string("x00620008");e.push({recommendedDisplayCIELab:i,segmentationCodeDesignator:r.segmentationCodeDesignator,segmentationCodeValue:r.segmentationCodeValue,segmentationCodeMeaning:r.segmentationCodeMeaning,segmentNumber:o,segmentLabel:a,segmentAlgorithmType:s})}return e}},{key:"_segmentationCode",value:function(e){var t="unknown",n="unknown",i="unknown",r=e.dataSet.elements.x00082218;return r&&r.items&&r.items.length>0&&(t=r.items[0].dataSet.string("x00080102"),n=r.items[0].dataSet.string("x00080100"),i=r.items[0].dataSet.string("x00080104")),{segmentationCodeDesignator:t,segmentationCodeValue:n,segmentationCodeMeaning:i}}},{key:"_recommendedDisplayCIELab",value:function(e){
if(!e.dataSet.elements.x0062000d)return null;for(var t=e.dataSet.elements.x0062000d.dataOffset,n=e.dataSet.elements.x0062000d.length,i=e.dataSet.byteArray.slice(t,t+n),r=new Uint16Array(n/2),o=0;o<n/2;o++)r[o]=(i[2*o+1]<<8)+i[2*o];var a=[r[0]/65535*100,r[1]/65535*255-128,r[2]/65535*255-128];return a}},{key:"sopInstanceUID",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=this._findStringEverywhere("x2005140f","x00080018",t);return e}},{key:"transferSyntaxUID",value:function(){return this._dataSet.string("x00020010")}},{key:"photometricInterpretation",value:function(){return this._dataSet.string("x00280004")}},{key:"planarConfiguration",value:function e(){var e=this._dataSet.uint16("x00280006");return"undefined"==typeof e&&(e=null),e}},{key:"samplesPerPixel",value:function(){return this._dataSet.uint16("x00280002")}},{key:"numberOfFrames",value:function e(){var e=this._dataSet.intString("x00280008");return"undefined"==typeof e&&(e=null),e}},{key:"numberOfChannels",value:function e(){var e=1,t=this.photometricInterpretation();return"RGB"!==t&&"PALETTE COLOR"!==t&&"YBR_FULL"!==t&&"YBR_FULL_422"!==t&&"YBR_PARTIAL_422"!==t&&"YBR_PARTIAL_420"!==t&&"YBR_RCT"!==t||(e=3),e}},{key:"invert",value:function(){var e=this.photometricInterpretation();return"MONOCHROME1"===e}},{key:"imageOrientation",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=this._findStringEverywhere("x00209116","x00200037",t);return e&&(e=e.split("\\").map(Number)),e}},{key:"referencedSegmentNumber",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=-1,n=this._findInGroupSequence("x52009230","x0062000a",t);return null!==n&&(e=n.uint16("x0062000b")),e}},{key:"pixelAspectRatio",value:function e(){var e=[this._dataSet.intString("x00280034",0),this._dataSet.intString("x00280034",1)];return"undefined"==typeof e[0]&&(e=null),e}},{key:"imagePosition",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=this._findStringEverywhere("x00209113","x00200032",t);return e&&(e=e.split("\\").map(Number)),e}},{key:"instanceNumber",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=null,n=this._dataSet.elements.x52009230;if("undefined"!=typeof n)if(n.items[t].dataSet.elements.x2005140f){var i=n.items[t].dataSet.elements.x2005140f.items[0].dataSet;e=i.intString("x00200013")}else e=this._dataSet.intString("x00200013"),"undefined"==typeof e&&(e=null);else e=this._dataSet.intString("x00200013"),"undefined"==typeof e&&(e=null);return e}},{key:"pixelSpacing",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=this._findStringEverywhere("x00289110","x00280030",t);return e&&(e=e.split("\\").map(Number)),e}},{key:"rows",value:function e(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,this._dataSet.uint16("x00280010"));return"undefined"==typeof e&&(e=null),e}},{key:"columns",value:function e(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,this._dataSet.uint16("x00280011"));return"undefined"==typeof e&&(e=null),e}},{key:"pixelType",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return 0}},{key:"pixelRepresentation",value:function e(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,this._dataSet.uint16("x00280103"));return e}},{key:"bitsAllocated",value:function e(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,this._dataSet.uint16("x00280100"));return e}},{key:"highBit",value:function e(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,this._dataSet.uint16("x00280102"));return e}},{key:"rescaleIntercept",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._findFloatStringInFrameGroupSequence("x00289145","x00281052",e)}},{key:"rescaleSlope",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._findFloatStringInFrameGroupSequence("x00289145","x00281053",e)}},{key:"windowCenter",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._findFloatStringInFrameGroupSequence("x00289132","x00281050",e)}},{key:"windowWidth",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._findFloatStringInFrameGroupSequence("x00289132","x00281051",e)}},{key:"sliceThickness",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._findFloatStringInFrameGroupSequence("x00289110","x00180050",e)}},{key:"dimensionIndexValues",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=[],n=this._dataSet.elements.x52009230;if("undefined"!=typeof n)for(var i=n.items[t].dataSet.elements.x00209111.items[0].dataSet,r=i.elements.x00209157,o=r.length/4,a=0;a<o;a++)e.push(i.uint32("x00209157",a));else e=null;return e}},{key:"inStackPositionNumber",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=null,n=this._dataSet.elements.x52009230;if("undefined"!=typeof n){var i=n.items[t].dataSet.elements.x00209111.items[0].dataSet;e=i.uint32("x00209057")}else e=null;return console.log("instack position "+e),e}},{key:"stackID",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=null,n=this._dataSet.elements.x52009230;if("undefined"!=typeof n){var i=n.items[t].dataSet.elements.x00209111.items[0].dataSet;e=i.intString("x00209056")}else e=null;return e}},{key:"extractPixelData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this._decodePixelData(e),n=this.numberOfChannels();return n>1?this._convertColorSpace(t):t}},{key:"minMaxPixelData",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=[65535,-32768],n=e.length,i=0;i<n;i++){var r=e[i];t[0]=Math.min(t[0],r),t[1]=Math.max(t[1],r)}return t}},{key:"_findInGroupSequence",value:function(e,t,n){var i=this._dataSet.elements[e];if("undefined"!=typeof i){var r=i.items[n].dataSet.elements[t];if("undefined"!=typeof r)return r.items[0].dataSet}return null}},{key:"_findStringInGroupSequence",value:function(e,t,n,i){var r=this._findInGroupSequence(e,t,i);return null!==r?r.string(n):null}},{key:"_findStringInFrameGroupSequence",value:function(e,t,n){return this._findStringInGroupSequence("x52009229",e,t,0)||this._findStringInGroupSequence("x52009230",e,t,n)}},{key:"_findStringEverywhere",value:function(e,t,n){var i=this._findStringInFrameGroupSequence(e,t,n);return null===i&&(i=this._dataSet.string(t)),"undefined"==typeof i&&(i=null),i}},{key:"_findFloatStringInGroupSequence",value:function(e,t,n,i){var r=this._dataSet.floatString(n);return"undefined"==typeof r?(r=this._findInGroupSequence(e,t,i),null!==r?r.floatString(n):null):r}},{key:"_findFloatStringInFrameGroupSequence",value:function(e,t,n){return this._findFloatStringInGroupSequence("x52009229",e,t,0)||this._findFloatStringInGroupSequence("x52009230",e,t,n)}},{key:"_decodePixelData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.transferSyntaxUID();if("1.2.840.10008.1.2.4.90"===t||"1.2.840.10008.1.2.4.91"===t)return this._decodeJ2K(e);if("1.2.840.10008.1.2.4.57"===t||"1.2.840.10008.1.2.4.70"===t)return this._decodeJPEGLossless(e);if("1.2.840.10008.1.2.4.50"===t||"1.2.840.10008.1.2.4.51"===t)return this._decodeJPEGBaseline(e);if("1.2.840.10008.1.2"===t||"1.2.840.10008.1.2.1"===t)return this._decodeUncompressed(e);if("1.2.840.10008.1.2.2"===t){var n=this._decodeUncompressed(e);return this._swapFrame(n)}throw"no decoder for transfer syntax "+t}},{key:"_decodeJ2K",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=h.readEncapsulatedPixelData(this._dataSet,this._dataSet.elements.x7fe00010,e),n=new p;n.parse(t);var i=n.componentsCount;if(1!==i)throw"JPEG2000 decoder returned a componentCount of ${componentsCount}, when 1 is expected";var r=n.tiles.length;if(1!==r)throw"JPEG2000 decoder returned a tileCount of ${tileCount}, when 1 is expected";var o=n.tiles[0],a=o.items;return a}},{key:"_decodeJPEGLossless",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=h.readEncapsulatedPixelData(this._dataSet,this._dataSet.elements.x7fe00010,e),n=this.pixelRepresentation(e),i=this.bitsAllocated(e),r=i<=8?1:2,o=new f.lossless.Decoder,a=o.decode(t.buffer,t.byteOffset,t.length,r);return 0===n?2===r?new Uint16Array(a.buffer):new Uint8Array(a.buffer):new Int16Array(a.buffer)}},{key:"_decodeJPEGBaseline",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=h.readEncapsulatedPixelData(this._dataSet,this._dataSet.elements.x7fe00010,e),n=this.rows(e),i=this.columns(e),r=this.bitsAllocated(e),o=new d;return o.parse(t),8===r?o.getData(i,n):16===r?o.getData16(i,n):void 0}},{key:"_decodeUncompressed",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.pixelRepresentation(e),n=this.bitsAllocated(e),i=this._dataSet.elements.x7fe00010,r=i.dataOffset,o=this.numberOfChannels(),a=this.rows(e)*this.columns(e)*o,s=0,l=this._dataSet.byteArray.buffer;if(0===t&&8===n)return s=r+e*a,new Uint8Array(l,s,a);if(0===t&&16===n)return s=r+e*a*2,new Uint16Array(l,s,a);if(1===t&&16===n)return s=r+e*a*2,new Int16Array(l,s,a);if(0===t&&32===n)return s=r+e*a*4,new Uint32Array(l,s,a);if(0===t&&1===n){var u=new ArrayBuffer(a),c=new Uint8Array(u);s=r+e*a;for(var h=0,f=e*a,d=e*a+a,p=Math.floor(f/8),m=f-8*p,_=Math.ceil(d/8),g=new Uint8Array(l,r),y=p;y<=_;y++){for(;m<8;){switch(m){case 0:c[h]=1&g[y];break;case 1:c[h]=g[y]>>>1&1;break;case 2:c[h]=g[y]>>>2&1;break;case 3:c[h]=g[y]>>>3&1;break;case 4:c[h]=g[y]>>>4&1;break;case 5:c[h]=g[y]>>>5&1;break;case 6:c[h]=g[y]>>>6&1;break;case 7:c[h]=g[y]>>>7&1}if(m++,h++,h>=a)return c}m=0}}}},{key:"_convertColorSpace",value:function(e){var t=null,n=this.photometricInterpretation(),i=this.planarConfiguration();if("RGB"===n&&0===i)t=e;else if("RGB"===n&&1===i){if(e instanceof Int8Array)t=new Int8Array(e.length);else if(e instanceof Uint8Array)t=new Uint8Array(e.length);else if(e instanceof Int16Array)t=new Int16Array(e.length);else{if(!(e instanceof Uint16Array))throw"unsuported typed array: ${uncompressedData}";t=new Uint16Array(e.length)}for(var r=e.length/3,o=0,a=0,s=r,l=2*r,u=0;u<r;u++)t[o++]=e[a++],t[o++]=e[s++],t[o++]=e[l++]}else{if("YBR_FULL"!==n)throw"photometric interpolation not supported: ${photometricInterpretation}";if(e instanceof Int8Array)t=new Int8Array(e.length);else if(e instanceof Uint8Array)t=new Uint8Array(e.length);else if(e instanceof Int16Array)t=new Int16Array(e.length);else{if(!(e instanceof Uint16Array))throw"unsuported typed array: ${uncompressedData}";t=new Uint16Array(e.length)}for(var c=e.length/3,h=0,f=0,d=0;d<c;d++){var p=e[h++],m=e[h++],_=e[h++];t[f++]=p+1.402*(_-128),t[f++]=p-.34414*(m-128)-.71414*(_-128),t[f++]=p+1.772*(m-128)}}return t}},{key:"_swapFrame",value:function(e){var t=this.bitsAllocated();if(16===t)for(var n=0;n<e.length;n++)e[n]=this._swap16(e[n]);else if(32===t)for(var i=0;i<e.length;i++)e[i]=this._swap32(e[i]);return e}}]),t}(c.default);n.default=m},{"../../external/scripts/jpeg":1,"../../external/scripts/jpx":2,"./parsers.volume":130,"dicom-parser":25,"jpeg-lossless-decoder-js":35}],127:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var r=e("./parsers.dicom"),o=i(r),a=e("./parsers.nifti"),s=i(a),l=e("./parsers.nrrd"),u=i(l);n.default={Dicom:o.default,Nifti:s.default,Nrrd:u.default}},{"./parsers.dicom":126,"./parsers.nifti":128,"./parsers.nrrd":129}],128:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":s(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":s(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=e("./parsers.volume"),c=i(u),h=e("nifti-reader-js"),f=function(e){function t(e,n){r(this,t);var i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(i._id=n,i._arrayBuffer=e.buffer,i._url=e.url,i._dataSet=null,i._niftiHeader=null,i._niftiImage=null,i._ordered=!0,i._orderedData=null,i._qfac=1,!h.isNIFTI(i._arrayBuffer))throw"parsers.nifti could not parse the file";return i._dataSet=h.readHeader(i._arrayBuffer),i._niftiImage=h.readImage(i._dataSet,i._arrayBuffer),i}return a(t,e),l(t,[{key:"seriesInstanceUID",value:function(){return this._url}},{key:"numberOfFrames",value:function(){return this._dataSet.dims[3]}},{key:"numberOfChannels",value:function e(){var e=1;return this._dataSet.dims[0]>=5?(e=this._dataSet.dims[5],this._ordered=!1):128===this._dataSet.datatypeCode?e=3:2304===this._dataSet.datatypeCode&&(e=4),e}},{key:"sopInstanceUID",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return e}},{key:"rows",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._dataSet.dims[2]}},{key:"columns",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._dataSet.dims[1]}},{key:"pixelType",value:function e(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,0);return 16!==this._dataSet.datatypeCode&&64!==this._dataSet.datatypeCode&&1536!==this._dataSet.datatypeCode||(e=1),e}},{key:"bitsAllocated",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._dataSet.numBitsPerVoxel}},{key:"pixelSpacing",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return[this._dataSet.pixDims[1],this._dataSet.pixDims[2],this._dataSet.pixDims[3]]}},{key:"sliceThickness",value:function(){return null}},{key:"imageOrientation",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this._dataSet.qform_code>0){var e=0,t=this._dataSet.quatern_b,n=this._dataSet.quatern_c,i=this._dataSet.quatern_d;return e=1-(t*t+n*n+i*i),e<1e-7?(e=1/Math.sqrt(t*t+n*n+i*i),t*=e,n*=e,i*=e,e=0):e=Math.sqrt(e),this._dataSet.pixDims[0]<0&&(this._rightHanded=!1),[-(e*e+t*t-n*n-i*i),-2*(t*n+e*i),2*(t*i-e*n),-2*(t*n-e*i),-(e*e+n*n-t*t-i*i),2*(n*i+e*t)]}if(this._dataSet.sform_code>0){console.log("sform > 0");this._dataSet.srow_x,this._dataSet.srow_y,this._dataSet.srow_z}else 0===this._dataSet.qform_code&&console.log("qform === 0");return[1,0,0,0,1,0]}},{key:"imagePosition",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return[-this._dataSet.qoffset_x,-this._dataSet.qoffset_y,this._dataSet.qoffset_z]}},{key:"dimensionIndexValues",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return null}},{key:"instanceNumber",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return e}},{key:"windowCenter",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return null}},{key:"windowWidth",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return null}},{key:"rescaleSlope",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._dataSet.scl_slope}},{key:"rescaleIntercept",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._dataSet.scl_intercept}},{key:"minMaxPixelData",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=[65535,-32768],n=e.length,i=0;i<n;i++){var r=e[i];t[0]=Math.min(t[0],r),t[1]=Math.max(t[1],r)}return t}},{key:"extractPixelData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._decompressUncompressed(e)}},{key:"_decompressUncompressed",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.numberOfChannels(),n=this.rows(e)*this.columns(e)*t,i=e*n,r=this._niftiImage;return this._ordered||null!==this._orderedData||this._reorderData(),null!==this._orderedData?this._orderedData.slice(i,i+n):2===this._dataSet.datatypeCode?new Uint8Array(r,i,n):256===this._dataSet.datatypeCode?new Int8Array(r,i,n):512===this._dataSet.datatypeCode?(i*=2,new Uint16Array(r,i,n)):4===this._dataSet.datatypeCode?(i*=2,new Int16Array(r,i,n)):16===this._dataSet.datatypeCode?(i*=4,new Float32Array(r,i,n)):void 0}},{key:"_reorderData",value:function(){window.console.log("re-order");var e=this.numberOfChannels(),t=this.rows()*this.columns()*e,n=this._niftiImage,i=t*this.numberOfFrames(),r=null;this._orderedData=null,2===this._dataSet.datatypeCode?(r=new Uint8Array(n,0,i),this._orderedData=new Uint8Array(r.length)):256===this._dataSet.datatypeCode?(r=new Int8Array(n,0,i),this._orderedData=new Int8Array(r.length)):512===this._dataSet.datatypeCode?(r=new Uint16Array(n,0,i),this._orderedData=new Uint16Array(r.length)):4===this._dataSet.datatypeCode?(r=new Int16Array(n,0,i),this._orderedData=new Int16Array(r.length)):16===this._dataSet.datatypeCode&&(r=new Float32Array(n,0,i),this._orderedData=new Float32Array(r.length));for(var o=r.length/3,a=0,s=0,l=o,u=2*o,c=0;c<o;c++)this._orderedData[a++]=r[s++],this._orderedData[a++]=r[l++],this._orderedData[a++]=r[u++];this._ordered=!0}}]),t}(c.default);n.default=f},{"./parsers.volume":130,"nifti-reader-js":46}],129:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":s(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":s(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=e("./parsers.volume"),c=i(u),h=e("pako"),f=e("nrrd-js"),d=function(e){function t(e,n){r(this,t);var i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));i._id=n,i._arrayBuffer=e.buffer,i._url=e.url,i._dataSet=null,i._unpackedData=null;try{i._dataSet=f.parse(i._arrayBuffer)}catch(e){window.console.log("ooops... :(")}return window.console.log(i._dataSet),i}return a(t,e),l(t,[{key:"rightHanded",value:function(){return this._dataSet.space.match(/^right-anterior-superior/)||this._dataSet.space.match(/^left-posterior-superior/)?this._rightHanded=!0:this._rightHanded=!1,this._rightHanded}},{key:"seriesInstanceUID",value:function(){return this._url}},{key:"numberOfFrames",value:function(){return this._dataSet.sizes[2]}},{key:"numberOfChannels",value:function e(){var e=1;return e}},{key:"sopInstanceUID",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return e}},{key:"rows",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._dataSet.sizes[1]}},{key:"columns",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._dataSet.sizes[0]}},{key:"pixelType",value:function e(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,0);return"float"===this._dataSet.type&&(e=1),e}},{key:"bitsAllocated",value:function e(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,1);return"int8"===this._dataSet.type||"uint8"===this._dataSet.type||"char"===this._dataSet.type?e=8:"int16"===this._dataSet.type||"uint16"===this._dataSet.type||"short"===this._dataSet.type?e=16:"int32"!==this._dataSet.type&&"uint32"!==this._dataSet.type&&"float"!==this._dataSet.type||(e=32),e}},{key:"pixelSpacing",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,new THREE.Vector3(this._dataSet.spaceDirections[0][0],this._dataSet.spaceDirections[0][1],this._dataSet.spaceDirections[0][2])),t=new THREE.Vector3(this._dataSet.spaceDirections[1][0],this._dataSet.spaceDirections[1][1],this._dataSet.spaceDirections[1][2]),n=new THREE.Vector3(this._dataSet.spaceDirections[2][0],this._dataSet.spaceDirections[2][1],this._dataSet.spaceDirections[2][2]);return[e.length(),t.length(),n.length()]}},{key:"sliceThickness",value:function(){return null}},{key:"imageOrientation",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,this._dataSet.space.match(/right/)?-1:1),t=this._dataSet.space.match(/anterior/)?-1:1,n=new THREE.Vector3(this._dataSet.spaceDirections[0][0]*e,this._dataSet.spaceDirections[0][1]*t,this._dataSet.spaceDirections[0][2]);n.normalize();var i=new THREE.Vector3(this._dataSet.spaceDirections[1][0]*e,this._dataSet.spaceDirections[1][1]*t,this._dataSet.spaceDirections[1][2]);return i.normalize(),[n.x,n.y,n.z,i.x,i.y,i.z]}},{key:"imagePosition",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return[this._dataSet.spaceOrigin[0],this._dataSet.spaceOrigin[1],this._dataSet.spaceOrigin[2]]}},{key:"dimensionIndexValues",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return null}},{key:"instanceNumber",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return e}},{key:"windowCenter",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return null}},{key:"windowWidth",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return null}},{key:"rescaleSlope",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return 1}},{key:"rescaleIntercept",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return 0}},{key:"minMaxPixelData",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=[65535,-32768],n=e.length,i=0;i<n;i++){var r=e[i];t[0]=Math.min(t[0],r),t[1]=Math.max(t[1],r)}return t}},{key:"extractPixelData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._decompressUncompressed(e)}},{key:"_decompressUncompressed",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this._dataSet.buffer,n=this.numberOfChannels(),i=this.rows(e)*this.columns(e)*n;this.rightHanded()||(e=this.numberOfFrames()-1-e);var r=e*i;if(null===this._unpackedData&&"gzip"===this._dataSet.encoding){var o=h.inflate(this._dataSet.buffer);this._unpackedData=o.buffer,t=this._unpackedData}else"gzip"===this._dataSet.encoding&&(t=this._unpackedData);return"int8"===this._dataSet.type||"char"===this._dataSet.type?(r=r,new Int8Array(t,r,i)):"uint8"===this._dataSet.type?(r=r,new Uint8Array(t,r,i)):"int16"===this._dataSet.type||"short"===this._dataSet.type?(r*=2,new Int16Array(t,r,i)):"uint16"===this._dataSet.type?(r*=2,new Uint16Array(t,r,i)):"int32"===this._dataSet.type?(r*=4,new Int32Array(t,r,i)):"uint32"===this._dataSet.type?(r*=4,new Uint32Array(t,r,i)):"float"===this._dataSet.type?(r*=4,new Float32Array(t,r,i)):void 0}}]),t}(c.default);n.default=d},{"./parsers.volume":130,"nrrd-js":50,pako:51}],130:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(){i(this,e),this._rightHanded=!0}return r(e,[{key:"pixelRepresentation",value:function(){return 0}},{key:"modality",value:function(){return"unkown"}},{key:"segmentationType",value:function(){return"unknown"}},{key:"segmentationSegments",value:function(){return[]}},{key:"referencedSegmentNumber",value:function(e){return-1}},{key:"rightHanded",value:function(){return this._rightHanded}},{key:"_decompressUncompressed",value:function(){}},{key:"_swap16",value:function(e){return(255&e)<<8|e>>8&255}},{key:"_swap32",value:function(e){return(255&e)<<24|(65280&e)<<8|e>>8&65280|e>>24&255}},{key:"invert",value:function(){return!1}}]),e}();n.default=o},{}],131:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":s(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":s(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=e("../shaders.base"),c=i(u),h=function(e){function t(){r(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name="intersectBox",e._rayOrigin="rayOrigin",e._rayDirection="rayDirection",e._aabbMin="aabbMin",e._aabbMax="aabbMax",e._tNear="tNear",e._tFar="tFar",e._intersect="intersect",e}return a(t,e),l(t,[{key:"api",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._base,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._rayOrigin,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._rayDirection,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._aabbMin,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this._aabbMax,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:this._tNear,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:this._tFar,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:this._intersect;return this._base=e,this.compute(t,n,i,r,o,a,s)}},{key:"compute",value:function(e,t,n,i,r,o,a){return this.computeDefinition(),this._base._functions[this._name]=this._definition,this._name+"("+e+", "+t+", "+n+", "+i+", "+r+", "+o+", "+a+");"}},{key:"computeDefinition",value:function(){this._definition="\nvoid "+this._name+"(vec3 rayOrigin, vec3 rayDirection, vec3 boxMin, vec3 boxMax, out float tNear, out float tFar, out bool intersect){\n  // compute intersection of ray with all six bbox planes\n  vec3 invRay = vec3(1.) / rayDirection;\n  vec3 tBot = invRay * (boxMin - rayOrigin);\n  vec3 tTop = invRay * (boxMax - rayOrigin);\n  // re-order intersections to find smallest and largest on each axis\n  vec3 tMin = min(tTop, tBot);\n  vec3 tMax = max(tTop, tBot);\n  // find the largest tMin and the smallest tMax\n  float largest_tMin = max(max(tMin.x, tMin.y), max(tMin.x, tMin.z));\n  float smallest_tMax = min(min(tMax.x, tMax.y), min(tMax.x, tMax.z));\n  tNear = largest_tMin;\n  tFar = smallest_tMax;\n  intersect = smallest_tMax > largest_tMin;\n}\n\n    "}}]),t}(c.default);n.default=new h},{"../shaders.base":137}],132:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":s(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":s(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=e("../shaders.base"),c=i(u),h=function(e){function t(){r(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name="texture3d",e._dataCoordinates="dataCoordinates",e._dataValue="dataValue",e._offset="offset",e}return a(t,e),l(t,[{key:"api",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._base,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._dataCoordinates,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._dataValue,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._offset;return this._base=e,this.compute(t,n,i)}},{key:"compute",value:function(e,t,n){return this.computeDefinition(),this._base._functions[this._name]=this._definition,this._name+"("+e+", "+t+", "+n+");"}},{key:"computeDefinition",value:function(){this._definition="\nvoid "+this._name+"(in ivec3 dataCoordinates, out vec4 dataValue, out int offset){\n    \n  int index = dataCoordinates.x\n            + dataCoordinates.y * uDataDimensions.x\n            + dataCoordinates.z * uDataDimensions.y * uDataDimensions.x;\n  int indexP = int(index/uPackedPerPixel);\n  offset = index - 2*indexP;\n\n  // Map data index to right sampler2D texture\n  int voxelsPerTexture = uTextureSize*uTextureSize;\n  int textureIndex = int(floor(float(indexP) / float(voxelsPerTexture)));\n  // modulo seems incorrect sometimes...\n  // int inTextureIndex = int(mod(float(index), float(textureSize*textureSize)));\n  int inTextureIndex = indexP - voxelsPerTexture*textureIndex;\n\n  // Get row and column in the texture\n  int colIndex = int(mod(float(inTextureIndex), float(uTextureSize)));\n  int rowIndex = int(floor(float(inTextureIndex)/float(uTextureSize)));\n\n  // Map row and column to uv\n  vec2 uv = vec2(0,0);\n  uv.x = (0.5 + float(colIndex)) / float(uTextureSize);\n  uv.y = 1. - (0.5 + float(rowIndex)) / float(uTextureSize);\n\n  //\n  if(textureIndex == 0){ dataValue = texture2D(uTextureContainer[0], uv); }\n  else if(textureIndex == 1){dataValue = texture2D(uTextureContainer[1], uv);}\n  else if(textureIndex == 2){ dataValue = texture2D(uTextureContainer[2], uv); }\n  else if(textureIndex == 3){ dataValue = texture2D(uTextureContainer[3], uv); }\n  else if(textureIndex == 4){ dataValue = texture2D(uTextureContainer[4], uv); }\n  else if(textureIndex == 5){ dataValue = texture2D(uTextureContainer[5], uv); }\n  else if(textureIndex == 6){ dataValue = texture2D(uTextureContainer[6], uv); }\n\n}\n    ";
}}]),t}(c.default);n.default=new h},{"../shaders.base":137}],133:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":s(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":s(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=e("../shaders.base"),c=i(u),h=function(e){function t(){r(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name="unpack",e._packedData="packedData",e._offset="offset",e._unpackedData="unpackedData",e._base._uniforms={uNumberOfChannels:{value:1},uBitsAllocated:{value:16},uPixelType:{value:0}},e}return a(t,e),l(t,[{key:"api",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._base,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._packedData,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._offset,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._unpackedData;return this._base=e,this.compute(t,n,i)}},{key:"compute",value:function(e,t,n){return this.computeDefinition(),this._base._functions[this._name]=this._definition,this._name+"("+e+", "+t+", "+n+");"}},{key:"computeDefinition",value:function(){var e="";if(1===this._base._uniforms.uNumberOfChannels.value)switch(this._base._uniforms.uBitsAllocated.value){case 1:case 8:e=this.upack8();break;case 16:e=this.upack16();break;case 32:e=this.upack32();break;default:e=this.upackDefault()}else e=this.upackIdentity();this._definition="\nvoid "+this._name+"(in vec4 packedData, in int offset, out vec4 unpackedData){\n\n"+e+"\n\n}  \n    "}},{key:"upack8",value:function(){return this._base._functions.uInt8=this.uInt8(),"\nuInt8(\n  packedData.r,\n  unpackedData.x);\n    "}},{key:"upack16",value:function(){return this._base._functions.uInt16=this.uInt16(),"\nuInt16(\n  packedData.r * float( 1 - offset) + packedData.b * float(offset),\n  packedData.g * float( 1 - offset) + packedData.a * float(offset),\n  unpackedData.x);\n    "}},{key:"upack32",value:function(){return 0===this._base._uniforms.uPixelType.value?(this._base._functions.uInt32=this.uInt32(),"\nuInt32(\n  packedData.r,\n  packedData.g,\n  packedData.b,\n  packedData.a,\n  unpackedData.x);\n      "):(this._base._functions.uFloat32=this.uFloat32(),"\nuFloat32(\n  packedData.r,\n  packedData.g,\n  packedData.b,\n  packedData.a,\n  unpackedData.x);\n      ")}},{key:"upackIdentity",value:function(){return"\n\nunpackedData = packedData;\n\n      "}},{key:"uInt8",value:function(){return"\nvoid uInt8(in float r, out float value){\n  value = r * 256.;\n}\n    "}},{key:"uInt16",value:function(){return"\nvoid uInt16(in float r, in float a, out float value){\n  value = r * 256. + a * 65536.;\n}\n    "}},{key:"uInt32",value:function(){return"\nvoid uInt32(in float r, in float g, in float b, in float a, out float value){\n  value = r * 256. + g * 65536. + b * 16777216. + a * 4294967296.;\n}\n    "}},{key:"uFloat32",value:function(){return"\nvoid uFloat32(in float r, in float g, in float b, in float a, out float value){\n\n  // create arrays containing bits for rgba values\n  // value between 0 and 255\n  value = r * 255.;\n  int bytemeR[8];\n  bytemeR[0] = int(floor(value / 128.));\n  value -= float(bytemeR[0] * 128);\n  bytemeR[1] = int(floor(value / 64.));\n  value -= float(bytemeR[1] * 64);\n  bytemeR[2] = int(floor(value / 32.));\n  value -= float(bytemeR[2] * 32);\n  bytemeR[3] = int(floor(value / 16.));\n  value -= float(bytemeR[3] * 16);\n  bytemeR[4] = int(floor(value / 8.));\n  value -= float(bytemeR[4] * 8);\n  bytemeR[5] = int(floor(value / 4.));\n  value -= float(bytemeR[5] * 4);\n  bytemeR[6] = int(floor(value / 2.));\n  value -= float(bytemeR[6] * 2);\n  bytemeR[7] = int(floor(value));\n\n  value = g * 255.;\n  int bytemeG[8];\n  bytemeG[0] = int(floor(value / 128.));\n  value -= float(bytemeG[0] * 128);\n  bytemeG[1] = int(floor(value / 64.));\n  value -= float(bytemeG[1] * 64);\n  bytemeG[2] = int(floor(value / 32.));\n  value -= float(bytemeG[2] * 32);\n  bytemeG[3] = int(floor(value / 16.));\n  value -= float(bytemeG[3] * 16);\n  bytemeG[4] = int(floor(value / 8.));\n  value -= float(bytemeG[4] * 8);\n  bytemeG[5] = int(floor(value / 4.));\n  value -= float(bytemeG[5] * 4);\n  bytemeG[6] = int(floor(value / 2.));\n  value -= float(bytemeG[6] * 2);\n  bytemeG[7] = int(floor(value));\n\n  value = b * 255.;\n  int bytemeB[8];\n  bytemeB[0] = int(floor(value / 128.));\n  value -= float(bytemeB[0] * 128);\n  bytemeB[1] = int(floor(value / 64.));\n  value -= float(bytemeB[1] * 64);\n  bytemeB[2] = int(floor(value / 32.));\n  value -= float(bytemeB[2] * 32);\n  bytemeB[3] = int(floor(value / 16.));\n  value -= float(bytemeB[3] * 16);\n  bytemeB[4] = int(floor(value / 8.));\n  value -= float(bytemeB[4] * 8);\n  bytemeB[5] = int(floor(value / 4.));\n  value -= float(bytemeB[5] * 4);\n  bytemeB[6] = int(floor(value / 2.));\n  value -= float(bytemeB[6] * 2);\n  bytemeB[7] = int(floor(value));\n\n  value = a * 255.;\n  int bytemeA[8];\n  bytemeA[0] = int(floor(value / 128.));\n  value -= float(bytemeA[0] * 128);\n  bytemeA[1] = int(floor(value / 64.));\n  value -= float(bytemeA[1] * 64);\n  bytemeA[2] = int(floor(value / 32.));\n  value -= float(bytemeA[2] * 32);\n  bytemeA[3] = int(floor(value / 16.));\n  value -= float(bytemeA[3] * 16);\n  bytemeA[4] = int(floor(value / 8.));\n  value -= float(bytemeA[4] * 8);\n  bytemeA[5] = int(floor(value / 4.));\n  value -= float(bytemeA[5] * 4);\n  bytemeA[6] = int(floor(value / 2.));\n  value -= float(bytemeA[6] * 2);\n  bytemeA[7] = int(floor(value));\n\n  // compute float32 value from bit arrays\n\n  // sign\n  int issigned = 1 - 2 * bytemeR[0];\n  //   issigned = int(pow(-1., float(bytemeR[0])));\n\n  // exponent\n  int exponent = 0;\n\n  exponent += bytemeR[1] * int(pow(2., 7.));\n  exponent += bytemeR[2] * int(pow(2., 6.));\n  exponent += bytemeR[3] * int(pow(2., 5.));\n  exponent += bytemeR[4] * int(pow(2., 4.));\n  exponent += bytemeR[5] * int(pow(2., 3.));\n  exponent += bytemeR[6] * int(pow(2., 2.));\n  exponent += bytemeR[7] * int(pow(2., 1.));\n\n  exponent += bytemeG[0];\n\n\n  // fraction\n  float fraction = 0.;\n\n  fraction = float(bytemeG[1]) * pow(2., -1.);\n  fraction += float(bytemeG[2]) * pow(2., -2.);\n  fraction += float(bytemeG[3]) * pow(2., -3.);\n  fraction += float(bytemeG[4]) * pow(2., -4.);\n  fraction += float(bytemeG[5]) * pow(2., -5.);\n  fraction += float(bytemeG[6]) * pow(2., -6.);\n  fraction += float(bytemeG[7]) * pow(2., -7.);\n\n  fraction += float(bytemeB[0]) * pow(2., -8.);\n  fraction += float(bytemeB[1]) * pow(2., -9.);\n  fraction += float(bytemeB[2]) * pow(2., -10.);\n  fraction += float(bytemeB[3]) * pow(2., -11.);\n  fraction += float(bytemeB[4]) * pow(2., -12.);\n  fraction += float(bytemeB[5]) * pow(2., -13.);\n  fraction += float(bytemeB[6]) * pow(2., -14.);\n  fraction += float(bytemeB[7]) * pow(2., -15.);\n\n  fraction += float(bytemeA[0]) * pow(2., -16.);\n  fraction += float(bytemeA[1]) * pow(2., -17.);\n  fraction += float(bytemeA[2]) * pow(2., -18.);\n  fraction += float(bytemeA[3]) * pow(2., -19.);\n  fraction += float(bytemeA[4]) * pow(2., -20.);\n  fraction += float(bytemeA[5]) * pow(2., -21.);\n  fraction += float(bytemeA[6]) * pow(2., -22.);\n  fraction += float(bytemeA[7]) * pow(2., -23.);\n\n  value = float(issigned) * pow( 2., float(exponent - 127)) * (1. + fraction);\n}\n    "}}]),t}(c.default);n.default=new h},{"../shaders.base":137}],134:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":s(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":s(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=e("../shaders.base"),c=i(u),h=e("../helpers/shaders.helpers.unpack"),f=i(h),d=e("../helpers/shaders.helpers.texture3d"),p=i(d),m=function(e){function t(){r(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name="interpolationIdentity",e._currentVoxel="currentVoxel",e._dataValue="dataValue",e}return a(t,e),l(t,[{key:"api",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._base,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._currentVoxel,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._dataValue;return this._base=e,this.compute(t,n)}},{key:"compute",value:function(e,t){return this.computeDefinition(),this._base._functions[this._name]=this._definition,this._name+"("+e+", "+t+");"}},{key:"computeDefinition",value:function(){this._definition="\nvoid "+this._name+"(in vec3 currentVoxel, out vec4 dataValue){\n  // lower bound\n  vec3 rcurrentVoxel = vec3(floor(currentVoxel.x + 0.5 ), floor(currentVoxel.y + 0.5 ), floor(currentVoxel.z + 0.5 ));\n  ivec3 voxel = ivec3(int(rcurrentVoxel.x), int(rcurrentVoxel.y), int(rcurrentVoxel.z));\n\n  vec4 tmp = vec4(0., 0., 0., 0.);\n  int offset = 0;\n\n  "+p.default.api(this._base,"voxel","tmp","offset")+"\n  "+f.default.api(this._base,"tmp","offset","dataValue")+"\n}\n    "}}]),t}(c.default);n.default=new m},{"../helpers/shaders.helpers.texture3d":132,"../helpers/shaders.helpers.unpack":133,"../shaders.base":137}],135:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t,n,i){switch(e._uniforms.uInterpolation.value){case 0:return a.default.api(e,t,n);case 1:return l.default.api(e,t,n,i);default:return a.default.api(e,t,n)}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./shaders.interpolation.identity"),a=i(o),s=e("./shaders.interpolation.trilinear"),l=i(s);n.default=r},{"./shaders.interpolation.identity":134,"./shaders.interpolation.trilinear":136}],136:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":s(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":s(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=e("../shaders.base"),c=i(u),h=e("./shaders.interpolation.identity"),f=i(h),d=function(e){function t(){r(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name="interpolationTrilinear",e._currentVoxel="currentVoxel",e._dataValue="dataValue",e._gradient="gradient",e}return a(t,e),l(t,[{key:"api",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._base,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._currentVoxel,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._dataValue,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._gradient;return this._base=e,this.compute(t,n,i)}},{key:"compute",value:function(e,t,n){return this.computeDefinition(),this._base._functions[this._name]=this._definition,this._name+"("+e+", "+t+", "+n+");"}},{key:"computeDefinition",value:function(){this._definition="\nvoid "+this._name+"(in vec3 currentVoxel, out vec4 dataValue, out vec3 gradient){\n\n  // https://en.wikipedia.org/wiki/Trilinear_interpolation\n  vec3 lower_bound = vec3(floor(currentVoxel.x), floor(currentVoxel.y), floor(currentVoxel.z));\n  if(lower_bound.x < 0.){\n    lower_bound.x = 0.;\n  }\n  if(lower_bound.y < 0.){\n    lower_bound.y = 0.;\n  }\n  if(lower_bound.z < 0.){\n    lower_bound.z = 0.;\n  }\n  \n  vec3 higher_bound = lower_bound + vec3(1);\n\n  float xd = ( currentVoxel.x - lower_bound.x ) / ( higher_bound.x - lower_bound.x );\n  float yd = ( currentVoxel.y - lower_bound.y ) / ( higher_bound.y - lower_bound.y );\n  float zd = ( currentVoxel.z - lower_bound.z ) / ( higher_bound.z - lower_bound.z );\n\n  //\n  // c00\n  //\n\n  //\n\n  vec4 v000 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c000 = vec3(lower_bound.x, lower_bound.y, lower_bound.z);\n  "+f.default.api(this._base,"c000","v000")+"\n  vec3 g000 = v000.r * vec3(-1., -1., -1.);\n\n  //\n\n  vec4 v100 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c100 = vec3(higher_bound.x, lower_bound.y, lower_bound.z);\n  "+f.default.api(this._base,"c100","v100")+"\n  vec3 g100 = v100.r * vec3(1., -1., -1.);\n\n  vec4 c00 = v000 * ( 1.0 - xd ) + v100 * xd;\n\n  //\n  // c01\n  //\n  vec4 v001 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c001 = vec3(lower_bound.x, lower_bound.y, higher_bound.z);\n  "+f.default.api(this._base,"c001","v001")+"\n  vec3 g001 = v001.r * vec3(-1., -1., 1.);\n\n  vec4 v101 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c101 = vec3(higher_bound.x, lower_bound.y, higher_bound.z);\n  "+f.default.api(this._base,"c101","v101")+"\n  vec3 g101 = v101.r * vec3(1., -1., 1.);\n\n  vec4 c01 = v001 * ( 1.0 - xd ) + v101 * xd;\n\n  //\n  // c10\n  //\n  vec4 v010 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c010 = vec3(lower_bound.x, higher_bound.y, lower_bound.z);\n  "+f.default.api(this._base,"c010","v010")+"\n  vec3 g010 = v010.r * vec3(-1., 1., -1.);\n\n  vec4 v110 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c110 = vec3(higher_bound.x, higher_bound.y, lower_bound.z);\n  "+f.default.api(this._base,"c110","v110")+"\n  vec3 g110 = v110.r * vec3(1., 1., -1.);\n\n  vec4 c10 = v010 * ( 1.0 - xd ) + v110 * xd;\n\n  //\n  // c11\n  //\n  vec4 v011 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c011 = vec3(lower_bound.x, higher_bound.y, higher_bound.z);\n  "+f.default.api(this._base,"c011","v011")+"\n  vec3 g011 = v011.r * vec3(-1., 1., 1.);\n\n  vec4 v111 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c111 = vec3(higher_bound.x, higher_bound.y, higher_bound.z);\n  "+f.default.api(this._base,"c111","v111")+"\n  vec3 g111 = v111.r * vec3(1., 1., 1.);\n\n  vec4 c11 = v011 * ( 1.0 - xd ) + v111 * xd;\n\n  // c0 and c1\n  vec4 c0 = c00 * ( 1.0 - yd) + c10 * yd;\n  vec4 c1 = c01 * ( 1.0 - yd) + c11 * yd;\n\n  // c\n  vec4 c = c0 * ( 1.0 - zd) + c1 * zd;\n  dataValue = c;\n\n  // compute gradient\n  gradient = g000 + g100 + g010 + g110 + g011 + g111 + g110 + g011;\n  // gradientMagnitude = length(gradient);\n  // // https://en.wikipedia.org/wiki/Normal_(geometry)#Transforming_normals\n  // vec3 localNormal = (-1. / gradientMagnitude) * gradient;\n  // normal = normalize(normalPixelToPatient"+this.id+" * localNormal);\n  //normal = gradient;\n\n}\n    "}}]),t}(c.default);n.default=new d},{"../shaders.base":137,"./shaders.interpolation.identity":134}],137:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(){i(this,e),this._name="shadersBase",this._base={_functions:{},_uniforms:{}},this._definition=""}return r(e,[{key:"name",get:function(){return this._name},set:function(e){this._name=e}}]),e}();n.default=o},{}],138:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=e("./interpolation/shaders.interpolation"),s=i(a),l=function(){function e(t){r(this,e),this._uniforms=t,this._functions={},this._main=""}return o(e,[{key:"functions",value:function(){""===this._main&&this.main();var e="";for(var t in this._functions)e+=this._functions[t]+"\n";return e}},{key:"uniforms",value:function(){var e="";for(var t in this._uniforms){var n=this._uniforms[t];e+="uniform "+n.typeGLSL+" "+t,n&&n.length&&(e+="["+n.length+"]"),e+=";\n"}return e}},{key:"main",value:function(){this._main="\nvoid main(void) {\n\n  // get texture coordinates of current pixel\n  vec4 dataCoordinates = uWorldToData * vPos;\n  vec3 currentVoxel = vec3(dataCoordinates.x, dataCoordinates.y, dataCoordinates.z);\n  vec4 dataValue = vec4(0., 0., 0., 0.);\n  vec3 gradient = vec3(0., 0., 0.);\n  "+(0,s.default)(this,"currentVoxel","dataValue","gradient")+"\n\n  // how do we deal wil more than 1 channel?\n  if(uNumberOfChannels == 1){\n    float intensity = dataValue.r;\n\n    // rescale/slope\n    intensity = intensity*uRescaleSlopeIntercept[0] + uRescaleSlopeIntercept[1];\n\n    float windowMin = uWindowCenterWidth[0] - uWindowCenterWidth[1] * 0.5;\n    float windowMax = uWindowCenterWidth[0] + uWindowCenterWidth[1] * 0.5;\n    intensity = ( intensity - windowMin ) / uWindowCenterWidth[1];\n\n    dataValue.r = dataValue.g = dataValue.b = intensity;\n    dataValue.a = 1.0;\n  }\n\n  // Apply LUT table...\n  //\n  if(uLut == 1){\n    // should opacity be grabbed there?\n    dataValue = texture2D( uTextureLUT, vec2( dataValue.r , 1.0) );\n  }\n\n  if(uInvert == 1){\n    dataValue = vec4(1.) - dataValue;\n    // how do we deal with that and opacity?\n    dataValue.a = 1.;\n  }\n\n  gl_FragColor = dataValue;\n\n}\n   "}},{key:"compute",value:function(){return"\n// uniforms\n"+this.uniforms()+"\n\n// varying (should fetch it from vertex directly)\nvarying vec4      vPos;\n\n// tailored functions\n"+this.functions()+"\n\n// main loop\n"+this._main+"\n      "}}]),e}();n.default=l},{"./interpolation/shaders.interpolation":135}],139:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(){i(this,e)}return r(e,null,[{key:"uniforms",value:function(){return{uTextureSize:{type:"i",value:0,typeGLSL:"int"},uTextureContainer:{type:"tv",value:[],typeGLSL:"sampler2D",length:7},uDataDimensions:{type:"iv",value:[0,0,0],typeGLSL:"ivec3"},uWorldToData:{type:"m4",value:new THREE.Matrix4,typeGLSL:"mat4"},uWindowCenterWidth:{type:"fv1",value:[0,0],typeGLSL:"float",length:2},uRescaleSlopeIntercept:{type:"fv1",value:[0,0],typeGLSL:"float",length:2},uNumberOfChannels:{type:"i",value:1,typeGLSL:"int"},uBitsAllocated:{type:"i",value:8,typeGLSL:"int"},uInvert:{type:"i",value:0,typeGLSL:"int"},uLut:{type:"i",value:0,typeGLSL:"int"},uTextureLUT:{type:"t",value:[],typeGLSL:"sampler2D"},uPixelType:{type:"i",value:0,typeGLSL:"int"},uPackedPerPixel:{type:"i",value:1,typeGLSL:"int"},uInterpolation:{type:"i",value:1,typeGLSL:"int"}}}}]),e}();n.default=o},{}],140:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(){i(this,e)}return r(e,[{key:"compute",value:function(){return"\nvarying vec4 vPos;\n\n//\n// main\n//\nvoid main() {\n\n  vPos = modelMatrix * vec4(position, 1.0 );\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0 );\n\n}\n        "}}]),e}();n.default=o},{}],141:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var r=e("./shaders.data.uniform"),o=i(r),a=e("./shaders.data.fragment"),s=i(a),l=e("./shaders.data.vertex"),u=i(l),c=e("./shaders.vr.uniform"),h=i(c),f=e("./shaders.vr.fragment"),d=i(f),p=e("./shaders.vr.vertex"),m=i(p),_=e("./shaders.layer.uniform"),g=i(_),y=e("./shaders.layer.fragment"),v=i(y),b=e("./shaders.layer.vertex"),w=i(b);n.default={DataUniform:o.default,DataFragment:s.default,DataVertex:u.default,VRUniform:h.default,VRFragment:d.default,VRVertex:m.default,LayerUniform:g.default,LayerFragment:v.default,LayerVertex:w.default}},{"./shaders.data.fragment":138,"./shaders.data.uniform":139,"./shaders.data.vertex":140,"./shaders.layer.fragment":142,"./shaders.layer.uniform":143,"./shaders.layer.vertex":144,"./shaders.vr.fragment":145,"./shaders.vr.uniform":146,"./shaders.vr.vertex":147}],142:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(t){i(this,e),this._uniforms=t,this._functions={},this._main=""}return r(e,[{key:"functions",value:function(){""===this._main&&this.main();var e="";for(var t in this._functions)e+=this._functions[t]+"\n";return e}},{key:"uniforms",value:function(){var e="";for(var t in this._uniforms){var n=this._uniforms[t];e+="uniform "+n.typeGLSL+" "+t,n&&n.length&&(e+="["+n.length+"]"),e+=";\n"}return e}},{key:"main",value:function(){this._main="\nvoid main(void) {\n\n  vec2 texc = vec2(((vProjectedCoords.x / vProjectedCoords.w) + 1.0 ) / 2.0,\n                ((vProjectedCoords.y / vProjectedCoords.w) + 1.0 ) / 2.0 );\n\n  // just silence warning for\n  vec4 dummy = vPos;\n\n  //The back position is the world space position stored in the texture.\n  vec4 baseColor0 = texture2D(uTextureBackTest0, texc);\n  vec4 baseColor1 = texture2D(uTextureBackTest1, texc);\n\n  if( uTrackMouse == 1 ){\n\n      if( vProjectedCoords.x < uMouse.x ){\n\n        gl_FragColor = baseColor0;\n\n      }\n      else{\n\n        gl_FragColor = mix( baseColor0, baseColor1, uOpacity1 );\n\n      }\n\n  }\n  else{\n\n    if( uType1 == 0 ){\n\n      //merge an image into\n      gl_FragColor = mix( baseColor0, baseColor1, uOpacity1 );\n\n    }\n    else{\n\n      float opacity = baseColor1.a;\n      gl_FragColor = mix( baseColor0, baseColor1, opacity * uOpacity1 );\n\n    }\n\n  }\n\n  return;\n}\n   "}},{key:"compute",value:function(){return"\n// uniforms\n"+this.uniforms()+"\n\n// varying (should fetch it from vertex directly)\nvarying vec4      vPos;\nvarying vec4      vProjectedCoords;\n\n// tailored functions\n"+this.functions()+"\n\n// main loop\n"+this._main+"\n      "}}]),e}();n.default=o},{}],143:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(){i(this,e)}return r(e,null,[{key:"uniforms",value:function(){return{uTextureBackTest0:{type:"t",value:[],typeGLSL:"sampler2D"},uTextureBackTest1:{type:"t",value:[],typeGLSL:"sampler2D"},uOpacity0:{type:"f",value:1,typeGLSL:"float"},uOpacity1:{type:"f",value:1,typeGLSL:"float"},uType0:{type:"i",value:0,typeGLSL:"int"},uType1:{type:"i",value:1,typeGLSL:"int"},uTrackMouse:{type:"i",value:0,typeGLSL:"int"},uMouse:{type:"v2",value:new THREE.Vector2,typeGLSL:"vec2"}}}}]),e}();n.default=o},{}],144:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(){i(this,e)}return r(e,[{key:"compute",value:function(){return"\nvarying vec4 vPos;\nvarying vec4 vProjectedCoords;\n\n//\n// main\n//\nvoid main() {\n\n  vPos = modelMatrix * vec4(position, 1.0 );\n  vProjectedCoords =  projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0 );\n\n}\n        "}}]),e}();n.default=o},{}],145:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=e("./interpolation/shaders.interpolation"),s=i(a),l=e("./helpers/shaders.helpers.intersectBox"),u=i(l),c=function(){function e(t){r(this,e),this._uniforms=t,this._functions={},this._main=""}return o(e,[{key:"functions",value:function(){""===this._main&&this.main();var e="";for(var t in this._functions)e+=this._functions[t]+"\n";return e}},{key:"uniforms",value:function(){var e="";for(var t in this._uniforms){var n=this._uniforms[t];e+="uniform "+n.typeGLSL+" "+t,n&&n.length&&(e+="["+n.length+"]"),e+=";\n"}return e}},{key:"main",value:function(){this._main="\nvoid getIntensity(in vec3 dataCoordinates, out float intensity, out vec3 gradient){\n\n  vec4 dataValue = vec4(0., 0., 0., 0.);\n  "+(0,s.default)(this,"dataCoordinates","dataValue","gradient")+"\n\n  intensity = dataValue.r;\n\n  // rescale/slope\n  intensity = intensity*uRescaleSlopeIntercept[0] + uRescaleSlopeIntercept[1];\n  // window level\n  float windowMin = uWindowCenterWidth[0] - uWindowCenterWidth[1] * 0.5;\n  intensity = ( intensity - windowMin ) / uWindowCenterWidth[1];\n}\n\nvoid main(void) {\n  const int maxSteps = 1024;\n\n  // the ray\n  vec3 rayOrigin = cameraPosition;\n  vec3 rayDirection = normalize(vPos.xyz - rayOrigin);\n\n  // the Axe-Aligned B-Box\n  vec3 AABBMin = vec3(uWorldBBox[0], uWorldBBox[2], uWorldBBox[4]);\n  vec3 AABBMax = vec3(uWorldBBox[1], uWorldBBox[3], uWorldBBox[5]);\n\n  // Intersection ray/bbox\n  float tNear, tFar;\n  bool intersect = false;\n  "+u.default.api(this,"rayOrigin","rayDirection","AABBMin","AABBMax","tNear","tFar","intersect")+"\n  if (tNear < 0.0) tNear = 0.0;\n\n  // init the ray marching\n  float tCurrent = tNear;\n  float tStep = (tFar - tNear) / float(uSteps);\n  vec4 accumulatedColor = vec4(0.0);\n  float accumulatedAlpha = 0.0;\n\n  for(int rayStep = 0; rayStep < maxSteps; rayStep++){\n    vec3 currentPosition = rayOrigin + rayDirection * tCurrent;\n    // some non-linear FUN\n    // some occlusion issue to be fixed\n    vec3 transformedPosition = currentPosition; //transformPoint(currentPosition, uAmplitude, uFrequence);\n    // world to data coordinates\n    // rounding trick\n    // first center of first voxel in data space is CENTERED on (0,0,0)\n    vec4 dataCoordinatesRaw = uWorldToData * vec4(transformedPosition, 1.0);\n    vec3 currentVoxel = vec3(dataCoordinatesRaw.x, dataCoordinatesRaw.y, dataCoordinatesRaw.z);\n    float intensity = 0.0;\n    vec3 gradient = vec3(0., 0., 0.);\n    getIntensity(currentVoxel, intensity, gradient);\n\n    vec4 colorSample;\n    float alphaSample;\n    if(uLut == 1){\n      vec4 colorFromLUT = texture2D( uTextureLUT, vec2( intensity, 1.0) );\n      // 256 colors\n      colorSample = colorFromLUT;\n      alphaSample = colorFromLUT.a;\n    }\n    else{\n      alphaSample = intensity;\n      colorSample.r = colorSample.g = colorSample.b = intensity * alphaSample;\n    }\n\n    alphaSample = alphaSample * uAlphaCorrection;\n    alphaSample *= (1.0 - accumulatedAlpha);\n\n    accumulatedColor += alphaSample * colorSample;\n    accumulatedAlpha += alphaSample;\n\n    tCurrent += tStep;\n\n    if(tCurrent > tFar || accumulatedAlpha >= 1.0 ) break;\n  }\n\n  gl_FragColor = vec4(accumulatedColor.xyz, accumulatedAlpha);\n}\n   "}},{key:"compute",value:function(){return"\n// uniforms\n"+this.uniforms()+"\n\n// varying (should fetch it from vertex directly)\nvarying vec4      vPos;\n\n// tailored functions\n"+this.functions()+"\n\n// main loop\n"+this._main+"\n      "}}]),e}();n.default=c},{"./helpers/shaders.helpers.intersectBox":131,"./interpolation/shaders.interpolation":135}],146:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(){i(this,e)}return r(e,null,[{key:"uniforms",value:function(){return{uTextureSize:{type:"i",value:0,typeGLSL:"int"},uTextureContainer:{type:"tv",value:[],typeGLSL:"sampler2D",length:7},uDataDimensions:{type:"iv",value:[0,0,0],typeGLSL:"ivec3"},uWorldToData:{type:"m4",value:new THREE.Matrix4,typeGLSL:"mat4"},uWindowCenterWidth:{type:"fv1",value:[0,0],typeGLSL:"float",length:2},uRescaleSlopeIntercept:{
type:"fv1",value:[0,0],typeGLSL:"float",length:2},uNumberOfChannels:{type:"i",value:1,typeGLSL:"int"},uBitsAllocated:{type:"i",value:8,typeGLSL:"int"},uInvert:{type:"i",value:0,typeGLSL:"int"},uLut:{type:"i",value:0,typeGLSL:"int"},uTextureLUT:{type:"t",value:[],typeGLSL:"sampler2D"},uPixelType:{type:"i",value:0,typeGLSL:"int"},uPackedPerPixel:{type:"i",value:1,typeGLSL:"int"},uInterpolation:{type:"i",value:1,typeGLSL:"int"},uWorldBBox:{type:"fv1",value:[0,0,0,0,0,0],typeGLSL:"float",length:6},uSteps:{type:"i",value:256,typeGLSL:"int"},uAlphaCorrection:{type:"f",value:.5,typeGLSL:"float"},uFrequence:{type:"f",value:0,typeGLSL:"float"},uAmplitude:{type:"f",value:0,typeGLSL:"float"}}}}]),e}();n.default=o},{}],147:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(){i(this,e)}return r(e,[{key:"compute",value:function(){return"\nvarying vec4 vPos;\n\n//\n// main\n//\nvoid main() {\n\n  vPos = modelMatrix * vec4(position, 1.0 );\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0 );\n\n}\n        "}}]),e}();n.default=o},{}],148:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),l=function(e){function t(){i(this,t);var e=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._enabled=!0,e._selected=!1,e._hovered=!1,e._active=!1,e._colors={default:"#00B0FF",active:"#FFEB3B",hover:"#F50057",select:"#76FF03"},e._color=e._colors.default,e._dragged=!1,e._displayed=!0,e}return o(t,e),s(t,[{key:"update",value:function(){window.console.log("update() should be overloaded!")}},{key:"updateColor",value:function(){this._active?this._color=this._colors.active:this._hovered?this._color=this._colors.hover:this._selected?this._color=this._colors.select:this._color=this._colors.default}},{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled=e,this.update()}},{key:"selected",get:function(){return this._selected},set:function(e){this._selected=e,this.update()}},{key:"hovered",get:function(){return this._hovered},set:function(e){this._hovered=e,this.update()}},{key:"dragged",get:function(){return this._dragged},set:function(e){this._dragged=e,this.update()}},{key:"displayed",get:function(){return this._displayed},set:function(e){this._displayed=e,this.update()}},{key:"active",get:function(){return this._active},set:function(e){this._active=e,this.update()}},{key:"color",get:function(){return this._color},set:function(e){this._color=e,this.update()}}]),t}(THREE.Object3D);n.default=l},{}],149:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":s(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":s(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=e("../../src/widgets/widgets.base"),c=i(u),h=e("../../src/core/core.intersections"),f=i(h),d=function(e){function t(e,n,i,a){r(this,t);var s=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return s._targetMesh=e,s._controls=n,s._camera=i,s._container=a,s._plane={position:new THREE.Vector3,direction:new THREE.Vector3},s._offset=new THREE.Vector3,s._raycaster=new THREE.Raycaster,s._tracking=!1,s._mouse=new THREE.Vector2,s._worldPosition=new THREE.Vector3,s._screenPosition=new THREE.Vector2,s._material=null,s._geometry=null,s._mesh=null,s._meshDisplayed=!0,s._meshHovered=!1,s._meshStyle="sphere",s._dom=null,s._domDisplayed=!0,s._domHovered=!1,s._domStyle="circle",null!==s._targetMesh&&s._worldPosition.copy(s._targetMesh.position),s._screenPosition=s.worldToScreen(s._worldPosition,s._camera,s._container),s.create(),s.onMove=s.onMove.bind(s),s.onHover=s.onHover.bind(s),s.addEventListeners(),s}return a(t,e),l(t,[{key:"addEventListeners",value:function(){this._dom.addEventListener("mouseenter",this.onHover),this._dom.addEventListener("mouseleave",this.onHover),this._container.addEventListener("mousewheel",this.onMove),this._container.addEventListener("DOMMouseScroll",this.onMove)}},{key:"removeEventListeners",value:function(){this._dom.removeEventListener("mouseenter",this.onHover),this._dom.removeEventListener("mouseleave",this.onHover),this._container.removeEventListener("mousewheel",this.onMove),this._container.removeEventListener("DOMMouseScroll",this.onMove)}},{key:"create",value:function(){this.createMesh(),this.createDOM()}},{key:"onStart",value:function(e){if(e.preventDefault(),this._raycaster.setFromCamera(this._mouse,this._camera),this._raycaster.ray.position=this._raycaster.ray.origin,this._hovered){if(this._active=!0,this._controls.enabled=!1,this._targetMesh){var t=this._raycaster.intersectObject(this._targetMesh);t.length>0&&this._offset.copy(t[0].point).sub(this._mesh.position)}else{var n=f.default.rayPlane(this._raycaster.ray,this._plane);null!==n&&this._offset.copy(n).sub(this._plane.position)}this.update()}}},{key:"onEnd",value:function(e){e.preventDefault(),this._tracking!==!0&&(!this._dragged&&this._active&&(this._selected=!this._selected),this._active=!1,this._dragged=!1,this._controls.enabled=!0,this.update())}},{key:"onMove",value:function(e){if(e.preventDefault(),this._mouse.set(event.clientX/this._container.offsetWidth*2-1,2*-(event.clientY/this._container.offsetHeight)+1),this._screenPosition=this.worldToScreen(this._worldPosition,this._camera,this._container),this._raycaster.setFromCamera(this._mouse,this._camera),this._raycaster.ray.position=this._raycaster.ray.origin,this._active)if(this._dragged=!0,null!==this._targetMesh){var t=this._raycaster.intersectObject(this._targetMesh);t.length>0&&this._worldPosition.copy(t[0].point.sub(this._offset))}else{0===this._plane.direction.length()&&(this._plane.position.copy(this._worldPosition),this._plane.direction.copy(this._camera.getWorldDirection()));var n=f.default.rayPlane(this._raycaster.ray,this._plane);null!==n&&this._worldPosition.copy(n.sub(this._offset))}else this.onHover(null),null===this._targetMesh&&(this._plane.position.copy(this._worldPosition),this._plane.direction.copy(this._camera.getWorldDirection()));this.update()}},{key:"onHover",value:function(e){e&&(e.preventDefault(),this.hoverDom(e)),this.hoverMesh(),this._hovered=this._meshHovered||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"}},{key:"update",value:function(){this.updateColor(),this.updateMeshColor(),this.updateMeshPosition(),this.updateDOMColor(),this.updateDOMPosition()}},{key:"updateMeshColor",value:function(){this._material&&this._material.color.set(this._color)}},{key:"updateMeshPosition",value:function(){this._mesh&&(this._mesh.position.x=this._worldPosition.x,this._mesh.position.y=this._worldPosition.y,this._mesh.position.z=this._worldPosition.z)}},{key:"hoverMesh",value:function(){var e=this._raycaster.intersectObject(this._mesh);this._meshHovered=e.length>0}},{key:"hoverDom",value:function(e){this._domHovered="mouseenter"===e.type}},{key:"worldToScreen",value:function(e,t,n){var i=e.clone();return i.project(t),i.x=Math.round((i.x+1)*n.offsetWidth/2),i.y=Math.round((-i.y+1)*n.offsetHeight/2),i.z=0,i}},{key:"createMesh",value:function(){this._geometry=new THREE.SphereGeometry(2,32,32),this._material=new THREE.MeshBasicMaterial({wireframe:!0,wireframeLinewidth:2}),this._mesh=new THREE.Mesh(this._geometry,this._material),this._mesh.position.x=this._worldPosition.x,this._mesh.position.y=this._worldPosition.y,this._mesh.position.z=this._worldPosition.z,this._mesh.visible=!0,this.updateMeshColor(),this.add(this._mesh)}},{key:"createDOM",value:function(){this._dom=document.createElement("div"),this._dom.setAttribute("id",this.uuid),this._dom.setAttribute("class","widgets handle"),this._dom.style.border="2px solid",this._dom.style.backgroundColor="#F9F9F9",this._dom.style.color="#F9F9F9",this._dom.style.position="absolute",this._dom.style.width="12px",this._dom.style.height="12px",this._dom.style.margin="-6px",this._dom.style.borderRadius="50%",this._dom.style.transformOrigin="0 100%";var e=this._screenPosition.y-this._container.offsetHeight;this._dom.style.transform="translate3D("+this._screenPosition.x+"px, "+e+"px, 0)",this.updateDOMColor(),this._container.appendChild(this._dom)}},{key:"updateDOMPosition",value:function(){if(this._dom){var e=this._screenPosition.y-this._container.offsetHeight;this._dom.style.transform="translate3D("+this._screenPosition.x+"px, "+e+"px, 0)"}}},{key:"updateDOMColor",value:function(){this._dom.style.borderColor=""+this._color}},{key:"free",value:function(){this.removeEventListeners()}},{key:"worldPosition",set:function(e){this._worldPosition.copy(e),this._screenPosition=this.worldToScreen(this._worldPosition,this._camera,this._container),this.update()},get:function(){return this._worldPosition}},{key:"screenPosition",set:function(e){this._screenPosition=e},get:function(){return this._screenPosition}},{key:"active",get:function(){return this._active},set:function(e){this._active=e,this._controls.enabled=!this._active,this.update()}},{key:"tracking",get:function(){return this._tracking},set:function(e){this._tracking=e,this.update()}}]),t}(c.default);n.default=d},{"../../src/core/core.intersections":93,"../../src/widgets/widgets.base":148}],150:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var r=e("./widgets.handle"),o=i(r),a=e("./widgets.voxelProbe"),s=i(a),l=e("./widgets.ruler"),u=i(l);n.default={Handle:o.default,VoxelProbe:s.default,Ruler:u.default}},{"./widgets.handle":149,"./widgets.ruler":151,"./widgets.voxelProbe":152}],151:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":s(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":s(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=e("../../src/widgets/widgets.base"),c=i(u),h=e("../../src/widgets/widgets.handle"),f=i(h),d=function(e){function t(e,n,i,a){r(this,t);var s=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));s._targetMesh=e,s._controls=n,s._camera=i,s._container=a,s._active=!0,s._worldPosition=new THREE.Vector3,null!==s._targetMesh&&(s._worldPosition=s._targetMesh.position),s._material=null,s._geometry=null,s._mesh=null,s._line=null,s._distance=null,s._handles=[];var l=new f.default(s._targetMesh,s._controls,s._camera,s._container);l.worldPosition=s._worldPosition,l.hovered=!0,s.add(l),s._handles.push(l);var u=new f.default(s._targetMesh,s._controls,s._camera,s._container);return u.worldPosition=s._worldPosition,u.hovered=!0,u.active=!0,u.tracking=!0,s.add(u),s._handles.push(u),s.create(),s.onMove=s.onMove.bind(s),s.addEventListeners(),s}return a(t,e),l(t,[{key:"addEventListeners",value:function(){this._container.addEventListener("mousewheel",this.onMove),this._container.addEventListener("DOMMouseScroll",this.onMove)}},{key:"onMove",value:function(e){this._dragged=!0,this._handles[0].onMove(e),this._handles[1].onMove(e),this._hovered=this._handles[0].hovered||this._handles[1].hovered,this.update()}},{key:"onStart",value:function(e){this._dragged=!1,this._handles[0].onStart(e),this._handles[1].onStart(e),this._active=this._handles[0].active||this._handles[1].active,this.update()}},{key:"onEnd",value:function(e){this._handles[0].onEnd(e),window.console.log(this),this._dragged||!this._handles[1].tracking?(this._handles[1].tracking=!1,this._handles[1].onEnd(e)):this._handles[1].tracking=!1,this._active=this._handles[0].active||this._handles[1].active,this.update()}},{key:"create",value:function(){this.createMesh(),this.createDOM()}},{key:"update",value:function(){this.updateColor(),this.updateMeshColor(),this.updateMeshPosition(),this.updateDOMPosition(),this.updateDOMColor()}},{key:"createMesh",value:function(){this._geometry=new THREE.Geometry,this._geometry.vertices.push(this._handles[0].worldPosition),this._geometry.vertices.push(this._handles[1].worldPosition),this._material=new THREE.LineBasicMaterial,this.updateMeshColor(),this._mesh=new THREE.Line(this._geometry,this._material),this._mesh.visible=!0,this.add(this._mesh)}},{key:"updateMeshColor",value:function(){this._material&&this._material.color.set(this._color)}},{key:"updateMeshPosition",value:function(){this._geometry&&(this._geometry.verticesNeedUpdate=!0)}},{key:"createDOM",value:function(){this._line=document.createElement("div"),this._line.setAttribute("class","widgets handle line"),this._line.style.position="absolute",this._line.style.transformOrigin="0 100%",this._line.style.marginTop="-1px",this._line.style.height="2px",this._line.style.width="3px",this._container.appendChild(this._line),this._distance=document.createElement("div"),this._distance.setAttribute("class","widgets handle distance"),this._distance.style.border="2px solid",this._distance.style.backgroundColor="#F9F9F9",this._distance.style.color="#353535",this._distance.style.padding="4px",this._distance.style.position="absolute",this._distance.style.transformOrigin="0 100%",this._distance.innerHTML="Hello, world!",this._container.appendChild(this._distance),this.updateDOMColor()}},{key:"updateDOMPosition",value:function(){var e=this._handles[0].screenPosition.x,t=this._handles[0].screenPosition.y,n=this._handles[1].screenPosition.x,i=this._handles[1].screenPosition.y,r=e+(n-e)/2,o=t+(i-t)/2,a=Math.sqrt((e-n)*(e-n)+(t-i)*(t-i)),s=180*Math.atan2(i-t,n-e)/Math.PI,l=t-this._container.offsetHeight,u="translate3D("+e+"px,"+l+"px, 0)";u+=" rotate("+s+"deg)",this._line.style.transform=u,this._line.style.width=a;var c=this._handles[0].worldPosition,h=this._handles[1].worldPosition;this._distance.innerHTML=Math.sqrt((c.x-h.x)*(c.x-h.x)+(c.y-h.y)*(c.y-h.y)+(c.z-h.z)*(c.z-h.z)).toFixed(2)+" mm";var f=o-this._container.offsetHeight-this._distance.offsetHeight/2;r-=this._distance.offsetWidth/2;var d="translate3D("+Math.round(r)+"px,"+Math.round(f)+"px, 0)";this._distance.style.transform=d}},{key:"updateDOMColor",value:function(){this._line.style.backgroundColor=""+this._color,this._distance.style.borderColor=""+this._color}},{key:"worldPosition",get:function(){return this._worldPosition},set:function(e){this._worldPosition=e,this._handles[0].worldPosition=this._worldPosition,this._handles[1].worldPosition=this._worldPosition,this.update()}}]),t}(c.default);n.default=d},{"../../src/widgets/widgets.base":148,"../../src/widgets/widgets.handle":149}],152:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":s(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":s(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=e("../../src/helpers/helpers.voxel"),c=i(u),h=function(e){function t(e,n,i,a,s){r(this,t);var l=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return l._enabled=!0,l._targetMesh=n,l._stack=e,l._container=s,l._controls=i,l._camera=a,l._mouse={x:0,y:0,screenX:0,screenY:0},l._showFrame=-1,l._raycaster=new THREE.Raycaster,l._draggingMouse=!1,l._active=-1,l._hover=-1,l._closest=null,l._selected=[],l._voxels=[],l._current=new c.default(e.worldCenter(),e),l._current._showVoxel=!0,l._current._showDomSVG=!0,l._current._showDomMeasurements=!0,l.add(l._current),l._container.addEventListener("mousedown",l.onMouseDown.bind(l),!1),l._container.addEventListener("mouseup",l.onMouseUp.bind(l),!1),l._container.addEventListener("mousemove",l.onMouseMove.bind(l),!1),l._container.addEventListener("mousewheel",l.onMouseMove.bind(l),!1),l._container.addEventListener("DOMMouseScroll",l.onMouseMove.bind(l),!1),window.addEventListener("keypress",l.onKeyPress.bind(l),!1),l._defaultColor="#00B0FF",l._activeColor="#FFEB3B",l._hoverColor="#F50057",l._selectedColor="#76FF03",l._showVoxel=!0,l._showDomSVG=!0,l._showDomMeasurements=!0,l}return a(t,e),l(t,[{key:"isEnabled",value:function(){}},{key:"onKeyPress",value:function(e){this._enabled!==!1&&100===e.keyCode&&this.deleteAllSelected()}},{key:"onMouseMove",value:function(){this._enabled!==!1&&(this.updateRaycaster(this._raycaster,event,this._container),this._draggingMouse=!0,this.update())}},{key:"onMouseDown",value:function(e){this._enabled!==!1&&(this.updateRaycaster(this._raycaster,e,this._container),this._draggingMouse=!1,this.activateVoxel())}},{key:"onMouseUp",value:function(e){this._enabled!==!1&&(this.updateRaycaster(this._raycaster,e,this._container),this._draggingMouse===!1?this._active===-1?this.createVoxel():(this.selectVoxel(),this.activateVoxel()):this._active>=0&&this.activateVoxel())}},{key:"updateRaycaster",value:function(e,t,n){this._mouse={x:t.clientX/n.offsetWidth*2-1,y:2*-(t.clientY/n.offsetHeight)+1,screenX:t.clientX,screenY:t.clientY},e.setFromCamera(this._mouse,this._camera)}},{key:"updateColor",value:function(e){e._active?e.color=this._activeColor:e.hover?e.color=this._hoverColor:e.selected?e.color=this._selectedColor:e.color=this._defaultColor}},{key:"deleteAllSelected",value:function(){for(var e=this._voxels.length;e--;){var t=this._selected.indexOf(e);t>=0&&(this._active===e&&(this._active=-1),this.remove(this._voxels[e]),this._voxels[e].removeTest(),this._voxels.splice(e,1))}this._selected=[],this._closest=null}},{key:"selectVoxel",value:function(){var e=this._selected.indexOf(this._active);e===-1?(this._selected.push(this._active),this._voxels[this._active].selected=!0,this.updateColor(this._voxels[this._active])):(this._selected.splice(e,1),this._voxels[this._active].selected=!1)}},{key:"activateVoxel",value:function(){if(this._active===-1){var e=this._raycaster.intersectObject(this._targetMesh);if(e.length>0&&(this._hover>=0||null!==this._closest&&this._voxels[this._closest].distance<10)){var t=Math.max(this._hover,this._closest);this._voxels[t]._active=!0,this.updateColor(this._voxels[t]),this._active=t,this._controls.enabled=!1}}else this._voxels[this._active].active=!1,this._active=-1,this._controls.enabled=!0}},{key:"createVoxel",value:function(){if(!(this._hover>=0)){var e=this._raycaster.intersectObject(this._targetMesh);if(e.length>0){var t=new c.default(e[0].point,this._stack);this.add(t),this._voxels.push(t),t.updateVoxelScreenCoordinates(this._camera,this._container),this.hoverVoxel(t,this._mouse,this._current.voxel.dataCoordinates),this.updateColor(t),t.updateDom(this._container),t.showVoxel=this._showVoxel,t.showDomSVG=this._showDomSVG,t.showDomMeasurements=this._showDomMeasurements}}}},{key:"update",value:function(){if(this._targetMesh){var e=this._raycaster.intersectObject(this._targetMesh);e.length>0&&(this._current.worldCoordinates=e[0].point,this._current.updateVoxelScreenCoordinates(this._camera,this._container),this.updateColor(this._current),this._current.updateDom(this._container),this._current.showVoxel=this._showVoxel,this._current.showDomSVG=this._showDomSVG,this._current.showDomMeasurements=this._showDomMeasurements,this._active>=0&&(this._voxels[this._active].worldCoordinates=e[0].point)),this.updateVoxels()}}},{key:"updateVoxels",value:function(){for(var e=-1,t=null,n=0;n<this._voxels.length;n++)this._voxels[n].updateVoxelScreenCoordinates(this._camera,this._container),this.hoverVoxel(this._voxels[n],this._mouse,this._current.voxel.dataCoordinates),this.updateColor(this._voxels[n]),this.showOfIntersectsFrame(this._voxels[n],this._showFrame),this._voxels[n].updateDom(this._container),this._voxels[n].hover&&(e=n),(null===t||this._voxels[n].distance<this._voxels[t].distance)&&(t=n),this._voxels[n].showVoxel=this._showVoxel,this._voxels[n].showDomSVG=this._showDomSVG,this._voxels[n].showDomMeasurements=this._showDomMeasurements;this._hover=e,this._closest=t}},{key:"hoverVoxel",value:function(e,t,n){if(e.voxel.dataCoordinates.x===n.x&&e.voxel.dataCoordinates.y===n.y&&e.voxel.dataCoordinates.z===n.z)e.hover=!0;else{var i=t.screenX-e.voxel.screenCoordinates.x,r=t.screenY-e.voxel.screenCoordinates.y,o=Math.sqrt(i*i+r*r);e.distance=o,o>=0&&o<10?e.hover=!0:e.hover=!1}}},{key:"showOfIntersectsFrame",value:function(e,t){t===e.voxel.dataCoordinates.z||t===-1?(e._showDomSVG=!0,e._showDomMeasurements=!0):(e._showDomSVG=!1,e._showDomMeasurements=!1)}},{key:"defaultColor",set:function(e){this._defaultColor=e,this.update()},get:function(){return this._defaultColor}},{key:"activeColor",set:function(e){this._activeColor=e,this.update()},get:function(){return this._activeColor}},{key:"hoverColor",set:function(e){this._hoverColor=e,this.update()},get:function(){return this._hoverColor}},{key:"selectedColor",set:function(e){this._selectedColor=e,this.update()},get:function(){return this._selectedColor}},{key:"showVoxel",set:function(e){this._showVoxel=e,this.update()},get:function(){return this._showVoxel}},{key:"showDomSVG",set:function(e){this._showDomSVG=e,this.update()},get:function(){return this._showDomSVG}},{key:"showDomMeasurements",set:function(e){this._showDomMeasurements=e,this.update()},get:function(){return this._showDomMeasurements}}]),t}(THREE.Object3D);n.default=h},{"../../src/helpers/helpers.voxel":110}]},{},[86])(86)});