<html><head><link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../paper-ripple/paper-ripple.html">
<link rel="import" href="../paper-styles/paper-styles.html">
<link rel="import" href="../iron-resizable-behavior/iron-resizable-behavior.html">
<link rel="import" href="../moment-element/moment-with-locales-import.html">

</head><body><dom-module id="paper-calendar">
  <template>
    <style>:host{display:block;box-sizing:border-box;padding:12px 0;position:relative;width:100%;height:100%;min-width:160px;min-height:160px;color:var(--primary-text-color);-webkit-font-smoothing:antialiased;-webkit-tap-highlight-color:rgba(0,0,0,0);--ease-in-sine:cubic-bezier(0.47, 0, 0.745, 0.715);--ease-out-sine:cubic-bezier(0.39, 0.575, 0.565, 1);@apply (--paper-font-body1);@apply (--paper-calendar);overflow:hidden;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;@apply (--paper-calendar);}#calendar{position:relative;width:100%;height:100%;@apply (--layout-horizontal);}#months{height:100%;@apply (--layout-horizontal);}#months.animating .month-nav{opacity:1;}#months.animating{transition-property:transform, opacity;transition-duration:300ms;}#months.animating.swipe{transition-timing-function:var(--ease-in-sine);--webkit-transition-timing-function:var(--ease-in-sine);}#months.animating.reset{transition-timing-function:var(--ease-out-sine);--webkit-transition-timing-function:var(--ease-out-sine);}.month{height:100%;@apply (--layout-vertical);@apply (--layout-justified);@apply (--layout-flex);}.month-row, .month-nav{height:calc(100%/8);box-sizing:border-box;padding:0 calc(100%/36);}.month-col{position:relative;@apply (--layout-vertical);@apply (--layout-flex);}.month-nav{position:absolute;top:0;left:0;width:100%;opacity:1;}.month-nav .col{position:relative;@apply (--layout-vertical);@apply (--layout-center-center);}.month-nav .btn .icon{cursor:pointer;}.month-nav .btn .ripple{position:absolute;width:48px;height:48px;top:50%;left:50%;transform:translate(-50%, -50%);}.month-nav .btn.right{text-align:right;}.month-name{line-height:24px;vertical-align:middle;text-align:center;font-weight:bold;@apply (--paper-font-body2);}.month-weekdays{color:var(--secondary-text-color);}.month-col .day{cursor:default;pointer-events:none;@apply (--layout-fit);@apply (--layout-vertical);@apply (--layout-center-center);}.month-col{position:relative;width:100%;height:100%;@apply (--layout-center-center);}.day-item{border-radius:100%;width:100%;height:100%;}.day-item::selection{background:none;}.day-item.selected{background:var(--default-primary-color);}.day-item.selected .day{color:var(--text-primary-color);}.day-item:not([disabled]){cursor:pointer;}.day-item[disabled] .day{color:var(--text-disabled-color, #9d9d9d);}.day-item.today .day{color:var(--default-primary-color);}.day-item.selected.today .day{color:var(--text-primary-color);}</style>
    <div id="calendar">
      <div id="months" on-track="_onTrack" class$="{{_contentClass}}">
        <template is="dom-repeat" items="{{_months}}" as="month">
          <div class$="{{_getMonthClass('month', month)}}">
            <div class="month-row month-name layout horizontal center-center flex">
              <span>{{dateFormat(month.date, 'MMMM YYYY', locale)}}</span>
            </div>
            <div class="month-row month-weekdays week layout horizontal justified flex">
              <template is="dom-repeat" items="{{_weekdays}}">
                <div class="month-col layout vertical flex">
                  <div class="day">{{item.0}}</div>
                </div>
              </template>
            </div>
            <template is="dom-repeat" items="{{month.weeks}}" as="row">
              <div class="month-row layout horizontal justified flex">
                <template is="dom-repeat" items="{{row}}">
                  <div class="month-col">
                    <div class$="{{_getDayClass('day-item selection', item.date, today, date)}}" disabled$="{{_isDisabled(item.day, item.date, minDate, maxDate)}}" on-tap="_tapDay" date$="{{item.name}}">
                      <div class="day">{{item.day}}</div>
                    </div>
                  </div>
                </template>
              </div>
            </template>
          </div>
        </template>
      </div>
      <div id="monthNav" class="month-nav layout horizontal center">
        <div class="flex col self-stretch">
          <div class="btn" on-tap="_swipePrevMonth">
            <paper-ripple center="" class="ripple circle"></paper-ripple>
            <iron-icon class="icon flex" icon="chevron-left"></iron-icon>
          </div>
        </div>
        <div class="flex-5"></div>
        <div class="flex col self-stretch">
          <div class="btn" on-tap="_swipeNextMonth">
            <paper-ripple center="" class="ripple circle"></paper-ripple>
            <iron-icon class="icon flex" icon="chevron-right"></iron-icon>
          </div>
        </div>
      </div>
    </div>
  </template>
  <script>!function(){var t=4,e=t*t,i=.5,n=40,s=2,a=1;Polymer({is:"paper-calendar",properties:{date:{type:Date,notify:!0,value:function(){return new Date},observer:"_dateChanged"},locale:{type:String,value:"en",notify:!0,observer:"_localeChanged"},minDate:{type:Date,value:null},maxDate:{type:Date,value:null},currentMonth:{type:Number},currentYear:{type:Number},_contentClass:String,_months:Array},behaviors:[Polymer.IronResizableBehavior],observers:["_populate(currentYear, currentMonth, minDate, maxDate, locale)"],listeners:{"iron-resize":"_resizeHandler",swiped:"_onSwipe"},ready:function(){this._updateToday(),this.currentMonth=this.date.getMonth()+1,this.currentYear=this.date.getFullYear(),this._transitionEvent=this.style.WebkitTransition?"transitionEnd":"webkitTransitionEnd"},dateFormat:function(t,e,i){if(!t)return"";var n=moment(t);return n.locale(i||this.locale),n.format(e)},_localeChanged:function(t){var e=moment();e.locale(t);for(var i=[],n=0;7>n;n++)i.push(e.weekday(n).format("dd"));this._weekdays=i,this._firstDayOfWeek=e.weekday(0).format("d")},_populate:function(t,e,i,n){var s,r,h,o,l,u,d,_=[];if(i&&new Date(t,e,0)<i)return this.currentYear=i.getFullYear(),void(this.currentMonth=i.getMonth()+1);if(n&&new Date(t,e-1,1)>n)return this.currentYear=n.getFullYear(),void(this.currentMonth=n.getMonth()+1);for(var c=-a;a>=c;c++)if(h=[[]],o=1,s=new Date(t,e-1+c,1),r=s.getMonth(),d={year:s.getFullYear(),month:s.getMonth()+1,date:new Date(s)},this._monthWithinValidRange(d.year,d.month)){var m=s.getDay()-this._firstDayOfWeek;for(0>m&&(m=7+m),l=0;m>l;l++)h[0].push({day:null,date:null});for(;s.getMonth()===r;)h[0].length&&l%7===0&&h.push([]),u={date:new Date(s.getFullYear(),r,o),name:this.dateFormat(s,"YYYY-MM-DD"),year:t,month:r,day:o},h[h.length-1].push(u),s.setDate(++o),l++;for(;42>l;)l%7===0&&h.push([]),h[h.length-1].push({day:null,date:null}),l+=1;d.weeks=h,_.push(d)}_.length&&(this.set("_months",_),this.async(function(){this._updateSelection(),this._positionSlider()}))},_getDayClass:function(t,e){if(e){var i=e.getTime();i===this.today.getTime()&&(t+=" today"),i===this.date.getTime()&&(t+=" selected",this.async(function(){this._updateSelection()}))}return t},_isDisabled:function(t,e){return!t||!this._withinValidRange(e)},_getMonthClass:function(t,e){return t+" month-"+e.year+"-"+e.month},_onTrack:function(t){var a=t.detail.dx,r=t.detail.dy,h=Math.abs(a),o=Math.abs(r),l=this._containerWidth;switch(t.detail.state){case"start":this._trackStartTime=(new Date).getTime(),this._startPos=this._currentPos,this._moveQueue=[];break;case"track":this._moveQueue.length>=4&&this._moveQueue.shift(),this._moveQueue.push(t);var u=a*a+r*r;if(!this._gesture&&u>e&&(this._gesture=h>o?"pan-x":"pan-y"),"pan-x"!==this._gesture)return;this._dragging=!0;var d=l*this._months.length,_=this._startPos+a;if(_>0||-d+l>_){isNaN(parseInt(this._resistStart))&&(this._resistStart=h);var c,m,f=h-this._resistStart,g=n;c=f>l?1:f/l,m=g*(1-Math.pow(1-c,s)),_=0>a?-this._scrollWidth+l-m:m}else this._resistStart=null;this._translateX(_);break;case"end":this._resistStart=null;var p=this._getMonthIdx(this._startPos),v=this._getMonthIdx(this._currentPos),y=this._getFastestMovement(t).v,w=v!==p||y>i;if(!this._resistStart&&"pan-x"===this._gesture&&w){if(y>i){var M=l-h,D=M/y;D>300&&(D=300),this._transitionDuration=D}a>0?this._swipePrevMonth():this._swipeNextMonth()}else this._translateX(this._startPos,"reset");this._gesture=null}},_swipePrevMonth:function(){this._translateX(0,"swipe",function(){this.set("_contentClass",""),this.transform("translateX("+this._startPos+"px)",this.$.months),this.fire("swiped",{direction:"right"})}.bind(this))},_swipeNextMonth:function(){this._translateX(2*-this._containerWidth,"swipe",function(){this.set("_contentClass",""),this.transform("translateX("+this._startPos+"px)",this.$.months),this.fire("swiped",{direction:"left"})}.bind(this))},_getMonthIdx:function(t){var e=this._containerWidth,i=Math.floor((-t+e/2)/e);return 0>i?0:i},_translateX:function(t,e,i){if(isNaN(parseInt(t)))throw new Error("Not a number: "+t);this._currentPos=t,e&&(this._transitionDuration&&(this.$.months.style.transitionDuration=this._transitionDuration+"ms"),this._once(this._transitionEvent,function(){this.set("_contentClass",""),this.$.months.style.transitionDuration="",this._transitionDuration=null,this.$.monthNav.style.removeProperty("opacity"),i&&i()}.bind(this),this.$.months),this.set("_contentClass","animating "+e),this.$.monthNav.style.removeProperty("opacity"),this._once("touchstart",function(){})),window.requestAnimationFrame(function(){if(!e){var i=this._containerWidth/2,n=Math.abs(this._startPos-t),s=100*(1-n/i);s=(100-Math.pow(s,2))/100/100;var a=Math.abs(parseFloat(s).toFixed(2));this.$.monthNav.style.opacity=a}this.transform("translateX("+t+"px)",this.$.months)}.bind(this))},_getFastestMovement:function(t){for(var e,i,n,s,a,r=this._moveQueue.length,h=0,o=0,l=0,u=0;r>u&&(a=this._moveQueue[u]);u++)e=t.timeStamp-a.timeStamp,i=(t.detail.x-a.detail.x)/e,n=(t.detail.y-a.detail.y)/e,s=i*i+n*n,s>l&&(h=i,o=n,l=s);return{x:h,y:o,v:Math.sqrt(l)}},_onSwipe:function(t){"right"===t.detail.direction?this._prevMonth():this._nextMonth()},_once:function(t,e,i){function n(){i.removeEventListener(t,n),e.apply(null,arguments)}i=i||this,i.addEventListener(t,n)},_incrMonth:function(t){var e=new Date(this.currentYear,this.currentMonth-1+t),i=e.getFullYear(),n=e.getMonth()+1;this._monthWithinValidRange(i,n)&&(this.currentYear=i,this.currentMonth=n)},_prevMonth:function(){this._incrMonth(-1)},_nextMonth:function(){this._incrMonth(1)},_dateChanged:function(t,e){this._isValidDate(t)||(console.warn("Invalid date: "+t),this.date=t=e),this._withinValidRange(t)||(console.warn("Date outside of valid range: "+t),this.date=t=e),this.currentYear=t.getFullYear(),this.currentMonth=t.getMonth()+1,t=new Date(t.getTime()),t.setHours(0,0,0,0),e&&t.getTime&&e.getTime&&t.getTime()===e.getTime()||(this.set("date",t),this._updateSelection())},_tapDay:function(t){return this._withinValidRange(t.model.item.date)?void(this.date=t.model.item.date):!1},_isValidDate:function(t){return t&&t.getTime&&!isNaN(t.getTime())},_withinValidRange:function(t){return this._isValidDate(t)?(!this.minDate||t>=this.minDate)&&(!this.maxDate||t<=this.maxDate):!1},_monthWithinValidRange:function(t,e){var i=new Date(t,e-1,1),n=new Date(t,e,0);return this._withinValidRange(i)||this._withinValidRange(n)},_positionSlider:function(){if(this._months&&this._containerWidth){this._scrollWidth=this.$.calendar.offsetWidth*this._months.length,this.$.months.style.minWidth=this._scrollWidth+"px";var t=12*this.currentYear+this.currentMonth-(12*this._months[0].year+this._months[0].month);this._translateX(-t*this._containerWidth)}},_updateSelection:function(){var t=this.$$(".day-item.selected");if(t){t.style.height="",t.style.width="";var e=t.parentElement.offsetWidth,i=t.parentElement.offsetHeight;t.style.flex="",window.requestAnimationFrame(function(){e>0&&i>e?t.style.height=e+"px":i>0&&(t.style.width=i+"px")})}},_resizeHandler:function(){this._containerWidth=this.$.calendar.offsetWidth,this._positionSlider(),this._updateSelection()},_getDayName:function(t){return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()},_updateToday:function(){this.today=new Date,this.today.setHours(0,0,0,0)}})}();</script>
</dom-module>
</body></html>