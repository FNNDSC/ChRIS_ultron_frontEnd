<!DOCTYPE html><html><head>
  <title>app-route</title>

  <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../../web-component-tester/browser.js"></script>

  <link rel="import" href="../../polymer/polymer.html">
  <link rel="import" href="../app-route.html">
  <link rel="import" href="./redirection.html">
</head>
<body>
  <test-fixture id="BasicRoute">
    <template>
      <app-route pattern="/user/:username">
      </app-route>
    </template>
  </test-fixture>

  <test-fixture id="ChainedRoutes">
    <template is="dom-template">
      <app-route pattern="/foo/:foo" route="{{numberOneTopRoute}}" data="{{fooData}}" tail="{{fooRoute}}">
      </app-route>

      <app-route pattern="/bar/:bar" route="{{fooRoute}}" data="{{barData}}">
      </app-route>

      <app-route pattern="/baz/:baz" route="{{fooRoute}}" data="{{bazData}}">
      </app-route>
    </template>
  </test-fixture>

  <test-fixture id="Redirection">
    <template>
      <redirect-app-route></redirect-app-route>
    </template>
  </test-fixture>

<script>"use strict";function fixtureChainedRoutes(e){var t=fixture("ChainedRoutes",{numberOneTopRoute:{path:e.path||"",prefix:e.prefix||"",__queryParams:e.__queryParams||{}}});return{foo:t[0],bar:t[1],baz:t[2]}}suite("<app-route>",function(){var e;setup(function(){e=fixture("BasicRoute");var t=document.querySelector("#ChainedRoutes").fixtureTemplates[0];t._parentProps={}}),test("it parses a path",function(){e.route={prefix:"",path:"/user/papyrus/details",__queryParams:{}},expect(e.tail.prefix).to.be.equal("/user/papyrus"),expect(e.tail.path).to.be.equal("/details"),expect(e.data.username).to.be.equal("papyrus")}),test("it bidirectionally maps changes between tail and route",function(){e.route={prefix:"",path:"/user/papyrus/details",__queryParams:{}},e.set("tail.path","/messages"),expect(e.route.path).to.be.deep.equal("/user/papyrus/messages"),e.set("route.path","/user/toriel"),expect(e.tail).to.be.deep.equal({prefix:"/user/toriel",path:"",__queryParams:{}})}),test("it creates data as described by pattern",function(){e.route={prefix:"",path:"/user/sans"},expect(e.data).to.be.deep.equal({username:"sans"}),expect(e.active).to.be.equal(!0),e.pattern="/user/:username/likes/:count",expect(e.data).to.be.deep.equal({username:"sans"}),expect(e.active).to.be.equal(!1),e.set("route.path","/does/not/match"),expect(e.data).to.be.deep.equal({username:"sans"}),expect(e.active).to.be.equal(!1),e.set("route.path","/user/undyne/likes/20"),expect(e.data).to.be.deep.equal({username:"undyne",count:"20"}),expect(e.active).to.be.equal(!0)}),test("changing data changes the path",function(){e.route={prefix:"",path:"/user/asgore"},expect(e.data).to.be.deep.equal({username:"asgore"}),e.data={username:"toriel"},expect(e.route.path).to.be.equal("/user/toriel")}),suite("propagating data",function(){test("data is empty if no routes in the tree have matched",function(){var e=fixtureChainedRoutes({path:""});expect(e.foo.data).to.be.eql({}),expect(e.bar.data).to.be.eql({}),expect(e.baz.data).to.be.eql({})}),test("limits propagation to last matched route",function(){var e=fixtureChainedRoutes({path:"/foo/123"});expect(e.foo.data).to.be.eql({foo:"123"}),expect(e.bar.data).to.be.eql({}),expect(e.baz.data).to.be.eql({})}),test("propagates data to matching chained routes",function(){var e=fixtureChainedRoutes({path:"/foo/123/bar/abc"});expect(e.foo.data).to.be.eql({foo:"123"}),expect(e.bar.data).to.be.eql({bar:"abc"}),expect(e.baz.data).to.be.eql({})}),test("chained route state is untouched when deactivated",function(){var e=fixtureChainedRoutes({path:"/foo/123/bar/abc"});e.foo.set("route.path","/foo/321/baz/zyx"),expect(e.foo.data).to.be.eql({foo:"321"}),expect(e.bar.data).to.be.eql({bar:"abc"}),expect(e.baz.data).to.be.eql({baz:"zyx"})}),suite("updating the global path",function(){test("happens when data changes if the route is active",function(){var e=fixtureChainedRoutes({path:"/foo/123/bar/abc"});expect(e.bar.active).to.be.eql(!0),e.bar.set("data.bar","cba"),expect(e.foo.route.path).to.be.eql("/foo/123/bar/cba")}),test("ignores changes when the route is inactive",function(){var e=fixtureChainedRoutes({path:"/foo/123/bar/abc"});expect(e.baz.active).to.be.eql(!1),e.baz.set("data.baz","cba"),expect(e.foo.route.path).to.be.eql("/foo/123/bar/abc")}),test("ignores changes after a route deactives",function(){var e=fixtureChainedRoutes({path:"/foo/123/bar/abc"});e.foo.set("route.path","/foo/123/baz/zyx"),expect(e.bar.active).to.be.eql(!1),expect(e.baz.active).to.be.eql(!0),e.bar.set("data.bar","cba"),expect(e.foo.route.path).to.be.eql("/foo/123/baz/zyx")})})}),suite("propagating query params",function(){test("query params are empty if no routes match",function(){var e=fixtureChainedRoutes({path:"",__queryParams:{qux:"zot"}});expect(e.foo.queryParams).to.be.eql({}),expect(e.bar.queryParams).to.be.eql({}),expect(e.baz.queryParams).to.be.eql({})}),test("updates query params for all matched routes",function(){var e=fixtureChainedRoutes({path:"/foo/123/bar/abc",__queryParams:{qux:"zot"}});expect(e.foo.queryParams).to.be.eql({qux:"zot"}),expect(e.bar.queryParams).to.be.eql({qux:"zot"}),expect(e.baz.queryParams).to.be.eql({})}),test("retains query params after routes deactivate",function(){var e=fixtureChainedRoutes({path:"/foo/123/bar/abc",__queryParams:{qux:"zot"}});e.foo.set("route.path","/foo/123/baz/xyz"),e.foo.set("queryParams",{qux:"quux"}),expect(e.foo.queryParams).to.be.eql({qux:"quux"}),expect(e.bar.queryParams).to.be.eql({qux:"zot"}),expect(e.baz.queryParams).to.be.eql({qux:"quux"})}),suite("updating global query params",function(){test("happens when query params change on active routes",function(){var e=fixtureChainedRoutes({path:"/foo/123/bar/abc",__queryParams:{qux:"zot"}});e.bar.set("queryParams",{qux:"quux"}),expect(e.foo.queryParams).to.be.eql({qux:"quux"}),expect(e.bar.queryParams).to.be.eql({qux:"quux"}),expect(e.baz.queryParams).to.be.eql({})}),test("updates are ignored for routes that are inactive",function(){var e=fixtureChainedRoutes({path:"/foo/123/bar/abc",__queryParams:{qux:"zot"}});e.baz.set("queryParams",{qux:"quux"}),expect(e.foo.queryParams).to.be.eql({qux:"zot"}),expect(e.bar.queryParams).to.be.eql({qux:"zot"}),expect(e.baz.queryParams).to.be.eql({qux:"quux"})}),test("doesn't generate excess query-params-changed events",function(){for(var e=fixtureChainedRoutes({}),t=[e.foo,e.bar,e.baz],a=0,o=0;o<t.length;o++)t[o].addEventListener("query-params-changed",function(){a++});expect(a).to.be.equal(0),e.foo.set("route.path","/foo/123/bar/456"),expect(a).to.be.equal(0),e.foo.set("route.path","/foo/456/baz/789"),expect(a).to.be.equal(0),e.foo.set("route.__queryParams",{key:"value"}),expect(a).to.be.equal(2),e.foo.set("route.path","/foo/123/bar/456"),expect(a).to.be.equal(3),e.foo.set("route.path","/foo/456/baz/789"),expect(a).to.be.equal(3),e.foo.set("route.__queryParams",{}),expect(a).to.be.equal(5),e.foo.set("route.path","/foo/123/bar/456"),expect(a).to.be.equal(6)})})}),suite("handles reentrent changes to its properties",function(){var e;setup(function(){e=window.location.href}),teardown(function(){window.history.replaceState({},"",e)}),test("changing path in response to path changing",function(){var e=fixture("Redirection");e.addEventListener("route-changed",function(){e.set("route.path","/bar/baz")}),e.set("route.path","/foo"),expect(window.location.pathname).to.be.equal("/bar/baz"),expect(e.data).to.be.deep.equal({page:"bar"}),expect(e.route.path).to.be.equal("/bar/baz"),expect(e.tail.path).to.be.equal("/baz")}),test("changing data wholesale in response to path changing",function(){var e=fixture("Redirection");e.set("data.page","bar"),e.addEventListener("route-changed",function(t){"route.path"===t.detail.path&&"/foo/baz"===e.route.path&&(e.data={page:"bar"})}),e.set("route.path","/foo/baz"),expect(window.location.pathname).to.be.equal("/bar"),expect(e.data).to.be.deep.equal({page:"bar"}),expect(e.route.path).to.be.equal("/bar"),expect(e.tail.path).to.be.equal("")}),test("changing a data piece in response to path changing",function(){var e=fixture("Redirection");e.set("data.page","bar"),e.addEventListener("route-changed",function(t){e.set("data.page","bar")}),e.set("route.path","/foo/baz"),expect(window.location.pathname).to.be.equal("/bar"),expect(e.data).to.be.deep.equal({page:"bar"}),expect(e.route.path).to.be.equal("/bar"),expect(e.tail.path).to.be.equal("")}),test("changing the tail in response to path changing",function(){var e=fixture("Redirection");e.addEventListener("route-changed",function(){e.set("tail.path","/bar")}),e.set("route.path","/foo"),expect(window.location.pathname).to.be.equal("/foo/bar"),expect(e.data).to.be.deep.equal({page:"foo"}),expect(e.route.path).to.be.equal("/foo/bar"),expect(e.tail.path).to.be.equal("/bar"),e.set("route.path","/foo/baz"),expect(window.location.pathname).to.be.equal("/foo/bar"),expect(e.data).to.be.deep.equal({page:"foo"}),expect(e.route.path).to.be.equal("/foo/bar"),expect(e.tail.path).to.be.equal("/bar")}),test("changing the path in response to data changing",function(){var e=fixture("Redirection");e.addEventListener("data-changed",function(){e.set("route.path","/bar")}),e.set("data",{page:"foo"}),expect(window.location.pathname).to.be.equal("/bar"),expect(e.data).to.be.deep.equal({page:"bar"}),expect(e.route.path).to.be.equal("/bar"),expect(e.tail.path).to.be.equal("")}),test("changing data in response to data changing",function(){var e=fixture("Redirection");e.addEventListener("data-changed",function(){e.set("data.page","bar")}),e.set("data",{page:"foo"}),expect(window.location.pathname).to.be.equal("/bar"),expect(e.data).to.be.deep.equal({page:"bar"}),expect(e.route.path).to.be.equal("/bar"),expect(e.tail.path).to.be.equal("")}),test("changing the data object wholesale in response to data changing",function(){var e=fixture("Redirection");e.addEventListener("data-changed",function(){"foo"==e.data.page&&e.set("data",{page:"bar"})}),e.set("data",{page:"foo"}),expect(window.location.pathname).to.be.equal("/bar"),expect(e.data).to.be.deep.equal({page:"bar"}),expect(e.route.path).to.be.equal("/bar"),expect(e.tail.path).to.be.equal("")}),test("changing the tail in response to data changing",function(){var e=fixture("Redirection");e.addEventListener("data-changed",function(){e.set("tail.path","/bar")}),e.set("data",{page:"foo"}),expect(window.location.pathname).to.be.equal("/foo/bar"),expect(e.data).to.be.deep.equal({page:"foo"}),expect(e.route.path).to.be.equal("/foo/bar"),expect(e.tail.path).to.be.equal("/bar")}),test("changing the path in response to tail changing",function(){var e=fixture("Redirection");e.set("route.path","/foo/"),e.addEventListener("tail-changed",function(){e.set("route.path","/baz"+e.tail.path)}),e.set("tail.path","/bar"),expect(window.location.pathname).to.be.equal("/baz/bar"),expect(e.data).to.be.deep.equal({page:"baz"}),expect(e.route.path).to.be.equal("/baz/bar"),expect(e.tail.path).to.be.equal("/bar")}),test("changing the data in response to tail changing",function(){var e=fixture("Redirection");e.set("route.path","/foo/"),e.addEventListener("tail-changed",function(){e.set("data.page","baz")}),e.set("tail.path","/bar"),expect(window.location.pathname).to.be.equal("/baz"),expect(e.data).to.be.deep.equal({page:"baz"}),expect(e.route.path).to.be.equal("/baz"),expect(e.tail.path).to.be.equal("")}),test("changing the data object wholesale in response to tail changing",function(){var e=fixture("Redirection");e.set("route.path","/foo/"),e.addEventListener("tail-changed",function(){e.set("data",{page:"baz"})}),e.set("tail.path","/bar"),expect(window.location.pathname).to.be.equal("/baz"),expect(e.data).to.be.deep.equal({page:"baz"}),expect(e.route.path).to.be.equal("/baz"),expect(e.tail.path).to.be.equal("")}),test("changing the tail in response to tail changing",function(){var e=fixture("Redirection");e.set("route.path","/foo/"),e.addEventListener("tail-changed",function(){e.set("tail.path","/baz")}),e.set("tail.path","/bar"),expect(window.location.pathname).to.be.equal("/foo/baz"),expect(e.data).to.be.deep.equal({page:"foo"}),expect(e.route.path).to.be.equal("/foo/baz"),expect(e.tail.path).to.be.equal("/baz")})})});</script>

</body></html>