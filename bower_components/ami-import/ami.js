!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.AMI=e()}}(function(){var e;return function t(e,n,i){function r(a,s){if(!n[a]){if(!e[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[a]={exports:{}};e[a][0].call(c.exports,function(t){var n=e[a][1][t];return r(n?n:t)},c,c.exports,t,e,n,i)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)r(i[a]);return r}({1:[function(e,t,n){var i={Unkown:0,Grayscale:1,AdobeRGB:2,RGB:3,CYMK:4},r=function(){"use strict";function e(){}function t(e,t){for(var n,i,r=0,o=[],a=16;a>0&&!e[a-1];)a--;o.push({children:[],index:0});var s,l=o[0];for(n=0;a>n;n++){for(i=0;i<e[n];i++){for(l=o.pop(),l.children[l.index]=t[r];l.index>0;)l=o.pop();for(l.index++,o.push(l);o.length<=n;)o.push(s={children:[],index:0}),l.children[l.index]=s.children,l=s;r++}a>n+1&&(o.push(s={children:[],index:0}),l.children[l.index]=s.children,l=s)}return o[0].children}function n(e,t,n){return 64*((e.blocksPerLine+1)*t+n)}function r(e,t,i,r,o,a,s,u,c){function f(){if(O>0)return O--,z>>O&1;if(z=e[t++],255==z){var n=e[t++];if(n)throw"unexpected marker: "+(z<<8|n).toString(16)}return O=7,z>>>7}function d(e){for(var t,n=e;null!==(t=f());){if(n=n[t],"number"==typeof n)return n;if("object"!=typeof n)throw"invalid huffman sequence"}return null}function h(e){for(var t=0;e>0;){var n=f();if(null===n)return;t=t<<1|n,e--}return t}function p(e){var t=h(e);return t>=1<<e-1?t:t+(-1<<e)+1}function m(e,t){var n=d(e.huffmanTableDC),i=0===n?0:p(n);e.blockData[t]=e.pred+=i;for(var r=1;64>r;){var o=d(e.huffmanTableAC),a=15&o,s=o>>4;if(0!==a){r+=s;var u=l[r];e.blockData[t+u]=p(a),r++}else{if(15>s)break;r+=16}}}function v(e,t){var n=d(e.huffmanTableDC),i=0===n?0:p(n)<<c;e.blockData[t]=e.pred+=i}function y(e,t){e.blockData[t]|=f()<<c}function x(e,t){if(R>0)return void R--;for(var n=a,i=s;i>=n;){var r=d(e.huffmanTableAC),o=15&r,u=r>>4;if(0!==o){n+=u;var f=l[n];e.blockData[t+f]=p(o)*(1<<c),n++}else{if(15>u){R=h(u)+(1<<u)-1;break}n+=16}}}function b(e,t){for(var n=a,i=s,r=0;i>=n;){var o=l[n];switch(M){case 0:var u=d(e.huffmanTableAC),m=15&u;if(r=u>>4,0===m)15>r?(R=h(r)+(1<<r),M=4):(r=16,M=1);else{if(1!==m)throw"invalid ACn encoding";w=p(m),M=r?2:3}continue;case 1:case 2:e.blockData[t+o]?e.blockData[t+o]+=f()<<c:(r--,0===r&&(M=2==M?3:0));break;case 3:e.blockData[t+o]?e.blockData[t+o]+=f()<<c:(e.blockData[t+o]=w<<c,M=0);break;case 4:e.blockData[t+o]&&(e.blockData[t+o]+=f()<<c)}n++}4===M&&(R--,0===R&&(M=0))}function _(e,t,i,r,o){var a=i/P|0,s=i%P,l=a*e.v+r,u=s*e.h+o,c=n(e,l,u);t(e,c)}function g(e,t,i){var r=i/e.blocksPerLine|0,o=i%e.blocksPerLine,a=n(e,r,o);t(e,a)}var w,k,C,S,I,T,D,P=(i.precision,i.samplesPerLine,i.scanLines,i.mcusPerLine),E=i.progressive,A=(i.maxH,i.maxV,t),z=0,O=0,R=0,M=0,B=r.length;D=E?0===a?0===u?v:y:0===u?x:b:m;var F,U,N=0;U=1==B?r[0].blocksPerLine*r[0].blocksPerColumn:P*i.mcusPerColumn,o||(o=U);for(var V,j;U>N;){for(C=0;B>C;C++)r[C].pred=0;if(R=0,1==B)for(k=r[0],T=0;o>T;T++)g(k,D,N),N++;else for(T=0;o>T;T++){for(C=0;B>C;C++)for(k=r[C],V=k.h,j=k.v,S=0;j>S;S++)for(I=0;V>I;I++)_(k,D,N,S,I);N++}if(O=0,F=e[t]<<8|e[t+1],65280>=F)throw"marker was not found";if(!(F>=65488&&65495>=F))break;t+=2}return t-A}function o(e,t,n){var i,r,o,a,s,l,y,x,b,_,g=e.quantizationTable;for(_=0;64>_;_++)n[_]=e.blockData[t+_]*g[_];for(_=0;8>_;++_){var w=8*_;0!==n[1+w]||0!==n[2+w]||0!==n[3+w]||0!==n[4+w]||0!==n[5+w]||0!==n[6+w]||0!==n[7+w]?(i=m*n[0+w]+128>>8,r=m*n[4+w]+128>>8,o=n[2+w],a=n[6+w],s=v*(n[1+w]-n[7+w])+128>>8,x=v*(n[1+w]+n[7+w])+128>>8,l=n[3+w]<<4,y=n[5+w]<<4,b=i-r+1>>1,i=i+r+1>>1,r=b,b=o*p+a*h+128>>8,o=o*h-a*p+128>>8,a=b,b=s-y+1>>1,s=s+y+1>>1,y=b,b=x+l+1>>1,l=x-l+1>>1,x=b,b=i-a+1>>1,i=i+a+1>>1,a=b,b=r-o+1>>1,r=r+o+1>>1,o=b,b=s*d+x*f+2048>>12,s=s*f-x*d+2048>>12,x=b,b=l*c+y*u+2048>>12,l=l*u-y*c+2048>>12,y=b,n[0+w]=i+x,n[7+w]=i-x,n[1+w]=r+y,n[6+w]=r-y,n[2+w]=o+l,n[5+w]=o-l,n[3+w]=a+s,n[4+w]=a-s):(b=m*n[0+w]+512>>10,n[0+w]=b,n[1+w]=b,n[2+w]=b,n[3+w]=b,n[4+w]=b,n[5+w]=b,n[6+w]=b,n[7+w]=b)}for(_=0;8>_;++_){var k=_;0!==n[8+k]||0!==n[16+k]||0!==n[24+k]||0!==n[32+k]||0!==n[40+k]||0!==n[48+k]||0!==n[56+k]?(i=m*n[0+k]+2048>>12,r=m*n[32+k]+2048>>12,o=n[16+k],a=n[48+k],s=v*(n[8+k]-n[56+k])+2048>>12,x=v*(n[8+k]+n[56+k])+2048>>12,l=n[24+k],y=n[40+k],b=i-r+1>>1,i=i+r+1>>1,r=b,b=o*p+a*h+2048>>12,o=o*h-a*p+2048>>12,a=b,b=s-y+1>>1,s=s+y+1>>1,y=b,b=x+l+1>>1,l=x-l+1>>1,x=b,b=i-a+1>>1,i=i+a+1>>1,a=b,b=r-o+1>>1,r=r+o+1>>1,o=b,b=s*d+x*f+2048>>12,s=s*f-x*d+2048>>12,x=b,b=l*c+y*u+2048>>12,l=l*u-y*c+2048>>12,y=b,n[0+k]=i+x,n[56+k]=i-x,n[8+k]=r+y,n[48+k]=r-y,n[16+k]=o+l,n[40+k]=o-l,n[24+k]=a+s,n[32+k]=a-s):(b=m*n[_+0]+8192>>14,n[0+k]=b,n[8+k]=b,n[16+k]=b,n[24+k]=b,n[32+k]=b,n[40+k]=b,n[48+k]=b,n[56+k]=b)}for(_=0;64>_;++_){var C=t+_,S=n[_];S=S<=-2056/e.bitConversion?0:S>=2024/e.bitConversion?255/e.bitConversion:S+2056/e.bitConversion>>4,e.blockData[C]=S}}function a(e,t){for(var i=t.blocksPerLine,r=t.blocksPerColumn,a=new Int32Array(64),s=0;r>s;s++)for(var l=0;i>l;l++){var u=n(t,s,l);o(t,u,a)}return t.blockData}function s(e){return 0>=e?0:e>=255?255:0|e}var l=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),u=4017,c=799,f=3406,d=2276,h=1567,p=3784,m=5793,v=2896;return e.prototype={load:function(e){var t=function(e){this.parse(e),this.onload&&this.onload()}.bind(this);if(e.indexOf("data:")>-1){for(var n=e.indexOf("base64,")+7,i=atob(e.substring(n)),r=new Uint8Array(i.length),o=i.length-1;o>=0;o--)r[o]=i.charCodeAt(o);t(i)}else{var a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="arraybuffer",a.onload=function(){var e=new Uint8Array(a.response);t(e)}.bind(this),a.send(null)}},parse:function(e){function n(){var t=e[f]<<8|e[f+1];return f+=2,t}function o(){var t=n(),i=e.subarray(f,f+t-2);return f+=i.length,i}function s(e){for(var t=Math.ceil(e.samplesPerLine/8/e.maxH),n=Math.ceil(e.scanLines/8/e.maxV),i=0;i<e.components.length;i++){V=e.components[i];var r=Math.ceil(Math.ceil(e.samplesPerLine/8)*V.h/e.maxH),o=Math.ceil(Math.ceil(e.scanLines/8)*V.v/e.maxV),a=t*V.h,s=n*V.v,l=64*s*(a+1);V.blockData=new Int16Array(l),V.blocksPerLine=r,V.blocksPerColumn=o}e.mcusPerLine=t,e.mcusPerColumn=n}var u,c,f=0,d=(e.length,null),h=null,p=[],m=[],v=[],y=n();if(65496!=y)throw"SOI not found";for(y=n();65497!=y;){var x,b,_;switch(y){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var g=o();65504===y&&74===g[0]&&70===g[1]&&73===g[2]&&70===g[3]&&0===g[4]&&(d={version:{major:g[5],minor:g[6]},densityUnits:g[7],xDensity:g[8]<<8|g[9],yDensity:g[10]<<8|g[11],thumbWidth:g[12],thumbHeight:g[13],thumbData:g.subarray(14,14+3*g[12]*g[13])}),65518===y&&65===g[0]&&100===g[1]&&111===g[2]&&98===g[3]&&101===g[4]&&0===g[5]&&(h={version:g[6],flags0:g[7]<<8|g[8],flags1:g[9]<<8|g[10],transformCode:g[11]});break;case 65499:for(var w=n(),k=w+f-2;k>f;){var C=e[f++],S=new Int32Array(64);if(C>>4===0)for(b=0;64>b;b++){var I=l[b];S[I]=e[f++]}else{if(C>>4!==1)throw"DQT: invalid table spec";for(b=0;64>b;b++){var T=l[b];S[T]=n()}}p[15&C]=S}break;case 65472:case 65473:case 65474:if(u)throw"Only single frame JPEGs supported";n(),u={},u.extended=65473===y,u.progressive=65474===y,u.precision=e[f++],u.scanLines=n(),u.samplesPerLine=n(),u.components=[],u.componentIds={};var D,P=e[f++],E=0,A=0;for(x=0;P>x;x++){D=e[f];var z=e[f+1]>>4,O=15&e[f+1];z>E&&(E=z),O>A&&(A=O);var R=e[f+2];_=u.components.push({h:z,v:O,quantizationTable:p[R],quantizationTableId:R,bitConversion:255/((1<<u.precision)-1)}),u.componentIds[D]=_-1,f+=3}u.maxH=E,u.maxV=A,s(u);break;case 65476:var M=n();for(x=2;M>x;){var B=e[f++],F=new Uint8Array(16),U=0;for(b=0;16>b;b++,f++)U+=F[b]=e[f];var N=new Uint8Array(U);for(b=0;U>b;b++,f++)N[b]=e[f];x+=17+U,(B>>4===0?v:m)[15&B]=t(F,N)}break;case 65501:n(),c=n();break;case 65498:var V,j=(n(),e[f++]),L=[];for(x=0;j>x;x++){var G=u.componentIds[e[f++]];V=u.components[G];var H=e[f++];V.huffmanTableDC=v[H>>4],V.huffmanTableAC=m[15&H],L.push(V)}var q=e[f++],X=e[f++],Y=e[f++],W=r(e,f,u,L,c,q,X,Y>>4,15&Y);f+=W;break;default:if(255==e[f-3]&&e[f-2]>=192&&e[f-2]<=254){f-=3;break}throw"unknown JPEG marker "+y.toString(16)}y=n()}switch(this.width=u.samplesPerLine,this.height=u.scanLines,this.jfif=d,this.adobe=h,this.components=[],u.components.length){case 1:this.colorspace=i.Grayscale;break;case 3:this.adobe?this.colorspace=i.AdobeRGB:this.colorspace=i.RGB;break;case 4:this.colorspace=i.CYMK;break;default:this.colorspace=i.Unknown}for(var x=0;x<u.components.length;x++){var V=u.components[x];V.quantizationTable||null===V.quantizationTableId||(V.quantizationTable=p[V.quantizationTableId]),this.components.push({output:a(u,V),scaleX:V.h/u.maxH,scaleY:V.v/u.maxV,blocksPerLine:V.blocksPerLine,blocksPerColumn:V.blocksPerColumn,bitConversion:V.bitConversion})}},getData16:function(e,t){if(1!==this.components.length)throw"Unsupported color mode";var i,r,o,a,s,l,u=this.width/e,c=this.height/t,f=0,d=this.components.length,h=e*t*d,p=new Uint16Array(h),m=new Uint16Array((this.components[0].blocksPerLine<<3)*this.components[0].blocksPerColumn*8);for(l=0;d>l;l++){i=this.components[l];for(var v,y,x=i.blocksPerLine,b=i.blocksPerColumn,_=x<<3,g=0,w=0;b>w;w++)for(var k=w<<3,C=0;x>C;C++){var S=n(i,w,C),f=0,I=C<<3;for(v=0;8>v;v++){var g=(k+v)*_;for(y=0;8>y;y++)m[g+I+y]=i.output[S+f++]}}r=i.scaleX*u,o=i.scaleY*c,f=l;var T,D,P;for(s=0;t>s;s++)for(a=0;e>a;a++)D=0|s*o,T=0|a*r,P=D*_+T,p[f]=m[P],f+=d}return p},getData:function(e,t){var i,r,o,a,l,u,c,f,d,h,p,m,v,y,x,b=this.width/e,_=this.height/t,g=0,w=this.components.length,k=e*t*w,C=new Uint8Array(k),S=new Uint8Array((this.components[0].blocksPerLine<<3)*this.components[0].blocksPerColumn*8);for(u=0;w>u;u++){i=this.components[u];for(var I,T,D=i.blocksPerLine,P=i.blocksPerColumn,E=D<<3,A=0,z=0;P>z;z++)for(var O=z<<3,R=0;D>R;R++){var M=n(i,z,R),g=0,B=R<<3;for(I=0;8>I;I++){var A=(O+I)*E;for(T=0;8>T;T++)S[A+B+T]=i.output[M+g++]*i.bitConversion}}r=i.scaleX*b,o=i.scaleY*_,g=u;var F,U,N;for(l=0;t>l;l++)for(a=0;e>a;a++)U=0|l*o,F=0|a*r,N=U*E+F,C[g]=S[N],g+=w}switch(w){case 1:case 2:break;case 3:if(x=!0,this.adobe&&this.adobe.transformCode?x=!0:"undefined"!=typeof this.colorTransform&&(x=!!this.colorTransform),x)for(u=0;k>u;u+=w)c=C[u],f=C[u+1],d=C[u+2],m=s(c-179.456+1.402*d),v=s(c+135.459-.344*f-.714*d),y=s(c-226.816+1.772*f),C[u]=m,C[u+1]=v,C[u+2]=y;break;case 4:if(!this.adobe)throw"Unsupported color mode (4 components)";if(x=!1,this.adobe&&this.adobe.transformCode?x=!0:"undefined"!=typeof this.colorTransform&&(x=!!this.colorTransform),x)for(u=0;k>u;u+=w)c=C[u],f=C[u+1],d=C[u+2],h=s(434.456-c-1.402*d),p=s(119.541-c+.344*f+.714*d),c=s(481.816-c-1.772*f),C[u]=h,C[u+1]=p,C[u+2]=c;break;default:throw"Unsupported color mode"}return C}},e}(),o=typeof t;"undefined"!==o&&t.exports&&(t.exports=r)},{}],2:[function(e,t,n){"use strict";function i(e){PDFJS.verbosity>=PDFJS.VERBOSITY_LEVELS.infos&&console.log("Info: "+e)}function r(e){PDFJS.verbosity>=PDFJS.VERBOSITY_LEVELS.warnings&&console.log("Warning: "+e)}function o(e){if(arguments.length>1){var t=["Error:"];t.push.apply(t,arguments),console.log.apply(console,t),e=[].join.call(arguments," ")}else console.log("Error: "+e);throw console.log(a()),_.notify(b.unknown),new Error(e)}function a(){try{throw new Error}catch(e){return e.stack?e.stack.split("\n").slice(2).join("\n"):""}}function s(e,t){if(!e)return!1;var n=/^[a-z][a-z0-9+\-.]*(?=:)/i.exec(e);if(!n)return t;switch(n=n[0].toLowerCase()){case"http":case"https":case"ftp":case"mailto":case"tel":return!0;default:return!1}}function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!1}),n}function u(e){for(var t=1,n=0;e>t;)t<<=1,n++;return n}function c(e,t){return e[t]<<8|e[t+1]}function f(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}function d(){var e=new Uint8Array(2);e[0]=1;var t=new Uint16Array(e.buffer);return 1===t[0]}function h(){var e=document.createElement("canvas");e.width=e.height=1;var t=e.getContext("2d"),n=t.createImageData(1,1);return"undefined"!=typeof n.data.buffer}function p(){var e={};return e.promise=new Promise(function(t,n){e.resolve=t,e.reject=n}),e}function m(e,t){this.name=e,this.comObj=t,this.callbackIndex=1,this.postMessageTransfers=!0;var n=this.callbacksCapabilities={},i=this.actionHandler={};i.console_log=[function(e){console.log.apply(console,e)}],i.console_error=[function(e){console.error.apply(console,e)}],i._unsupported_feature=[function(e){_.notify(e)}],t.onmessage=function(e){var r=e.data;if(r.isReply){var a=r.callbackId;if(r.callbackId in n){var s=n[a];delete n[a],"error"in r?s.reject(r.error):s.resolve(r.data)}else o("Cannot resolve callback "+a)}else if(r.action in i){var l=i[r.action];r.callbackId?Promise.resolve().then(function(){return l[0].call(l[1],r.data)}).then(function(e){t.postMessage({isReply:!0,callbackId:r.callbackId,data:e})},function(e){t.postMessage({isReply:!0,callbackId:r.callbackId,error:e})}):l[0].call(l[1],r.data)}else o("Unknown action from worker: "+r.action)}}var v=function(){function e(){this.failOnCorruptedImage=!1}function t(e,t){e.x0=Math.ceil(t.XOsiz/e.XRsiz),e.x1=Math.ceil(t.Xsiz/e.XRsiz),e.y0=Math.ceil(t.YOsiz/e.YRsiz),e.y1=Math.ceil(t.Ysiz/e.YRsiz),e.width=e.x1-e.x0,e.height=e.y1-e.y0}function n(e,t){for(var n,i=e.SIZ,r=[],o=Math.ceil((i.Xsiz-i.XTOsiz)/i.XTsiz),a=Math.ceil((i.Ysiz-i.YTOsiz)/i.YTsiz),s=0;a>s;s++)for(var l=0;o>l;l++)n={},n.tx0=Math.max(i.XTOsiz+l*i.XTsiz,i.XOsiz),n.ty0=Math.max(i.YTOsiz+s*i.YTsiz,i.YOsiz),n.tx1=Math.min(i.XTOsiz+(l+1)*i.XTsiz,i.Xsiz),n.ty1=Math.min(i.YTOsiz+(s+1)*i.YTsiz,i.Ysiz),n.width=n.tx1-n.tx0,n.height=n.ty1-n.ty0,n.components=[],r.push(n);e.tiles=r;for(var u=i.Csiz,c=0,f=u;f>c;c++)for(var d=t[c],h=0,p=r.length;p>h;h++){var m={};n=r[h],m.tcx0=Math.ceil(n.tx0/d.XRsiz),m.tcy0=Math.ceil(n.ty0/d.YRsiz),m.tcx1=Math.ceil(n.tx1/d.XRsiz),m.tcy1=Math.ceil(n.ty1/d.YRsiz),m.width=m.tcx1-m.tcx0,m.height=m.tcy1-m.tcy0,n.components[c]=m}}function o(e,t,n){var i=t.codingStyleParameters,r={};return i.entropyCoderWithCustomPrecincts?(r.PPx=i.precinctsSizes[n].PPx,r.PPy=i.precinctsSizes[n].PPy):(r.PPx=15,r.PPy=15),r.xcb_=n>0?Math.min(i.xcb,r.PPx-1):Math.min(i.xcb,r.PPx),r.ycb_=n>0?Math.min(i.ycb,r.PPy-1):Math.min(i.ycb,r.PPy),r}function a(e,t,n){var i=1<<n.PPx,r=1<<n.PPy,o=0===t.resLevel,a=1<<n.PPx+(o?0:-1),s=1<<n.PPy+(o?0:-1),l=t.trx1>t.trx0?Math.ceil(t.trx1/i)-Math.floor(t.trx0/i):0,u=t.try1>t.try0?Math.ceil(t.try1/r)-Math.floor(t.try0/r):0,c=l*u;t.precinctParameters={precinctWidth:i,precinctHeight:r,numprecinctswide:l,numprecinctshigh:u,numprecincts:c,precinctWidthInSubband:a,precinctHeightInSubband:s}}function s(e,t,n){var i,r,o,a,s=n.xcb_,l=n.ycb_,u=1<<s,c=1<<l,f=t.tbx0>>s,d=t.tby0>>l,h=t.tbx1+u-1>>s,p=t.tby1+c-1>>l,m=t.resolution.precinctParameters,v=[],y=[];for(r=d;p>r;r++)for(i=f;h>i;i++){o={cbx:i,cby:r,tbx0:u*i,tby0:c*r,tbx1:u*(i+1),tby1:c*(r+1)},o.tbx0_=Math.max(t.tbx0,o.tbx0),o.tby0_=Math.max(t.tby0,o.tby0),o.tbx1_=Math.min(t.tbx1,o.tbx1),o.tby1_=Math.min(t.tby1,o.tby1);var x=Math.floor((o.tbx0_-t.tbx0)/m.precinctWidthInSubband),b=Math.floor((o.tby0_-t.tby0)/m.precinctHeightInSubband);if(a=x+b*m.numprecinctswide,o.precinctNumber=a,o.subbandType=t.type,o.Lblock=3,!(o.tbx1_<=o.tbx0_||o.tby1_<=o.tby0_)){v.push(o);var _=y[a];void 0!==_?(i<_.cbxMin?_.cbxMin=i:i>_.cbxMax&&(_.cbxMax=i),r<_.cbyMin?_.cbxMin=r:r>_.cbyMax&&(_.cbyMax=r)):y[a]=_={cbxMin:i,cbyMin:r,cbxMax:i,cbyMax:r},o.precinct=_}}t.codeblockParameters={codeblockWidth:s,codeblockHeight:l,numcodeblockwide:h-f+1,numcodeblockhigh:p-d+1},t.codeblocks=v,t.precincts=y}function l(e,t,n){for(var i=[],r=e.subbands,o=0,a=r.length;a>o;o++)for(var s=r[o],l=s.codeblocks,u=0,c=l.length;c>u;u++){var f=l[u];f.precinctNumber===t&&i.push(f)}return{layerNumber:n,codeblocks:i}}function d(e){for(var t=e.SIZ,n=e.currentTile.index,i=e.tiles[n],r=i.codingStyleDefaultParameters.layersCount,o=t.Csiz,a=0,s=0;o>s;s++)a=Math.max(a,i.components[s].codingStyleParameters.decompositionLevelsCount);var u=0,c=0,f=0,d=0;this.nextPacket=function(){for(;r>u;u++){for(;a>=c;c++){for(;o>f;f++){var e=i.components[f];if(!(c>e.codingStyleParameters.decompositionLevelsCount)){for(var t=e.resolutions[c],n=t.precinctParameters.numprecincts;n>d;){var s=l(t,d,u);return d++,s}d=0}}f=0}c=0}}}function h(e){for(var t=e.SIZ,n=e.currentTile.index,i=e.tiles[n],r=i.codingStyleDefaultParameters.layersCount,o=t.Csiz,a=0,s=0;o>s;s++)a=Math.max(a,i.components[s].codingStyleParameters.decompositionLevelsCount);var u=0,c=0,f=0,d=0;this.nextPacket=function(){for(;a>=u;u++){for(;r>c;c++){for(;o>f;f++){var e=i.components[f];if(!(u>e.codingStyleParameters.decompositionLevelsCount)){for(var t=e.resolutions[u],n=t.precinctParameters.numprecincts;n>d;){var s=l(t,d,c);return d++,s}d=0}}f=0}c=0}}}function p(e){var t,n,i,r,o=e.SIZ,a=e.currentTile.index,s=e.tiles[a],u=s.codingStyleDefaultParameters.layersCount,c=o.Csiz,f=0;for(i=0;c>i;i++){var d=s.components[i];f=Math.max(f,d.codingStyleParameters.decompositionLevelsCount)}var h=new Int32Array(f+1);for(n=0;f>=n;++n){var p=0;for(i=0;c>i;++i){var m=s.components[i].resolutions;n<m.length&&(p=Math.max(p,m[n].precinctParameters.numprecincts))}h[n]=p}t=0,n=0,i=0,r=0,this.nextPacket=function(){for(;f>=n;n++){for(;r<h[n];r++){for(;c>i;i++){var e=s.components[i];if(!(n>e.codingStyleParameters.decompositionLevelsCount)){var o=e.resolutions[n],a=o.precinctParameters.numprecincts;if(!(r>=a)){for(;u>t;){var d=l(o,r,t);return t++,d}t=0}}}i=0}r=0}}}function m(e){var t=e.SIZ,n=e.currentTile.index,i=e.tiles[n],r=i.codingStyleDefaultParameters.layersCount,o=t.Csiz,a=b(i),s=a,u=0,c=0,f=0,d=0,h=0;this.nextPacket=function(){for(;h<s.maxNumHigh;h++){for(;d<s.maxNumWide;d++){for(;o>f;f++){for(var e=i.components[f],t=e.codingStyleParameters.decompositionLevelsCount;t>=c;c++){var n=e.resolutions[c],p=a.components[f].resolutions[c],m=x(d,h,p,s,n);if(null!==m){for(;r>u;){var v=l(n,m,u);return u++,v}u=0}}c=0}f=0}d=0}}}function v(e){var t=e.SIZ,n=e.currentTile.index,i=e.tiles[n],r=i.codingStyleDefaultParameters.layersCount,o=t.Csiz,a=b(i),s=0,u=0,c=0,f=0,d=0;this.nextPacket=function(){for(;o>c;++c){for(var e=i.components[c],t=a.components[c],n=e.codingStyleParameters.decompositionLevelsCount;d<t.maxNumHigh;d++){for(;f<t.maxNumWide;f++){for(;n>=u;u++){var h=e.resolutions[u],p=t.resolutions[u],m=x(f,d,p,t,h);if(null!==m){for(;r>s;){var v=l(h,m,s);return s++,v}s=0}}u=0}f=0}d=0}}}function x(e,t,n,i,r){var o=e*i.minWidth,a=t*i.minHeight;if(o%n.width!==0||a%n.height!==0)return null;var s=a/n.width*r.precinctParameters.numprecinctswide;return o/n.height+s}function b(e){for(var t=e.components.length,n=Number.MAX_VALUE,i=Number.MAX_VALUE,r=0,o=0,a=new Array(t),s=0;t>s;s++){for(var l=e.components[s],u=l.codingStyleParameters.decompositionLevelsCount,c=new Array(u+1),f=Number.MAX_VALUE,d=Number.MAX_VALUE,h=0,p=0,m=1,v=u;v>=0;--v){var y=l.resolutions[v],x=m*y.precinctParameters.precinctWidth,b=m*y.precinctParameters.precinctHeight;f=Math.min(f,x),d=Math.min(d,b),h=Math.max(h,y.precinctParameters.numprecinctswide),p=Math.max(p,y.precinctParameters.numprecinctshigh),c[v]={width:x,height:b},m<<=1}n=Math.min(n,f),i=Math.min(i,d),r=Math.max(r,h),o=Math.max(o,p),a[s]={resolutions:c,minWidth:f,minHeight:d,maxNumWide:h,maxNumHigh:p}}return{components:a,minWidth:n,minHeight:i,maxNumWide:r,maxNumHigh:o}}function _(e){for(var t=e.SIZ,n=e.currentTile.index,i=e.tiles[n],r=t.Csiz,l=0;r>l;l++){for(var u=i.components[l],c=u.codingStyleParameters.decompositionLevelsCount,f=[],y=[],x=0;c>=x;x++){var b=o(e,u,x),_={},g=1<<c-x;_.trx0=Math.ceil(u.tcx0/g),_.try0=Math.ceil(u.tcy0/g),_.trx1=Math.ceil(u.tcx1/g),_.try1=Math.ceil(u.tcy1/g),_.resLevel=x,a(e,_,b),f.push(_);var w;if(0===x)w={},w.type="LL",w.tbx0=Math.ceil(u.tcx0/g),w.tby0=Math.ceil(u.tcy0/g),w.tbx1=Math.ceil(u.tcx1/g),w.tby1=Math.ceil(u.tcy1/g),w.resolution=_,s(e,w,b),y.push(w),_.subbands=[w];else{var k=1<<c-x+1,C=[];w={},w.type="HL",w.tbx0=Math.ceil(u.tcx0/k-.5),w.tby0=Math.ceil(u.tcy0/k),w.tbx1=Math.ceil(u.tcx1/k-.5),w.tby1=Math.ceil(u.tcy1/k),w.resolution=_,s(e,w,b),y.push(w),C.push(w),w={},w.type="LH",w.tbx0=Math.ceil(u.tcx0/k),w.tby0=Math.ceil(u.tcy0/k-.5),w.tbx1=Math.ceil(u.tcx1/k),w.tby1=Math.ceil(u.tcy1/k-.5),w.resolution=_,s(e,w,b),y.push(w),C.push(w),w={},w.type="HH",w.tbx0=Math.ceil(u.tcx0/k-.5),w.tby0=Math.ceil(u.tcy0/k-.5),w.tbx1=Math.ceil(u.tcx1/k-.5),w.tby1=Math.ceil(u.tcy1/k-.5),w.resolution=_,s(e,w,b),y.push(w),C.push(w),_.subbands=C}}u.resolutions=f,u.subbands=y}var S=i.codingStyleDefaultParameters.progressionOrder;switch(S){case 0:i.packetsIterator=new d(e);break;case 1:i.packetsIterator=new h(e);break;case 2:i.packetsIterator=new p(e);break;case 3:i.packetsIterator=new m(e);break;case 4:i.packetsIterator=new v(e);break;default:throw new Error("JPX Error: Unsupported progression order "+S)}}function g(e,t,n,i){function r(e){for(;e>d;){if(n+f>=t.length)throw new Error("Unexpected EOF");var i=t[n+f];f++,h?(c=c<<7|i,d+=7,h=!1):(c=c<<8|i,d+=8),255===i&&(h=!0)}return d-=e,c>>>d&(1<<e)-1}function o(e){return 255===t[n+f-1]&&t[n+f]===e?(a(1),!0):255===t[n+f]&&t[n+f+1]===e?(a(2),!0):!1}function a(e){f+=e}function s(){d=0,h&&(f++,h=!1)}function l(){if(0===r(1))return 1;if(0===r(1))return 2;var e=r(2);return 3>e?e+3:(e=r(5),31>e?e+6:(e=r(7),e+37))}for(var c,f=0,d=0,h=!1,p=e.currentTile.index,m=e.tiles[p],v=e.COD.sopMarkerUsed,y=e.COD.ephMarkerUsed,x=m.packetsIterator;i>f;)try{s(),v&&o(145)&&a(4);var b=x.nextPacket();if(void 0===b)return;if(!r(1))continue;for(var _,g=b.layerNumber,w=[],k=0,C=b.codeblocks.length;C>k;k++){_=b.codeblocks[k];var S,I=_.precinct,P=_.cbx-I.cbxMin,E=_.cby-I.cbyMin,A=!1,z=!1;if(void 0!==_.included)A=!!r(1);else{I=_.precinct;var O,R;if(void 0!==I.inclusionTree)O=I.inclusionTree;else{var M=I.cbxMax-I.cbxMin+1,B=I.cbyMax-I.cbyMin+1;O=new D(M,B),R=new T(M,B),I.inclusionTree=O,I.zeroBitPlanesTree=R}for(O.reset(P,E,g);;){if(f>=t.length)return;if(O.isAboveThreshold())break;if(O.isKnown())O.nextLevel();else if(r(1)){if(O.setKnown(),O.isLeaf()){_.included=!0,A=z=!0;break}O.nextLevel()}else O.incrementValue()}}if(A){if(z){for(R=I.zeroBitPlanesTree,R.reset(P,E);;){if(f>=t.length)return;if(r(1)){if(S=!R.nextLevel())break}else R.incrementValue()}_.zeroBitPlanes=R.value}for(var F=l();r(1);)_.Lblock++;var U=u(F),N=(1<<U>F?U-1:U)+_.Lblock,V=r(N);w.push({codeblock:_,codingpasses:F,dataLength:V})}}for(s(),y&&o(146);w.length>0;){var j=w.shift();_=j.codeblock,void 0===_.data&&(_.data=[]),_.data.push({data:t,start:n+f,end:n+f+j.dataLength,codingpasses:j.codingpasses}),f+=j.dataLength}}catch(L){return}return f}function w(e,t,n,i,r,o,a,s){for(var l=i.tbx0,u=i.tby0,c=i.tbx1-i.tbx0,f=i.codeblocks,d="H"===i.type.charAt(0)?1:0,h="H"===i.type.charAt(1)?t:0,p=0,m=f.length;m>p;++p){var v=f[p],x=v.tbx1_-v.tbx0_,b=v.tby1_-v.tby0_;if(0!==x&&0!==b&&void 0!==v.data){var _,g;_=new P(x,b,v.subbandType,v.zeroBitPlanes,o),g=2;var w,k,C,S=v.data,I=0,T=0;for(w=0,k=S.length;k>w;w++)C=S[w],I+=C.end-C.start,T+=C.codingpasses;var D=new Int16Array(I),E=0;for(w=0,k=S.length;k>w;w++){C=S[w];var A=C.data.subarray(C.start,C.end);D.set(A,E),E+=A.length}var z=new y(D,0,I);for(_.setDecoder(z),w=0;T>w;w++){switch(g){case 0:_.runSignificancePropogationPass();break;case 1:_.runMagnitudeRefinementPass();break;case 2:_.runCleanupPass(),s&&_.checkSegmentationSymbol()}g=(g+1)%3}var O,R,M,B=v.tbx0_-l+(v.tby0_-u)*c,F=_.coefficentsSign,U=_.coefficentsMagnitude,N=_.bitsDecoded,V=a?0:.5;E=0;var j="LL"!==i.type;for(w=0;b>w;w++){var L=B/c|0,G=2*L*(t-c)+d+h;for(O=0;x>O;O++){if(R=U[E],0!==R){R=(R+V)*r,0!==F[E]&&(R=-R),M=N[E];var H=j?G+(B<<1):B;a&&M>=o?e[H]=R:e[H]=R*(1<<o-M)}B++,E++}B+=c-x}}}}function k(e,t,n){for(var i=t.components[n],r=i.codingStyleParameters,o=i.quantizationParameters,a=r.decompositionLevelsCount,s=o.SPqcds,l=o.scalarExpounded,u=o.guardBits,c=r.segmentationSymbolUsed,f=e.components[n].precision,d=r.reversibleTransformation,h=d?new z:new A,p=[],m=0,v=0;a>=v;v++){for(var y=i.resolutions[v],x=y.trx1-y.trx0,b=y.try1-y.try0,_=new Float32Array(x*b),g=0,k=y.subbands.length;k>g;g++){var C,S;l?(C=s[m].mu,S=s[m].epsilon,m++):(C=s[0].mu,S=s[0].epsilon+(v>0?1-v:0));var T=y.subbands[g],D=I[T.type],P=d?1:Math.pow(2,f+D-S)*(1+C/2048),E=u+S-1;w(_,x,b,T,P,E,d,c)}p.push({width:x,height:b,items:_})}var O=h.calculate(p,i.tcx0,i.tcy0);return{left:i.tcx0,top:i.tcy0,width:O.width,height:O.height,items:O.items}}function C(e){for(var t=e.SIZ,n=e.components,i=t.Csiz,r=[],o=0,a=e.tiles.length;a>o;o++){var s,l=e.tiles[o],u=[];for(s=0;i>s;s++)u[s]=k(e,l,s);var c=u[0],f=n[0].isSigned;if(f)var d=new Int16Array(c.items.length*i);else var d=new Uint16Array(c.items.length*i);var h,p,m,v,y,x,b,_,g,w,C,S,I,T,D,P={left:c.left,top:c.top,width:c.width,height:c.height,items:d},E=0;if(l.codingStyleDefaultParameters.multipleComponentTransform){var A=4===i,z=u[0].items,O=u[1].items,R=u[2].items,M=A?u[3].items:null;h=n[0].precision-8,p=(128<<h)+.5,m=255*(1<<h),y=.5*m,v=-y;var B=l.components[0],F=i-3;if(b=z.length,B.codingStyleParameters.reversibleTransformation)for(x=0;b>x;x++,E+=F)_=z[x]+p,g=O[x],w=R[x],S=_-(w+g>>2),C=S+w,I=S+g,d[E++]=0>=C?0:C>=m?255:C>>h,d[E++]=0>=S?0:S>=m?255:S>>h,d[E++]=0>=I?0:I>=m?255:I>>h;else for(x=0;b>x;x++,E+=F)_=z[x]+p,g=O[x],w=R[x],C=_+1.402*w,S=_-.34413*g-.71414*w,I=_+1.772*g,d[E++]=0>=C?0:C>=m?255:C>>h,d[E++]=0>=S?0:S>=m?255:S>>h,d[E++]=0>=I?0:I>=m?255:I>>h;if(A)for(x=0,E=3;b>x;x++,E+=4)T=M[x],d[E]=v>=T?0:T>=y?255:T+p>>h}else for(s=0;i>s;s++)if(8===n[s].precision){var U=u[s].items;for(h=n[s].precision-8,p=(128<<h)+.5,m=127.5*(1<<h),v=-m,E=s,x=0,b=U.length;b>x;x++)D=U[x],d[E]=v>=D?0:D>=m?255:D+p>>h,E+=i}else{var f=n[s].isSigned,U=u[s].items;if(f)for(E=s,x=0,b=U.length;b>x;x++)d[E]=U[x],E+=i;else{h=n[s].precision-8,p=(128<<h)+.5;var N=Math.pow(2,n[s].precision)-1;for(E=s,x=0,b=U.length;b>x;x++)D=U[x],d[E]=Math.max(Math.min(D+p,N),0),E+=i}}r.push(P)}return r}function S(e,t){for(var n=e.SIZ,i=n.Csiz,r=e.tiles[t],o=0;i>o;o++){var a=r.components[o],s=void 0!==e.currentTile.QCC[o]?e.currentTile.QCC[o]:e.currentTile.QCD;a.quantizationParameters=s;var l=void 0!==e.currentTile.COC[o]?e.currentTile.COC[o]:e.currentTile.COD;a.codingStyleParameters=l}r.codingStyleDefaultParameters=e.currentTile.COD}var I={LL:0,LH:1,HL:1,HH:2};e.prototype={parse:function(e){var t=c(e,0);if(65359===t)return void this.parseCodestream(e,0,e.length);for(var n=0,o=e.length;o>n;){var a=8,s=f(e,n),l=f(e,n+4);if(n+=a,1===s&&(s=4294967296*f(e,n)+f(e,n+4),n+=8,a+=8),0===s&&(s=o-n+a),a>s)throw new Error("JPX Error: Invalid box field size");var u=s-a,d=!0;switch(l){case 1785737832:d=!1;break;case 1668246642:var h=e[n];e[n+1],e[n+2];if(1===h){var p=f(e,n+3);switch(p){case 16:case 17:case 18:break;default:r("Unknown colorspace "+p)}}else 2===h&&i("ICC profile not supported");break;case 1785737827:this.parseCodestream(e,n,n+u);break;case 1783636e3:218793738!==f(e,n)&&r("Invalid JP2 signature");break;case 1783634458:case 1718909296:case 1920099697:case 1919251232:case 1768449138:break;default:var m=String.fromCharCode(l>>24&255,l>>16&255,l>>8&255,255&l);r("Unsupported header type "+l+" ("+m+")")}d&&(n+=u)}},parseImageProperties:function(e){for(var t=e.getByte();t>=0;){var n=t;t=e.getByte();var i=n<<8|t;if(65361===i){e.skip(4);var r=e.getInt32()>>>0,o=e.getInt32()>>>0,a=e.getInt32()>>>0,s=e.getInt32()>>>0;e.skip(16);var l=e.getUint16();return this.width=r-a,this.height=o-s,this.componentsCount=l,void(this.bitsPerComponent=8)}}throw new Error("JPX Error: No size marker found in JPX stream")},parseCodestream:function(e,i,o){var a={};try{for(var s=!1,l=i;o>l+1;){var u=c(e,l);l+=2;var d,h,p,m,v,y,x=0;switch(u){case 65359:a.mainHeader=!0;break;case 65497:break;case 65361:x=c(e,l);var b={};b.Xsiz=f(e,l+4),b.Ysiz=f(e,l+8),b.XOsiz=f(e,l+12),b.YOsiz=f(e,l+16),b.XTsiz=f(e,l+20),b.YTsiz=f(e,l+24),b.XTOsiz=f(e,l+28),b.YTOsiz=f(e,l+32);var w=c(e,l+36);b.Csiz=w;var k=[];d=l+38;for(var I=0;w>I;I++){var T={precision:(127&e[d])+1,isSigned:!!(128&e[d]),XRsiz:e[d+1],YRsiz:e[d+1]};t(T,b),k.push(T)}a.SIZ=b,a.components=k,n(a,k),a.QCC=[],a.COC=[];break;case 65372:x=c(e,l);var D={};switch(d=l+2,h=e[d++],31&h){case 0:m=8,v=!0;break;case 1:m=16,v=!1;break;case 2:m=16,v=!0;break;default:throw new Error("JPX Error: Invalid SQcd value "+h)}for(D.noQuantization=8===m,D.scalarExpounded=v,D.guardBits=h>>5,p=[];x+l>d;){var P={};8===m?(P.epsilon=e[d++]>>3,P.mu=0):(P.epsilon=e[d]>>3,P.mu=(7&e[d])<<8|e[d+1],d+=2),p.push(P)}D.SPqcds=p,a.mainHeader?a.QCD=D:(a.currentTile.QCD=D,a.currentTile.QCC=[]);break;case 65373:x=c(e,l);var E={};d=l+2;var A;switch(a.SIZ.Csiz<257?A=e[d++]:(A=c(e,d),d+=2),h=e[d++],31&h){case 0:m=8,v=!0;break;case 1:m=16,v=!1;break;case 2:m=16,v=!0;break;default:throw new Error("JPX Error: Invalid SQcd value "+h)}for(E.noQuantization=8===m,E.scalarExpounded=v,E.guardBits=h>>5,p=[];x+l>d;)P={},8===m?(P.epsilon=e[d++]>>3,P.mu=0):(P.epsilon=e[d]>>3,P.mu=(7&e[d])<<8|e[d+1],d+=2),p.push(P);E.SPqcds=p,a.mainHeader?a.QCC[A]=E:a.currentTile.QCC[A]=E;break;case 65362:x=c(e,l);var z={};d=l+2;var O=e[d++];z.entropyCoderWithCustomPrecincts=!!(1&O),z.sopMarkerUsed=!!(2&O),z.ephMarkerUsed=!!(4&O),z.progressionOrder=e[d++],z.layersCount=c(e,d),d+=2,z.multipleComponentTransform=e[d++],z.decompositionLevelsCount=e[d++],z.xcb=(15&e[d++])+2,z.ycb=(15&e[d++])+2;var R=e[d++];if(z.selectiveArithmeticCodingBypass=!!(1&R),z.resetContextProbabilities=!!(2&R),z.terminationOnEachCodingPass=!!(4&R),z.verticalyStripe=!!(8&R),z.predictableTermination=!!(16&R),z.segmentationSymbolUsed=!!(32&R),z.reversibleTransformation=e[d++],z.entropyCoderWithCustomPrecincts){for(var M=[];x+l>d;){var B=e[d++];M.push({PPx:15&B,PPy:B>>4})}z.precinctsSizes=M}var F=[];if(z.selectiveArithmeticCodingBypass&&F.push("selectiveArithmeticCodingBypass"),z.resetContextProbabilities&&F.push("resetContextProbabilities"),z.terminationOnEachCodingPass&&F.push("terminationOnEachCodingPass"),z.verticalyStripe&&F.push("verticalyStripe"),z.predictableTermination&&F.push("predictableTermination"),F.length>0)throw s=!0,new Error("JPX Error: Unsupported COD options ("+F.join(", ")+")");a.mainHeader?a.COD=z:(a.currentTile.COD=z,a.currentTile.COC=[]);break;case 65424:x=c(e,l),y={},y.index=c(e,l+2),y.length=f(e,l+4),y.dataEnd=y.length+l-2,y.partIndex=e[l+8],y.partsCount=e[l+9],a.mainHeader=!1,0===y.partIndex&&(y.COD=a.COD,y.COC=a.COC.slice(0),y.QCD=a.QCD,y.QCC=a.QCC.slice(0)),a.currentTile=y;break;case 65427:y=a.currentTile,0===y.partIndex&&(S(a,y.index),_(a)),x=y.dataEnd-l,g(a,e,l,x);break;case 65365:case 65367:case 65368:case 65380:x=c(e,l);break;case 65363:throw new Error("JPX Error: Codestream code 0xFF53 (COC) is not implemented");default:throw new Error("JPX Error: Unknown codestream code: "+u.toString(16))}l+=x}}catch(U){if(s||this.failOnCorruptedImage)throw U;r("Trying to recover from "+U.message)}this.tiles=C(a),this.width=a.SIZ.Xsiz-a.SIZ.XOsiz,this.height=a.SIZ.Ysiz-a.SIZ.YOsiz,this.componentsCount=a.SIZ.Csiz}};var T=function(){function e(e,t){var n=u(Math.max(e,t))+1;this.levels=[];for(var i=0;n>i;i++){var r={width:e,height:t,items:[]};this.levels.push(r),e=Math.ceil(e/2),t=Math.ceil(t/2)}}return e.prototype={reset:function(e,t){for(var n,i=0,r=0;i<this.levels.length;){n=this.levels[i];var o=e+t*n.width;if(void 0!==n.items[o]){r=n.items[o];break}n.index=o,e>>=1,t>>=1,i++}i--,n=this.levels[i],n.items[n.index]=r,this.currentLevel=i,delete this.value},incrementValue:function(){var e=this.levels[this.currentLevel];e.items[e.index]++},nextLevel:function(){var e=this.currentLevel,t=this.levels[e],n=t.items[t.index];return e--,0>e?(this.value=n,!1):(this.currentLevel=e,t=this.levels[e],t.items[t.index]=n,!0)}},e}(),D=function(){function e(e,t){
var n=u(Math.max(e,t))+1;this.levels=[];for(var i=0;n>i;i++){for(var r=new Uint8Array(e*t),o=new Uint8Array(e*t),a=0,s=r.length;s>a;a++)r[a]=0,o[a]=0;var l={width:e,height:t,items:r,status:o};this.levels.push(l),e=Math.ceil(e/2),t=Math.ceil(t/2)}}return e.prototype={reset:function(e,t,n){this.currentStopValue=n;for(var i=0;i<this.levels.length;){var r=this.levels[i],o=e+t*r.width;r.index=o,e>>=1,t>>=1,i++}this.currentLevel=this.levels.length-1,this.minValue=this.levels[this.currentLevel].items[0]},incrementValue:function(){var e=this.levels[this.currentLevel];e.items[e.index]=e.items[e.index]+1,e.items[e.index]>this.minValue&&(this.minValue=e.items[e.index])},nextLevel:function(){var e=this.currentLevel;if(e--,0>e)return!1;this.currentLevel=e;var t=this.levels[e];return t.items[t.index]<this.minValue?t.items[t.index]=this.minValue:t.items[t.index]>this.minValue&&(this.minValue=t.items[t.index]),!0},isLeaf:function(){return 0===this.currentLevel},isAboveThreshold:function(){var e=this.currentLevel,t=this.levels[e];return t.items[t.index]>this.currentStopValue},isKnown:function(){var e=this.currentLevel,t=this.levels[e];return t.status[t.index]>0},setKnown:function(){var e=this.currentLevel,t=this.levels[e];t.status[t.index]=1}},e}(),P=function(){function e(e,t,n,a,s){this.width=e,this.height=t,this.contextLabelTable="HH"===n?o:"HL"===n?r:i;var l=e*t;this.neighborsSignificance=new Uint8Array(l),this.coefficentsSign=new Uint8Array(l),this.coefficentsMagnitude=s>14?new Uint32Array(l):s>6?new Uint16Array(l):new Uint8Array(l),this.processingFlags=new Uint8Array(l);var u=new Uint8Array(l);if(0!==a)for(var c=0;l>c;c++)u[c]=a;this.bitsDecoded=u,this.reset()}var t=17,n=18,i=new Uint8Array([0,5,8,0,3,7,8,0,4,7,8,0,0,0,0,0,1,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8]),r=new Uint8Array([0,3,4,0,5,7,7,0,8,8,8,0,0,0,0,0,1,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8]),o=new Uint8Array([0,1,2,0,1,2,2,0,2,2,2,0,0,0,0,0,3,4,5,0,4,5,5,0,5,5,5,0,0,0,0,0,6,7,7,0,7,7,7,0,7,7,7,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8]);return e.prototype={setDecoder:function(e){this.decoder=e},reset:function(){this.contexts=new Int8Array(19),this.contexts[0]=8,this.contexts[t]=92,this.contexts[n]=6},setNeighborsSignificance:function(e,t,n){var i,r=this.neighborsSignificance,o=this.width,a=this.height,s=t>0,l=o>t+1;e>0&&(i=n-o,s&&(r[i-1]+=16),l&&(r[i+1]+=16),r[i]+=4),a>e+1&&(i=n+o,s&&(r[i-1]+=16),l&&(r[i+1]+=16),r[i]+=4),s&&(r[n-1]+=1),l&&(r[n+1]+=1),r[n]|=128},runSignificancePropogationPass:function(){for(var e=this.decoder,t=this.width,n=this.height,i=this.coefficentsMagnitude,r=this.coefficentsSign,o=this.neighborsSignificance,a=this.processingFlags,s=this.contexts,l=this.contextLabelTable,u=this.bitsDecoded,c=-2,f=1,d=2,h=0;n>h;h+=4)for(var p=0;t>p;p++)for(var m=h*t+p,v=0;4>v;v++,m+=t){var y=h+v;if(y>=n)break;if(a[m]&=c,!i[m]&&o[m]){var x=l[o[m]],b=e.readBit(s,x);if(b){var _=this.decodeSignBit(y,p,m);r[m]=_,i[m]=1,this.setNeighborsSignificance(y,p,m),a[m]|=d}u[m]++,a[m]|=f}}},decodeSignBit:function(e,t,n){var i,r,o,a,s,l,u=this.width,c=this.height,f=this.coefficentsMagnitude,d=this.coefficentsSign;a=t>0&&0!==f[n-1],u>t+1&&0!==f[n+1]?(o=d[n+1],a?(r=d[n-1],i=1-o-r):i=1-o-o):a?(r=d[n-1],i=1-r-r):i=0;var h=3*i;return a=e>0&&0!==f[n-u],c>e+1&&0!==f[n+u]?(o=d[n+u],a?(r=d[n-u],i=1-o-r+h):i=1-o-o+h):a?(r=d[n-u],i=1-r-r+h):i=h,i>=0?(s=9+i,l=this.decoder.readBit(this.contexts,s)):(s=9-i,l=1^this.decoder.readBit(this.contexts,s)),l},runMagnitudeRefinementPass:function(){for(var e,t=this.decoder,n=this.width,i=this.height,r=this.coefficentsMagnitude,o=this.neighborsSignificance,a=this.contexts,s=this.bitsDecoded,l=this.processingFlags,u=1,c=2,f=n*i,d=4*n,h=0;f>h;h=e){e=Math.min(f,h+d);for(var p=0;n>p;p++)for(var m=h+p;e>m;m+=n)if(r[m]&&0===(l[m]&u)){var v=16;if(0!==(l[m]&c)){l[m]^=c;var y=127&o[m];v=0===y?15:14}var x=t.readBit(a,v);r[m]=r[m]<<1|x,s[m]++,l[m]|=u}}},runCleanupPass:function(){for(var e,i=this.decoder,r=this.width,o=this.height,a=this.neighborsSignificance,s=this.coefficentsMagnitude,l=this.coefficentsSign,u=this.contexts,c=this.contextLabelTable,f=this.bitsDecoded,d=this.processingFlags,h=1,p=2,m=r,v=2*r,y=3*r,x=0;o>x;x=e){e=Math.min(x+4,o);for(var b=x*r,_=o>x+3,g=0;r>g;g++){var w,k=b+g,C=_&&0===d[k]&&0===d[k+m]&&0===d[k+v]&&0===d[k+y]&&0===a[k]&&0===a[k+m]&&0===a[k+v]&&0===a[k+y],S=0,I=k,T=x;if(C){var D=i.readBit(u,n);if(!D){f[k]++,f[k+m]++,f[k+v]++,f[k+y]++;continue}S=i.readBit(u,t)<<1|i.readBit(u,t),0!==S&&(T=x+S,I+=S*r),w=this.decodeSignBit(T,g,I),l[I]=w,s[I]=1,this.setNeighborsSignificance(T,g,I),d[I]|=p,I=k;for(var P=x;T>=P;P++,I+=r)f[I]++;S++}for(T=x+S;e>T;T++,I+=r)if(!s[I]&&0===(d[I]&h)){var E=c[a[I]],A=i.readBit(u,E);1===A&&(w=this.decodeSignBit(T,g,I),l[I]=w,s[I]=1,this.setNeighborsSignificance(T,g,I),d[I]|=p),f[I]++}}}},checkSegmentationSymbol:function(){var e=this.decoder,n=this.contexts,i=e.readBit(n,t)<<3|e.readBit(n,t)<<2|e.readBit(n,t)<<1|e.readBit(n,t);if(10!==i)throw new Error("JPX Error: Invalid segmentation symbol")}},e}(),E=function(){function e(){}return e.prototype.calculate=function(e,t,n){for(var i=e[0],r=1,o=e.length;o>r;r++)i=this.iterate(i,e[r],t,n);return i},e.prototype.extend=function(e,t,n){var i=t-1,r=t+1,o=t+n-2,a=t+n;e[i--]=e[r++],e[a++]=e[o--],e[i--]=e[r++],e[a++]=e[o--],e[i--]=e[r++],e[a++]=e[o--],e[i]=e[r],e[a]=e[o]},e.prototype.iterate=function(e,t,n,i){var r,o,a,s,l,u,c=e.width,f=e.height,d=e.items,h=t.width,p=t.height,m=t.items;for(a=0,r=0;f>r;r++)for(s=2*r*h,o=0;c>o;o++,a++,s+=2)m[s]=d[a];d=e.items=null;var v=4,y=new Float32Array(h+2*v);if(1===h){if(0!==(1&n))for(u=0,a=0;p>u;u++,a+=h)m[a]*=.5}else for(u=0,a=0;p>u;u++,a+=h)y.set(m.subarray(a,a+h),v),this.extend(y,v,h),this.filter(y,v,h),m.set(y.subarray(v,v+h),a);var x=16,b=[];for(r=0;x>r;r++)b.push(new Float32Array(p+2*v));var _,g=0;if(e=v+p,1===p){if(0!==(1&i))for(l=0;h>l;l++)m[l]*=.5}else for(l=0;h>l;l++){if(0===g){for(x=Math.min(h-l,x),a=l,s=v;e>s;a+=h,s++)for(_=0;x>_;_++)b[_][s]=m[a+_];g=x}g--;var w=b[g];if(this.extend(w,v,p),this.filter(w,v,p),0===g)for(a=l-x+1,s=v;e>s;a+=h,s++)for(_=0;x>_;_++)m[a+_]=b[_][s]}return{width:h,height:p,items:m}},e}(),A=function(){function e(){E.call(this)}return e.prototype=Object.create(E.prototype),e.prototype.filter=function(e,t,n){var i=n>>1;t=0|t;var r,o,a,s,l=-1.586134342059924,u=-.052980118572961,c=.882911075530934,f=.443506852043971,d=1.230174104914001,h=1/d;for(r=t-3,o=i+4;o--;r+=2)e[r]*=h;for(r=t-2,a=f*e[r-1],o=i+3;o--&&(s=f*e[r+1],e[r]=d*e[r]-a-s,o--);r+=2)r+=2,a=f*e[r+1],e[r]=d*e[r]-a-s;for(r=t-1,a=c*e[r-1],o=i+2;o--&&(s=c*e[r+1],e[r]-=a+s,o--);r+=2)r+=2,a=c*e[r+1],e[r]-=a+s;for(r=t,a=u*e[r-1],o=i+1;o--&&(s=u*e[r+1],e[r]-=a+s,o--);r+=2)r+=2,a=u*e[r+1],e[r]-=a+s;if(0!==i)for(r=t+1,a=l*e[r-1],o=i;o--&&(s=l*e[r+1],e[r]-=a+s,o--);r+=2)r+=2,a=l*e[r+1],e[r]-=a+s},e}(),z=function(){function e(){E.call(this)}return e.prototype=Object.create(E.prototype),e.prototype.filter=function(e,t,n){var i=n>>1;t=0|t;var r,o;for(r=t,o=i+1;o--;r+=2)e[r]-=e[r-1]+e[r+1]+2>>2;for(r=t+1,o=i;o--;r+=2)e[r]+=e[r-1]+e[r+1]>>1},e}();return e}(),y=function(){function e(e,t,n){this.data=e,this.bp=t,this.dataEnd=n,this.chigh=e[t],this.clow=0,this.byteIn(),this.chigh=this.chigh<<7&65535|this.clow>>9&127,this.clow=this.clow<<7&65535,this.ct-=7,this.a=32768}var t=[{qe:22017,nmps:1,nlps:1,switchFlag:1},{qe:13313,nmps:2,nlps:6,switchFlag:0},{qe:6145,nmps:3,nlps:9,switchFlag:0},{qe:2753,nmps:4,nlps:12,switchFlag:0},{qe:1313,nmps:5,nlps:29,switchFlag:0},{qe:545,nmps:38,nlps:33,switchFlag:0},{qe:22017,nmps:7,nlps:6,switchFlag:1},{qe:21505,nmps:8,nlps:14,switchFlag:0},{qe:18433,nmps:9,nlps:14,switchFlag:0},{qe:14337,nmps:10,nlps:14,switchFlag:0},{qe:12289,nmps:11,nlps:17,switchFlag:0},{qe:9217,nmps:12,nlps:18,switchFlag:0},{qe:7169,nmps:13,nlps:20,switchFlag:0},{qe:5633,nmps:29,nlps:21,switchFlag:0},{qe:22017,nmps:15,nlps:14,switchFlag:1},{qe:21505,nmps:16,nlps:14,switchFlag:0},{qe:20737,nmps:17,nlps:15,switchFlag:0},{qe:18433,nmps:18,nlps:16,switchFlag:0},{qe:14337,nmps:19,nlps:17,switchFlag:0},{qe:13313,nmps:20,nlps:18,switchFlag:0},{qe:12289,nmps:21,nlps:19,switchFlag:0},{qe:10241,nmps:22,nlps:19,switchFlag:0},{qe:9217,nmps:23,nlps:20,switchFlag:0},{qe:8705,nmps:24,nlps:21,switchFlag:0},{qe:7169,nmps:25,nlps:22,switchFlag:0},{qe:6145,nmps:26,nlps:23,switchFlag:0},{qe:5633,nmps:27,nlps:24,switchFlag:0},{qe:5121,nmps:28,nlps:25,switchFlag:0},{qe:4609,nmps:29,nlps:26,switchFlag:0},{qe:4353,nmps:30,nlps:27,switchFlag:0},{qe:2753,nmps:31,nlps:28,switchFlag:0},{qe:2497,nmps:32,nlps:29,switchFlag:0},{qe:2209,nmps:33,nlps:30,switchFlag:0},{qe:1313,nmps:34,nlps:31,switchFlag:0},{qe:1089,nmps:35,nlps:32,switchFlag:0},{qe:673,nmps:36,nlps:33,switchFlag:0},{qe:545,nmps:37,nlps:34,switchFlag:0},{qe:321,nmps:38,nlps:35,switchFlag:0},{qe:273,nmps:39,nlps:36,switchFlag:0},{qe:133,nmps:40,nlps:37,switchFlag:0},{qe:73,nmps:41,nlps:38,switchFlag:0},{qe:37,nmps:42,nlps:39,switchFlag:0},{qe:21,nmps:43,nlps:40,switchFlag:0},{qe:9,nmps:44,nlps:41,switchFlag:0},{qe:5,nmps:45,nlps:42,switchFlag:0},{qe:1,nmps:45,nlps:43,switchFlag:0},{qe:22017,nmps:46,nlps:46,switchFlag:0}];return e.prototype={byteIn:function(){var e=this.data,t=this.bp;if(255===e[t]){var n=e[t+1];n>143?(this.clow+=65280,this.ct=8):(t++,this.clow+=e[t]<<9,this.ct=7,this.bp=t)}else t++,this.clow+=t<this.dataEnd?e[t]<<8:65280,this.ct=8,this.bp=t;this.clow>65535&&(this.chigh+=this.clow>>16,this.clow&=65535)},readBit:function(e,n){var i,r=e[n]>>1,o=1&e[n],a=t[r],s=a.qe,l=this.a-s;if(this.chigh<s)s>l?(l=s,i=o,r=a.nmps):(l=s,i=1^o,1===a.switchFlag&&(o=i),r=a.nlps);else{if(this.chigh-=s,0!==(32768&l))return this.a=l,o;s>l?(i=1^o,1===a.switchFlag&&(o=i),r=a.nlps):(i=o,r=a.nmps)}do 0===this.ct&&this.byteIn(),l<<=1,this.chigh=this.chigh<<1&65535|this.clow>>15&1,this.clow=this.clow<<1&65535,this.ct--;while(0===(32768&l));return this.a=l,e[n]=r<<1|o,i}},e}(),x="undefined"==typeof window?this:window;"undefined"==typeof window;x.PDFJS||(x.PDFJS={}),x.PDFJS.pdfBug=!1,PDFJS.VERBOSITY_LEVELS={errors:0,warnings:1,infos:5};var b=(PDFJS.OPS={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotations:78,endAnnotations:79,beginAnnotation:80,endAnnotation:81,paintJpegXObject:82,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91},PDFJS.UNSUPPORTED_FEATURES={unknown:"unknown",forms:"forms",javaScript:"javaScript",smask:"smask",shadingPattern:"shadingPattern",font:"font"}),_=PDFJS.UnsupportedManager=function(){var e=[];return{listen:function(t){e.push(t)},notify:function(t){r('Unsupported feature "'+t+'"');for(var n=0,i=e.length;i>n;n++)e[n](t)}}}();PDFJS.isValidUrl=s,PDFJS.shadow=l;var g=(PDFJS.PasswordResponses={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},function(){function e(e,t){this.name="PasswordException",this.message=e,this.code=t}return e.prototype=new Error,e.constructor=e,e}());PDFJS.PasswordException=g;var w=function(){function e(e,t){this.name="UnknownErrorException",this.message=e,this.details=t}return e.prototype=new Error,e.constructor=e,e}();PDFJS.UnknownErrorException=w;var k=function(){function e(e){this.name="InvalidPDFException",this.message=e}return e.prototype=new Error,e.constructor=e,e}();PDFJS.InvalidPDFException=k;var C=function(){function e(e){this.name="MissingPDFException",this.message=e}return e.prototype=new Error,e.constructor=e,e}();PDFJS.MissingPDFException=C;var S=function(){function e(e,t){this.name="UnexpectedResponseException",this.message=e,this.status=t}return e.prototype=new Error,e.constructor=e,e}();PDFJS.UnexpectedResponseException=S;(function(){function e(e){this.message=e}return e.prototype=new Error,e.prototype.name="NotImplementedException",e.constructor=e,e})(),function(){function e(e,t){this.begin=e,this.end=t,this.message="Missing data ["+e+", "+t+")"}return e.prototype=new Error,e.prototype.name="MissingDataException",e.constructor=e,e}(),function(){function e(e){this.message=e}return e.prototype=new Error,e.prototype.name="XRefParseException",e.constructor=e,e}();Object.defineProperty(PDFJS,"isLittleEndian",{configurable:!0,get:function(){return l(PDFJS,"isLittleEndian",d())}}),Object.defineProperty(PDFJS,"hasCanvasTypedArrays",{configurable:!0,get:function(){return l(PDFJS,"hasCanvasTypedArrays",h())}});var I=(function(){function e(e,t){this.buffer=e,this.byteLength=e.length,this.length=void 0===t?this.byteLength>>2:t,n(this.length)}function t(e){return{get:function(){var t=this.buffer,n=e<<2;return(t[n]|t[n+1]<<8|t[n+2]<<16|t[n+3]<<24)>>>0},set:function(t){var n=this.buffer,i=e<<2;n[i]=255&t,n[i+1]=t>>8&255,n[i+2]=t>>16&255,n[i+3]=t>>>24&255}}}function n(n){for(;n>i;)Object.defineProperty(e.prototype,i,t(i)),i++}e.prototype=Object.create(null);var i=0;return e}(),PDFJS.Util=function(){function e(){}var t=["rgb(",0,",",0,",",0,")"];return e.makeCssRgb=function(e,n,i){return t[1]=e,t[3]=n,t[5]=i,t.join("")},e.transform=function(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]},e.applyTransform=function(e,t){var n=e[0]*t[0]+e[1]*t[2]+t[4],i=e[0]*t[1]+e[1]*t[3]+t[5];return[n,i]},e.applyInverseTransform=function(e,t){var n=t[0]*t[3]-t[1]*t[2],i=(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/n,r=(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/n;return[i,r]},e.getAxialAlignedBoundingBox=function(t,n){var i=e.applyTransform(t,n),r=e.applyTransform(t.slice(2,4),n),o=e.applyTransform([t[0],t[3]],n),a=e.applyTransform([t[2],t[1]],n);return[Math.min(i[0],r[0],o[0],a[0]),Math.min(i[1],r[1],o[1],a[1]),Math.max(i[0],r[0],o[0],a[0]),Math.max(i[1],r[1],o[1],a[1])]},e.inverseTransform=function(e){var t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]},e.apply3dTransform=function(e,t){return[e[0]*t[0]+e[1]*t[1]+e[2]*t[2],e[3]*t[0]+e[4]*t[1]+e[5]*t[2],e[6]*t[0]+e[7]*t[1]+e[8]*t[2]]},e.singularValueDecompose2dScale=function(e){var t=[e[0],e[2],e[1],e[3]],n=e[0]*t[0]+e[1]*t[2],i=e[0]*t[1]+e[1]*t[3],r=e[2]*t[0]+e[3]*t[2],o=e[2]*t[1]+e[3]*t[3],a=(n+o)/2,s=Math.sqrt((n+o)*(n+o)-4*(n*o-r*i))/2,l=a+s||1,u=a-s||1;return[Math.sqrt(l),Math.sqrt(u)]},e.normalizeRect=function(e){var t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t},e.intersect=function(t,n){function i(e,t){return e-t}var r=[t[0],t[2],n[0],n[2]].sort(i),o=[t[1],t[3],n[1],n[3]].sort(i),a=[];return t=e.normalizeRect(t),n=e.normalizeRect(n),r[0]===t[0]&&r[1]===n[0]||r[0]===n[0]&&r[1]===t[0]?(a[0]=r[1],a[2]=r[2],o[0]===t[1]&&o[1]===n[1]||o[0]===n[1]&&o[1]===t[1]?(a[1]=o[1],a[3]=o[2],a):!1):!1},e.sign=function(e){return 0>e?-1:1},e.appendToArray=function(e,t){Array.prototype.push.apply(e,t)},e.prependToArray=function(e,t){Array.prototype.unshift.apply(e,t)},e.extendObj=function(e,t){for(var n in t)e[n]=t[n]},e.getInheritableProperty=function(e,t){for(;e&&!e.has(t);)e=e.get("Parent");return e?e.get(t):null},e.inherit=function(e,t,n){e.prototype=Object.create(t.prototype),e.prototype.constructor=e;for(var i in n)e.prototype[i]=n[i]},e.loadScript=function(e,t){var n=document.createElement("script"),i=!1;n.setAttribute("src",e),t&&(n.onload=function(){i||t(),i=!0}),document.getElementsByTagName("head")[0].appendChild(n)},e}());PDFJS.PageViewport=function(){function e(e,t,n,i,r,o){this.viewBox=e,this.scale=t,this.rotation=n,this.offsetX=i,this.offsetY=r;var a,s,l,u,c=(e[2]+e[0])/2,f=(e[3]+e[1])/2;switch(n%=360,n=0>n?n+360:n){case 180:a=-1,s=0,l=0,u=1;break;case 90:a=0,s=1,l=1,u=0;break;case 270:a=0,s=-1,l=-1,u=0;break;default:a=1,s=0,l=0,u=-1}o&&(l=-l,u=-u);var d,h,p,m;0===a?(d=Math.abs(f-e[1])*t+i,h=Math.abs(c-e[0])*t+r,p=Math.abs(e[3]-e[1])*t,m=Math.abs(e[2]-e[0])*t):(d=Math.abs(c-e[0])*t+i,h=Math.abs(f-e[1])*t+r,p=Math.abs(e[2]-e[0])*t,m=Math.abs(e[3]-e[1])*t),this.transform=[a*t,s*t,l*t,u*t,d-a*t*c-l*t*f,h-s*t*c-u*t*f],this.width=p,this.height=m,this.fontScale=t}return e.prototype={clone:function(t){t=t||{};var n="scale"in t?t.scale:this.scale,i="rotation"in t?t.rotation:this.rotation;return new e(this.viewBox.slice(),n,i,this.offsetX,this.offsetY,t.dontFlip)},convertToViewportPoint:function(e,t){return I.applyTransform([e,t],this.transform)},convertToViewportRectangle:function(e){var t=I.applyTransform([e[0],e[1]],this.transform),n=I.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],n[0],n[1]]},convertToPdfPoint:function(e,t){return I.applyInverseTransform([e,t],this.transform)}},e}();PDFJS.createPromiseCapability=p,function(){function e(e){this._status=t,this._handlers=[];try{e.call(this,this._resolve.bind(this),this._reject.bind(this))}catch(n){this._reject(n)}}if(x.Promise)return"function"!=typeof x.Promise.all&&(x.Promise.all=function(e){var t,n,i=0,r=[],o=new x.Promise(function(e,i){t=e,n=i});return e.forEach(function(e,o){i++,e.then(function(e){r[o]=e,i--,0===i&&t(r)},n)}),0===i&&t(r),o}),"function"!=typeof x.Promise.resolve&&(x.Promise.resolve=function(e){return new x.Promise(function(t){t(e)})}),"function"!=typeof x.Promise.reject&&(x.Promise.reject=function(e){return new x.Promise(function(t,n){n(e)})}),void("function"!=typeof x.Promise.prototype["catch"]&&(x.Promise.prototype["catch"]=function(e){return x.Promise.prototype.then(void 0,e)}));var t=0,n=1,i=2,o=500,a={handlers:[],running:!1,unhandledRejections:[],pendingRejectionCheck:!1,scheduleHandlers:function(e){e._status!==t&&(this.handlers=this.handlers.concat(e._handlers),e._handlers=[],this.running||(this.running=!0,setTimeout(this.runHandlers.bind(this),0)))},runHandlers:function(){for(var e=1,t=Date.now()+e;this.handlers.length>0;){var r=this.handlers.shift(),o=r.thisPromise._status,a=r.thisPromise._value;try{o===n?"function"==typeof r.onResolve&&(a=r.onResolve(a)):"function"==typeof r.onReject&&(a=r.onReject(a),o=n,r.thisPromise._unhandledRejection&&this.removeUnhandeledRejection(r.thisPromise))}catch(s){o=i,a=s}if(r.nextPromise._updateStatus(o,a),Date.now()>=t)break}return this.handlers.length>0?void setTimeout(this.runHandlers.bind(this),0):void(this.running=!1)},addUnhandledRejection:function(e){this.unhandledRejections.push({promise:e,time:Date.now()}),this.scheduleRejectionCheck()},removeUnhandeledRejection:function(e){e._unhandledRejection=!1;for(var t=0;t<this.unhandledRejections.length;t++)this.unhandledRejections[t].promise===e&&(this.unhandledRejections.splice(t),t--)},scheduleRejectionCheck:function(){this.pendingRejectionCheck||(this.pendingRejectionCheck=!0,setTimeout(function(){this.pendingRejectionCheck=!1;for(var e=Date.now(),t=0;t<this.unhandledRejections.length;t++)if(e-this.unhandledRejections[t].time>o){var n=this.unhandledRejections[t].promise._value,i="Unhandled rejection: "+n;n.stack&&(i+="\n"+n.stack),r(i),this.unhandledRejections.splice(t),t--}this.unhandledRejections.length&&this.scheduleRejectionCheck()}.bind(this),o))}};e.all=function(t){function n(e){a._status!==i&&(l=[],o(e))}var r,o,a=new e(function(e,t){r=e,o=t}),s=t.length,l=[];if(0===s)return r(l),a;for(var u=0,c=t.length;c>u;++u){var f=t[u],d=function(e){return function(t){a._status!==i&&(l[e]=t,s--,0===s&&r(l))}}(u);e.isPromise(f)?f.then(d,n):d(f)}return a},e.isPromise=function(e){return e&&"function"==typeof e.then},e.resolve=function(t){return new e(function(e){e(t)})},e.reject=function(t){return new e(function(e,n){n(t)})},e.prototype={_status:null,_value:null,_handlers:null,_unhandledRejection:null,_updateStatus:function(t,r){if(this._status!==n&&this._status!==i){if(t===n&&e.isPromise(r))return void r.then(this._updateStatus.bind(this,n),this._updateStatus.bind(this,i));this._status=t,this._value=r,t===i&&0===this._handlers.length&&(this._unhandledRejection=!0,a.addUnhandledRejection(this)),a.scheduleHandlers(this)}},_resolve:function(e){this._updateStatus(n,e)},_reject:function(e){this._updateStatus(i,e)},then:function(t,n){var i=new e(function(e,t){this.resolve=e,this.reject=t});return this._handlers.push({thisPromise:this,onResolve:t,onReject:n,nextPromise:i}),a.scheduleHandlers(this),i},"catch":function(e){return this.then(void 0,e)}},x.Promise=e}();(function(){function e(e,t,n){for(;e.length<n;)e+=t;return e}function t(){this.started={},this.times=[],this.enabled=!0}return t.prototype={time:function(e){this.enabled&&(e in this.started&&r("Timer is already running for "+e),this.started[e]=Date.now())},timeEnd:function(e){this.enabled&&(e in this.started||r("Timer has not been started for "+e),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e])},toString:function(){var t,n,i=this.times,r="",o=0;for(t=0,n=i.length;n>t;++t){var a=i[t].name;a.length>o&&(o=a.length)}for(t=0,n=i.length;n>t;++t){var s=i[t],l=s.end-s.start;r+=e(s.name," ",o)+" "+l+"ms\n"}return r}},t})();PDFJS.createBlob=function(e,t){if("undefined"!=typeof Blob)return new Blob([e],{type:t});var n=new MozBlobBuilder;return n.append(e),n.getBlob(t)},PDFJS.createObjectURL=function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return function(t,n){if(!PDFJS.disableCreateObjectURL&&"undefined"!=typeof URL&&URL.createObjectURL){var i=PDFJS.createBlob(t,n);return URL.createObjectURL(i)}for(var r="data:"+n+";base64,",o=0,a=t.length;a>o;o+=3){var s=255&t[o],l=255&t[o+1],u=255&t[o+2],c=s>>2,f=(3&s)<<4|l>>4,d=a>o+1?(15&l)<<2|u>>6:64,h=a>o+2?63&u:64;r+=e[c]+e[f]+e[d]+e[h]}return r}}(),m.prototype={on:function(e,t,n){var i=this.actionHandler;i[e]&&o('There is already an actionName called "'+e+'"'),i[e]=[t,n]},send:function(e,t,n){var i={action:e,data:t};this.postMessage(i,n)},sendWithPromise:function(e,t,n){var i=this.callbackIndex++,r={action:e,data:t,callbackId:i},o=p();this.callbacksCapabilities[i]=o;try{this.postMessage(r,n)}catch(a){o.reject(a)}return o.promise},postMessage:function(e,t){t&&this.postMessageTransfers?this.comObj.postMessage(e,t):this.comObj.postMessage(e)}};var T=typeof t;"undefined"!==T&&t.exports&&(t.exports=v)},{}],3:[function(e,t,n){function i(e,t){return h.isUndefined(t)?""+t:h.isNumber(t)&&!isFinite(t)?t.toString():h.isFunction(t)||h.isRegExp(t)?t.toString():t}function r(e,t){return h.isString(e)?e.length<t?e:e.slice(0,t):e}function o(e){return r(JSON.stringify(e.actual,i),128)+" "+e.operator+" "+r(JSON.stringify(e.expected,i),128)}function a(e,t,n,i,r){throw new v.AssertionError({message:n,actual:e,expected:t,operator:i,stackStartFunction:r})}function s(e,t){e||a(e,!0,t,"==",v.ok)}function l(e,t){if(e===t)return!0;if(h.isBuffer(e)&&h.isBuffer(t)){if(e.length!=t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}return h.isDate(e)&&h.isDate(t)?e.getTime()===t.getTime():h.isRegExp(e)&&h.isRegExp(t)?e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase:h.isObject(e)||h.isObject(t)?c(e,t):e==t}function u(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function c(e,t){if(h.isNullOrUndefined(e)||h.isNullOrUndefined(t))return!1;if(e.prototype!==t.prototype)return!1;if(h.isPrimitive(e)||h.isPrimitive(t))return e===t;var n=u(e),i=u(t);if(n&&!i||!n&&i)return!1;if(n)return e=p.call(e),t=p.call(t),l(e,t);var r,o,a=y(e),s=y(t);if(a.length!=s.length)return!1;for(a.sort(),s.sort(),o=a.length-1;o>=0;o--)if(a[o]!=s[o])return!1;for(o=a.length-1;o>=0;o--)if(r=a[o],!l(e[r],t[r]))return!1;return!0}function f(e,t){return e&&t?"[object RegExp]"==Object.prototype.toString.call(t)?t.test(e):e instanceof t?!0:t.call({},e)===!0:!1}function d(e,t,n,i){var r;h.isString(n)&&(i=n,n=null);try{t()}catch(o){r=o}if(i=(n&&n.name?" ("+n.name+").":".")+(i?" "+i:"."),e&&!r&&a(r,n,"Missing expected exception"+i),!e&&f(r,n)&&a(r,n,"Got unwanted exception"+i),e&&r&&n&&!f(r,n)||!e&&r)throw r}var h=e("util/"),p=Array.prototype.slice,m=Object.prototype.hasOwnProperty,v=t.exports=s;v.AssertionError=function(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=o(this),this.generatedMessage=!0);var t=e.stackStartFunction||a;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var n=new Error;if(n.stack){var i=n.stack,r=t.name,s=i.indexOf("\n"+r);if(s>=0){var l=i.indexOf("\n",s+1);i=i.substring(l+1)}this.stack=i}}},h.inherits(v.AssertionError,Error),v.fail=a,v.ok=s,v.equal=function(e,t,n){e!=t&&a(e,t,n,"==",v.equal)},v.notEqual=function(e,t,n){e==t&&a(e,t,n,"!=",v.notEqual)},v.deepEqual=function(e,t,n){l(e,t)||a(e,t,n,"deepEqual",v.deepEqual)},v.notDeepEqual=function(e,t,n){l(e,t)&&a(e,t,n,"notDeepEqual",v.notDeepEqual)},v.strictEqual=function(e,t,n){e!==t&&a(e,t,n,"===",v.strictEqual)},v.notStrictEqual=function(e,t,n){e===t&&a(e,t,n,"!==",v.notStrictEqual)},v["throws"]=function(e,t,n){d.apply(this,[!0].concat(p.call(arguments)))},v.doesNotThrow=function(e,t){d.apply(this,[!1].concat(p.call(arguments)))},v.ifError=function(e){if(e)throw e};var y=Object.keys||function(e){var t=[];for(var n in e)m.call(e,n)&&t.push(n);return t}},{"util/":47}],4:[function(e,t,n){"use strict";var i=new Float32Array(1),r=new Uint32Array(i.buffer),o=4286578688;r[0]=o,t.exports=i[0]},{}],5:[function(e,t,n){"use strict";var i=new Float32Array(1),r=new Uint32Array(i.buffer),o=2139095040;r[0]=o,t.exports=i[0]},{}],6:[function(t,n,i){!function(t,i){"undefined"!=typeof n&&n.exports?n.exports=i():"function"==typeof e&&e.amd?e([],i):("undefined"==typeof cornerstone&&(dicomParser={},"undefined"!=typeof Package&&(t.dicomParser=dicomParser)),dicomParser=i())}(this,function(){var e=function(e){return void 0===e&&(e={}),e.parseDicom=function(t,n){function i(){f.seek(128);var e=f.readFixedString(4);if("DICM"!==e)throw"dicomParser.parseDicom: DICM prefix not found at location 132"}function r(){i();for(var t=[],n={};f.position<f.byteArray.length;){var r=f.position,o=e.readDicomElementExplicit(f,t);if(o.tag>"x0002ffff"){f.position=r;break}o.parser=e.littleEndianByteArrayParser,n[o.tag]=o}var a=new e.DataSet(f.byteArrayParser,f.byteArray,n);return a.warnings=f.warnings,a}function o(t){if(void 0===t.elements.x00020010)throw"dicomParser.parseDicom: missing required meta header attribute 0002,0010";var n=t.elements.x00020010;return e.readFixedString(f.byteArray,n.dataOffset,n.length)}function a(e){return"1.2.840.10008.1.2"!==e}function s(n){return"1.2.840.10008.1.2.2"===n?new e.ByteStream(e.bigEndianByteArrayParser,t,f.position):new e.ByteStream(e.littleEndianByteArrayParser,t,f.position)}function l(e,t){for(var n in e.elements)e.elements.hasOwnProperty(n)&&(t.elements[n]=e.elements[n]);return void 0!==e.warnings&&(t.warnings=e.warnings.concat(t.warnings)),t}function u(t){var i=o(t),r=a(i),l=s(i),u={},c=new e.DataSet(l.byteArrayParser,l.byteArray,u);c.warnings=l.warnings;try{r?e.parseDicomDataSetExplicit(c,l,l.byteArray.length,n):e.parseDicomDataSetImplicit(c,l,l.byteArray.length,n)}catch(f){var d={exception:f,dataSet:c};throw d}return c}function c(){var e=r(),t=u(e);return l(e,t)}if(void 0===t)throw"dicomParser.parseDicom: missing required parameter 'byteArray'";var f=new e.ByteStream(e.littleEndianByteArrayParser,t);return c()},e}(e),e=function(e){"use strict";return void 0===e&&(e={}),e.explicitDataSetToJS=function(t,n){if(void 0===t)throw"dicomParser.explicitDataSetToJS: missing required parameter dataSet";n=n||{omitPrivateAttibutes:!0,maxElementLength:128};var i={};for(var r in t.elements){var o=t.elements[r];if(n.omitPrivateAttibutes!==!0||!e.isPrivateTag(r))if(o.items){for(var a=[],s=0;s<o.items.length;s++)a.push(e.explicitDataSetToJS(o.items[s].dataSet,n));i[r]=a}else{var l;l=void 0,o.length<n.maxElementLength&&(l=e.explicitElementToString(t,o)),void 0!==l?i[r]=l:i[r]={dataOffset:o.dataOffset,length:o.length}}}return i},e}(e),e=function(e){"use strict";return void 0===e&&(e={}),e.explicitElementToString=function(t,n){function i(e,n){for(var i="",r=0;e>r;r++)0!==r&&(i+="/"),i+=n.call(t,a).toString();return i}if(void 0===t||void 0===n)throw"dicomParser.explicitElementToString: missing required parameters";if(void 0===n.vr)throw"dicomParser.explicitElementToString: cannot convert implicit element to string";var r,o=n.vr,a=n.tag;if(e.isStringVr(o)===!0)r=t.string(a);else{if("AT"==o){var s=t.uint32(a);if(void 0===s)return;return 0>s&&(s=4294967295+s+1),"x"+s.toString(16).toUpperCase()}"US"==o?r=i(n.length/2,t.uint16):"SS"===o?r=i(n.length/2,t.int16):"UL"==o?r=i(n.length/4,t.uint32):"SL"===o?r=i(n.length/4,t.int32):"FD"==o?r=i(n.length/8,t.int32):"FL"==o&&(r=i(n.length/4,t["float"]))}return r},e}(e),e=function(e){"use strict";void 0===e&&(e={});var t={AE:!0,AS:!0,AT:!1,CS:!0,DA:!0,DS:!0,DT:!0,FL:!1,FD:!1,IS:!0,LO:!0,LT:!0,OB:!1,OD:!1,OF:!1,OW:!1,PN:!0,SH:!0,SL:!1,SQ:!1,SS:!1,ST:!0,TM:!0,UI:!0,UL:!1,UN:void 0,UR:!0,US:!1,UT:!0};return e.isStringVr=function(e){return t[e]},e.isPrivateTag=function(e){var t=parseInt(e[4]),n=t%2===1;return n},e.parsePN=function(e){if(void 0!==e){var t=e.split("^");return{familyName:t[0],givenName:t[1],middleName:t[2],prefix:t[3],suffix:t[4]}}},e.parseDA=function(e){if(e&&8===e.length){var t=parseInt(e.substring(0,4),10),n=parseInt(e.substring(4,6),10),i=parseInt(e.substring(6,8),10);return{year:t,month:n,day:i}}},e.parseTM=function(e){if(e.length>=2){var t=parseInt(e.substring(0,2),10),n=e.length>=4?parseInt(e.substring(2,4),10):void 0,i=e.length>=6?parseInt(e.substring(4,6),10):void 0,r=e.length>=8?parseInt(e.substring(7,13),10):void 0;return{hours:t,minutes:n,seconds:i,fractionalSeconds:r}}},e}(e),e=function(e){"use strict";function t(e,t,n){if(1===t.length)return new Uint8Array(e.byteArray.buffer,t[0].dataOffset,t[0].length);for(var i=new Uint8Array(n),r=0,o=0;o<t.length;o++)for(var a=t[o].dataOffset,s=0;s<t[o].length;s++)i[r++]=e.byteArray[a++];return i}function n(n,i){for(var r=[],o=0;n.position<i&&n.position<n.byteArray.length;){var a=e.readSequenceItem(n);if("xfffee0dd"===a.tag)break;r.push(a),n.seek(a.length),o+=a.length}var s=t(n,r,o);return s}function i(e,t,i){var r=e.basicOffsetTable.length;if(i>r)throw"dicomParser.readEncapsulatedPixelData: parameter frame exceeds number of frames in basic offset table";var o=e.basicOffsetTable[i];t.seek(o);var a=e.basicOffsetTable[i+1];void 0===a&&(a=t.position+e.length);var s=n(t,a);return s}function r(e,t,i){if(0!==i)throw"dicomParser.readEncapsulatedPixelData: non zero frame specified for single frame encapsulated pixel data";var r=t.position+e.length,o=n(t,r);return o}return void 0===e&&(e={}),e.readEncapsulatedPixelData=function(t,n,o){if(void 0===t)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'dataSet'";if(void 0===n)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'element'";
if(void 0===o)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'frame'";if("x7fe00010"!==n.tag)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to non pixel data tag (expected tag = x7fe00010'";if(n.encapsulatedPixelData!==!0)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(n.hadUndefinedLength!==!0)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===n.basicOffsetTable)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===n.fragments)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(0>o)throw"dicomParser.readEncapsulatedPixelData: parameter 'frame' must be >= 0";var a=new e.ByteStream(t.byteArrayParser,t.byteArray,n.dataOffset),s=e.readSequenceItem(a);if("xfffee000"!==s.tag)throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";return a.seek(s.length),0!==n.basicOffsetTable.length?i(n,a,o):r(n,a,o)},e}(e),e=function(e){"use strict";return void 0===e&&(e={}),e.bigEndianByteArrayParser={readUint16:function(e,t){if(0>t)throw"bigEndianByteArrayParser.readUint16: position cannot be less than 0";if(t+2>e.length)throw"bigEndianByteArrayParser.readUint16: attempt to read past end of buffer";return(e[t]<<8)+e[t+1]},readInt16:function(e,t){if(0>t)throw"bigEndianByteArrayParser.readInt16: position cannot be less than 0";if(t+2>e.length)throw"bigEndianByteArrayParser.readInt16: attempt to read past end of buffer";var n=(e[t]<<8)+e[t+1];return 32768&n&&(n=n-65535-1),n},readUint32:function(e,t){if(0>t)throw"bigEndianByteArrayParser.readUint32: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readUint32: attempt to read past end of buffer";var n=256*(256*(256*e[t]+e[t+1])+e[t+2])+e[t+3];return n},readInt32:function(e,t){if(0>t)throw"bigEndianByteArrayParser.readInt32: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readInt32: attempt to read past end of buffer";var n=(e[t]<<24)+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3];return n},readFloat:function(e,t){if(0>t)throw"bigEndianByteArrayParser.readFloat: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readFloat: attempt to read past end of buffer";var n=new Uint8Array(4);n[3]=e[t],n[2]=e[t+1],n[1]=e[t+2],n[0]=e[t+3];var i=new Float32Array(n.buffer);return i[0]},readDouble:function(e,t){if(0>t)throw"bigEndianByteArrayParser.readDouble: position cannot be less than 0";if(t+8>e.length)throw"bigEndianByteArrayParser.readDouble: attempt to read past end of buffer";var n=new Uint8Array(8);n[7]=e[t],n[6]=e[t+1],n[5]=e[t+2],n[4]=e[t+3],n[3]=e[t+4],n[2]=e[t+5],n[1]=e[t+6],n[0]=e[t+7];var i=new Float64Array(n.buffer);return i[0]}},e}(e),e=function(e){"use strict";return void 0===e&&(e={}),e.readFixedString=function(e,t,n){if(0>n)throw"readFixedString - length cannot be less than 0";if(t+n>e.length)throw"dicomParser.readFixedString: attempt to read past end of buffer";for(var i="",r=0;n>r;r++){var o=e[t+r];if(0===o)return t+=n,i;i+=String.fromCharCode(o)}return i},e}(e),e=function(e){"use strict";return void 0===e&&(e={}),e.ByteStream=function(e,t,n){if(void 0===e)throw"dicomParser.ByteStream: missing required parameter 'byteArrayParser'";if(void 0===t)throw"dicomParser.ByteStream: missing required parameter 'byteArray'";if(t instanceof Uint8Array==!1)throw"dicomParser.ByteStream: parameter byteArray is not of type Uint8Array";if(0>n)throw"dicomParser.ByteStream: parameter 'position' cannot be less than 0";if(n>=t.length)throw"dicomParser.ByteStream: parameter 'position' cannot be greater than or equal to 'byteArray' length";this.byteArrayParser=e,this.byteArray=t,this.position=n?n:0,this.warnings=[]},e.ByteStream.prototype.seek=function(e){if(this.position+e<0)throw"cannot seek to position < 0";this.position+=e},e.ByteStream.prototype.readByteStream=function(t){if(this.position+t>this.byteArray.length)throw"readByteStream - buffer overread";var n=new Uint8Array(this.byteArray.buffer,this.position,t);return this.position+=t,new e.ByteStream(this.byteArrayParser,n)},e.ByteStream.prototype.readUint16=function(){var e=this.byteArrayParser.readUint16(this.byteArray,this.position);return this.position+=2,e},e.ByteStream.prototype.readUint32=function(){var e=this.byteArrayParser.readUint32(this.byteArray,this.position);return this.position+=4,e},e.ByteStream.prototype.readFixedString=function(t){var n=e.readFixedString(this.byteArray,this.position,t);return this.position+=t,n},e}(e),e=function(e){"use strict";function t(e,t){return void 0!==e.parser?e.parser:t}return void 0===e&&(e={}),e.DataSet=function(e,t,n){this.byteArrayParser=e,this.byteArray=t,this.elements=n},e.DataSet.prototype.uint16=function(e,n){var i=this.elements[e];return n=void 0!==n?n:0,i&&0!==i.length?t(i,this.byteArrayParser).readUint16(this.byteArray,i.dataOffset+2*n):void 0},e.DataSet.prototype.int16=function(e,n){var i=this.elements[e];return n=void 0!==n?n:0,i&&0!==i.length?t(i,this.byteArrayParser).readInt16(this.byteArray,i.dataOffset+2*n):void 0},e.DataSet.prototype.uint32=function(e,n){var i=this.elements[e];return n=void 0!==n?n:0,i&&0!==i.length?t(i,this.byteArrayParser).readUint32(this.byteArray,i.dataOffset+4*n):void 0},e.DataSet.prototype.int32=function(e,n){var i=this.elements[e];return n=void 0!==n?n:0,i&&0!==i.length?t(i,this.byteArrayParser).readInt32(this.byteArray,i.dataOffset+4*n):void 0},e.DataSet.prototype["float"]=function(e,n){var i=this.elements[e];return n=void 0!==n?n:0,i&&0!==i.length?t(i,this.byteArrayParser).readFloat(this.byteArray,i.dataOffset+4*n):void 0},e.DataSet.prototype["double"]=function(e,n){var i=this.elements[e];return n=void 0!==n?n:0,i&&0!==i.length?t(i,this.byteArrayParser).readDouble(this.byteArray,i.dataOffset+8*n):void 0},e.DataSet.prototype.numStringValues=function(t){var n=this.elements[t];if(n&&n.length>0){var i=e.readFixedString(this.byteArray,n.dataOffset,n.length),r=i.match(/\\/g);return null===r?1:r.length+1}},e.DataSet.prototype.string=function(t,n){var i=this.elements[t];if(i&&i.length>0){var r=e.readFixedString(this.byteArray,i.dataOffset,i.length);if(n>=0){var o=r.split("\\");return o[n].trim()}return r.trim()}},e.DataSet.prototype.text=function(t,n){var i=this.elements[t];if(i&&i.length>0){var r=e.readFixedString(this.byteArray,i.dataOffset,i.length);if(n>=0){var o=r.split("\\");return o[n].replace(/ +$/,"")}return r.replace(/ +$/,"")}},e.DataSet.prototype.floatString=function(e,t){var n=this.elements[e];if(n&&n.length>0){t=void 0!==t?t:0;var i=this.string(e,t);if(void 0!==i)return parseFloat(i)}},e.DataSet.prototype.intString=function(e,t){var n=this.elements[e];if(n&&n.length>0){t=void 0!==t?t:0;var i=this.string(e,t);if(void 0!==i)return parseInt(i)}},e}(e),e=function(e){"use strict";return void 0===e&&(e={}),e.findEndOfEncapsulatedElement=function(t,n,i){if(void 0===t)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'byteStream'";if(void 0===n)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'element'";n.encapsulatedPixelData=!0,n.basicOffsetTable=[],n.fragments=[];var r=e.readTag(t);if("xfffee000"!==r)throw"dicomParser.findEndOfEncapsulatedElement: basic offset table not found";for(var o=t.readUint32(),a=o/4,s=0;a>s;s++){var l=t.readUint32();n.basicOffsetTable.push(l)}for(var u=t.position;t.position<t.byteArray.length;){var c=e.readTag(t),f=t.readUint32();if("xfffee0dd"===c)return t.seek(f),void(n.length=t.position-n.dataOffset);if("xfffee000"!==c)return i&&i.push("unexpected tag "+c+" while searching for end of pixel data element with undefined length"),f>t.byteArray.length-t.position&&(f=t.byteArray.length-t.position),n.fragments.push({offset:t.position-u-8,position:t.position,length:f}),t.seek(f),void(n.length=t.position-n.dataOffset);n.fragments.push({offset:t.position-u-8,position:t.position,length:f}),t.seek(f)}i&&i.push("pixel data element "+n.tag+" missing sequence delimiter tag xfffee0dd")},e}(e),e=function(e){"use strict";return void 0===e&&(e={}),e.findItemDelimitationItemAndSetElementLength=function(e,t){if(void 0===e)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";for(var n=8,i=e.byteArray.length-n;e.position<=i;){var r=e.readUint16();if(65534===r){var o=e.readUint16();if(57357===o){var a=e.readUint32();return 0!==a&&e.warnings("encountered non zero length following item delimiter at position"+e.position-4+" while reading element of undefined length with tag ' + element.tag"),void(t.length=e.position-t.dataOffset)}}}t.length=e.byteArray.length-t.dataOffset,e.seek(e.byteArray.length-e.position)},e}(e),e=function(e){"use strict";return void 0===e&&(e={}),e.littleEndianByteArrayParser={readUint16:function(e,t){if(0>t)throw"littleEndianByteArrayParser.readUint16: position cannot be less than 0";if(t+2>e.length)throw"littleEndianByteArrayParser.readUint16: attempt to read past end of buffer";return e[t]+256*e[t+1]},readInt16:function(e,t){if(0>t)throw"littleEndianByteArrayParser.readInt16: position cannot be less than 0";if(t+2>e.length)throw"littleEndianByteArrayParser.readInt16: attempt to read past end of buffer";var n=e[t]+(e[t+1]<<8);return 32768&n&&(n=n-65535-1),n},readUint32:function(e,t){if(0>t)throw"littleEndianByteArrayParser.readUint32: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readUint32: attempt to read past end of buffer";var n=e[t]+256*e[t+1]+256*e[t+2]*256+256*e[t+3]*256*256;return n},readInt32:function(e,t){if(0>t)throw"littleEndianByteArrayParser.readInt32: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readInt32: attempt to read past end of buffer";var n=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return n},readFloat:function(e,t){if(0>t)throw"littleEndianByteArrayParser.readFloat: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readFloat: attempt to read past end of buffer";var n=new Uint8Array(4);n[0]=e[t],n[1]=e[t+1],n[2]=e[t+2],n[3]=e[t+3];var i=new Float32Array(n.buffer);return i[0]},readDouble:function(e,t){if(0>t)throw"littleEndianByteArrayParser.readDouble: position cannot be less than 0";if(t+8>e.length)throw"littleEndianByteArrayParser.readDouble: attempt to read past end of buffer";var n=new Uint8Array(8);n[0]=e[t],n[1]=e[t+1],n[2]=e[t+2],n[3]=e[t+3],n[4]=e[t+4],n[5]=e[t+5],n[6]=e[t+6],n[7]=e[t+7];var i=new Float64Array(n.buffer);return i[0]}},e}(e),e=function(e){"use strict";return void 0===e&&(e={}),e.parseDicomDataSetExplicit=function(t,n,i,r){if(i=void 0===i?n.byteArray.length:i,r=r||{},void 0===n)throw"dicomParser.parseDicomDataSetExplicit: missing required parameter 'byteStream'";if(i<n.position||i>n.byteArray.length)throw"dicomParser.parseDicomDataSetExplicit: invalid value for parameter 'maxPosition'";for(var o=t.elements;n.position<i;){var a=e.readDicomElementExplicit(n,t.warnings,r.untilTag);if(o[a.tag]=a,a.tag===r.untilTag)return}if(n.position>i)throw"dicomParser:parseDicomDataSetExplicit: buffer overrun"},e.parseDicomDataSetImplicit=function(t,n,i,r){if(i=void 0===i?t.byteArray.length:i,r=r||{},void 0===n)throw"dicomParser.parseDicomDataSetImplicit: missing required parameter 'byteStream'";if(i<n.position||i>n.byteArray.length)throw"dicomParser.parseDicomDataSetImplicit: invalid value for parameter 'maxPosition'";for(var o=t.elements;n.position<i;){var a=e.readDicomElementImplicit(n,r.untilTag);if(o[a.tag]=a,a.tag===r.untilTag)return}},e}(e),e=function(e){"use strict";function t(e){return"OB"===e||"OW"===e||"SQ"===e||"OF"===e||"UT"===e||"UN"===e?4:2}return void 0===e&&(e={}),e.readDicomElementExplicit=function(n,i,r){if(void 0===n)throw"dicomParser.readDicomElementExplicit: missing required parameter 'byteStream'";var o={tag:e.readTag(n),vr:n.readFixedString(2)},a=t(o.vr);return 2===a?(o.length=n.readUint16(),o.dataOffset=n.position):(n.seek(2),o.length=n.readUint32(),o.dataOffset=n.position),4294967295===o.length&&(o.hadUndefinedLength=!0),o.tag===r?o:"SQ"===o.vr?(e.readSequenceItemsExplicit(n,o,i),o):4294967295===o.length?"x7fe00010"===o.tag?(e.findEndOfEncapsulatedElement(n,o,i),o):(e.findItemDelimitationItemAndSetElementLength(n,o),o):(n.seek(o.length),o)},e}(e),e=function(e){"use strict";return void 0===e&&(e={}),e.readDicomElementImplicit=function(t,n){if(void 0===t)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";var i={tag:e.readTag(t),length:t.readUint32(),dataOffset:t.position};if(4294967295===i.length&&(i.hadUndefinedLength=!0),i.tag===n)return i;if(t.position+4<=t.byteArray.length){var r=e.readTag(t);if(t.seek(-4),"xfffee000"===r)return e.readSequenceItemsImplicit(t,i),i}return 4294967295===i.length?(e.findItemDelimitationItemAndSetElementLength(t,i),i):(t.seek(i.length),i)},e}(e),e=function(e){"use strict";function t(t,n){for(var i={};t.position<t.byteArray.length;){var r=e.readDicomElementExplicit(t,n);if(i[r.tag]=r,"xfffee00d"===r.tag)return new e.DataSet(t.byteArrayParser,t.byteArray,i)}return t.warnings.push("eof encountered before finding sequence delimitation item while reading sequence item of undefined length"),new e.DataSet(t.byteArrayParser,t.byteArray,i)}function n(n,i){var r=e.readSequenceItem(n);return 4294967295===r.length?(r.hadUndefinedLength=!0,r.dataSet=t(n,i),r.length=n.position-r.dataOffset):(r.dataSet=new e.DataSet(n.byteArrayParser,n.byteArray,{}),e.parseDicomDataSetExplicit(r.dataSet,n,n.position+r.length)),r}function i(e,t,i){for(;e.position<e.byteArray.length;){var r=n(e,i);if(t.items.push(r),"xfffee0dd"===r.tag)return void(t.length=e.position-t.dataOffset)}e.warnings.push("eof encountered before finding sequence delimitation item in sequence element of undefined length with tag "+t.tag),t.length=e.byteArray.length-t.dataOffset}function r(e,t,i){for(var r=t.dataOffset+t.length;e.position<r;){var o=n(e,i);t.items.push(o)}}return void 0===e&&(e={}),e.readSequenceItemsExplicit=function(e,t,n){if(void 0===e)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'element'";t.items=[],4294967295===t.length?i(e,t):r(e,t,n)},e}(e),e=function(e){"use strict";function t(t){for(var n={};t.position<t.byteArray.length;){var i=e.readDicomElementImplicit(t);if(n[i.tag]=i,"xfffee00d"===i.tag)return new e.DataSet(t.byteArrayParser,t.byteArray,n)}return t.warnings.push("eof encountered before finding sequence item delimiter in sequence item of undefined length"),new e.DataSet(t.byteArrayParser,t.byteArray,n)}function n(n){var i=e.readSequenceItem(n);return 4294967295===i.length?(i.hadUndefinedLength=!0,i.dataSet=t(n),i.length=n.position-i.dataOffset):(i.dataSet=new e.DataSet(n.byteArrayParser,n.byteArray,{}),e.parseDicomDataSetImplicit(i.dataSet,n,n.position+i.length)),i}function i(e,t){for(;e.position<e.byteArray.length;){var i=n(e);if(t.items.push(i),"xfffee0dd"===i.tag)return void(t.length=e.position-t.dataOffset)}e.warnings.push("eof encountered before finding sequence delimitation item in sequence of undefined length"),t.length=e.byteArray.length-t.dataOffset}function r(e,t){for(var i=t.dataOffset+t.length;e.position<i;){var r=n(e);t.items.push(r)}}return void 0===e&&(e={}),e.readSequenceItemsImplicit=function(e,t){if(void 0===e)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'element'";t.items=[],4294967295===t.length?i(e,t):r(e,t)},e}(e),e=function(e){"use strict";return void 0===e&&(e={}),e.readSequenceItem=function(t){if(void 0===t)throw"dicomParser.readSequenceItem: missing required parameter 'byteStream'";var n={tag:e.readTag(t),length:t.readUint32(),dataOffset:t.position};return n},e}(e),e=function(e){"use strict";return void 0===e&&(e={}),e.readTag=function(e){if(void 0===e)throw"dicomParser.readTag: missing required parameter 'byteStream'";var t=256*e.readUint16()*256,n=e.readUint16(),i="x"+("00000000"+(t+n).toString(16)).substr(-8);return i},e}(e);return e})},{}],7:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],8:[function(e,t,n){"use strict";var i=i||{};i.lossless=i.lossless||{},i.lossless.ComponentSpec=i.lossless.ComponentSpec||function(){this.hSamp=0,this.quantTableSel=0,this.vSamp=0};var r=typeof t;"undefined"!==r&&t.exports&&(t.exports=i.lossless.ComponentSpec)},{}],9:[function(e,t,n){"use strict";var i=i||{};i.lossless=i.lossless||{},i.lossless.DataStream=i.lossless.DataStream||function(e,t,n){this.buffer=new DataView(e,t,n),this.index=0},i.lossless.DataStream.prototype.get16=function(){var e=this.buffer.getUint16(this.index,!1);return this.index+=2,e},i.lossless.DataStream.prototype.get8=function(){var e=this.buffer.getUint8(this.index);return this.index+=1,e};var r=typeof t;"undefined"!==r&&t.exports&&(t.exports=i.lossless.DataStream)},{}],10:[function(e,t,n){"use strict";var i=i||{};i.lossless=i.lossless||{},i.lossless.DataStream=i.lossless.DataStream||("undefined"!=typeof e?e("./data-stream.js"):null),i.lossless.HuffmanTable=i.lossless.HuffmanTable||("undefined"!=typeof e?e("./huffman-table.js"):null),i.lossless.QuantizationTable=i.lossless.QuantizationTable||("undefined"!=typeof e?e("./quantization-table.js"):null),i.lossless.ScanHeader=i.lossless.ScanHeader||("undefined"!=typeof e?e("./scan-header.js"):null),i.lossless.FrameHeader=i.lossless.FrameHeader||("undefined"!=typeof e?e("./frame-header.js"):null),i.lossless.Utils=i.lossless.Utils||("undefined"!=typeof e?e("./utils.js"):null),i.lossless.Decoder=i.lossless.Decoder||function(e,t){this.buffer=e,this.frame=new i.lossless.FrameHeader,this.huffTable=new i.lossless.HuffmanTable,this.quantTable=new i.lossless.QuantizationTable,this.scan=new i.lossless.ScanHeader,this.DU=i.lossless.Utils.createArray(10,4,64),this.HuffTab=i.lossless.Utils.createArray(4,2,12800),this.IDCT_Source=[],this.nBlock=[],this.acTab=i.lossless.Utils.createArray(10,1),this.dcTab=i.lossless.Utils.createArray(10,1),this.qTab=i.lossless.Utils.createArray(10,1),this.marker=0,this.markerIndex=0,this.numComp=0,this.restartInterval=0,this.selection=0,this.xDim=0,this.yDim=0,this.xLoc=0,this.yLoc=0,this.numBytes=0,this.outputData=null,this.restarting=!1,this.mask=0,"undefined"!=typeof t&&(this.numBytes=t)},i.lossless.Decoder.IDCT_P=[0,5,40,16,45,2,7,42,21,56,8,61,18,47,1,4,41,23,58,13,32,24,37,10,63,17,44,3,6,43,20,57,15,34,29,48,53,26,39,9,60,19,46,22,59,12,33,31,50,55,25,36,11,62,14,35,28,49,52,27,38,30,51,54],i.lossless.Decoder.TABLE=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],i.lossless.Decoder.MAX_HUFFMAN_SUBTREE=50,i.lossless.Decoder.MSB=2147483648,i.lossless.Decoder.RESTART_MARKER_BEGIN=65488,i.lossless.Decoder.RESTART_MARKER_END=65495,i.lossless.Decoder.prototype.decompress=function(e,t,n){return this.decode(e,t,n).buffer},i.lossless.Decoder.prototype.decode=function(e,t,n,r){var o,a,s,l,u=0,c=[],f=[],d=[];if("undefined"!=typeof e&&(this.buffer=e),"undefined"!=typeof r&&(this.numBytes=r),this.stream=new i.lossless.DataStream(this.buffer,t,n),this.buffer=null,this.xLoc=0,this.yLoc=0,o=this.stream.get16(),65496!==o)throw new Error("Not a JPEG file");for(o=this.stream.get16();o>>4!==4092||65476===o;){switch(o){case 65476:this.huffTable.read(this.stream,this.HuffTab);break;case 65484:throw new Error("Program doesn't support arithmetic coding. (format throw new IOException)");case 65499:this.quantTable.read(this.stream,i.lossless.Decoder.TABLE);break;case 65501:this.restartInterval=this.readNumber();break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:this.readApp();break;case 65534:this.readComment();break;default:if(o>>8!==255)throw new Error("ERROR: format throw new IOException! (decode)")}o=this.stream.get16()}if(65472>o||o>65479)throw new Error("ERROR: could not handle arithmetic code!");this.frame.read(this.stream),o=this.stream.get16();do{for(;65498!==o;){switch(o){case 65476:this.huffTable.read(this.stream,this.HuffTab);break;case 65484:throw new Error("Program doesn't support arithmetic coding. (format throw new IOException)");case 65499:this.quantTable.read(this.stream,i.lossless.Decoder.TABLE);break;case 65501:this.restartInterval=this.readNumber();break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:this.readApp();break;case 65534:this.readComment();break;default:if(o>>8!==255)throw new Error("ERROR: format throw new IOException! (Parser.decode)")}o=this.stream.get16()}switch(this.precision=this.frame.precision,this.components=this.frame.components,this.numBytes||(this.numBytes=parseInt(Math.ceil(this.precision/8))),1==this.numBytes?this.mask=255:this.mask=65535,this.scan.read(this.stream),this.numComp=this.scan.numComp,this.selection=this.scan.selection,1===this.numBytes?3===this.numComp?(this.getter=this.getValueRGB,this.setter=this.setValueRGB,this.output=this.outputRGB):(this.getter=this.getValue8,this.setter=this.setValue8,this.output=this.outputSingle):(this.getter=this.getValue16,this.setter=this.setValue16,this.output=this.outputSingle),this.selection){case 2:this.selector=this.select2;break;case 3:this.selector=this.select3;break;case 4:this.selector=this.select4;break;case 5:this.selector=this.select5;break;case 6:this.selector=this.select6;break;case 7:this.selector=this.select7;break;default:this.selector=this.select1}for(this.scanComps=this.scan.components,this.quantTables=this.quantTable.quantTables,a=0;a<this.numComp;a+=1)s=this.scanComps[a].scanCompSel,this.qTab[a]=this.quantTables[this.components[s].quantTableSel],this.nBlock[a]=this.components[s].vSamp*this.components[s].hSamp,this.dcTab[a]=this.HuffTab[this.scanComps[a].dcTabSel][0],this.acTab[a]=this.HuffTab[this.scanComps[a].acTabSel][1];for(this.xDim=this.frame.dimX,this.yDim=this.frame.dimY,this.outputData=new DataView(new ArrayBuffer(this.xDim*this.yDim*this.numBytes*this.numComp)),u+=1;;){for(f[0]=0,d[0]=0,a=0;10>a;a+=1)c[a]=1<<this.precision-1;if(0===this.restartInterval){for(o=this.decodeUnit(c,f,d);0===o&&this.xLoc<this.xDim&&this.yLoc<this.yDim;)this.output(c),o=this.decodeUnit(c,f,d);break}for(l=0;l<this.restartInterval&&(this.restarting=0==l,o=this.decodeUnit(c,f,d),this.output(c),0===o);l+=1);if(0===o&&(0!==this.markerIndex?(o=65280|this.marker,this.markerIndex=0):o=this.stream.get16()),!(o>=i.lossless.Decoder.RESTART_MARKER_BEGIN&&o<=i.lossless.Decoder.RESTART_MARKER_END))break}65500===o&&1===u&&(this.readNumber(),o=this.stream.get16())}while(65497!==o&&this.xLoc<this.xDim&&this.yLoc<this.yDim&&0===u);return this.outputData},i.lossless.Decoder.prototype.decodeUnit=function(e,t,n){return 1==this.numComp?this.decodeSingle(e,t,n):3==this.numComp?this.decodeRGB(e,t,n):-1},i.lossless.Decoder.prototype.select1=function(e){return this.getPreviousX(e)},i.lossless.Decoder.prototype.select2=function(e){return this.getPreviousY(e)},i.lossless.Decoder.prototype.select3=function(e){return this.getPreviousXY(e)},i.lossless.Decoder.prototype.select4=function(e){return this.getPreviousX(e)+this.getPreviousY(e)-this.getPreviousXY(e)},i.lossless.Decoder.prototype.select5=function(e){return this.getPreviousX(e)+(this.getPreviousY(e)-this.getPreviousXY(e)>>1)},i.lossless.Decoder.prototype.select6=function(e){return this.getPreviousY(e)+(this.getPreviousX(e)-this.getPreviousXY(e)>>1)},i.lossless.Decoder.prototype.select7=function(e){return(this.getPreviousX(e)+this.getPreviousY(e))/2},i.lossless.Decoder.prototype.decodeRGB=function(e,t,n){var r,o,a,s,l,u,c,f;for(e[0]=this.selector(0),e[1]=this.selector(1),e[2]=this.selector(2),l=0;l<this.numComp;l+=1)for(s=this.qTab[l],o=this.acTab[l],a=this.dcTab[l],u=0;u<this.nBlock[l];u+=1){for(c=0;c<this.IDCT_Source.length;c+=1)this.IDCT_Source[c]=0;if(r=this.getHuffmanValue(a,t,n),r>=65280)return r;for(e[l]=this.IDCT_Source[0]=e[l]+this.getn(n,r,t,n),this.IDCT_Source[0]*=s[0],f=1;64>f;f+=1){if(r=this.getHuffmanValue(o,t,n),r>=65280)return r;if(f+=r>>4,0===(15&r)){if(r>>4===0)break}else this.IDCT_Source[i.lossless.Decoder.IDCT_P[f]]=this.getn(n,15&r,t,n)*s[f]}}return 0},i.lossless.Decoder.prototype.decodeSingle=function(e,t,n){var r,o,a,s;for(this.restarting?(this.restarting=!1,e[0]=1<<this.frame.precision-1):e[0]=this.selector(),o=0;o<this.nBlock[0];o+=1){if(r=this.getHuffmanValue(this.dcTab[0],t,n),r>=65280)return r;if(a=this.getn(e,r,t,n),s=a>>8,s>=i.lossless.Decoder.RESTART_MARKER_BEGIN&&s<=i.lossless.Decoder.RESTART_MARKER_END)return s;e[0]+=a}return 0},i.lossless.Decoder.prototype.getHuffmanValue=function(e,t,n){var r,o,a;if(a=65535,n[0]<8?(t[0]<<=8,o=this.stream.get8(),255===o&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),t[0]|=o):n[0]-=8,r=e[t[0]>>n[0]],0!==(r&i.lossless.Decoder.MSB)){if(0!==this.markerIndex)return this.markerIndex=0,65280|this.marker;t[0]&=a>>16-n[0],t[0]<<=8,o=this.stream.get8(),255===o&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),t[0]|=o,r=e[256*(255&r)+(t[0]>>n[0])],n[0]+=8}if(n[0]+=8-(r>>8),n[0]<0)throw new Error("index="+n[0]+" temp="+t[0]+" code="+r+" in HuffmanValue()");return n[0]<this.markerIndex?(this.markerIndex=0,65280|this.marker):(t[0]&=a>>16-n[0],255&r)},i.lossless.Decoder.prototype.getn=function(e,t,n,i){var r,o,a,s,l;if(o=1,a=-1,s=65535,0===t)return 0;if(16===t)return e[0]>=0?-32768:32768;if(i[0]-=t,i[0]>=0){if(i[0]<this.markerIndex&&!this.isLastPixel())return this.markerIndex=0,(65280|this.marker)<<8;r=n[0]>>i[0],n[0]&=s>>16-i[0]}else{if(n[0]<<=8,l=this.stream.get8(),255===l&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),n[0]|=l,i[0]+=8,i[0]<0){if(0!==this.markerIndex)return this.markerIndex=0,(65280|this.marker)<<8;n[0]<<=8,l=this.stream.get8(),255===l&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),n[0]|=l,i[0]+=8}if(i[0]<0)throw new Error("index="+i[0]+" in getn()");if(i[0]<this.markerIndex)return this.markerIndex=0,(65280|this.marker)<<8;r=n[0]>>i[0],n[0]&=s>>16-i[0]}return o<<t-1>r&&(r+=(a<<t)+1),r},i.lossless.Decoder.prototype.getPreviousX=function(e){return this.xLoc>0?this.getter(this.yLoc*this.xDim+this.xLoc-1,e):this.yLoc>0?this.getPreviousY(e):1<<this.frame.precision-1},i.lossless.Decoder.prototype.getPreviousXY=function(e){return this.xLoc>0&&this.yLoc>0?this.getter((this.yLoc-1)*this.xDim+this.xLoc-1,e):this.getPreviousY(e)},i.lossless.Decoder.prototype.getPreviousY=function(e){return this.yLoc>0?this.getter((this.yLoc-1)*this.xDim+this.xLoc,e):this.getPreviousX(e)},i.lossless.Decoder.prototype.isLastPixel=function(){return this.xLoc===this.xDim-1&&this.yLoc===this.yDim-1},i.lossless.Decoder.prototype.outputSingle=function(e){this.xLoc<this.xDim&&this.yLoc<this.yDim&&(this.setter(this.yLoc*this.xDim+this.xLoc,this.mask&e[0]),this.xLoc+=1,this.xLoc>=this.xDim&&(this.yLoc+=1,this.xLoc=0))},i.lossless.Decoder.prototype.outputRGB=function(e){var t=this.yLoc*this.xDim+this.xLoc;this.xLoc<this.xDim&&this.yLoc<this.yDim&&(this.setter(t,e[0],0),this.setter(t,e[1],1),this.setter(t,e[2],2),this.xLoc+=1,this.xLoc>=this.xDim&&(this.yLoc+=1,this.xLoc=0))},i.lossless.Decoder.prototype.setValue16=function(e,t){this.outputData.setInt16(2*e,t,!0)},i.lossless.Decoder.prototype.getValue16=function(e){return this.outputData.getInt16(2*e,!0)},i.lossless.Decoder.prototype.setValue8=function(e,t){this.outputData.setInt8(e,t)},i.lossless.Decoder.prototype.getValue8=function(e){return this.outputData.getInt8(e)},i.lossless.Decoder.prototype.setValueRGB=function(e,t,n){this.outputData.setUint8(3*e+n,t)},i.lossless.Decoder.prototype.getValueRGB=function(e,t){return this.outputData.getUint8(3*e+t)},i.lossless.Decoder.prototype.readApp=function(){var e=0,t=this.stream.get16();for(e+=2;t>e;)this.stream.get8(),e+=1;return t},i.lossless.Decoder.prototype.readComment=function(){var e,t="",n=0;for(e=this.stream.get16(),n+=2;e>n;)t+=this.stream.get8(),n+=1;return t},i.lossless.Decoder.prototype.readNumber=function(){var e=this.stream.get16();if(4!==e)throw new Error("ERROR: Define number format throw new IOException [Ld!=4]");return this.stream.get16()};var r=typeof t;"undefined"!==r&&t.exports&&(t.exports=i.lossless.Decoder)},{"./data-stream.js":9,"./frame-header.js":11,"./huffman-table.js":12,"./quantization-table.js":14,"./scan-header.js":16,"./utils.js":17}],11:[function(e,t,n){"use strict";var i=i||{};i.lossless=i.lossless||{},i.lossless.ComponentSpec=i.lossless.ComponentSpec||("undefined"!=typeof e?e("./component-spec.js"):null),i.lossless.DataStream=i.lossless.DataStream||("undefined"!=typeof e?e("./data-stream.js"):null),i.lossless.FrameHeader=i.lossless.FrameHeader||function(){this.components=[],this.dimX=0,this.dimY=0,this.numComp=0,this.precision=0},i.lossless.FrameHeader.prototype.read=function(e){var t,n,r,o,a=0;for(t=e.get16(),a+=2,this.precision=e.get8(),a+=1,this.dimY=e.get16(),a+=2,this.dimX=e.get16(),a+=2,this.numComp=e.get8(),a+=1,n=1;n<=this.numComp;n+=1){if(a>t)throw new Error("ERROR: frame format error");if(r=e.get8(),a+=1,a>=t)throw new Error("ERROR: frame format error [c>=Lf]");o=e.get8(),a+=1,this.components[r]||(this.components[r]=new i.lossless.ComponentSpec),this.components[r].hSamp=o>>4,this.components[r].vSamp=15&o,this.components[r].quantTableSel=e.get8(),a+=1}if(a!==t)throw new Error("ERROR: frame format error [Lf!=count]");return 1};var r=typeof t;"undefined"!==r&&t.exports&&(t.exports=i.lossless.FrameHeader)},{"./component-spec.js":8,"./data-stream.js":9}],12:[function(e,t,n){"use strict";var i=i||{};i.lossless=i.lossless||{},i.lossless.DataStream=i.lossless.DataStream||("undefined"!=typeof e?e("./data-stream.js"):null),i.lossless.Utils=i.lossless.Utils||("undefined"!=typeof e?e("./utils.js"):null),i.lossless.HuffmanTable=i.lossless.HuffmanTable||function(){this.l=i.lossless.Utils.createArray(4,2,16),this.th=[],this.v=i.lossless.Utils.createArray(4,2,16,200),this.tc=i.lossless.Utils.createArray(4,2),this.tc[0][0]=0,this.tc[1][0]=0,this.tc[2][0]=0,this.tc[3][0]=0,this.tc[0][1]=0,this.tc[1][1]=0,this.tc[2][1]=0,this.tc[3][1]=0,this.th[0]=0,this.th[1]=0,this.th[2]=0,this.th[3]=0},i.lossless.HuffmanTable.MSB=2147483648,i.lossless.HuffmanTable.prototype.read=function(e,t){var n,i,r,o,a,s,l=0;for(n=e.get16(),l+=2;n>l;){if(i=e.get8(),l+=1,r=15&i,r>3)throw new Error("ERROR: Huffman table ID > 3");if(o=i>>4,o>2)throw new Error("ERROR: Huffman table [Table class > 2 ]");for(this.th[r]=1,this.tc[r][o]=1,a=0;16>a;a+=1)this.l[r][o][a]=e.get8(),l+=1;for(a=0;16>a;a+=1)for(s=0;s<this.l[r][o][a];s+=1){if(l>n)throw new Error("ERROR: Huffman table format error [count>Lh]");this.v[r][o][a][s]=e.get8(),l+=1}}if(l!==n)throw new Error("ERROR: Huffman table format error [count!=Lf]");for(a=0;4>a;a+=1)for(s=0;2>s;s+=1)0!==this.tc[a][s]&&this.buildHuffTable(t[a][s],this.l[a][s],this.v[a][s]);return 1},i.lossless.HuffmanTable.prototype.buildHuffTable=function(e,t,n){var r,o,a,s,l,u;for(o=256,a=0,s=0;8>s;s+=1)for(l=0;l<t[s];l+=1)for(u=0;o>>s+1>u;u+=1)e[a]=n[s][l]|s+1<<8,a+=1;for(s=1;256>a;s+=1,a+=1)e[a]=s|i.lossless.HuffmanTable.MSB;for(r=1,a=0,s=8;16>s;s+=1)for(l=0;l<t[s];l+=1){for(u=0;o>>s-7>u;u+=1)e[256*r+a]=n[s][l]|s+1<<8,a+=1;if(a>=256){
if(a>256)throw new Error("ERROR: Huffman table error(1)!");a=0,r+=1}}};var r=typeof t;"undefined"!==r&&t.exports&&(t.exports=i.lossless.HuffmanTable)},{"./data-stream.js":9,"./utils.js":17}],13:[function(e,t,n){"use strict";var i=i||{};i.lossless=i.lossless||{},i.lossless.ComponentSpec=i.lossless.ComponentSpec||("undefined"!=typeof e?e("./component-spec.js"):null),i.lossless.DataStream=i.lossless.DataStream||("undefined"!=typeof e?e("./data-stream.js"):null),i.lossless.Decoder=i.lossless.Decoder||("undefined"!=typeof e?e("./decoder.js"):null),i.lossless.FrameHeader=i.lossless.FrameHeader||("undefined"!=typeof e?e("./frame-header.js"):null),i.lossless.HuffmanTable=i.lossless.HuffmanTable||("undefined"!=typeof e?e("./huffman-table.js"):null),i.lossless.QuantizationTable=i.lossless.QuantizationTable||("undefined"!=typeof e?e("./quantization-table.js"):null),i.lossless.ScanComponent=i.lossless.ScanComponent||("undefined"!=typeof e?e("./scan-component.js"):null),i.lossless.ScanHeader=i.lossless.ScanHeader||("undefined"!=typeof e?e("./scan-header.js"):null),i.lossless.Utils=i.lossless.Utils||("undefined"!=typeof e?e("./utils.js"):null);var r=typeof t;"undefined"!==r&&t.exports&&(t.exports=i)},{"./component-spec.js":8,"./data-stream.js":9,"./decoder.js":10,"./frame-header.js":11,"./huffman-table.js":12,"./quantization-table.js":14,"./scan-component.js":15,"./scan-header.js":16,"./utils.js":17}],14:[function(e,t,n){"use strict";var i=i||{};i.lossless=i.lossless||{},i.lossless.DataStream=i.lossless.DataStream||("undefined"!=typeof e?e("./data-stream.js"):null),i.lossless.Utils=i.lossless.Utils||("undefined"!=typeof e?e("./utils.js"):null),i.lossless.QuantizationTable=i.lossless.QuantizationTable||function(){this.precision=[],this.tq=[],this.quantTables=i.lossless.Utils.createArray(4,64),this.tq[0]=0,this.tq[1]=0,this.tq[2]=0,this.tq[3]=0},i.lossless.QuantizationTable.enhanceQuantizationTable=function(e,t){var n;for(n=0;8>n;n+=1)e[t[0+n]]*=90,e[t[32+n]]*=90,e[t[16+n]]*=118,e[t[48+n]]*=49,e[t[40+n]]*=71,e[t[8+n]]*=126,e[t[56+n]]*=25,e[t[24+n]]*=106;for(n=0;8>n;n+=1)e[t[0+8*n]]*=90,e[t[4+8*n]]*=90,e[t[2+8*n]]*=118,e[t[6+8*n]]*=49,e[t[5+8*n]]*=71,e[t[1+8*n]]*=126,e[t[7+8*n]]*=25,e[t[3+8*n]]*=106;for(n=0;64>n;n+=1)e[n]>>=6},i.lossless.QuantizationTable.prototype.read=function(e,t){var n,r,o,a,s=0;for(n=e.get16(),s+=2;n>s;){if(r=e.get8(),s+=1,o=15&r,o>3)throw new Error("ERROR: Quantization table ID > 3");if(this.precision[o]=r>>4,0===this.precision[o])this.precision[o]=8;else{if(1!==this.precision[o])throw new Error("ERROR: Quantization table precision error");this.precision[o]=16}if(this.tq[o]=1,8===this.precision[o]){for(a=0;64>a;a+=1){if(s>n)throw new Error("ERROR: Quantization table format error");this.quantTables[o][a]=e.get8(),s+=1}i.lossless.QuantizationTable.enhanceQuantizationTable(this.quantTables[o],t)}else{for(a=0;64>a;a+=1){if(s>n)throw new Error("ERROR: Quantization table format error");this.quantTables[o][a]=e.get16(),s+=2}i.lossless.QuantizationTable.enhanceQuantizationTable(this.quantTables[o],t)}}if(s!==n)throw new Error("ERROR: Quantization table error [count!=Lq]");return 1};var r=typeof t;"undefined"!==r&&t.exports&&(t.exports=i.lossless.QuantizationTable)},{"./data-stream.js":9,"./utils.js":17}],15:[function(e,t,n){"use strict";var i=i||{};i.lossless=i.lossless||{},i.lossless.ScanComponent=i.lossless.ScanComponent||function(){this.acTabSel=0,this.dcTabSel=0,this.scanCompSel=0};var r=typeof t;"undefined"!==r&&t.exports&&(t.exports=i.lossless.ScanComponent)},{}],16:[function(e,t,n){"use strict";var i=i||{};i.lossless=i.lossless||{},i.lossless.DataStream=i.lossless.DataStream||("undefined"!=typeof e?e("./data-stream.js"):null),i.lossless.ScanComponent=i.lossless.ScanComponent||("undefined"!=typeof e?e("./scan-component.js"):null),i.lossless.ScanHeader=i.lossless.ScanHeader||function(){this.ah=0,this.al=0,this.numComp=0,this.selection=0,this.spectralEnd=0,this.components=[]},i.lossless.ScanHeader.prototype.read=function(e){var t,n,r,o=0;for(t=e.get16(),o+=2,this.numComp=e.get8(),o+=1,n=0;n<this.numComp;n+=1){if(this.components[n]=new i.lossless.ScanComponent,o>t)throw new Error("ERROR: scan header format error");this.components[n].scanCompSel=e.get8(),o+=1,r=e.get8(),o+=1,this.components[n].dcTabSel=r>>4,this.components[n].acTabSel=15&r}if(this.selection=e.get8(),o+=1,this.spectralEnd=e.get8(),o+=1,r=e.get8(),this.ah=r>>4,this.al=15&r,o+=1,o!==t)throw new Error("ERROR: scan header format error [count!=Ns]");return 1};var r=typeof t;"undefined"!==r&&t.exports&&(t.exports=i.lossless.ScanHeader)},{"./data-stream.js":9,"./scan-component.js":15}],17:[function(e,t,n){"use strict";var i=i||{};i.lossless=i.lossless||{},i.lossless.Utils=i.lossless.Utils||{},i.lossless.Utils.createArray=function(e){var t=new Array(e||0),n=e;if(arguments.length>1)for(var r=Array.prototype.slice.call(arguments,1);n--;)t[e-1-n]=i.lossless.Utils.createArray.apply(this,r);return t},i.lossless.Utils.makeCRCTable=function(){for(var e,t=[],n=0;256>n;n++){e=n;for(var i=0;8>i;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t},i.lossless.Utils.crc32=function(e){for(var t=i.lossless.Utils.crcTable||(i.lossless.Utils.crcTable=i.lossless.Utils.makeCRCTable()),n=-1,r=0;r<e.byteLength;r++)n=n>>>8^t[255&(n^e.getUint8(r))];return(-1^n)>>>0};var r=typeof t;"undefined"!==r&&t.exports&&(t.exports=i.lossless.Utils)},{}],18:[function(e,t,n){"use strict";function i(e){return 0>e?-e:0===e?0:e}t.exports=i},{}],19:[function(e,t,n){"use strict";t.exports=Math.ceil},{}],20:[function(e,t,n){"use strict";function i(e){for(var t,n="";e>0;)t=e/2,e=r(t),n=t===e?"0"+n:"1"+n;return n}var r=e("math-floor");t.exports=i},{"math-floor":23}],21:[function(e,t,n){"use strict";function i(e){var t,n,i,p,m,v,y;if(n=0>e||1/e===o?"1":"0",e===r||e===o)return p=c("1",8),i=c("0",23),n+p+i;if(e!==e)return p=c("1",8),i="1"+c("0",22),n+p+i;if(0===e)return p=c("0",8),i=c("0",23),n+p+i;if(e=a(e),m=s(e),v=e-m,m=f(m),v=d(v),m)p=m.length-1;else{for(y=0;y<v.length;y++)if("1"===v[y]){t=y+1;break}p=-t}return i=m+v,0>p?(-h>=p&&(t=h-1),i=i.substring(t)):i=i.substring(1),p=f(p+h),p=u(p,8,"0"),i=l(i,23,"0").substring(0,23),n+p+i}var r=e("const-pinf-float32"),o=e("const-ninf-float32"),a=e("math-abs"),s=e("math-floor"),l=e("utils-right-pad-string"),u=e("utils-left-pad-string"),c=e("utils-repeat-string"),f=e("./div2.js"),d=e("./mult2.js"),h=127;t.exports=i},{"./div2.js":20,"./mult2.js":22,"const-ninf-float32":4,"const-pinf-float32":5,"math-abs":18,"math-floor":23,"utils-left-pad-string":48,"utils-repeat-string":49,"utils-right-pad-string":50}],22:[function(e,t,n){"use strict";function i(e){var t,n,i,a;if(t="",0===e)return t;for(a=r,i=0;r>i&&(n=2*e,n>=1?(e=n-1,t+="1",a===r&&(a=i)):(e=n,t+="0"),!(1===n||i-a>o));i++);return t}var r=149,o=24;t.exports=i},{}],23:[function(e,t,n){"use strict";t.exports=Math.floor},{}],24:[function(e,t,n){"use strict";var i=i||{};i.NIFTI1=i.NIFTI1||("undefined"!=typeof e?e("./nifti1.js"):null),i.NIFTI2=i.NIFTI2||("undefined"!=typeof e?e("./nifti2.js"):null),i.Utils=i.Utils||("undefined"!=typeof e?e("./utilities.js"):null);var r=r||("undefined"!=typeof e?e("pako"):null);i.isNIFTI1=function(e){var t,n,r,o;return t=new DataView(e),n=t.getUint8(i.NIFTI1.MAGIC_NUMBER_LOCATION),r=t.getUint8(i.NIFTI1.MAGIC_NUMBER_LOCATION+1),o=t.getUint8(i.NIFTI1.MAGIC_NUMBER_LOCATION+2),!(n!==i.NIFTI1.MAGIC_NUMBER[0]||r!==i.NIFTI1.MAGIC_NUMBER[1]||o!==i.NIFTI1.MAGIC_NUMBER[2])},i.isNIFTI2=function(e){var t,n,r,o;return t=new DataView(e),n=t.getUint8(i.NIFTI2.MAGIC_NUMBER_LOCATION),r=t.getUint8(i.NIFTI2.MAGIC_NUMBER_LOCATION+1),o=t.getUint8(i.NIFTI2.MAGIC_NUMBER_LOCATION+2),!(n!==i.NIFTI2.MAGIC_NUMBER[0]||r!==i.NIFTI2.MAGIC_NUMBER[1]||o!==i.NIFTI2.MAGIC_NUMBER[2])},i.isNIFTI=function(e){return i.isNIFTI1(e)||i.isNIFTI2(e)},i.isCompressed=function(e){var t,n,r;if(e){if(t=new DataView(e),n=t.getUint8(0),r=t.getUint8(1),n===i.Utils.GUNZIP_MAGIC_COOKIE1)return!0;if(r===i.Utils.GUNZIP_MAGIC_COOKIE2)return!0}return!1},i.decompress=function(e){return r.inflate(e).buffer},i.readHeader=function(e){var t=null;return i.isCompressed(e)&&(e=i.decompress(e)),i.isNIFTI1(e)?t=new i.NIFTI1:i.isNIFTI2(e)&&(t=new i.NIFTI2),t?t.readHeader(e):console.error("That file does not appear to be NIFTI!"),t},i.hasExtension=function(e){return 0!=e.extensionFlag[0]},i.readImage=function(e,t){var n=e.vox_offset,i=1,r=1;e.dims[4]&&(i=e.dims[4]),e.dims[5]&&(r=e.dims[5]);var o=e.dims[1]*e.dims[2]*e.dims[3]*i*r*(e.numBitsPerVoxel/8);return t.slice(n,n+o)},i.readExtension=function(e,t){var n=e.getExtensionLocation(),i=e.extensionSize;return t.slice(n,n+i)},i.readExtensionData=function(e,t){var n=e.getExtensionLocation(),i=e.extensionSize;return t.slice(n+8,n+i-8)};var o=typeof t;"undefined"!==o&&t.exports&&(t.exports=i)},{"./nifti1.js":25,"./nifti2.js":26,"./utilities.js":27,pako:29}],25:[function(e,t,n){"use strict";var i=i||{};i.Utils=i.Utils||("undefined"!=typeof e?e("./utilities.js"):null),i.NIFTI1=i.NIFTI1||function(){this.littleEndian=!1,this.dim_info=0,this.dims=[],this.intent_p1=0,this.intent_p2=0,this.intent_p3=0,this.intent_code=0,this.datatypeCode=0,this.numBitsPerVoxel=0,this.slice_start=0,this.slice_end=0,this.slice_code=0,this.pixDims=[],this.vox_offset=0,this.scl_slope=1,this.scl_inter=0,this.xyzt_units=0,this.cal_max=0,this.cal_min=0,this.slice_duration=0,this.toffset=0,this.description="",this.aux_file="",this.intent_name="",this.qform_code=0,this.sform_code=0,this.quatern_b=0,this.quatern_c=0,this.quatern_d=0,this.qoffset_x=0,this.qoffset_y=0,this.qoffset_z=0,this.affine=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],this.magic=0,this.isHDR=!1,this.extensionFlag=[0,0,0,0],this.extensionSize=0,this.extensionCode=0},i.NIFTI1.TYPE_NONE=0,i.NIFTI1.TYPE_BINARY=1,i.NIFTI1.TYPE_UINT8=2,i.NIFTI1.TYPE_INT16=4,i.NIFTI1.TYPE_INT32=8,i.NIFTI1.TYPE_FLOAT32=16,i.NIFTI1.TYPE_COMPLEX64=32,i.NIFTI1.TYPE_FLOAT64=64,i.NIFTI1.TYPE_RGB24=128,i.NIFTI1.TYPE_INT8=256,i.NIFTI1.TYPE_UINT16=512,i.NIFTI1.TYPE_UINT32=768,i.NIFTI1.TYPE_INT64=1024,i.NIFTI1.TYPE_UINT64=1280,i.NIFTI1.TYPE_FLOAT128=1536,i.NIFTI1.TYPE_COMPLEX128=1792,i.NIFTI1.TYPE_COMPLEX256=2048,i.NIFTI1.XFORM_UNKNOWN=0,i.NIFTI1.XFORM_SCANNER_ANAT=1,i.NIFTI1.XFORM_ALIGNED_ANAT=2,i.NIFTI1.XFORM_TALAIRACH=3,i.NIFTI1.XFORM_MNI_152=4,i.NIFTI1.SPATIAL_UNITS_MASK=7,i.NIFTI1.TEMPORAL_UNITS_MASK=56,i.NIFTI1.UNITS_UNKNOWN=0,i.NIFTI1.UNITS_METER=1,i.NIFTI1.UNITS_MM=2,i.NIFTI1.UNITS_MICRON=3,i.NIFTI1.UNITS_SEC=8,i.NIFTI1.UNITS_MSEC=16,i.NIFTI1.UNITS_USEC=24,i.NIFTI1.UNITS_HZ=32,i.NIFTI1.UNITS_PPM=40,i.NIFTI1.UNITS_RADS=48,i.NIFTI1.MAGIC_COOKIE=348,i.NIFTI1.MAGIC_NUMBER_LOCATION=344,i.NIFTI1.MAGIC_NUMBER=[110,43,49],i.NIFTI1.MAGIC_NUMBER2=[110,105,49],i.NIFTI1.EXTENSION_HEADER_SIZE=8,i.NIFTI1.prototype.readHeader=function(e){var t,n,r,o,a=new DataView(e),s=i.Utils.getIntAt(a,0,this.littleEndian);if(s!==i.NIFTI1.MAGIC_COOKIE&&(this.littleEndian=!0,s=i.Utils.getIntAt(a,0,this.littleEndian)),s!==i.NIFTI1.MAGIC_COOKIE)throw new Error("This does not appear to be a NIFTI file!");for(this.dim_info=i.Utils.getByteAt(a,39),t=0;8>t;t+=1)o=40+2*t,this.dims[t]=i.Utils.getShortAt(a,o,this.littleEndian);for(this.intent_p1=i.Utils.getFloatAt(a,56,this.littleEndian),this.intent_p2=i.Utils.getFloatAt(a,60,this.littleEndian),this.intent_p3=i.Utils.getFloatAt(a,64,this.littleEndian),this.intent_code=i.Utils.getShortAt(a,68,this.littleEndian),this.datatypeCode=i.Utils.getShortAt(a,70,this.littleEndian),this.numBitsPerVoxel=i.Utils.getShortAt(a,72,this.littleEndian),this.slice_start=i.Utils.getShortAt(a,74,this.littleEndian),t=0;8>t;t+=1)o=76+4*t,this.pixDims[t]=i.Utils.getFloatAt(a,o,this.littleEndian);for(this.vox_offset=i.Utils.getFloatAt(a,108,this.littleEndian),this.scl_slope=i.Utils.getFloatAt(a,112,this.littleEndian),this.scl_inter=i.Utils.getFloatAt(a,116,this.littleEndian),this.slice_end=i.Utils.getShortAt(a,120,this.littleEndian),this.slice_code=i.Utils.getByteAt(a,122),this.xyzt_units=i.Utils.getByteAt(a,123),this.cal_max=i.Utils.getFloatAt(a,124,this.littleEndian),this.cal_min=i.Utils.getFloatAt(a,128,this.littleEndian),this.slice_duration=i.Utils.getFloatAt(a,132,this.littleEndian),this.toffset=i.Utils.getFloatAt(a,136,this.littleEndian),this.description=i.Utils.getStringAt(a,148,228),this.aux_file=i.Utils.getStringAt(a,228,252),this.qform_code=i.Utils.getShortAt(a,252,this.littleEndian),this.sform_code=i.Utils.getShortAt(a,254,this.littleEndian),this.quatern_b=i.Utils.getFloatAt(a,256,this.littleEndian),this.quatern_c=i.Utils.getFloatAt(a,260,this.littleEndian),this.quatern_d=i.Utils.getFloatAt(a,264,this.littleEndian),this.qoffset_x=i.Utils.getFloatAt(a,268,this.littleEndian),this.qoffset_y=i.Utils.getFloatAt(a,272,this.littleEndian),this.qoffset_z=i.Utils.getFloatAt(a,276,this.littleEndian),n=0;3>n;n+=1)for(r=0;4>r;r+=1)o=280+4*(4*n+r),this.affine[n][r]=i.Utils.getFloatAt(a,o,this.littleEndian);this.affine[3][0]=0,this.affine[3][1]=0,this.affine[3][2]=0,this.affine[3][3]=1,this.intent_name=i.Utils.getStringAt(a,328,344),this.magic=i.Utils.getStringAt(a,344,348),this.isHDR=this.magic===i.NIFTI1.MAGIC_NUMBER2,a.byteLength>i.NIFTI1.MAGIC_COOKIE&&(this.extensionFlag[0]=i.Utils.getByteAt(a,348),this.extensionFlag[1]=i.Utils.getByteAt(a,349),this.extensionFlag[2]=i.Utils.getByteAt(a,350),this.extensionFlag[3]=i.Utils.getByteAt(a,351),this.extensionFlag[0]&&(this.extensionSize=this.getExtensionSize(a),this.extensionCode=this.getExtensionCode(a)))},i.NIFTI1.prototype.toFormattedString=function(){var e=i.Utils.formatNumber,t="";return t+="Dim Info = "+this.dim_info+"\n",t+="Image Dimensions (1-8): "+this.dims[0]+", "+this.dims[1]+", "+this.dims[2]+", "+this.dims[3]+", "+this.dims[4]+", "+this.dims[5]+", "+this.dims[6]+", "+this.dims[7]+"\n",t+="Intent Parameters (1-3): "+this.intent_p1+", "+this.intent_p2+", "+this.intent_p3+"\n",t+="Intent Code = "+this.intent_code+"\n",t+="Datatype = "+this.datatypeCode+" ("+this.getDatatypeCodeString(this.datatypeCode)+")\n",t+="Bits Per Voxel = "+this.numBitsPerVoxel+"\n",t+="Slice Start = "+this.slice_start+"\n",t+="Voxel Dimensions (1-8): "+e(this.pixDims[0])+", "+e(this.pixDims[1])+", "+e(this.pixDims[2])+", "+e(this.pixDims[3])+", "+e(this.pixDims[4])+", "+e(this.pixDims[5])+", "+e(this.pixDims[6])+", "+e(this.pixDims[7])+"\n",t+="Image Offset = "+this.vox_offset+"\n",t+="Data Scale:  Slope = "+e(this.scl_slope)+"  Intercept = "+e(this.scl_inter)+"\n",t+="Slice End = "+this.slice_end+"\n",t+="Slice Code = "+this.slice_code+"\n",t+="Units Code = "+this.xyzt_units+" ("+this.getUnitsCodeString(i.NIFTI1.SPATIAL_UNITS_MASK&this.xyzt_units)+", "+this.getUnitsCodeString(i.NIFTI1.TEMPORAL_UNITS_MASK&this.xyzt_units)+")\n",t+="Display Range:  Max = "+e(this.cal_max)+"  Min = "+e(this.cal_min)+"\n",t+="Slice Duration = "+this.slice_duration+"\n",t+="Time Axis Shift = "+this.toffset+"\n",t+='Description: "'+this.description+'"\n',t+='Auxiliary File: "'+this.aux_file+'"\n',t+="Q-Form Code = "+this.qform_code+" ("+this.getTransformCodeString(this.qform_code)+")\n",t+="S-Form Code = "+this.sform_code+" ("+this.getTransformCodeString(this.sform_code)+")\n",t+="Quaternion Parameters:  b = "+e(this.quatern_b)+"  c = "+e(this.quatern_c)+"  d = "+e(this.quatern_d)+"\n",t+="Quaternion Offsets:  x = "+this.qoffset_x+"  y = "+this.qoffset_y+"  z = "+this.qoffset_z+"\n",t+="S-Form Parameters X: "+e(this.affine[0][0])+", "+e(this.affine[0][1])+", "+e(this.affine[0][2])+", "+e(this.affine[0][3])+"\n",t+="S-Form Parameters Y: "+e(this.affine[1][0])+", "+e(this.affine[1][1])+", "+e(this.affine[1][2])+", "+e(this.affine[1][3])+"\n",t+="S-Form Parameters Z: "+e(this.affine[2][0])+", "+e(this.affine[2][1])+", "+e(this.affine[2][2])+", "+e(this.affine[2][3])+"\n",t+='Intent Name: "'+this.intent_name+'"\n',this.extensionFlag[0]&&(t+="Extension: Size = "+this.extensionSize+"  Code = "+this.extensionCode+"\n"),t},i.NIFTI1.prototype.getDatatypeCodeString=function(e){return e===i.NIFTI1.TYPE_UINT8?"1-Byte Unsigned Integer":e===i.NIFTI1.TYPE_INT16?"2-Byte Signed Integer":e===i.NIFTI1.TYPE_INT32?"4-Byte Signed Integer":e===i.NIFTI1.TYPE_FLOAT32?"4-Byte Float":e===i.NIFTI1.TYPE_FLOAT64?"8-Byte Float":e===i.NIFTI1.TYPE_RGB24?"RGB":e===i.NIFTI1.TYPE_INT8?"1-Byte Signed Integer":e===i.NIFTI1.TYPE_UINT16?"2-Byte Unsigned Integer":e===i.NIFTI1.TYPE_UINT32?"4-Byte Unsigned Integer":e===i.NIFTI1.TYPE_INT64?"8-Byte Signed Integer":e===i.NIFTI1.TYPE_UINT64?"8-Byte Unsigned Integer":"Unknown"},i.NIFTI1.prototype.getTransformCodeString=function(e){return e===i.NIFTI1.XFORM_SCANNER_ANAT?"Scanner":e===i.NIFTI1.XFORM_ALIGNED_ANAT?"Aligned":e===i.NIFTI1.XFORM_TALAIRACH?"Talairach":e===i.NIFTI1.XFORM_MNI_152?"MNI":"Unknown"},i.NIFTI1.prototype.getUnitsCodeString=function(e){return e===i.NIFTI1.UNITS_METER?"Meters":e===i.NIFTI1.UNITS_MM?"Millimeters":e===i.NIFTI1.UNITS_MICRON?"Microns":e===i.NIFTI1.UNITS_SEC?"Seconds":e===i.NIFTI1.UNITS_MSEC?"Milliseconds":e===i.NIFTI1.UNITS_USEC?"Microseconds":e===i.NIFTI1.UNITS_HZ?"Hz":e===i.NIFTI1.UNITS_PPM?"PPM":e===i.NIFTI1.UNITS_RADS?"Rads":"Unknown"},i.NIFTI1.prototype.getQformMat=function(){return this.convertNiftiQFormToNiftiSForm(this.quatern_b,this.quatern_c,this.quatern_d,this.qoffset_x,this.qoffset_y,this.qoffset_z,this.pixDims[1],this.pixDims[2],this.pixDims[3],this.pixDims[0])},i.NIFTI1.prototype.convertNiftiQFormToNiftiSForm=function(e,t,n,i,r,o,a,s,l,u){var c,f,d,h,p=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],m=e,v=t,y=n;return p[3][0]=p[3][1]=p[3][2]=0,p[3][3]=1,c=1-(m*m+v*v+y*y),1e-7>c?(c=1/Math.sqrt(m*m+v*v+y*y),m*=c,v*=c,y*=c,c=0):c=Math.sqrt(c),f=a>0?a:1,d=s>0?s:1,h=l>0?l:1,0>u&&(h=-h),p[0][0]=(c*c+m*m-v*v-y*y)*f,p[0][1]=2*(m*v-c*y)*d,p[0][2]=2*(m*y+c*v)*h,p[1][0]=2*(m*v+c*y)*f,p[1][1]=(c*c+v*v-m*m-y*y)*d,p[1][2]=2*(v*y-c*m)*h,p[2][0]=2*(m*y-c*v)*f,p[2][1]=2*(v*y+c*m)*d,p[2][2]=(c*c+y*y-v*v-m*m)*h,p[0][3]=i,p[1][3]=r,p[2][3]=o,p},i.NIFTI1.prototype.convertNiftiSFormToNEMA=function(e){var t,n,i,r,o,a,s,l,u,c,f,d,h,p,m,v,y,x,b,_,g,w,k,C,S,I,T,D,P,E,A,z,O,R;if(m=0,T=[[0,0,0],[0,0,0],[0,0,0]],D=[[0,0,0],[0,0,0],[0,0,0]],t=e[0][0],n=e[0][1],i=e[0][2],r=e[1][0],o=e[1][1],a=e[1][2],s=e[2][0],l=e[2][1],u=e[2][2],c=Math.sqrt(t*t+r*r+s*s),0===c)return null;if(t/=c,r/=c,s/=c,c=Math.sqrt(n*n+o*o+l*l),0===c)return null;if(n/=c,o/=c,l/=c,c=t*n+r*o+s*l,Math.abs(c)>1e-4){if(n-=c*t,o-=c*r,l-=c*s,c=Math.sqrt(n*n+o*o+l*l),0===c)return null;n/=c,o/=c,l/=c}if(c=Math.sqrt(i*i+a*a+u*u),0===c?(i=r*l-s*o,a=s*n-l*t,u=t*o-r*n):(i/=c,a/=c,u/=c),c=t*i+r*a+s*u,Math.abs(c)>1e-4){if(i-=c*t,a-=c*r,u-=c*s,c=Math.sqrt(i*i+a*a+u*u),0===c)return null;i/=c,a/=c,u/=c}if(c=n*i+o*a+l*u,Math.abs(c)>1e-4){if(i-=c*n,a-=c*o,u-=c*l,c=Math.sqrt(i*i+a*a+u*u),0===c)return null;i/=c,a/=c,u/=c}if(T[0][0]=t,T[0][1]=n,T[0][2]=i,T[1][0]=r,T[1][1]=o,T[1][2]=a,T[2][0]=s,T[2][1]=l,T[2][2]=u,f=this.nifti_mat33_determ(T),0===f)return null;for(I=-666,b=w=k=C=1,_=2,g=3,h=1;3>=h;h+=1)for(p=1;3>=p;p+=1)if(h!==p)for(m=1;3>=m;m+=1)if(h!==m&&p!==m)for(D[0][0]=D[0][1]=D[0][2]=D[1][0]=D[1][1]=D[1][2]=D[2][0]=D[2][1]=D[2][2]=0,v=-1;1>=v;v+=2)for(y=-1;1>=y;y+=2)for(x=-1;1>=x;x+=2)D[0][h-1]=v,D[1][p-1]=y,D[2][m-1]=x,d=this.nifti_mat33_determ(D),d*f>0&&(S=this.nifti_mat33_mul(D,T),c=S[0][0]+S[1][1]+S[2][2],c>I&&(I=c,b=h,_=p,g=m,w=v,k=y,C=x));switch(P=E=A=z=O=R=0,b*w){case 1:P="X",z="+";break;case-1:P="X",z="-";break;case 2:P="Y",z="+";break;case-2:P="Y",z="-";break;case 3:P="Z",z="+";break;case-3:P="Z",z="-"}switch(_*k){case 1:E="X",O="+";break;case-1:E="X",O="-";break;case 2:E="Y",O="+";break;case-2:E="Y",O="-";break;case 3:E="Z",O="+";break;case-3:E="Z",O="-"}switch(g*C){case 1:A="X",R="+";break;case-1:A="X",R="-";break;case 2:A="Y",R="+";break;case-2:A="Y",R="-";break;case 3:A="Z",R="+";break;case-3:A="Z",R="-"}return P+E+A+z+O+R},i.NIFTI1.prototype.nifti_mat33_mul=function(e,t){var n,i,r=[[0,0,0],[0,0,0],[0,0,0]];for(n=0;3>n;n+=1)for(i=0;3>i;i+=1)r[n][i]=e[n][0]*t[0][i]+e[n][1]*t[1][i]+e[n][2]*t[2][i];return r},i.NIFTI1.prototype.nifti_mat33_determ=function(e){var t,n,i,r,o,a,s,l,u;return t=e[0][0],n=e[0][1],i=e[0][2],r=e[1][0],o=e[1][1],a=e[1][2],s=e[2][0],l=e[2][1],u=e[2][2],t*o*u-t*l*a-r*n*u+r*l*i+s*n*a-s*o*i},i.NIFTI1.prototype.getExtensionLocation=function(){return i.NIFTI1.MAGIC_COOKIE+4},i.NIFTI1.prototype.getExtensionSize=function(e){return i.Utils.getIntAt(e,this.getExtensionLocation(),this.littleEndian)},i.NIFTI1.prototype.getExtensionCode=function(e){return i.Utils.getIntAt(e,this.getExtensionLocation()+4,this.littleEndian)};var r=typeof t;"undefined"!==r&&t.exports&&(t.exports=i.NIFTI1)},{"./utilities.js":27}],26:[function(e,t,n){"use strict";var i=i||{};i.Utils=i.Utils||("undefined"!=typeof e?e("./utilities.js"):null),i.NIFTI1=i.NIFTI1||("undefined"!=typeof e?e("./nifti1.js"):null),i.NIFTI2=i.NIFTI2||function(){this.littleEndian=!1,this.dim_info=0,this.dims=[],this.intent_p1=0,this.intent_p2=0,this.intent_p3=0,this.intent_code=0,this.datatypeCode=0,this.numBitsPerVoxel=0,this.slice_start=0,this.slice_end=0,this.slice_code=0,this.pixDims=[],this.vox_offset=0,this.scl_slope=1,this.scl_inter=0,this.xyzt_units=0,this.cal_max=0,this.cal_min=0,this.slice_duration=0,this.toffset=0,this.description="",this.aux_file="",this.intent_name="",this.qform_code=0,this.sform_code=0,this.quatern_b=0,this.quatern_c=0,this.quatern_d=0,this.qoffset_x=0,this.qoffset_y=0,this.qoffset_z=0,this.affine=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],this.magic=0,this.extensionFlag=[0,0,0,0]},i.NIFTI2.MAGIC_COOKIE=540,i.NIFTI2.MAGIC_NUMBER_LOCATION=4,i.NIFTI2.MAGIC_NUMBER=[110,43,50,0,13,10,26,10],i.NIFTI2.prototype.readHeader=function(e){var t,n,r,o,a=new DataView(e),s=i.Utils.getIntAt(a,0,this.littleEndian);if(s!==i.NIFTI2.MAGIC_COOKIE&&(this.littleEndian=!0,s=i.Utils.getIntAt(a,0,this.littleEndian)),s!==i.NIFTI2.MAGIC_COOKIE)throw new Error("This does not appear to be a NIFTI file!");for(this.datatypeCode=i.Utils.getShortAt(a,12,this.littleEndian),this.numBitsPerVoxel=i.Utils.getShortAt(a,14,this.littleEndian),t=0;8>t;t+=1)o=16+8*t,this.dims[t]=i.Utils.getLongAt(a,o,this.littleEndian);for(this.intent_p1=i.Utils.getDoubleAt(a,80,this.littleEndian),this.intent_p2=i.Utils.getDoubleAt(a,88,this.littleEndian),this.intent_p3=i.Utils.getDoubleAt(a,96,this.littleEndian),t=0;8>t;t+=1)o=104+8*t,this.pixDims[t]=i.Utils.getDoubleAt(a,o,this.littleEndian);for(this.vox_offset=i.Utils.getLongAt(a,168,this.littleEndian),this.scl_slope=i.Utils.getDoubleAt(a,176,this.littleEndian),this.scl_inter=i.Utils.getDoubleAt(a,184,this.littleEndian),this.cal_max=i.Utils.getDoubleAt(a,192,this.littleEndian),this.cal_min=i.Utils.getDoubleAt(a,200,this.littleEndian),this.slice_duration=i.Utils.getDoubleAt(a,208,this.littleEndian),this.toffset=i.Utils.getDoubleAt(a,216,this.littleEndian),this.slice_start=i.Utils.getLongAt(a,224,this.littleEndian),this.slice_end=i.Utils.getLongAt(a,232,this.littleEndian),this.description=i.Utils.getStringAt(a,240,320),this.aux_file=i.Utils.getStringAt(a,320,344),this.qform_code=i.Utils.getIntAt(a,344,this.littleEndian),this.sform_code=i.Utils.getIntAt(a,348,this.littleEndian),this.quatern_b=i.Utils.getDoubleAt(a,352,this.littleEndian),this.quatern_c=i.Utils.getDoubleAt(a,360,this.littleEndian),this.quatern_d=i.Utils.getDoubleAt(a,368,this.littleEndian),this.qoffset_x=i.Utils.getDoubleAt(a,376,this.littleEndian),this.qoffset_y=i.Utils.getDoubleAt(a,384,this.littleEndian),this.qoffset_z=i.Utils.getDoubleAt(a,392,this.littleEndian),n=0;3>n;n+=1)for(r=0;4>r;r+=1)o=400+8*(4*n+r),this.affine[n][r]=i.Utils.getDoubleAt(a,o,this.littleEndian);this.affine[3][0]=0,this.affine[3][1]=0,this.affine[3][2]=0,this.affine[3][3]=1,this.slice_code=i.Utils.getIntAt(a,496,this.littleEndian),this.xyzt_units=i.Utils.getIntAt(a,500,this.littleEndian),this.intent_code=i.Utils.getIntAt(a,504,this.littleEndian),this.intent_name=i.Utils.getStringAt(a,508,524),this.dim_info=i.Utils.getByteAt(a,524),a.byteLength>i.NIFTI2.MAGIC_COOKIE&&(this.extensionFlag[0]=i.Utils.getByteAt(a,540),this.extensionFlag[1]=i.Utils.getByteAt(a,541),this.extensionFlag[2]=i.Utils.getByteAt(a,542),this.extensionFlag[3]=i.Utils.getByteAt(a,543),this.extensionFlag[0]&&(this.extensionSize=this.getExtensionSize(a),this.extensionCode=this.getExtensionCode(a)))},i.NIFTI2.prototype.toFormattedString=function(){var e=i.Utils.formatNumber,t="";return t+="Datatype = "+ +this.datatypeCode+" ("+this.getDatatypeCodeString(this.datatypeCode)+")\n",t+="Bits Per Voxel =  = "+this.numBitsPerVoxel+"\n",t+="Image Dimensions (1-8): "+this.dims[0]+", "+this.dims[1]+", "+this.dims[2]+", "+this.dims[3]+", "+this.dims[4]+", "+this.dims[5]+", "+this.dims[6]+", "+this.dims[7]+"\n",t+="Intent Parameters (1-3): "+this.intent_p1+", "+this.intent_p2+", "+this.intent_p3+"\n",t+="Voxel Dimensions (1-8): "+e(this.pixDims[0])+", "+e(this.pixDims[1])+", "+e(this.pixDims[2])+", "+e(this.pixDims[3])+", "+e(this.pixDims[4])+", "+e(this.pixDims[5])+", "+e(this.pixDims[6])+", "+e(this.pixDims[7])+"\n",t+="Image Offset = "+this.vox_offset+"\n",t+="Data Scale:  Slope = "+e(this.scl_slope)+"  Intercept = "+e(this.scl_inter)+"\n",t+="Display Range:  Max = "+e(this.cal_max)+"  Min = "+e(this.cal_min)+"\n",t+="Slice Duration = "+this.slice_duration+"\n",t+="Time Axis Shift = "+this.toffset+"\n",t+="Slice Start = "+this.slice_start+"\n",t+="Slice End = "+this.slice_end+"\n",t+='Description: "'+this.description+'"\n',t+='Auxiliary File: "'+this.aux_file+'"\n',t+="Q-Form Code = "+this.qform_code+" ("+this.getTransformCodeString(this.qform_code)+")\n",t+="S-Form Code = "+this.sform_code+" ("+this.getTransformCodeString(this.sform_code)+")\n",t+="Quaternion Parameters:  b = "+e(this.quatern_b)+"  c = "+e(this.quatern_c)+"  d = "+e(this.quatern_d)+"\n",t+="Quaternion Offsets:  x = "+this.qoffset_x+"  y = "+this.qoffset_y+"  z = "+this.qoffset_z+"\n",t+="S-Form Parameters X: "+e(this.affine[0][0])+", "+e(this.affine[0][1])+", "+e(this.affine[0][2])+", "+e(this.affine[0][3])+"\n",t+="S-Form Parameters Y: "+e(this.affine[1][0])+", "+e(this.affine[1][1])+", "+e(this.affine[1][2])+", "+e(this.affine[1][3])+"\n",t+="S-Form Parameters Z: "+e(this.affine[2][0])+", "+e(this.affine[2][1])+", "+e(this.affine[2][2])+", "+e(this.affine[2][3])+"\n",t+="Slice Code = "+this.slice_code+"\n",t+="Units Code = "+this.xyzt_units+" ("+this.getUnitsCodeString(i.NIFTI1.SPATIAL_UNITS_MASK&this.xyzt_units)+", "+this.getUnitsCodeString(i.NIFTI1.TEMPORAL_UNITS_MASK&this.xyzt_units)+")\n",t+="Intent Code = "+this.intent_code+"\n",t+='Intent Name: "'+this.intent_name+'"\n',t+="Dim Info = "+this.dim_info+"\n"},i.NIFTI2.prototype.getExtensionLocation=function(){return i.NIFTI2.MAGIC_COOKIE+4},i.NIFTI2.prototype.getExtensionSize=i.NIFTI1.prototype.getExtensionSize,i.NIFTI2.prototype.getExtensionCode=i.NIFTI1.prototype.getExtensionCode,i.NIFTI2.prototype.getDatatypeCodeString=i.NIFTI1.prototype.getDatatypeCodeString,i.NIFTI2.prototype.getTransformCodeString=i.NIFTI1.prototype.getTransformCodeString,i.NIFTI2.prototype.getUnitsCodeString=i.NIFTI1.prototype.getUnitsCodeString,i.NIFTI2.prototype.getQformMat=i.NIFTI1.prototype.getQformMat,i.NIFTI2.prototype.convertNiftiQFormToNiftiSForm=i.NIFTI1.prototype.convertNiftiQFormToNiftiSForm,i.NIFTI2.prototype.convertNiftiSFormToNEMA=i.NIFTI1.prototype.convertNiftiSFormToNEMA,i.NIFTI2.prototype.nifti_mat33_mul=i.NIFTI1.prototype.nifti_mat33_mul,i.NIFTI2.prototype.nifti_mat33_determ=i.NIFTI1.prototype.nifti_mat33_determ;var r=typeof t;"undefined"!==r&&t.exports&&(t.exports=i.NIFTI2)},{"./nifti1.js":25,"./utilities.js":27}],27:[function(e,t,n){"use strict";var i=i||{};i.Utils=i.Utils||{},i.Utils.crcTable=null,i.Utils.GUNZIP_MAGIC_COOKIE1=31,i.Utils.GUNZIP_MAGIC_COOKIE2=139,i.Utils.getStringAt=function(e,t,n){var i,r,o="";for(i=t;n>i;i+=1)r=e.getUint8(i),0!==r&&(o+=String.fromCharCode(r));return o},i.Utils.getByteAt=function(e,t){return e.getInt8(t)},i.Utils.getShortAt=function(e,t,n){return e.getInt16(t,n)},i.Utils.getIntAt=function(e,t,n){return e.getInt32(t,n)},i.Utils.getFloatAt=function(e,t,n){return e.getFloat32(t,n)},i.Utils.getDoubleAt=function(e,t,n){return e.getFloat64(t,n)},i.Utils.getLongAt=function(e,t,n){var r,o=[],a=0;for(r=0;8>r;r+=1)o[r]=i.Utils.getByteAt(e,t+r,n);for(r=o.length-1;r>=0;r--)a=256*a+o[r];return a},i.Utils.toArrayBuffer=function(e){var t,n,i;for(t=new ArrayBuffer(e.length),n=new Uint8Array(t),i=0;i<e.length;i+=1)n[i]=e[i];return t},i.Utils.isString=function(e){return"string"==typeof e||e instanceof String},i.Utils.formatNumber=function(e,t){var n=0;return n=i.Utils.isString(e)?Number(e):e,n=t?n.toPrecision(5):n.toPrecision(7),parseFloat(n)},i.Utils.makeCRCTable=function(){for(var e,t=[],n=0;256>n;n++){e=n;for(var i=0;8>i;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t},i.Utils.crc32=function(e){for(var t=i.Utils.crcTable||(i.Utils.crcTable=i.Utils.makeCRCTable()),n=-1,r=0;r<e.byteLength;r++)n=n>>>8^t[255&(n^e.getUint8(r))];return(-1^n)>>>0};var r=typeof t;"undefined"!==r&&t.exports&&(t.exports=i.Utils)},{}],28:[function(e,t,n){"use strict";function i(e){return e.replace("\\","\\\\").replace("\n","\\n")}function r(e){return e.split("\\\\").map(function(e){return e.replace("\\n","\n")}).join("\\")}function o(e,t,n,i){var r,o=l(e);switch(e){case"data":case"buffer":case"keys":case"version":break;case"content":case"number":case"sampleUnits":case"space":r=o+": "+t;break;case"blockSize":case"lineSkip":case"byteSkip":case"dimension":case"spaceDimension":A("number"==typeof t||t instanceof Number,"Field "+e+" should at least contain a number!"),r=o+": "+t;break;case"min":case"max":case"oldMin":case"oldMax":A("number"==typeof t||t instanceof Number,"Field "+e+" should contain a number!"),r=o+": "+t;break;case"spaceOrigin":A(t.length===i,"Field "+e+" should be a list with length equal to the space dimension!"),t.forEach(function(t){A("number"==typeof t||t instanceof Number,"Field "+e+" should be a list of numbers!")}),r=o+": ("+t.join(",")+")";break;case"labels":case"units":case"spaceUnits":A(void 0!==t.length&&t.length==n,"Field "+e+" should be a list with length equal to the dimension!"),t.forEach(function(t){A("string"==typeof t||t instanceof String,"Field "+e+" should be a list of numbers!")}),r=o+": "+t.map(h).join(" ");break;case"sizes":A(void 0!==t.length&&t.length==n,"Field "+e+" should be a list with length equal to the dimension!"),t.forEach(function(t){A("number"==typeof t||t instanceof Number,"Field "+e+" should be a list of numbers!")}),r=o+": "+t.join(" ");break;case"spacings":case"thicknesses":case"axisMins":case"axisMaxs":A(void 0!==t.length&&t.length==n,"Field "+e+" should be a list with length equal to the dimension!"),t.forEach(function(t){A("number"==typeof t||t instanceof Number,"Field "+e+" should be a list of numbers!")}),r=o+": "+t.join(" ");break;case"spaceDirections":A(void 0!==t.length&&t.length===n,"Field "+e+" should be a list with length equal to the dimension!"),t.forEach(function(t){A(null===t||void 0!==t.length&&t.length===i,"The elements of field "+e+" should be lists with length equal to the space dimension!"),null!==t&&t.forEach(function(t){A("number"==typeof t||t instanceof Number,"The elements of field "+e+" should be lists of numbers!")})}),r=o+": "+t.map(function(e){return null===e?"none":"("+e.join(",")+")"}).join(" ");break;case"measurementFrame":A(void 0!==t.length&&t.length===i,"Field "+e+" should be a list with length equal to the space dimension!"),t.forEach(function(t){A(null===t||void 0!==t.length&&t.length===i,"The elements of field "+e+" should be lists with length equal to the space dimension!"),null!==t&&t.forEach(function(t){A("number"==typeof t||t instanceof Number,"The elements of field "+e+" should be lists of numbers!")})}),r=o+": "+t.map(function(e){return null===e?"none":"("+e.join(",")+")"}).join(" ");break;case"type":A("string"==typeof t||t instanceof String,"Field "+e+" should contain a string!"),r=o+": "+t;break;case"encoding":A("string"==typeof t||t instanceof String,"Field "+e+" should contain a string!"),r=o+": "+t;break;case"endian":A("string"==typeof t||t instanceof String,"Field "+e+" should contain a string!"),r=o+": "+t;break;case"dataFile":
t.length||t.files&&"subdim"in t||(r=o+": "+_(t));break;case"centers":A(void 0!==t.length&&t.length==n,"Field "+e+" should be a list with length equal to the dimension!"),r=o+": "+t.map(k).join(" ");break;case"kinds":A(void 0!==t.length&&t.length==n,"Field "+e+" should be a list with length equal to the dimension!"),r=o+": "+t.map(k).join(" ");break;default:console.warn("Unrecognized NRRD field: "+e+", skipping.")}return r}function a(e,t){switch(e){case"content":case"number":case"sampleUnits":break;case"dimension":case"blockSize":case"lineSkip":case"byteSkip":case"spaceDimension":t=u(t);break;case"min":case"max":case"oldMin":case"oldMax":t=c(t);break;case"spaceOrigin":t=f(t);break;case"labels":case"units":case"spaceUnits":t=p(t,d);break;case"sizes":t=p(t,u);break;case"spacings":case"thicknesses":case"axisMins":case"axisMaxs":t=p(t,c);break;case"spaceDirections":case"measurementFrame":t=p(t,f);break;case"type":t=m(t);break;case"encoding":t=v(t);break;case"endian":t=x(t);break;case"dataFile":t=b(t);break;case"centers":t=p(t,g);break;case"kinds":t=p(t,w);break;case"space":t=y(t);break;default:console.warn("Unrecognized NRRD field: "+e)}return t}function s(e){return e=e.toLowerCase(),e in B?B[e]:e}function l(e){return e in F?F[e]:e}function u(e){var t=parseInt(e,10);if(Number.isNaN(t))throw new Error("Malformed NRRD integer: "+e);return t}function c(e){if(e=e.toLowerCase(),e.indexOf("nan")>=0)return NaN;if(e.indexOf("-inf")>=0)return-(1/0);if(e.indexOf("inf")>=0)return 1/0;var t=parseFloat(e);if(Number.isNaN(t))throw new Error("Malformed NRRD float: "+e);return t}function f(e){if("none"==e)return null;if(e.length<2||"("!==e[0]||")"!==e[e.length-1])throw new Error("Malformed NRRD vector: "+e);return e.slice(1,-1).split(",").map(c)}function d(e){if(length<2||'"'!=e[0]||'"'!=e[e.length-1])throw new Error("Invalid NRRD quoted string: "+e);return e.slice(1,-1).replace('\\"','"')}function h(e){return'"'+e.replace('"','\\"')+'"'}function p(e,t){return e.split(U).map(t)}function m(e){switch(e.toLowerCase()){case"signed char":case"int8":case"int8_t":return"int8";case"uchar":case"unsigned char":case"uint8":case"uint8_t":return"uint8";case"short":case"short int":case"signed short":case"signed short int":case"int16":case"int16_t":return"int16";case"ushort":case"unsigned short":case"unsigned short int":case"uint16":case"uint16_t":return"uint16";case"int":case"signed int":case"int32":case"int32_t":return"int32";case"uint":case"unsigned int":case"uint32":case"uint32_t":return"uint32";case"longlong":case"long long":case"long long int":case"signed long long":case"signed long long int":case"int64":case"int64_t":return"int64";case"ulonglong":case"unsigned long long":case"unsigned long long int":case"uint64":case"uint64_t":return"uint64";case"float":return"float";case"double":return"double";case"block":return"block";default:return console.warn("Unrecognized NRRD type: "+e),e}}function v(e){switch(e.toLowerCase()){case"raw":return"raw";case"txt":case"text":case"ascii":return"ascii";case"hex":return"hex";case"gz":case"gzip":return"gzip";case"bz2":case"bzip2":return"bzip2";default:return console.warn("Unrecognized NRRD encoding: "+e),e}}function y(e){switch(e.toLowerCase()){case"right-anterior-superior":case"ras":return"right-anterior-superior";case"left-anterior-superior":case"las":return"left-anterior-superior";case"left-posterior-superior":case"lps":return"left-posterior-superior";case"right-anterior-superior-time":case"rast":return"right-anterior-superior-time";case"left-anterior-superior-time":case"last":return"left-anterior-superior-time";case"left-posterior-superior-time":case"lpst":return"left-posterior-superior-time";case"scanner-xyz":return"scanner-xyz";case"scanner-xyz-time":return"scanner-xyz-time";case"3d-right-handed":return"3D-right-handed";case"3d-left-handed":return"3D-left-handed";case"3d-right-handed-time":return"3D-right-handed-time";case"3d-left-handed-time":return"3D-left-handed-time";default:return console.warn("Unrecognized space: "+e),e}}function x(e){switch(e.toLowerCase()){case"little":return"little";case"big":return"big";default:return console.warn("Unrecognized NRRD endianness: "+e),e}}function b(e){var t=N.exec(e);return t?5==t.length&&t[4]?{format:e.substring(0,t.index),min:u(t[1]),max:u(t[2]),step:u(t[3]),subdim:u(t[4])}:{format:e.substring(0,t.index),min:u(t[1]),max:u(t[2]),step:u(t[3])}:e}function _(e){if("string"==typeof e||e instanceof String)return e;if("format"in e&&"min"in e&&"max"in e&&"step"in e)return"subdim"in e?e.format+" "+e.min+" "+e.max+" "+e.step+" "+e.subdim:e.format+" "+e.min+" "+e.max+" "+e.step;throw new Error("Unrecognized data file format!")}function g(e){switch(e.toLowerCase()){case"cell":return"cell";case"node":return"node";case"???":case"none":return null;default:return console.warn("Unrecognized NRRD center: "+e),e}}function w(e){var t=e.toLowerCase();return t in V?V[t]:(console.warn("Unrecognized NRRD kind: "+e),e)}function k(e){return null===e?"???":e}function C(e,t,n,i){function r(t){if(e.byteLength<u*t)throw new Error("NRRD file does not contain enough data!")}var o,a,s,l,u=1;for(o=0;o<n.length;o++){if(n[o]<=0)throw new Error("Sizes should be a list of positive (>0) integers!");u*=n[o]}if("block"==t)return e.slice(0,u*i.blockSize);if("int8"==t||"uint8"==t||i.endian==j)switch(t){case"int8":return r(1),new Int8Array(e.slice(0,u));case"uint8":return r(1),new Uint8Array(e.slice(0,u));case"int16":return r(2),new Int16Array(e.slice(0,2*u));case"uint16":return r(2),new Uint16Array(e.slice(0,2*u));case"int32":return r(4),new Int32Array(e.slice(0,4*u));case"uint32":return r(4),new Uint32Array(e.slice(0,4*u));case"float":return r(4),new Float32Array(e.slice(0,4*u));case"double":return r(8),new Float64Array(e.slice(0,8*u));default:return void console.warn("Unsupported NRRD type: "+t+", returning raw buffer.")}else{switch(i.endian){case"big":l=!1;break;case"little":l=!0;break;default:return void console.warn("Unsupported endianness in NRRD file: "+i.endian)}switch(s=new DataView(e),t){case"int8":for(a=new Int8Array(u),o=0;u>o;o++)a[o]=s.getInt8(o);return a;case"uint8":for(a=new Uint8Array(u),o=0;u>o;o++)a[o]=s.getUint8(o);return a;case"int16":for(a=new Int16Array(u),o=0;u>o;o++)a[o]=s.getInt16(2*o);return a;case"uint16":for(a=new Uint16Array(u),o=0;u>o;o++)a[o]=s.getUint16(2*o);return a;case"int32":for(a=new Int32Array(u),o=0;u>o;o++)a[o]=s.getInt32(4*o);return a;case"uint32":for(a=new Uint32Array(u),o=0;u>o;o++)a[o]=s.getUint32(4*o);return a;case"float":for(a=new Float32Array(u),o=0;u>o;o++)a[o]=s.getFloat32(4*o);return a;case"double":for(a=new Float64Array(u),o=0;u>o;o++)a[o]=s.getFloat64(8*o);return a;default:return void console.warn("Unsupported NRRD type: "+t+", returning raw buffer.")}}}function S(e,t,n){var i,r,o,a,s=1;for(i=0;i<n.length;i++){if(n[i]<=0)throw new Error("Sizes should be a list of positive (>0) integers!");s*=n[i]}if(r=new Uint8Array(e),o=String.fromCharCode.apply(null,r),a=o.split(L),a.length<s)throw new Error("Not enough data in NRRD file!");switch(a.length>s&&(""===a[0]&&(a=a.slice(1)),a=a.slice(0,s)),t){case"int8":return new Int8Array(a.map(u));case"uint8":return new Uint8Array(a.map(u));case"int16":return new Int16Array(a.map(u));case"uint16":return new Uint16Array(a.map(u));case"int32":return new Int32Array(a.map(u));case"uint32":return new Uint32Array(a.map(u));case"float":return new Float32Array(a.map(c));case"double":return new Float64Array(a.map(c));default:return void console.warn("Unsupported NRRD type: "+t+".")}}function I(e){switch(e){case"int8":return 1;case"uint8":return 1;case"int16":return 2;case"uint16":return 2;case"int32":return 4;case"uint32":return 4;case"int64":return 8;case"uint64":return 8;case"float":return 4;case"double":return 8;default:throw new Error("Do not know the size of NRRD type: "+e)}}function T(e){if(void 0===e.dimension)throw new Error("Dimension missing from NRRD file!");if(void 0===e.type)throw new Error("Type missing from NRRD file!");if(void 0===e.encoding)throw new Error("Encoding missing from NRRD file!");if(void 0===e.sizes)throw new Error("Sizes missing from NRRD file!");if("block"!=e.type&&"int8"!=e.type&&"uint8"!=e.type&&"ascii"!=e.encoding&&void 0===e.endian)throw new Error("Endianness missing from NRRD file!");if("block"==e.type&&void 0===e.blockSize)throw new Error("Missing block size in NRRD file!");if(0===e.dimension)throw new Error("Zero-dimensional NRRD file?");if(e.dimension!=e.sizes.length)throw new Error("Length of 'sizes' is different from 'dimension' in an NRRD file!");if(e.spacings&&e.dimension!=e.spacings.length)throw new Error("Length of 'spacings' is different from 'dimension' in an NRRD file!");if(e.thicknesses&&e.dimension!=e.thicknesses.length)throw new Error("Length of 'thicknesses' is different from 'dimension' in an NRRD file!");if(e.axisMins&&e.dimension!=e.axisMins.length)throw new Error("Length of 'axis mins' is different from 'dimension' in an NRRD file!");if(e.axisMaxs&&e.dimension!=e.axisMaxs.length)throw new Error("Length of 'axis maxs' is different from 'dimension' in an NRRD file!");if(e.centers&&e.dimension!=e.centers.length)throw new Error("Length of 'centers' is different from 'dimension' in an NRRD file!");if(e.labels&&e.dimension!=e.labels.length)throw new Error("Length of 'labels' is different from 'dimension' in an NRRD file!");if(e.units&&e.dimension!=e.units.length)throw new Error("Length of 'units' is different from 'dimension' in an NRRD file!");if(e.kinds&&e.dimension!=e.kinds.length)throw new Error("Length of 'kinds' is different from 'dimension' in an NRRD file!");if(!(void 0!==e.data&&0!==e.data.length||void 0!==e.buffer&&0!==e.buffer.byteLength||void 0!==e.dataFile))throw new Error("NRRD file has neither inline or external data!")}function D(e,t){switch(t){case"int8":return new Int8Array(e);case"uint8":return new Uint8Array(e);case"int16":return new Int16Array(e);case"uint16":return new Uint16Array(e);case"int32":return new Int32Array(e);case"uint32":return new Uint32Array(e);case"float":return new Float32Array(e);case"double":return new Float64Array(e);default:throw new Error("Cannot cast to NRRD type: "+t)}}function P(e,t,n){var i,r,o,a=I(t),s=new ArrayBuffer(e.length*a);switch(n){case"big":r=!1;break;case"little":r=!0;break;default:return void console.warn("Unsupported endianness in NRRD file: "+n)}switch(o=new DataView(s),t){case"int8":for(i=0;i<e.length;i++)o.setInt8(i,e[i],r);return s;case"uint8":for(i=0;i<e.length;i++)o.setUint8(i,e[i],r);return s;case"int16":for(i=0;i<e.length;i++)o.setInt16(2*i,e[i],r);return s;case"uint16":for(i=0;i<e.length;i++)o.setUint16(2*i,e[i],r);return s;case"int32":for(i=0;i<e.length;i++)o.setInt32(4*i,e[i],r);return s;case"uint32":for(i=0;i<e.length;i++)o.setUint32(4*i,e[i],r);return s;case"float":for(i=0;i<e.length;i++)o.setFloat32(4*i,e[i],r);return s;case"double":for(i=0;i<e.length;i++)o.setFloat64(8*i,e[i],r);return s;default:return void console.warn("Cannot serialize NRRD type: "+t+".")}}function E(e){var t,n,i,r,o=new Array(e.length);for(t=0;t<e.length;t++)o[t]=""+e[t];for(n=o.join(" "),i=new ArrayBuffer(n.length),r=new Uint8Array(i),t=0;t<r.length;t++)r[t]=n.charCodeAt(t);return i}var A=e("assert"),z=/[ \f\t\v]*\r?\n/,O=/^NRRD\d{4}$/,R=/^([^:]*)(:[ =])(.*)$/,M=/^LIST(?: (\d+))?$/;t.exports.serialize=function(e){var t,n,r,a,s,l,u,c,f,d,h=1,p={},y=[];for(a in e)p[a]=e[a];if(void 0===p.sizes)throw new Error("Sizes missing from NRRD file!");if(void 0===p.dimension&&(p.dimension=p.sizes.length),p.data instanceof Int8Array?s="int8":p.data instanceof Uint8Array?s="uint8":p.data instanceof Int16Array?s="int16":p.data instanceof Uint16Array?s="uint16":p.data instanceof Int32Array?s="int32":p.data instanceof Uint32Array?s="uint32":p.data instanceof Float32Array?s="float":p.data instanceof Float64Array&&(s="double"),void 0===p.type&&void 0!==s)p.type=s;else{if(void 0===p.type)throw new Error("Type of data is not given and cannot be inferred!");("string"==typeof p.type||p.type instanceof String)&&(p.type=m(p.type))}void 0===p.encoding?p.encoding="raw":("string"==typeof p.encoding||p.encoding instanceof String)&&(p.encoding=v(p.encoding)),p.data&&"block"!=p.type&&"int8"!=p.type&&"uint8"!=p.type&&"ascii"!=p.encoding?p.endian=j:"block"==p.type||"int8"==p.type||"uint8"==p.type||"ascii"==p.encoding?p.endian=void 0:("string"==typeof p.endian||p.endian instanceof String)&&(p.endian=x(p.endian));var b=void 0;if(void 0!==p.spaceDimension)b=p.spaceDimension;else if(void 0!==p.space)switch(p.space){case"right-anterior-superior":case"RAS":b=3;break;case"left-anterior-superior":case"LAS":b=3;break;case"left-posterior-superior":case"LPS":b=3;break;case"right-anterior-superior-time":case"RAST":b=4;break;case"left-anterior-superior-time":case"LAST":b=4;break;case"left-posterior-superior-time":case"LPST":b=4;break;case"scanner-xyz":b=3;break;case"scanner-xyz-time":b=4;break;case"3D-right-handed":b=3;break;case"3D-left-handed":b=3;break;case"3D-right-handed-time":b=4;break;case"3D-left-handed-time":b=4;break;default:console.warn("Unrecognized space: "+p.space)}for(T(p),t=0;t<p.sizes.length;t++){if(p.sizes[t]<=0)throw new Error("Sizes should be a list of positive (>0) integers!");h*=p.sizes[t]}if(p.data){if(p.data.length<h)throw new Error("Missing data to serialize!")}else if(p.buffer){if("raw"==p.encoding&&(l="block"==p.type&&void 0!==p.blockSize?p.blockSize:I(p.type),p.buffer.byteLength<h*l))throw new Error("Missing data to serialize!")}else if(!p.dataFile)throw new Error("Will not serialize an empty NRRD file!");if(p.data)switch(p.encoding){case"raw":p.type==s&&p.endian==j?u=p.data.buffer.slice(p.data.byteOffset,p.data.byteOffset+p.data.byteLength):p.endian==j?(u=D(p.data,p.type),u=u.buffer.slice(u.byteOffset,u.byteOffset+u.byteLength)):u=P(p.data,p.type,p.endian);break;case"ascii":u=E(p.type==s?p.data:D(p.data,p.type));break;default:throw new Error("Unsupported NRRD encoding: "+p.encoding)}else p.buffer&&(u=p.buffer);y.push("NRRD0005"),y.push("# Generated by nrrd-js");var _=["dimension","spaceDimension","space"];for(t=0;t<_.length;t++)a=_[t],void 0!==p[a]&&(f=o(a,p[a],p.dimension,b),void 0!==f&&y.push(f));for(a in p)void 0!==p[a]&&(_.indexOf(a)>=0||(f=o(a,p[a],p.dimension,b),void 0!==f&&y.push(f)));if(p.keys)for(a in p.keys){if(a.indexOf(":=")>=0)throw new Error("The combination ':=' is not allowed in an NRRD key!");y.push(a+":="+i(p[a]))}if(p.dataFile&&p.dataFile.length?(y.push("data file: LIST"),Array.prototype.push.apply(y,p.dataFile)):p.dataFile&&p.dataFile.files&&"subdim"in p.dataFile&&(y.push("data file: LIST "+p.dataFile.subdim),Array.prototype.push.apply(y,p.dataFile.files)),!u||"dataFile"in p)for(y.push(""),d=y.join("\n"),n=new ArrayBuffer(d.length),r=new Uint8Array(n),t=0;t<d.length;t++)r[t]=d.charCodeAt(t);else{for(y.push(""),y.push(""),d=y.join("\n"),n=new ArrayBuffer(d.length+u.byteLength),r=new Uint8Array(n),t=0;t<d.length;t++)r[t]=d.charCodeAt(t);c=new Uint8Array(u),r.set(c,d.length)}return n},t.exports.parse=function(e){var t,n,i,o,l,c,f={data:void 0,buffer:void 0,keys:{},version:void 0},d=new Uint8Array(e);for(d.buffer!==e&&(e=d.buffer),t=2;t<d.length;)if(10==d[t]){if(10==d[t-1]||13==d[t-1]&&10==d[t-2]){i=t+1;break}t++}else 13==d[t]?t++:t+=2;if(void 0===i?n=String.fromCharCode.apply(null,d):(n=String.fromCharCode.apply(null,d.subarray(0,i)),f.buffer=e.slice(i)),o=n.split(z),o=o.filter(function(e){return e.length>0&&"#"!=e[0]}),!O.test(o[0]))throw new Error("File is not an NRRD file!");for(f.version=parseInt(o[0].substring(4,8),10),f.version>5&&console.warn("Reading an unsupported version of the NRRD format; things may go haywire."),t=1;t<o.length;t++)if(l=R.exec(o[t]))if(": "==l[2])l[1]=s(l[1]),"dataFile"==l[1]&&(c=M.exec(l[3]))?(2==c.length&&c[1]?f[l[1]]={files:o.slice(t+1),subdim:u(c[1])}:f[l[1]]=o.slice(t+1),o.length=t):f[l[1]]=a(l[1],l[3]);else{if(":="!=l[2])throw new Error("Logic error in NRRD parser.");f.keys[l[1]]=r(l[3])}else console.warn("Unrecognized line in NRRD header: "+o[t]);if(T(f),"dataFile"in f)console.warn("No support for external data yet!");else switch(f.encoding){case"raw":f.data=C(f.buffer,f.type,f.sizes,{endian:f.endian,blockSize:f.blockSize});break;case"ascii":f.data=S(f.buffer,f.type,f.sizes);break;default:console.warn("Unsupported NRRD encoding: "+f.encoding)}return f};var B={"block size":"blockSize",blocksize:"blockSize","old min":"oldMin",oldmin:"oldMin","old max":"oldMax",oldmax:"oldMax","data file":"dataFile",datafile:"dataFile","line skip":"lineSkip",lineskip:"lineSkip","byte skip":"byteSkip",byteskip:"byteSkip","sample units":"sampleUnits",sampleunits:"sampleUnits","axis mins":"axisMins","axis maxs":"axisMaxs",centers:"centers",centerings:"centers","space dimension":"spaceDimension","space units":"spaceUnits","space origin":"spaceOrigin","space directions":"spaceDirections","measurement frame":"measurementFrame"},F=function(){var e,t={};for(e in B)t[B[e]]=e;return t}(),U=/[ \t]+/,N=/ (-?\d+) (-?\d+) (-?\d+)(?: (\d+))?$/,V={domain:"domain",space:"space",time:"time",list:"list",point:"point",vector:"vector","covariant-vector":"covariant-vector",normal:"normal",stub:"stub",scalar:"scalar",complex:"complex","2-vector":"2-vector","3-color":"3-color","rgb-color":"RGB-color","hsv-color":"HSV-color","xyz-color":"XYZ-color","4-color":"4-color","rgba-color":"RGBA-color","3-vector":"3-vector","3-gradient":"3-gradient","3-normal":"3-normal","4-vector":"4-vector",quaternion:"quaternion","2d-symmetric-matrix":"2D-symmetric-matrix","2d-masked-symmetric-matrix":"2D-masked-symmetric-matrix","2d-matrix":"2D-matrix","2d-masked-matrix":"2D-masked-matrix","3d-symmetric-matrix":"3D-symmetric-matrix","3d-masked-symmetric-matrix":"3D-masked-symmetric-matrix","3d-matrix":"3D-matrix","3d-masked-matrix":"3D-masked-matrix","???":null,none:null},j=function(){var e=new ArrayBuffer(4),t=new Uint32Array(e),n=new Uint8Array(e);return t[0]=16909060,1==n[0]&&2==n[1]&&3==n[2]&&4==n[3]?"big":4==n[0]&&3==n[1]&&2==n[2]&&1==n[3]?"little":void console.warn("Unrecognized system endianness!")}(),L=/[ \t\n\r\v\f]+/},{assert:3}],29:[function(e,t,n){"use strict";var i=e("./lib/utils/common").assign,r=e("./lib/deflate"),o=e("./lib/inflate"),a=e("./lib/zlib/constants"),s={};i(s,r,o,a),t.exports=s},{"./lib/deflate":30,"./lib/inflate":31,"./lib/utils/common":32,"./lib/zlib/constants":35}],30:[function(e,t,n){"use strict";function i(e){if(!(this instanceof i))return new i(e);this.options=l.assign({level:x,method:_,chunkSize:16384,windowBits:15,memLevel:8,strategy:b,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;var n=s.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==m)throw new Error(c[n]);if(t.header&&s.deflateSetHeader(this.strm,t.header),t.dictionary){var r;if(r="string"==typeof t.dictionary?u.string2buf(t.dictionary):"[object ArrayBuffer]"===d.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,n=s.deflateSetDictionary(this.strm,r),n!==m)throw new Error(c[n]);this._dict_set=!0}}function r(e,t){var n=new i(t);if(n.push(e,!0),n.err)throw n.msg;return n.result}function o(e,t){return t=t||{},t.raw=!0,r(e,t)}function a(e,t){return t=t||{},t.gzip=!0,r(e,t)}var s=e("./zlib/deflate"),l=e("./utils/common"),u=e("./utils/strings"),c=e("./zlib/messages"),f=e("./zlib/zstream"),d=Object.prototype.toString,h=0,p=4,m=0,v=1,y=2,x=-1,b=0,_=8;i.prototype.push=function(e,t){var n,i,r=this.strm,o=this.options.chunkSize;if(this.ended)return!1;i=t===~~t?t:t===!0?p:h,"string"==typeof e?r.input=u.string2buf(e):"[object ArrayBuffer]"===d.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;do{if(0===r.avail_out&&(r.output=new l.Buf8(o),r.next_out=0,r.avail_out=o),n=s.deflate(r,i),n!==v&&n!==m)return this.onEnd(n),this.ended=!0,!1;0!==r.avail_out&&(0!==r.avail_in||i!==p&&i!==y)||("string"===this.options.to?this.onData(u.buf2binstring(l.shrinkBuf(r.output,r.next_out))):this.onData(l.shrinkBuf(r.output,r.next_out)))}while((r.avail_in>0||0===r.avail_out)&&n!==v);return i===p?(n=s.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===m):i===y?(this.onEnd(m),r.avail_out=0,!0):!0},i.prototype.onData=function(e){this.chunks.push(e)},i.prototype.onEnd=function(e){e===m&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Deflate=i,n.deflate=r,n.deflateRaw=o,n.gzip=a},{"./utils/common":32,"./utils/strings":33,"./zlib/deflate":37,"./zlib/messages":42,"./zlib/zstream":44}],31:[function(e,t,n){"use strict";function i(e){if(!(this instanceof i))return new i(e);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0===(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;var n=a.inflateInit2(this.strm,t.windowBits);if(n!==u.Z_OK)throw new Error(c[n]);this.header=new d,a.inflateGetHeader(this.strm,this.header)}function r(e,t){var n=new i(t);if(n.push(e,!0),n.err)throw n.msg;return n.result}function o(e,t){return t=t||{},t.raw=!0,r(e,t)}var a=e("./zlib/inflate"),s=e("./utils/common"),l=e("./utils/strings"),u=e("./zlib/constants"),c=e("./zlib/messages"),f=e("./zlib/zstream"),d=e("./zlib/gzheader"),h=Object.prototype.toString;i.prototype.push=function(e,t){var n,i,r,o,c,f,d=this.strm,p=this.options.chunkSize,m=this.options.dictionary,v=!1;if(this.ended)return!1;i=t===~~t?t:t===!0?u.Z_FINISH:u.Z_NO_FLUSH,"string"==typeof e?d.input=l.binstring2buf(e):"[object ArrayBuffer]"===h.call(e)?d.input=new Uint8Array(e):d.input=e,d.next_in=0,d.avail_in=d.input.length;do{if(0===d.avail_out&&(d.output=new s.Buf8(p),d.next_out=0,d.avail_out=p),n=a.inflate(d,u.Z_NO_FLUSH),n===u.Z_NEED_DICT&&m&&(f="string"==typeof m?l.string2buf(m):"[object ArrayBuffer]"===h.call(m)?new Uint8Array(m):m,n=a.inflateSetDictionary(this.strm,f)),n===u.Z_BUF_ERROR&&v===!0&&(n=u.Z_OK,v=!1),n!==u.Z_STREAM_END&&n!==u.Z_OK)return this.onEnd(n),this.ended=!0,!1;d.next_out&&(0!==d.avail_out&&n!==u.Z_STREAM_END&&(0!==d.avail_in||i!==u.Z_FINISH&&i!==u.Z_SYNC_FLUSH)||("string"===this.options.to?(r=l.utf8border(d.output,d.next_out),o=d.next_out-r,c=l.buf2string(d.output,r),d.next_out=o,d.avail_out=p-o,o&&s.arraySet(d.output,d.output,r,o,0),this.onData(c)):this.onData(s.shrinkBuf(d.output,d.next_out)))),0===d.avail_in&&0===d.avail_out&&(v=!0)}while((d.avail_in>0||0===d.avail_out)&&n!==u.Z_STREAM_END);return n===u.Z_STREAM_END&&(i=u.Z_FINISH),i===u.Z_FINISH?(n=a.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===u.Z_OK):i===u.Z_SYNC_FLUSH?(this.onEnd(u.Z_OK),d.avail_out=0,!0):!0},i.prototype.onData=function(e){this.chunks.push(e)},i.prototype.onEnd=function(e){e===u.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Inflate=i,n.inflate=r,n.inflateRaw=o,n.ungzip=r},{"./utils/common":32,"./utils/strings":33,"./zlib/constants":35,"./zlib/gzheader":38,"./zlib/inflate":40,"./zlib/messages":42,"./zlib/zstream":44}],32:[function(e,t,n){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;n.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var i in n)n.hasOwnProperty(i)&&(e[i]=n[i])}}return e},n.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var r={arraySet:function(e,t,n,i,r){if(t.subarray&&e.subarray)return void e.set(t.subarray(n,n+i),r);for(var o=0;i>o;o++)e[r+o]=t[n+o]},flattenChunks:function(e){var t,n,i,r,o,a;for(i=0,t=0,n=e.length;n>t;t++)i+=e[t].length;for(a=new Uint8Array(i),r=0,t=0,n=e.length;n>t;t++)o=e[t],a.set(o,r),r+=o.length;return a}},o={arraySet:function(e,t,n,i,r){for(var o=0;i>o;o++)e[r+o]=t[n+o]},flattenChunks:function(e){return[].concat.apply([],e)}};n.setTyped=function(e){e?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,r)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,o))},n.setTyped(i)},{}],33:[function(e,t,n){"use strict";function i(e,t){if(65537>t&&(e.subarray&&a||!e.subarray&&o))return String.fromCharCode.apply(null,r.shrinkBuf(e,t));for(var n="",i=0;t>i;i++)n+=String.fromCharCode(e[i]);return n}var r=e("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch(s){o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(s){a=!1}for(var l=new r.Buf8(256),u=0;256>u;u++)l[u]=u>=252?6:u>=248?5:u>=240?4:u>=224?3:u>=192?2:1;l[254]=l[254]=1,n.string2buf=function(e){var t,n,i,o,a,s=e.length,l=0;for(o=0;s>o;o++)n=e.charCodeAt(o),55296===(64512&n)&&s>o+1&&(i=e.charCodeAt(o+1),56320===(64512&i)&&(n=65536+(n-55296<<10)+(i-56320),o++)),l+=128>n?1:2048>n?2:65536>n?3:4;for(t=new r.Buf8(l),a=0,o=0;l>a;o++)n=e.charCodeAt(o),55296===(64512&n)&&s>o+1&&(i=e.charCodeAt(o+1),56320===(64512&i)&&(n=65536+(n-55296<<10)+(i-56320),o++)),128>n?t[a++]=n:2048>n?(t[a++]=192|n>>>6,t[a++]=128|63&n):65536>n?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|63&n):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|63&n);return t},n.buf2binstring=function(e){return i(e,e.length)},n.binstring2buf=function(e){for(var t=new r.Buf8(e.length),n=0,i=t.length;i>n;n++)t[n]=e.charCodeAt(n);return t},n.buf2string=function(e,t){var n,r,o,a,s=t||e.length,u=new Array(2*s);for(r=0,n=0;s>n;)if(o=e[n++],128>o)u[r++]=o;else if(a=l[o],a>4)u[r++]=65533,n+=a-1;else{for(o&=2===a?31:3===a?15:7;a>1&&s>n;)o=o<<6|63&e[n++],a--;a>1?u[r++]=65533:65536>o?u[r++]=o:(o-=65536,u[r++]=55296|o>>10&1023,u[r++]=56320|1023&o)}return i(u,r)},n.utf8border=function(e,t){var n;for(t=t||e.length,t>e.length&&(t=e.length),n=t-1;n>=0&&128===(192&e[n]);)n--;return 0>n?t:0===n?t:n+l[e[n]]>t?n:t}},{"./common":32}],34:[function(e,t,n){"use strict";function i(e,t,n,i){for(var r=65535&e|0,o=e>>>16&65535|0,a=0;0!==n;){a=n>2e3?2e3:n,n-=a;do r=r+t[i++]|0,o=o+r|0;while(--a);r%=65521,o%=65521}return r|o<<16|0}t.exports=i},{}],35:[function(e,t,n){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],36:[function(e,t,n){"use strict";function i(){for(var e,t=[],n=0;256>n;n++){e=n;for(var i=0;8>i;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}function r(e,t,n,i){var r=o,a=i+n;e^=-1;for(var s=i;a>s;s++)e=e>>>8^r[255&(e^t[s])];return-1^e}var o=i();t.exports=r},{}],37:[function(e,t,n){"use strict";function i(e,t){return e.msg=R[t],t}function r(e){return(e<<1)-(e>4?9:0)}function o(e){for(var t=e.length;--t>=0;)e[t]=0}function a(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(E.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function s(e,t){A._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,a(e.strm)}function l(e,t){e.pending_buf[e.pending++]=t}function u(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function c(e,t,n,i){var r=e.avail_in;return r>i&&(r=i),0===r?0:(e.avail_in-=r,E.arraySet(t,e.input,e.next_in,r,n),1===e.state.wrap?e.adler=z(e.adler,t,r,n):2===e.state.wrap&&(e.adler=O(e.adler,t,r,n)),e.next_in+=r,e.total_in+=r,r)}function f(e,t){var n,i,r=e.max_chain_length,o=e.strstart,a=e.prev_length,s=e.nice_match,l=e.strstart>e.w_size-fe?e.strstart-(e.w_size-fe):0,u=e.window,c=e.w_mask,f=e.prev,d=e.strstart+ce,h=u[o+a-1],p=u[o+a];e.prev_length>=e.good_match&&(r>>=2),s>e.lookahead&&(s=e.lookahead);do if(n=t,u[n+a]===p&&u[n+a-1]===h&&u[n]===u[o]&&u[++n]===u[o+1]){o+=2,n++;do;while(u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&d>o);if(i=ce-(d-o),o=d-ce,i>a){if(e.match_start=t,a=i,i>=s)break;h=u[o+a-1],p=u[o+a]}}while((t=f[t&c])>l&&0!==--r);return a<=e.lookahead?a:e.lookahead}function d(e){var t,n,i,r,o,a=e.w_size;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=a+(a-fe)){E.arraySet(e.window,e.window,a,a,0),e.match_start-=a,e.strstart-=a,e.block_start-=a,n=e.hash_size,t=n;do i=e.head[--t],e.head[t]=i>=a?i-a:0;while(--n);n=a,t=n;do i=e.prev[--t],e.prev[t]=i>=a?i-a:0;while(--n);r+=a}if(0===e.strm.avail_in)break;if(n=c(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=n,e.lookahead+e.insert>=ue)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+ue-1])&e.hash_mask,e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<ue)););}while(e.lookahead<fe&&0!==e.strm.avail_in)}function h(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(d(e),0===e.lookahead&&t===M)return _e;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var i=e.block_start+n;if((0===e.strstart||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,s(e,!1),0===e.strm.avail_out))return _e;if(e.strstart-e.block_start>=e.w_size-fe&&(s(e,!1),0===e.strm.avail_out))return _e}return e.insert=0,t===U?(s(e,!0),0===e.strm.avail_out?we:ke):e.strstart>e.block_start&&(s(e,!1),0===e.strm.avail_out)?_e:_e}function p(e,t){for(var n,i;;){if(e.lookahead<fe){if(d(e),e.lookahead<fe&&t===M)return _e;if(0===e.lookahead)break}if(n=0,e.lookahead>=ue&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ue-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-fe&&(e.match_length=f(e,n)),e.match_length>=ue)if(i=A._tr_tally(e,e.strstart-e.match_start,e.match_length-ue),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=ue){e.match_length--;do e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ue-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(0!==--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=A._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(s(e,!1),0===e.strm.avail_out))return _e}return e.insert=e.strstart<ue-1?e.strstart:ue-1,t===U?(s(e,!0),0===e.strm.avail_out?we:ke):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?_e:ge}function m(e,t){for(var n,i,r;;){if(e.lookahead<fe){if(d(e),e.lookahead<fe&&t===M)return _e;if(0===e.lookahead)break}if(n=0,e.lookahead>=ue&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ue-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=ue-1,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-fe&&(e.match_length=f(e,n),e.match_length<=5&&(e.strategy===X||e.match_length===ue&&e.strstart-e.match_start>4096)&&(e.match_length=ue-1)),e.prev_length>=ue&&e.match_length<=e.prev_length){r=e.strstart+e.lookahead-ue,i=A._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-ue),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=r&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ue-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(0!==--e.prev_length);
if(e.match_available=0,e.match_length=ue-1,e.strstart++,i&&(s(e,!1),0===e.strm.avail_out))return _e}else if(e.match_available){if(i=A._tr_tally(e,0,e.window[e.strstart-1]),i&&s(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return _e}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=A._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<ue-1?e.strstart:ue-1,t===U?(s(e,!0),0===e.strm.avail_out?we:ke):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?_e:ge}function v(e,t){for(var n,i,r,o,a=e.window;;){if(e.lookahead<=ce){if(d(e),e.lookahead<=ce&&t===M)return _e;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=ue&&e.strstart>0&&(r=e.strstart-1,i=a[r],i===a[++r]&&i===a[++r]&&i===a[++r])){o=e.strstart+ce;do;while(i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&o>r);e.match_length=ce-(o-r),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=ue?(n=A._tr_tally(e,1,e.match_length-ue),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=A._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(s(e,!1),0===e.strm.avail_out))return _e}return e.insert=0,t===U?(s(e,!0),0===e.strm.avail_out?we:ke):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?_e:ge}function y(e,t){for(var n;;){if(0===e.lookahead&&(d(e),0===e.lookahead)){if(t===M)return _e;break}if(e.match_length=0,n=A._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(s(e,!1),0===e.strm.avail_out))return _e}return e.insert=0,t===U?(s(e,!0),0===e.strm.avail_out?we:ke):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?_e:ge}function x(e,t,n,i,r){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=r}function b(e){e.window_size=2*e.w_size,o(e.head),e.max_lazy_match=P[e.level].max_lazy,e.good_match=P[e.level].good_length,e.nice_match=P[e.level].nice_length,e.max_chain_length=P[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=ue-1,e.match_available=0,e.ins_h=0}function _(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Q,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new E.Buf16(2*se),this.dyn_dtree=new E.Buf16(2*(2*oe+1)),this.bl_tree=new E.Buf16(2*(2*ae+1)),o(this.dyn_ltree),o(this.dyn_dtree),o(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new E.Buf16(le+1),this.heap=new E.Buf16(2*re+1),o(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new E.Buf16(2*re+1),o(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function g(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=K,t=e.state,t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?he:xe,e.adler=2===t.wrap?0:1,t.last_flush=M,A._tr_init(t),V):i(e,L)}function w(e){var t=g(e);return t===V&&b(e.state),t}function k(e,t){return e&&e.state?2!==e.state.wrap?L:(e.state.gzhead=t,V):L}function C(e,t,n,r,o,a){if(!e)return L;var s=1;if(t===q&&(t=6),0>r?(s=0,r=-r):r>15&&(s=2,r-=16),1>o||o>$||n!==Q||8>r||r>15||0>t||t>9||0>a||a>J)return i(e,L);8===r&&(r=9);var l=new _;return e.state=l,l.strm=e,l.wrap=s,l.gzhead=null,l.w_bits=r,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=o+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+ue-1)/ue),l.window=new E.Buf8(2*l.w_size),l.head=new E.Buf16(l.hash_size),l.prev=new E.Buf16(l.w_size),l.lit_bufsize=1<<o+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new E.Buf8(l.pending_buf_size),l.d_buf=l.lit_bufsize>>1,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=a,l.method=n,w(e)}function S(e,t){return C(e,t,Q,ee,te,Z)}function I(e,t){var n,s,c,f;if(!e||!e.state||t>N||0>t)return e?i(e,L):L;if(s=e.state,!e.output||!e.input&&0!==e.avail_in||s.status===be&&t!==U)return i(e,0===e.avail_out?H:L);if(s.strm=e,n=s.last_flush,s.last_flush=t,s.status===he)if(2===s.wrap)e.adler=0,l(s,31),l(s,139),l(s,8),s.gzhead?(l(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),l(s,255&s.gzhead.time),l(s,s.gzhead.time>>8&255),l(s,s.gzhead.time>>16&255),l(s,s.gzhead.time>>24&255),l(s,9===s.level?2:s.strategy>=Y||s.level<2?4:0),l(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(l(s,255&s.gzhead.extra.length),l(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(e.adler=O(e.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=pe):(l(s,0),l(s,0),l(s,0),l(s,0),l(s,0),l(s,9===s.level?2:s.strategy>=Y||s.level<2?4:0),l(s,Ce),s.status=xe);else{var d=Q+(s.w_bits-8<<4)<<8,h=-1;h=s.strategy>=Y||s.level<2?0:s.level<6?1:6===s.level?2:3,d|=h<<6,0!==s.strstart&&(d|=de),d+=31-d%31,s.status=xe,u(s,d),0!==s.strstart&&(u(s,e.adler>>>16),u(s,65535&e.adler)),e.adler=1}if(s.status===pe)if(s.gzhead.extra){for(c=s.pending;s.gzindex<(65535&s.gzhead.extra.length)&&(s.pending!==s.pending_buf_size||(s.gzhead.hcrc&&s.pending>c&&(e.adler=O(e.adler,s.pending_buf,s.pending-c,c)),a(e),c=s.pending,s.pending!==s.pending_buf_size));)l(s,255&s.gzhead.extra[s.gzindex]),s.gzindex++;s.gzhead.hcrc&&s.pending>c&&(e.adler=O(e.adler,s.pending_buf,s.pending-c,c)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=me)}else s.status=me;if(s.status===me)if(s.gzhead.name){c=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>c&&(e.adler=O(e.adler,s.pending_buf,s.pending-c,c)),a(e),c=s.pending,s.pending===s.pending_buf_size)){f=1;break}f=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,l(s,f)}while(0!==f);s.gzhead.hcrc&&s.pending>c&&(e.adler=O(e.adler,s.pending_buf,s.pending-c,c)),0===f&&(s.gzindex=0,s.status=ve)}else s.status=ve;if(s.status===ve)if(s.gzhead.comment){c=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>c&&(e.adler=O(e.adler,s.pending_buf,s.pending-c,c)),a(e),c=s.pending,s.pending===s.pending_buf_size)){f=1;break}f=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,l(s,f)}while(0!==f);s.gzhead.hcrc&&s.pending>c&&(e.adler=O(e.adler,s.pending_buf,s.pending-c,c)),0===f&&(s.status=ye)}else s.status=ye;if(s.status===ye&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&a(e),s.pending+2<=s.pending_buf_size&&(l(s,255&e.adler),l(s,e.adler>>8&255),e.adler=0,s.status=xe)):s.status=xe),0!==s.pending){if(a(e),0===e.avail_out)return s.last_flush=-1,V}else if(0===e.avail_in&&r(t)<=r(n)&&t!==U)return i(e,H);if(s.status===be&&0!==e.avail_in)return i(e,H);if(0!==e.avail_in||0!==s.lookahead||t!==M&&s.status!==be){var p=s.strategy===Y?y(s,t):s.strategy===W?v(s,t):P[s.level].func(s,t);if(p!==we&&p!==ke||(s.status=be),p===_e||p===we)return 0===e.avail_out&&(s.last_flush=-1),V;if(p===ge&&(t===B?A._tr_align(s):t!==N&&(A._tr_stored_block(s,0,0,!1),t===F&&(o(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),a(e),0===e.avail_out))return s.last_flush=-1,V}return t!==U?V:s.wrap<=0?j:(2===s.wrap?(l(s,255&e.adler),l(s,e.adler>>8&255),l(s,e.adler>>16&255),l(s,e.adler>>24&255),l(s,255&e.total_in),l(s,e.total_in>>8&255),l(s,e.total_in>>16&255),l(s,e.total_in>>24&255)):(u(s,e.adler>>>16),u(s,65535&e.adler)),a(e),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?V:j)}function T(e){var t;return e&&e.state?(t=e.state.status,t!==he&&t!==pe&&t!==me&&t!==ve&&t!==ye&&t!==xe&&t!==be?i(e,L):(e.state=null,t===xe?i(e,G):V)):L}function D(e,t){var n,i,r,a,s,l,u,c,f=t.length;if(!e||!e.state)return L;if(n=e.state,a=n.wrap,2===a||1===a&&n.status!==he||n.lookahead)return L;for(1===a&&(e.adler=z(e.adler,t,f,0)),n.wrap=0,f>=n.w_size&&(0===a&&(o(n.head),n.strstart=0,n.block_start=0,n.insert=0),c=new E.Buf8(n.w_size),E.arraySet(c,t,f-n.w_size,n.w_size,0),t=c,f=n.w_size),s=e.avail_in,l=e.next_in,u=e.input,e.avail_in=f,e.next_in=0,e.input=t,d(n);n.lookahead>=ue;){i=n.strstart,r=n.lookahead-(ue-1);do n.ins_h=(n.ins_h<<n.hash_shift^n.window[i+ue-1])&n.hash_mask,n.prev[i&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=i,i++;while(--r);n.strstart=i,n.lookahead=ue-1,d(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=ue-1,n.match_available=0,e.next_in=l,e.input=u,e.avail_in=s,n.wrap=a,V}var P,E=e("../utils/common"),A=e("./trees"),z=e("./adler32"),O=e("./crc32"),R=e("./messages"),M=0,B=1,F=3,U=4,N=5,V=0,j=1,L=-2,G=-3,H=-5,q=-1,X=1,Y=2,W=3,J=4,Z=0,K=2,Q=8,$=9,ee=15,te=8,ne=29,ie=256,re=ie+1+ne,oe=30,ae=19,se=2*re+1,le=15,ue=3,ce=258,fe=ce+ue+1,de=32,he=42,pe=69,me=73,ve=91,ye=103,xe=113,be=666,_e=1,ge=2,we=3,ke=4,Ce=3;P=[new x(0,0,0,0,h),new x(4,4,8,4,p),new x(4,5,16,8,p),new x(4,6,32,32,p),new x(4,4,16,16,m),new x(8,16,32,32,m),new x(8,16,128,128,m),new x(8,32,128,256,m),new x(32,128,258,1024,m),new x(32,258,258,4096,m)],n.deflateInit=S,n.deflateInit2=C,n.deflateReset=w,n.deflateResetKeep=g,n.deflateSetHeader=k,n.deflate=I,n.deflateEnd=T,n.deflateSetDictionary=D,n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":32,"./adler32":34,"./crc32":36,"./messages":42,"./trees":43}],38:[function(e,t,n){"use strict";function i(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}t.exports=i},{}],39:[function(e,t,n){"use strict";var i=30,r=12;t.exports=function(e,t){var n,o,a,s,l,u,c,f,d,h,p,m,v,y,x,b,_,g,w,k,C,S,I,T,D;n=e.state,o=e.next_in,T=e.input,a=o+(e.avail_in-5),s=e.next_out,D=e.output,l=s-(t-e.avail_out),u=s+(e.avail_out-257),c=n.dmax,f=n.wsize,d=n.whave,h=n.wnext,p=n.window,m=n.hold,v=n.bits,y=n.lencode,x=n.distcode,b=(1<<n.lenbits)-1,_=(1<<n.distbits)-1;e:do{15>v&&(m+=T[o++]<<v,v+=8,m+=T[o++]<<v,v+=8),g=y[m&b];t:for(;;){if(w=g>>>24,m>>>=w,v-=w,w=g>>>16&255,0===w)D[s++]=65535&g;else{if(!(16&w)){if(0===(64&w)){g=y[(65535&g)+(m&(1<<w)-1)];continue t}if(32&w){n.mode=r;break e}e.msg="invalid literal/length code",n.mode=i;break e}k=65535&g,w&=15,w&&(w>v&&(m+=T[o++]<<v,v+=8),k+=m&(1<<w)-1,m>>>=w,v-=w),15>v&&(m+=T[o++]<<v,v+=8,m+=T[o++]<<v,v+=8),g=x[m&_];n:for(;;){if(w=g>>>24,m>>>=w,v-=w,w=g>>>16&255,!(16&w)){if(0===(64&w)){g=x[(65535&g)+(m&(1<<w)-1)];continue n}e.msg="invalid distance code",n.mode=i;break e}if(C=65535&g,w&=15,w>v&&(m+=T[o++]<<v,v+=8,w>v&&(m+=T[o++]<<v,v+=8)),C+=m&(1<<w)-1,C>c){e.msg="invalid distance too far back",n.mode=i;break e}if(m>>>=w,v-=w,w=s-l,C>w){if(w=C-w,w>d&&n.sane){e.msg="invalid distance too far back",n.mode=i;break e}if(S=0,I=p,0===h){if(S+=f-w,k>w){k-=w;do D[s++]=p[S++];while(--w);S=s-C,I=D}}else if(w>h){if(S+=f+h-w,w-=h,k>w){k-=w;do D[s++]=p[S++];while(--w);if(S=0,k>h){w=h,k-=w;do D[s++]=p[S++];while(--w);S=s-C,I=D}}}else if(S+=h-w,k>w){k-=w;do D[s++]=p[S++];while(--w);S=s-C,I=D}for(;k>2;)D[s++]=I[S++],D[s++]=I[S++],D[s++]=I[S++],k-=3;k&&(D[s++]=I[S++],k>1&&(D[s++]=I[S++]))}else{S=s-C;do D[s++]=D[S++],D[s++]=D[S++],D[s++]=D[S++],k-=3;while(k>2);k&&(D[s++]=D[S++],k>1&&(D[s++]=D[S++]))}break}}break}}while(a>o&&u>s);k=v>>3,o-=k,v-=k<<3,m&=(1<<v)-1,e.next_in=o,e.next_out=s,e.avail_in=a>o?5+(a-o):5-(o-a),e.avail_out=u>s?257+(u-s):257-(s-u),n.hold=m,n.bits=v}},{}],40:[function(e,t,n){"use strict";function i(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function r(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new x.Buf16(320),this.work=new x.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function o(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=F,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new x.Buf32(me),t.distcode=t.distdyn=new x.Buf32(ve),t.sane=1,t.back=-1,P):z}function a(e){var t;return e&&e.state?(t=e.state,t.wsize=0,t.whave=0,t.wnext=0,o(e)):z}function s(e,t){var n,i;return e&&e.state?(i=e.state,0>t?(n=0,t=-t):(n=(t>>4)+1,48>t&&(t&=15)),t&&(8>t||t>15)?z:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,a(e))):z}function l(e,t){var n,i;return e?(i=new r,e.state=i,i.window=null,n=s(e,t),n!==P&&(e.state=null),n):z}function u(e){return l(e,xe)}function c(e){if(be){var t;for(v=new x.Buf32(512),y=new x.Buf32(32),t=0;144>t;)e.lens[t++]=8;for(;256>t;)e.lens[t++]=9;for(;280>t;)e.lens[t++]=7;for(;288>t;)e.lens[t++]=8;for(w(C,e.lens,0,288,v,0,e.work,{bits:9}),t=0;32>t;)e.lens[t++]=5;w(S,e.lens,0,32,y,0,e.work,{bits:5}),be=!1}e.lencode=v,e.lenbits=9,e.distcode=y,e.distbits=5}function f(e,t,n,i){var r,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new x.Buf8(o.wsize)),i>=o.wsize?(x.arraySet(o.window,t,n-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):(r=o.wsize-o.wnext,r>i&&(r=i),x.arraySet(o.window,t,n-i,r,o.wnext),i-=r,i?(x.arraySet(o.window,t,n-i,i,0),o.wnext=i,o.whave=o.wsize):(o.wnext+=r,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=r))),0}function d(e,t){var n,r,o,a,s,l,u,d,h,p,m,v,y,me,ve,ye,xe,be,_e,ge,we,ke,Ce,Se,Ie=0,Te=new x.Buf8(4),De=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return z;n=e.state,n.mode===W&&(n.mode=J),s=e.next_out,o=e.output,u=e.avail_out,a=e.next_in,r=e.input,l=e.avail_in,d=n.hold,h=n.bits,p=l,m=u,ke=P;e:for(;;)switch(n.mode){case F:if(0===n.wrap){n.mode=J;break}for(;16>h;){if(0===l)break e;l--,d+=r[a++]<<h,h+=8}if(2&n.wrap&&35615===d){n.check=0,Te[0]=255&d,Te[1]=d>>>8&255,n.check=_(n.check,Te,2,0),d=0,h=0,n.mode=U;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&d)<<8)+(d>>8))%31){e.msg="incorrect header check",n.mode=de;break}if((15&d)!==B){e.msg="unknown compression method",n.mode=de;break}if(d>>>=4,h-=4,we=(15&d)+8,0===n.wbits)n.wbits=we;else if(we>n.wbits){e.msg="invalid window size",n.mode=de;break}n.dmax=1<<we,e.adler=n.check=1,n.mode=512&d?X:W,d=0,h=0;break;case U:for(;16>h;){if(0===l)break e;l--,d+=r[a++]<<h,h+=8}if(n.flags=d,(255&n.flags)!==B){e.msg="unknown compression method",n.mode=de;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=de;break}n.head&&(n.head.text=d>>8&1),512&n.flags&&(Te[0]=255&d,Te[1]=d>>>8&255,n.check=_(n.check,Te,2,0)),d=0,h=0,n.mode=N;case N:for(;32>h;){if(0===l)break e;l--,d+=r[a++]<<h,h+=8}n.head&&(n.head.time=d),512&n.flags&&(Te[0]=255&d,Te[1]=d>>>8&255,Te[2]=d>>>16&255,Te[3]=d>>>24&255,n.check=_(n.check,Te,4,0)),d=0,h=0,n.mode=V;case V:for(;16>h;){if(0===l)break e;l--,d+=r[a++]<<h,h+=8}n.head&&(n.head.xflags=255&d,n.head.os=d>>8),512&n.flags&&(Te[0]=255&d,Te[1]=d>>>8&255,n.check=_(n.check,Te,2,0)),d=0,h=0,n.mode=j;case j:if(1024&n.flags){for(;16>h;){if(0===l)break e;l--,d+=r[a++]<<h,h+=8}n.length=d,n.head&&(n.head.extra_len=d),512&n.flags&&(Te[0]=255&d,Te[1]=d>>>8&255,n.check=_(n.check,Te,2,0)),d=0,h=0}else n.head&&(n.head.extra=null);n.mode=L;case L:if(1024&n.flags&&(v=n.length,v>l&&(v=l),v&&(n.head&&(we=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),x.arraySet(n.head.extra,r,a,v,we)),512&n.flags&&(n.check=_(n.check,r,v,a)),l-=v,a+=v,n.length-=v),n.length))break e;n.length=0,n.mode=G;case G:if(2048&n.flags){if(0===l)break e;v=0;do we=r[a+v++],n.head&&we&&n.length<65536&&(n.head.name+=String.fromCharCode(we));while(we&&l>v);if(512&n.flags&&(n.check=_(n.check,r,v,a)),l-=v,a+=v,we)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=H;case H:if(4096&n.flags){if(0===l)break e;v=0;do we=r[a+v++],n.head&&we&&n.length<65536&&(n.head.comment+=String.fromCharCode(we));while(we&&l>v);if(512&n.flags&&(n.check=_(n.check,r,v,a)),l-=v,a+=v,we)break e}else n.head&&(n.head.comment=null);n.mode=q;case q:if(512&n.flags){for(;16>h;){if(0===l)break e;l--,d+=r[a++]<<h,h+=8}if(d!==(65535&n.check)){e.msg="header crc mismatch",n.mode=de;break}d=0,h=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=W;break;case X:for(;32>h;){if(0===l)break e;l--,d+=r[a++]<<h,h+=8}e.adler=n.check=i(d),d=0,h=0,n.mode=Y;case Y:if(0===n.havedict)return e.next_out=s,e.avail_out=u,e.next_in=a,e.avail_in=l,n.hold=d,n.bits=h,A;e.adler=n.check=1,n.mode=W;case W:if(t===T||t===D)break e;case J:if(n.last){d>>>=7&h,h-=7&h,n.mode=ue;break}for(;3>h;){if(0===l)break e;l--,d+=r[a++]<<h,h+=8}switch(n.last=1&d,d>>>=1,h-=1,3&d){case 0:n.mode=Z;break;case 1:if(c(n),n.mode=ne,t===D){d>>>=2,h-=2;break e}break;case 2:n.mode=$;break;case 3:e.msg="invalid block type",n.mode=de}d>>>=2,h-=2;break;case Z:for(d>>>=7&h,h-=7&h;32>h;){if(0===l)break e;l--,d+=r[a++]<<h,h+=8}if((65535&d)!==(d>>>16^65535)){e.msg="invalid stored block lengths",n.mode=de;break}if(n.length=65535&d,d=0,h=0,n.mode=K,t===D)break e;case K:n.mode=Q;case Q:if(v=n.length){if(v>l&&(v=l),v>u&&(v=u),0===v)break e;x.arraySet(o,r,a,v,s),l-=v,a+=v,u-=v,s+=v,n.length-=v;break}n.mode=W;break;case $:for(;14>h;){if(0===l)break e;l--,d+=r[a++]<<h,h+=8}if(n.nlen=(31&d)+257,d>>>=5,h-=5,n.ndist=(31&d)+1,d>>>=5,h-=5,n.ncode=(15&d)+4,d>>>=4,h-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=de;break}n.have=0,n.mode=ee;case ee:for(;n.have<n.ncode;){for(;3>h;){if(0===l)break e;l--,d+=r[a++]<<h,h+=8}n.lens[De[n.have++]]=7&d,d>>>=3,h-=3}for(;n.have<19;)n.lens[De[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,Ce={bits:n.lenbits},ke=w(k,n.lens,0,19,n.lencode,0,n.work,Ce),n.lenbits=Ce.bits,ke){e.msg="invalid code lengths set",n.mode=de;break}n.have=0,n.mode=te;case te:for(;n.have<n.nlen+n.ndist;){for(;Ie=n.lencode[d&(1<<n.lenbits)-1],ve=Ie>>>24,ye=Ie>>>16&255,xe=65535&Ie,!(h>=ve);){if(0===l)break e;l--,d+=r[a++]<<h,h+=8}if(16>xe)d>>>=ve,h-=ve,n.lens[n.have++]=xe;else{if(16===xe){for(Se=ve+2;Se>h;){if(0===l)break e;l--,d+=r[a++]<<h,h+=8}if(d>>>=ve,h-=ve,0===n.have){e.msg="invalid bit length repeat",n.mode=de;break}we=n.lens[n.have-1],v=3+(3&d),d>>>=2,h-=2}else if(17===xe){for(Se=ve+3;Se>h;){if(0===l)break e;l--,d+=r[a++]<<h,h+=8}d>>>=ve,h-=ve,we=0,v=3+(7&d),d>>>=3,h-=3}else{for(Se=ve+7;Se>h;){if(0===l)break e;l--,d+=r[a++]<<h,h+=8}d>>>=ve,h-=ve,we=0,v=11+(127&d),d>>>=7,h-=7}if(n.have+v>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=de;break}for(;v--;)n.lens[n.have++]=we}}if(n.mode===de)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=de;break}if(n.lenbits=9,Ce={bits:n.lenbits},ke=w(C,n.lens,0,n.nlen,n.lencode,0,n.work,Ce),n.lenbits=Ce.bits,ke){e.msg="invalid literal/lengths set",n.mode=de;break}if(n.distbits=6,n.distcode=n.distdyn,Ce={bits:n.distbits},ke=w(S,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,Ce),n.distbits=Ce.bits,ke){e.msg="invalid distances set",n.mode=de;break}if(n.mode=ne,t===D)break e;case ne:n.mode=ie;case ie:if(l>=6&&u>=258){e.next_out=s,e.avail_out=u,e.next_in=a,e.avail_in=l,n.hold=d,n.bits=h,g(e,m),s=e.next_out,o=e.output,u=e.avail_out,a=e.next_in,r=e.input,l=e.avail_in,d=n.hold,h=n.bits,n.mode===W&&(n.back=-1);break}for(n.back=0;Ie=n.lencode[d&(1<<n.lenbits)-1],ve=Ie>>>24,ye=Ie>>>16&255,xe=65535&Ie,!(h>=ve);){if(0===l)break e;l--,d+=r[a++]<<h,h+=8}if(ye&&0===(240&ye)){for(be=ve,_e=ye,ge=xe;Ie=n.lencode[ge+((d&(1<<be+_e)-1)>>be)],ve=Ie>>>24,ye=Ie>>>16&255,xe=65535&Ie,!(h>=be+ve);){if(0===l)break e;l--,d+=r[a++]<<h,h+=8}d>>>=be,h-=be,n.back+=be}if(d>>>=ve,h-=ve,n.back+=ve,n.length=xe,0===ye){n.mode=le;break}if(32&ye){n.back=-1,n.mode=W;break}if(64&ye){e.msg="invalid literal/length code",n.mode=de;break}n.extra=15&ye,n.mode=re;case re:if(n.extra){for(Se=n.extra;Se>h;){if(0===l)break e;l--,d+=r[a++]<<h,h+=8}n.length+=d&(1<<n.extra)-1,d>>>=n.extra,h-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=oe;case oe:for(;Ie=n.distcode[d&(1<<n.distbits)-1],ve=Ie>>>24,ye=Ie>>>16&255,xe=65535&Ie,!(h>=ve);){if(0===l)break e;l--,d+=r[a++]<<h,h+=8}if(0===(240&ye)){for(be=ve,_e=ye,ge=xe;Ie=n.distcode[ge+((d&(1<<be+_e)-1)>>be)],ve=Ie>>>24,ye=Ie>>>16&255,xe=65535&Ie,!(h>=be+ve);){if(0===l)break e;l--,d+=r[a++]<<h,h+=8}d>>>=be,h-=be,n.back+=be}if(d>>>=ve,h-=ve,n.back+=ve,64&ye){e.msg="invalid distance code",n.mode=de;break}n.offset=xe,n.extra=15&ye,n.mode=ae;case ae:if(n.extra){for(Se=n.extra;Se>h;){if(0===l)break e;l--,d+=r[a++]<<h,h+=8}n.offset+=d&(1<<n.extra)-1,d>>>=n.extra,h-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=de;break}n.mode=se;case se:if(0===u)break e;if(v=m-u,n.offset>v){if(v=n.offset-v,v>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=de;break}v>n.wnext?(v-=n.wnext,y=n.wsize-v):y=n.wnext-v,v>n.length&&(v=n.length),me=n.window}else me=o,y=s-n.offset,v=n.length;v>u&&(v=u),u-=v,n.length-=v;do o[s++]=me[y++];while(--v);0===n.length&&(n.mode=ie);break;case le:if(0===u)break e;o[s++]=n.length,u--,n.mode=ie;break;case ue:if(n.wrap){for(;32>h;){if(0===l)break e;l--,d|=r[a++]<<h,h+=8}if(m-=u,e.total_out+=m,n.total+=m,m&&(e.adler=n.check=n.flags?_(n.check,o,m,s-m):b(n.check,o,m,s-m)),m=u,(n.flags?d:i(d))!==n.check){e.msg="incorrect data check",n.mode=de;break}d=0,h=0}n.mode=ce;case ce:if(n.wrap&&n.flags){for(;32>h;){if(0===l)break e;l--,d+=r[a++]<<h,h+=8}if(d!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=de;break}d=0,h=0}n.mode=fe;case fe:ke=E;break e;case de:ke=O;break e;case he:return R;case pe:default:return z}return e.next_out=s,e.avail_out=u,e.next_in=a,e.avail_in=l,n.hold=d,n.bits=h,(n.wsize||m!==e.avail_out&&n.mode<de&&(n.mode<ue||t!==I))&&f(e,e.output,e.next_out,m-e.avail_out)?(n.mode=he,R):(p-=e.avail_in,m-=e.avail_out,e.total_in+=p,e.total_out+=m,n.total+=m,n.wrap&&m&&(e.adler=n.check=n.flags?_(n.check,o,m,e.next_out-m):b(n.check,o,m,e.next_out-m)),e.data_type=n.bits+(n.last?64:0)+(n.mode===W?128:0)+(n.mode===ne||n.mode===K?256:0),(0===p&&0===m||t===I)&&ke===P&&(ke=M),ke)}function h(e){if(!e||!e.state)return z;var t=e.state;return t.window&&(t.window=null),e.state=null,P}function p(e,t){var n;return e&&e.state?(n=e.state,0===(2&n.wrap)?z:(n.head=t,t.done=!1,P)):z}function m(e,t){var n,i,r,o=t.length;return e&&e.state?(n=e.state,0!==n.wrap&&n.mode!==Y?z:n.mode===Y&&(i=1,i=b(i,t,o,0),i!==n.check)?O:(r=f(e,t,o,o))?(n.mode=he,R):(n.havedict=1,P)):z}var v,y,x=e("../utils/common"),b=e("./adler32"),_=e("./crc32"),g=e("./inffast"),w=e("./inftrees"),k=0,C=1,S=2,I=4,T=5,D=6,P=0,E=1,A=2,z=-2,O=-3,R=-4,M=-5,B=8,F=1,U=2,N=3,V=4,j=5,L=6,G=7,H=8,q=9,X=10,Y=11,W=12,J=13,Z=14,K=15,Q=16,$=17,ee=18,te=19,ne=20,ie=21,re=22,oe=23,ae=24,se=25,le=26,ue=27,ce=28,fe=29,de=30,he=31,pe=32,me=852,ve=592,ye=15,xe=ye,be=!0;n.inflateReset=a,n.inflateReset2=s,n.inflateResetKeep=o,n.inflateInit=u,n.inflateInit2=l,n.inflate=d,n.inflateEnd=h,n.inflateGetHeader=p,n.inflateSetDictionary=m,n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":32,"./adler32":34,"./crc32":36,"./inffast":39,"./inftrees":41}],41:[function(e,t,n){"use strict";var i=e("../utils/common"),r=15,o=852,a=592,s=0,l=1,u=2,c=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],f=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],d=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,n,p,m,v,y,x){var b,_,g,w,k,C,S,I,T,D=x.bits,P=0,E=0,A=0,z=0,O=0,R=0,M=0,B=0,F=0,U=0,N=null,V=0,j=new i.Buf16(r+1),L=new i.Buf16(r+1),G=null,H=0;for(P=0;r>=P;P++)j[P]=0;for(E=0;p>E;E++)j[t[n+E]]++;for(O=D,z=r;z>=1&&0===j[z];z--);if(O>z&&(O=z),0===z)return m[v++]=20971520,m[v++]=20971520,x.bits=1,0;for(A=1;z>A&&0===j[A];A++);for(A>O&&(O=A),B=1,P=1;r>=P;P++)if(B<<=1,B-=j[P],0>B)return-1;if(B>0&&(e===s||1!==z))return-1;for(L[1]=0,P=1;r>P;P++)L[P+1]=L[P]+j[P];for(E=0;p>E;E++)0!==t[n+E]&&(y[L[t[n+E]]++]=E);if(e===s?(N=G=y,C=19):e===l?(N=c,V-=257,G=f,H-=257,C=256):(N=d,G=h,C=-1),U=0,E=0,P=A,k=v,R=O,M=0,g=-1,F=1<<O,w=F-1,e===l&&F>o||e===u&&F>a)return 1;for(var q=0;;){q++,S=P-M,y[E]<C?(I=0,T=y[E]):y[E]>C?(I=G[H+y[E]],T=N[V+y[E]]):(I=96,T=0),b=1<<P-M,_=1<<R,A=_;do _-=b,m[k+(U>>M)+_]=S<<24|I<<16|T|0;while(0!==_);for(b=1<<P-1;U&b;)b>>=1;if(0!==b?(U&=b-1,U+=b):U=0,E++,0===--j[P]){if(P===z)break;P=t[n+y[E]]}if(P>O&&(U&w)!==g){for(0===M&&(M=O),k+=A,R=P-M,B=1<<R;z>R+M&&(B-=j[R+M],!(0>=B));)R++,B<<=1;if(F+=1<<R,e===l&&F>o||e===u&&F>a)return 1;g=U&w,m[g]=O<<24|R<<16|k-v|0}}return 0!==U&&(m[k+U]=P-M<<24|64<<16|0),x.bits=O,0}},{"../utils/common":32}],42:[function(e,t,n){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],43:[function(e,t,n){"use strict";function i(e){for(var t=e.length;--t>=0;)e[t]=0}function r(e,t,n,i,r){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=r,this.has_stree=e&&e.length}function o(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function a(e){return 256>e?le[e]:le[256+(e>>>7)]}function s(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function l(e,t,n){e.bi_valid>J-n?(e.bi_buf|=t<<e.bi_valid&65535,s(e,e.bi_buf),e.bi_buf=t>>J-e.bi_valid,e.bi_valid+=n-J):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function u(e,t,n){l(e,n[2*t],n[2*t+1])}function c(e,t){var n=0;do n|=1&e,e>>>=1,n<<=1;while(--t>0);return n>>>1}function f(e){16===e.bi_valid?(s(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}function d(e,t){var n,i,r,o,a,s,l=t.dyn_tree,u=t.max_code,c=t.stat_desc.static_tree,f=t.stat_desc.has_stree,d=t.stat_desc.extra_bits,h=t.stat_desc.extra_base,p=t.stat_desc.max_length,m=0;for(o=0;W>=o;o++)e.bl_count[o]=0;for(l[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;Y>n;n++)i=e.heap[n],o=l[2*l[2*i+1]+1]+1,o>p&&(o=p,m++),l[2*i+1]=o,i>u||(e.bl_count[o]++,a=0,i>=h&&(a=d[i-h]),s=l[2*i],e.opt_len+=s*(o+a),f&&(e.static_len+=s*(c[2*i+1]+a)));if(0!==m){do{for(o=p-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[p]--,m-=2}while(m>0);for(o=p;0!==o;o--)for(i=e.bl_count[o];0!==i;)r=e.heap[--n],r>u||(l[2*r+1]!==o&&(e.opt_len+=(o-l[2*r+1])*l[2*r],l[2*r+1]=o),i--)}}function h(e,t,n){var i,r,o=new Array(W+1),a=0;for(i=1;W>=i;i++)o[i]=a=a+n[i-1]<<1;for(r=0;t>=r;r++){var s=e[2*r+1];0!==s&&(e[2*r]=c(o[s]++,s))}}function p(){var e,t,n,i,o,a=new Array(W+1);for(n=0,i=0;L-1>i;i++)for(ce[i]=n,e=0;e<1<<te[i];e++)ue[n++]=i;for(ue[n-1]=i,o=0,i=0;16>i;i++)for(fe[i]=o,e=0;e<1<<ne[i];e++)le[o++]=i;for(o>>=7;q>i;i++)for(fe[i]=o<<7,e=0;e<1<<ne[i]-7;e++)le[256+o++]=i;for(t=0;W>=t;t++)a[t]=0;for(e=0;143>=e;)ae[2*e+1]=8,e++,a[8]++;for(;255>=e;)ae[2*e+1]=9,e++,a[9]++;for(;279>=e;)ae[2*e+1]=7,e++,a[7]++;for(;287>=e;)ae[2*e+1]=8,e++,a[8]++;for(h(ae,H+1,a),e=0;q>e;e++)se[2*e+1]=5,se[2*e]=c(e,5);de=new r(ae,te,G+1,H,W),he=new r(se,ne,0,q,W),pe=new r(new Array(0),ie,0,X,Z)}function m(e){var t;for(t=0;H>t;t++)e.dyn_ltree[2*t]=0;for(t=0;q>t;t++)e.dyn_dtree[2*t]=0;for(t=0;X>t;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*K]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function v(e){e.bi_valid>8?s(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function y(e,t,n,i){v(e),i&&(s(e,n),s(e,~n)),z.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}function x(e,t,n,i){var r=2*t,o=2*n;return e[r]<e[o]||e[r]===e[o]&&i[t]<=i[n]}function b(e,t,n){for(var i=e.heap[n],r=n<<1;r<=e.heap_len&&(r<e.heap_len&&x(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!x(t,i,e.heap[r],e.depth));)e.heap[n]=e.heap[r],n=r,r<<=1;e.heap[n]=i}function _(e,t,n){var i,r,o,s,c=0;if(0!==e.last_lit)do i=e.pending_buf[e.d_buf+2*c]<<8|e.pending_buf[e.d_buf+2*c+1],r=e.pending_buf[e.l_buf+c],c++,0===i?u(e,r,t):(o=ue[r],u(e,o+G+1,t),s=te[o],0!==s&&(r-=ce[o],l(e,r,s)),i--,o=a(i),u(e,o,n),s=ne[o],0!==s&&(i-=fe[o],l(e,i,s)));while(c<e.last_lit);u(e,K,t)}function g(e,t){var n,i,r,o=t.dyn_tree,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,l=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=Y,n=0;l>n;n++)0!==o[2*n]?(e.heap[++e.heap_len]=u=n,e.depth[n]=0):o[2*n+1]=0;for(;e.heap_len<2;)r=e.heap[++e.heap_len]=2>u?++u:0,o[2*r]=1,e.depth[r]=0,e.opt_len--,s&&(e.static_len-=a[2*r+1]);for(t.max_code=u,n=e.heap_len>>1;n>=1;n--)b(e,o,n);r=l;do n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],b(e,o,1),i=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=i,o[2*r]=o[2*n]+o[2*i],e.depth[r]=(e.depth[n]>=e.depth[i]?e.depth[n]:e.depth[i])+1,o[2*n+1]=o[2*i+1]=r,e.heap[1]=r++,b(e,o,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],d(e,t),h(o,u,e.bl_count)}function w(e,t,n){var i,r,o=-1,a=t[1],s=0,l=7,u=4;for(0===a&&(l=138,u=3),t[2*(n+1)+1]=65535,i=0;n>=i;i++)r=a,a=t[2*(i+1)+1],++s<l&&r===a||(u>s?e.bl_tree[2*r]+=s:0!==r?(r!==o&&e.bl_tree[2*r]++,e.bl_tree[2*Q]++):10>=s?e.bl_tree[2*$]++:e.bl_tree[2*ee]++,s=0,o=r,0===a?(l=138,u=3):r===a?(l=6,u=3):(l=7,u=4))}function k(e,t,n){var i,r,o=-1,a=t[1],s=0,c=7,f=4;for(0===a&&(c=138,f=3),i=0;n>=i;i++)if(r=a,a=t[2*(i+1)+1],!(++s<c&&r===a)){if(f>s){do u(e,r,e.bl_tree);while(0!==--s)}else 0!==r?(r!==o&&(u(e,r,e.bl_tree),s--),u(e,Q,e.bl_tree),l(e,s-3,2)):10>=s?(u(e,$,e.bl_tree),l(e,s-3,3)):(u(e,ee,e.bl_tree),l(e,s-11,7));s=0,o=r,0===a?(c=138,f=3):r===a?(c=6,f=3):(c=7,f=4)}}function C(e){var t;for(w(e,e.dyn_ltree,e.l_desc.max_code),w(e,e.dyn_dtree,e.d_desc.max_code),g(e,e.bl_desc),t=X-1;t>=3&&0===e.bl_tree[2*re[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}function S(e,t,n,i){var r;for(l(e,t-257,5),l(e,n-1,5),l(e,i-4,4),r=0;i>r;r++)l(e,e.bl_tree[2*re[r]+1],3);k(e,e.dyn_ltree,t-1),k(e,e.dyn_dtree,n-1)}function I(e){var t,n=4093624447;for(t=0;31>=t;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return R;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return M;for(t=32;G>t;t++)if(0!==e.dyn_ltree[2*t])return M;return R}function T(e){me||(p(),me=!0),e.l_desc=new o(e.dyn_ltree,de),e.d_desc=new o(e.dyn_dtree,he),e.bl_desc=new o(e.bl_tree,pe),e.bi_buf=0,e.bi_valid=0,m(e)}function D(e,t,n,i){l(e,(F<<1)+(i?1:0),3),y(e,t,n,!0)}function P(e){l(e,U<<1,3),u(e,K,ae),f(e)}function E(e,t,n,i){var r,o,a=0;e.level>0?(e.strm.data_type===B&&(e.strm.data_type=I(e)),g(e,e.l_desc),g(e,e.d_desc),a=C(e),r=e.opt_len+3+7>>>3,o=e.static_len+3+7>>>3,r>=o&&(r=o)):r=o=n+5,r>=n+4&&-1!==t?D(e,t,n,i):e.strategy===O||o===r?(l(e,(U<<1)+(i?1:0),3),_(e,ae,se)):(l(e,(N<<1)+(i?1:0),3),S(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),_(e,e.dyn_ltree,e.dyn_dtree)),m(e),i&&v(e)}function A(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(ue[n]+G+1)]++,e.dyn_dtree[2*a(t)]++),e.last_lit===e.lit_bufsize-1}var z=e("../utils/common"),O=4,R=0,M=1,B=2,F=0,U=1,N=2,V=3,j=258,L=29,G=256,H=G+1+L,q=30,X=19,Y=2*H+1,W=15,J=16,Z=7,K=256,Q=16,$=17,ee=18,te=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],ne=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],ie=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],re=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],oe=512,ae=new Array(2*(H+2));i(ae);var se=new Array(2*q);i(se);var le=new Array(oe);i(le);var ue=new Array(j-V+1);i(ue);var ce=new Array(L);i(ce);var fe=new Array(q);i(fe);var de,he,pe,me=!1;n._tr_init=T,n._tr_stored_block=D,n._tr_flush_block=E,n._tr_tally=A,n._tr_align=P},{"../utils/common":32
}],44:[function(e,t,n){"use strict";function i(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}t.exports=i},{}],45:[function(e,t,n){function i(){d&&c&&(d=!1,c.length?f=c.concat(f):h=-1,f.length&&r())}function r(){if(!d){var e=s(i);d=!0;for(var t=f.length;t;){for(c=f,f=[];++h<t;)c&&c[h].run();h=-1,t=f.length}c=null,d=!1,l(e)}}function o(e,t){this.fun=e,this.array=t}function a(){}var s,l,u=t.exports={};!function(){try{s=setTimeout}catch(e){s=function(){throw new Error("setTimeout is not defined")}}try{l=clearTimeout}catch(e){l=function(){throw new Error("clearTimeout is not defined")}}}();var c,f=[],d=!1,h=-1;u.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];f.push(new o(e,t)),1!==f.length||d||s(r,0)},o.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={},u.on=a,u.addListener=a,u.once=a,u.off=a,u.removeListener=a,u.removeAllListeners=a,u.emit=a,u.binding=function(e){throw new Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(e){throw new Error("process.chdir is not supported")},u.umask=function(){return 0}},{}],46:[function(e,t,n){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],47:[function(e,t,n){(function(t,i){function r(e,t){var i={seen:[],stylize:a};return arguments.length>=3&&(i.depth=arguments[2]),arguments.length>=4&&(i.colors=arguments[3]),m(t)?i.showHidden=t:t&&n._extend(i,t),g(i.showHidden)&&(i.showHidden=!1),g(i.depth)&&(i.depth=2),g(i.colors)&&(i.colors=!1),g(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=o),l(i,e,i.depth)}function o(e,t){var n=r.styles[t];return n?"["+r.colors[n][0]+"m"+e+"["+r.colors[n][1]+"m":e}function a(e,t){return e}function s(e){var t={};return e.forEach(function(e,n){t[e]=!0}),t}function l(e,t,i){if(e.customInspect&&t&&I(t.inspect)&&t.inspect!==n.inspect&&(!t.constructor||t.constructor.prototype!==t)){var r=t.inspect(i,e);return b(r)||(r=l(e,r,i)),r}var o=u(e,t);if(o)return o;var a=Object.keys(t),m=s(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(t)),S(t)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return c(t);if(0===a.length){if(I(t)){var v=t.name?": "+t.name:"";return e.stylize("[Function"+v+"]","special")}if(w(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(C(t))return e.stylize(Date.prototype.toString.call(t),"date");if(S(t))return c(t)}var y="",x=!1,_=["{","}"];if(p(t)&&(x=!0,_=["[","]"]),I(t)){var g=t.name?": "+t.name:"";y=" [Function"+g+"]"}if(w(t)&&(y=" "+RegExp.prototype.toString.call(t)),C(t)&&(y=" "+Date.prototype.toUTCString.call(t)),S(t)&&(y=" "+c(t)),0===a.length&&(!x||0==t.length))return _[0]+y+_[1];if(0>i)return w(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special");e.seen.push(t);var k;return k=x?f(e,t,i,m,a):a.map(function(n){return d(e,t,i,m,n,x)}),e.seen.pop(),h(k,y,_)}function u(e,t){if(g(t))return e.stylize("undefined","undefined");if(b(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return x(t)?e.stylize(""+t,"number"):m(t)?e.stylize(""+t,"boolean"):v(t)?e.stylize("null","null"):void 0}function c(e){return"["+Error.prototype.toString.call(e)+"]"}function f(e,t,n,i,r){for(var o=[],a=0,s=t.length;s>a;++a)A(t,String(a))?o.push(d(e,t,n,i,String(a),!0)):o.push("");return r.forEach(function(r){r.match(/^\d+$/)||o.push(d(e,t,n,i,r,!0))}),o}function d(e,t,n,i,r,o){var a,s,u;if(u=Object.getOwnPropertyDescriptor(t,r)||{value:t[r]},u.get?s=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(s=e.stylize("[Setter]","special")),A(i,r)||(a="["+r+"]"),s||(e.seen.indexOf(u.value)<0?(s=v(n)?l(e,u.value,null):l(e,u.value,n-1),s.indexOf("\n")>-1&&(s=o?s.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+s.split("\n").map(function(e){return"   "+e}).join("\n"))):s=e.stylize("[Circular]","special")),g(a)){if(o&&r.match(/^\d+$/))return s;a=JSON.stringify(""+r),a.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+s}function h(e,t,n){var i=0,r=e.reduce(function(e,t){return i++,t.indexOf("\n")>=0&&i++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0);return r>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}function p(e){return Array.isArray(e)}function m(e){return"boolean"==typeof e}function v(e){return null===e}function y(e){return null==e}function x(e){return"number"==typeof e}function b(e){return"string"==typeof e}function _(e){return"symbol"==typeof e}function g(e){return void 0===e}function w(e){return k(e)&&"[object RegExp]"===D(e)}function k(e){return"object"==typeof e&&null!==e}function C(e){return k(e)&&"[object Date]"===D(e)}function S(e){return k(e)&&("[object Error]"===D(e)||e instanceof Error)}function I(e){return"function"==typeof e}function T(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function D(e){return Object.prototype.toString.call(e)}function P(e){return 10>e?"0"+e.toString(10):e.toString(10)}function E(){var e=new Date,t=[P(e.getHours()),P(e.getMinutes()),P(e.getSeconds())].join(":");return[e.getDate(),M[e.getMonth()],t].join(" ")}function A(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var z=/%[sdj%]/g;n.format=function(e){if(!b(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(r(arguments[n]));return t.join(" ")}for(var n=1,i=arguments,o=i.length,a=String(e).replace(z,function(e){if("%%"===e)return"%";if(n>=o)return e;switch(e){case"%s":return String(i[n++]);case"%d":return Number(i[n++]);case"%j":try{return JSON.stringify(i[n++])}catch(t){return"[Circular]"}default:return e}}),s=i[n];o>n;s=i[++n])a+=v(s)||!k(s)?" "+s:" "+r(s);return a},n.deprecate=function(e,r){function o(){if(!a){if(t.throwDeprecation)throw new Error(r);t.traceDeprecation?console.trace(r):console.error(r),a=!0}return e.apply(this,arguments)}if(g(i.process))return function(){return n.deprecate(e,r).apply(this,arguments)};if(t.noDeprecation===!0)return e;var a=!1;return o};var O,R={};n.debuglog=function(e){if(g(O)&&(O=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!R[e])if(new RegExp("\\b"+e+"\\b","i").test(O)){var i=t.pid;R[e]=function(){var t=n.format.apply(n,arguments);console.error("%s %d: %s",e,i,t)}}else R[e]=function(){};return R[e]},n.inspect=r,r.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},r.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=p,n.isBoolean=m,n.isNull=v,n.isNullOrUndefined=y,n.isNumber=x,n.isString=b,n.isSymbol=_,n.isUndefined=g,n.isRegExp=w,n.isObject=k,n.isDate=C,n.isError=S,n.isFunction=I,n.isPrimitive=T,n.isBuffer=e("./support/isBuffer");var M=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];n.log=function(){console.log("%s - %s",E(),n.format.apply(n,arguments))},n.inherits=e("inherits"),n._extend=function(e,t){if(!t||!k(t))return e;for(var n=Object.keys(t),i=n.length;i--;)e[n[i]]=t[n[i]];return e}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":46,_process:45,inherits:7}],48:[function(e,t,n){"use strict";function i(e,t,n){var i,u;if(!r(e))throw new TypeError("invalid input argument. First argument must be a string. Value: `"+e+"`.");if(!o(t))throw new TypeError("invalid input argument. Second argument must be a nonnegative integer. Value: `"+t+"`.");if(arguments.length>2){if(u=n,!r(u))throw new TypeError("invalid input argument. Third argument must be a string. Value: `"+u+"`.");if(0===u.length)throw new RangeError("invalid input argument. Pad string must not be an empty string.")}else u=" ";if(t>l)throw new RangeError("invalid input argument. Output string length exceeds maximum allowed string length.");return i=(t-e.length)/u.length,0>=i?e:(i=a(i),s(u,i)+e)}var r=e("validate.io-string-primitive"),o=e("validate.io-nonnegative-integer"),a=e("math-ceil"),s=e("utils-repeat-string"),l=9007199254740991;t.exports=i},{"math-ceil":19,"utils-repeat-string":49,"validate.io-nonnegative-integer":52,"validate.io-string-primitive":54}],49:[function(e,t,n){"use strict";function i(e,t){var n,i;if(!r(e))throw new TypeError("invalid input argument. First argument must be a string. Value: `"+e+"`.");if(!o(t))throw new TypeError("invalid input argument. Second argument must be a nonnegative integer. Value: `"+t+"`.");if(0===e.length||0===t)return"";if(e.length*t>a)throw new RangeError("invalid input argument. Output string length exceeds maximum allowed string length.");for(n="",i=t;1===(1&i)&&(n+=e),i>>>=1,0!==i;)e+=e;return n}var r=e("validate.io-string-primitive"),o=e("validate.io-nonnegative-integer"),a=9007199254740991;t.exports=i},{"validate.io-nonnegative-integer":52,"validate.io-string-primitive":54}],50:[function(e,t,n){"use strict";function i(e,t,n){var i,u;if(!r(e))throw new TypeError("invalid input argument. First argument must be a string. Value: `"+e+"`.");if(!o(t))throw new TypeError("invalid input argument. Second argument must be a nonnegative integer. Value: `"+t+"`.");if(arguments.length>2){if(u=n,!r(u))throw new TypeError("invalid input argument. Third argument must be a string. Value: `"+u+"`.");if(0===u.length)throw new RangeError("invalid input argument. Pad string must not be an empty string.")}else u=" ";if(t>l)throw new RangeError("invalid input argument. Output string length exceeds maximum allowed string length.");return i=(t-e.length)/u.length,0>=i?e:(i=a(i),e+s(u,i))}var r=e("validate.io-string-primitive"),o=e("validate.io-nonnegative-integer"),a=e("math-ceil"),s=e("utils-repeat-string"),l=9007199254740991;t.exports=i},{"math-ceil":19,"utils-repeat-string":49,"validate.io-nonnegative-integer":52,"validate.io-string-primitive":54}],51:[function(e,t,n){"use strict";function i(e){return r(e)&&e%1===0}var r=e("validate.io-number");t.exports=i},{"validate.io-number":53}],52:[function(e,t,n){"use strict";function i(e){return r(e)&&e>=0}var r=e("validate.io-integer");t.exports=i},{"validate.io-integer":51}],53:[function(e,t,n){"use strict";function i(e){return("number"==typeof e||"[object Number]"===Object.prototype.toString.call(e))&&e.valueOf()===e.valueOf()}t.exports=i},{}],54:[function(e,t,n){"use strict";function i(e){return"string"==typeof e}t.exports=i},{}],55:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var r=e("./cameras/cameras"),o=i(r),a=e("./controls/controls"),s=i(a),l=e("./core/core"),u=i(l),c=e("./geometries/geometries"),f=i(c),d=e("./helpers/helpers"),h=i(d),p=e("./loaders/loaders"),m=i(p),v=e("./models/models"),y=i(v),x=e("./parsers/parsers"),b=i(x),_=e("./shaders/shaders"),g=i(_),w=e("./widgets/widgets"),k=i(w);n["default"]={Cameras:o["default"],Controls:s["default"],Core:u["default"],Geometries:f["default"],Helpers:h["default"],Loaders:m["default"],Models:y["default"],Parsers:b["default"],Shaders:g["default"],Widgets:k["default"]},window.console.log("AMI - v0.0.9-dev")},{"./cameras/cameras":56,"./controls/controls":58,"./core/core":62,"./geometries/geometries":66,"./helpers/helpers":71,"./loaders/loaders":79,"./models/models":83,"./parsers/parsers":88,"./shaders/shaders":93,"./widgets/widgets":96}],56:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var r=e("./cameras.orthographic"),o=i(r);n["default"]={Orthographic:o["default"]}},{"./cameras.orthographic":57}],57:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":s(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":s(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=e("../core/core.intersections"),c=i(u),f=e("../core/core.validators"),d=i(f),h=function(e){function t(e,n,i,a,s,l){r(this,t);var u=o(this,Object.getPrototypeOf(t).call(this,e,n,i,a,s,l));return u._front=null,u._back=null,u._xCosine=null,u._yCosine=null,u._zCosine=null,u._controls=null,u._box=null,u._canvas={width:null,height:null},u._fromFront=!0,u._angle=0,u}return a(t,e),l(t,[{key:"init",value:function(e,t,n,i,r,o){if(!(d["default"].vector3(e)&&d["default"].vector3(t)&&d["default"].vector3(n)&&d["default"].box(r)&&i))return window.console.log("Invalid input provided."),!1;this._xCosine=e,this._yCosine=t,this._zCosine=n,this._controls=i,this._box=r,this._canvas=o;var a={position:this._box.center,direction:this._zCosine},s=c["default"].rayBox(a,this._box);this._front=s[0],this._back=s[1],this.up.set(this._yCosine.x,this._yCosine.y,this._yCosine.z),this._updateCanvas(),this._updatePositionAndTarget(this._front,this._back),this._updateMatrices()}},{key:"invertRows",value:function(){this.up.multiplyScalar(-1),this.invertColumns()}},{key:"invertColumns",value:function(){this.center();var e=this._oppositePosition(this.position);this._updatePositionAndTarget(e,this.position.clone()),this._updateMatrices(),this._fromFront=!this._fromFront;var t=1;this._fromFront||(t=-1),this._angle%=360,this._angle=360-this._angle}},{key:"center",value:function(){this._fromFront?this._updatePositionAndTarget(this._front,this._back):this._updatePositionAndTarget(this._back,this._front),this._updateMatrices()}},{key:"rotate",value:function(){var e=arguments.length<=0||void 0===arguments[0]?null:arguments[0];this.center();var t=90,n=1;this._fromFront||(n=-1),null===e?(t*=-n,this._angle+=90):(t=360-n*(e-this._angle),this._angle=e),this._angle%=360;var i=(new THREE.Matrix4).makeRotationAxis(this._zCosine,t*Math.PI/180);this.up.applyMatrix4(i),this._updateMatrices()}},{key:"fitBox",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],t=arguments.length<=1||void 0===arguments[1]?1.5:arguments[1],n=1;switch(e){case 0:n=t*this._computeZoom(this._canvas.width,this._xCosine);break;case 1:n=t*this._computeZoom(this._canvas.height,this._yCosine);break;case 2:n=t*Math.min(this._computeZoom(this._canvas.width,this._xCosine),this._computeZoom(this._canvas.height,this._yCosine))}return n?(this.zoom=n,void this.center()):!1}},{key:"_updateCanvas",value:function(){var e=2;this.left=-this._canvas.width/e,this.right=this._canvas.width/e,this.top=this._canvas.height/e,this.bottom=-this._canvas.height/e,this._updateMatrices(),this.controls.handleResize()}},{key:"_oppositePosition",value:function(e){var t=e.clone();t.sub(this._box.center);var n=(new THREE.Matrix4).makeRotationAxis(this.up,Math.PI);return t.applyMatrix4(n),t.add(this._box.center),t}},{key:"_computeZoom",value:function(e,t){if(!(e&&e>0))return window.console.log("Invalid dimension provided."),window.console.log(e),!1;var n={position:this._box.center.clone(),direction:t},i=c["default"].rayBox(n,this._box);return i.length<2?(window.console.log("Can not adjust the camera ( < 2 intersections)."),window.console.log(n),window.console.log(this._box),!1):e/i[0].distanceTo(i[1])}},{key:"_updatePositionAndTarget",value:function(e,t){this.position.set(e.x,e.y,e.z),this.lookAt(t.x,t.y,t.z),this._controls.target.set(t.x,t.y,t.z)}},{key:"_updateMatrices",value:function(){this._controls.update(),this.updateProjectionMatrix(),this.updateMatrixWorld()}},{key:"xCosine",set:function(e){this._xCosine=e},get:function(){return this._xCosine}},{key:"yCosine",set:function(e){this._yCosine=e},get:function(){return this._yCosine}},{key:"zCosine",set:function(e){this._zCosine=e},get:function(){return this._zCosine}},{key:"controls",set:function(e){this._controls=e},get:function(){return this._controls}},{key:"box",set:function(e){this._box=e},get:function(){return this._box}},{key:"canvas",set:function(e){this._canvas=e,this._updateCanvas()},get:function(){return this._canvas}},{key:"angle",set:function(e){this.rotate(e)},get:function(){return this._angle}}]),t}(THREE.OrthographicCamera);n["default"]=h},{"../core/core.intersections":61,"../core/core.validators":65}],58:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var r=e("./controls.trackball"),o=i(r),a=e("./controls.trackballortho"),s=i(a);n["default"]={Trackball:o["default"],TrackballOrtho:s["default"]}},{"./controls.trackball":59,"./controls.trackballortho":60}],59:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var s=function(e){function t(e,n){function o(e){m.enabled!==!1&&(window.removeEventListener("keydown",o),_=b,b===v.NONE&&(e.keyCode!==m.keys[v.ROTATE]||m.noRotate?e.keyCode!==m.keys[v.ZOOM]||m.noZoom?e.keyCode!==m.keys[v.PAN]||m.noPan||(b=v.PAN):b=v.ZOOM:b=v.ROTATE))}function a(e){m.enabled!==!1&&(b=_,window.addEventListener("keydown",o,!1))}function s(e){m.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),b===v.NONE&&(b=e.button),b!==v.ROTATE||m.noRotate?b!==v.ZOOM||m.noZoom?b!==v.PAN||m.noPan?b!==v.CUSTOM||m.noCustom||(z.copy(F(e.pageX,e.pageY)),O.copy(E)):(E.copy(F(e.pageX,e.pageY)),A.copy(E)):(I.copy(F(e.pageX,e.pageY)),T.copy(I)):(k.copy(U(e.pageX,e.pageY)),w.copy(k)),document.addEventListener("mousemove",l,!1),document.addEventListener("mouseup",u,!1),m.dispatchEvent(M))}function l(e){m.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),b!==v.ROTATE||m.noRotate?b!==v.ZOOM||m.noZoom?b!==v.PAN||m.noPan?b!==v.CUSTOM||m.noCustom||O.copy(F(e.pageX,e.pageY)):A.copy(F(e.pageX,e.pageY)):T.copy(F(e.pageX,e.pageY)):(w.copy(k),k.copy(U(e.pageX,e.pageY))))}function u(e){m.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),-1===m.forceState&&(b=v.NONE),document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",u),m.dispatchEvent(B))}function c(e){if(m.enabled!==!1){e.preventDefault(),e.stopPropagation();var t=0;e.wheelDelta?t=e.wheelDelta/40:e.detail&&(t=-e.detail/3),b!==v.CUSTOM?I.y+=.01*t:b===v.CUSTOM&&(z.y+=.01*t),m.dispatchEvent(M),m.dispatchEvent(B)}}function f(e){if(m.enabled!==!1){if(-1===m.forceState)switch(e.touches.length){case 1:b=v.TOUCH_ROTATE,k.copy(U(e.touches[0].pageX,e.touches[0].pageY)),w.copy(k);break;case 2:b=v.TOUCH_ZOOM;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;P=D=Math.sqrt(t*t+n*n);var i=(e.touches[0].pageX+e.touches[1].pageX)/2,r=(e.touches[0].pageY+e.touches[1].pageY)/2;E.copy(F(i,r)),A.copy(E);break;default:b=v.NONE}else switch(b){case 0:b=v.TOUCH_ROTATE,k.copy(U(e.touches[0].pageX,e.touches[0].pageY)),w.copy(k);break;case 1:case 4:if(e.touches.length>=2){b=v.TOUCH_ZOOM;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;P=D=Math.sqrt(t*t+n*n)}else b=v.ZOOM,I.copy(F(e.touches[0].pageX,e.touches[0].pageY)),T.copy(I);break;case 2:case 5:if(e.touches.length>=2){b=v.TOUCH_PAN;var i=(e.touches[0].pageX+e.touches[1].pageX)/2,r=(e.touches[0].pageY+e.touches[1].pageY)/2;E.copy(F(i,r)),A.copy(E)}else b=v.PAN,E.copy(F(e.touches[0].pageX,e.touches[0].pageY)),A.copy(E);break;case 99:b=v.CUSTOM;var i=(e.touches[0].pageX+e.touches[1].pageX)/2,r=(e.touches[0].pageY+e.touches[1].pageY)/2;z.copy(F(i,r)),O.copy(z);break;default:b=v.NONE}m.dispatchEvent(M)}}function d(e){if(m.enabled!==!1)if(e.preventDefault(),e.stopPropagation(),-1===m.forceState)switch(e.touches.length){case 1:w.copy(k),k.copy(U(e.touches[0].pageX,e.touches[0].pageY));break;case 2:var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;P=Math.sqrt(t*t+n*n);var i=(e.touches[0].pageX+e.touches[1].pageX)/2,r=(e.touches[0].pageY+e.touches[1].pageY)/2;A.copy(F(i,r));break;default:b=v.NONE}else switch(b){case 0:w.copy(k),k.copy(U(e.touches[0].pageX,e.touches[0].pageY));break;case 1:T.copy(F(e.touches[0].pageX,e.touches[0].pageY));break;case 2:A.copy(F(e.touches[0].pageX,e.touches[0].pageY));break;case 4:var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;P=Math.sqrt(t*t+n*n);break;case 5:var i=(e.touches[0].pageX+e.touches[1].pageX)/2,r=(e.touches[0].pageY+e.touches[1].pageY)/2;A.copy(F(i,r));break;case 99:var i=(e.touches[0].pageX+e.touches[1].pageX)/2,r=(e.touches[0].pageY+e.touches[1].pageY)/2;O.copy(F(i,r));break;default:b=v.NONE}}function h(e){if(m.enabled!==!1){if(-1===m.forceState){switch(e.touches.length){case 1:w.copy(k),k.copy(U(e.touches[0].pageX,e.touches[0].pageY));break;case 2:D=P=0;var t=(e.touches[0].pageX+e.touches[1].pageX)/2,n=(e.touches[0].pageY+e.touches[1].pageY)/2;A.copy(F(t,n)),E.copy(A)}b=v.NONE}else switch(b){case 0:w.copy(k),k.copy(U(e.touches[0].pageX,e.touches[0].pageY));break;case 1:case 2:break;case 4:D=P=0,b=v.ZOOM;break;case 5:if(e.touches.length>=2){var t=(e.touches[0].pageX+e.touches[1].pageX)/2,n=(e.touches[0].pageY+e.touches[1].pageY)/2;A.copy(F(t,n)),E.copy(A)}b=v.PAN;break;case 99:var t=(e.touches[0].pageX+e.touches[1].pageX)/2,n=(e.touches[0].pageY+e.touches[1].pageY)/2;O.copy(F(t,n)),z.copy(O);break;default:b=v.NONE}m.dispatchEvent(B)}}i(this,t);var p=r(this,Object.getPrototypeOf(t).call(this)),m=p,v={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM:4,TOUCH_PAN:5,CUSTOM:99};p.object=e,p.domElement=void 0!==n?n:document,p.enabled=!0,p.screen={left:0,top:0,width:0,height:0},p.rotateSpeed=1,p.zoomSpeed=1.2,p.panSpeed=.3,p.noRotate=!1,p.noZoom=!1,p.noPan=!1,p.noCustom=!1,p.forceState=-1,p.staticMoving=!1,p.dynamicDampingFactor=.2,p.minDistance=0,p.maxDistance=1/0,p.keys=[65,83,68],p.target=new THREE.Vector3;var y=1e-6,x=new THREE.Vector3,b=v.NONE,_=v.NONE,g=new THREE.Vector3,w=new THREE.Vector2,k=new THREE.Vector2,C=new THREE.Vector3,S=0,I=new THREE.Vector2,T=new THREE.Vector2,D=0,P=0,E=new THREE.Vector2,A=new THREE.Vector2,z=new THREE.Vector2,O=new THREE.Vector2;p.target0=p.target.clone(),p.position0=p.object.position.clone(),p.up0=p.object.up.clone();var R={type:"change"},M={type:"start"},B={type:"end"};p.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}},p.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)};var F=function(){var e=new THREE.Vector2;return function(t,n){return e.set((t-m.screen.left)/m.screen.width,(n-m.screen.top)/m.screen.height),e}}(),U=function(){var e=new THREE.Vector2;return function(t,n){return e.set((t-.5*m.screen.width-m.screen.left)/(.5*m.screen.width),(m.screen.height+2*(m.screen.top-n))/m.screen.width),e}}();return p.rotateCamera=function(){var e,t=new THREE.Vector3,n=new THREE.Quaternion,i=new THREE.Vector3,r=new THREE.Vector3,o=new THREE.Vector3,a=new THREE.Vector3;return function(){a.set(k.x-w.x,k.y-w.y,0),e=a.length(),e?(g.copy(m.object.position).sub(m.target),i.copy(g).normalize(),r.copy(m.object.up).normalize(),o.crossVectors(r,i).normalize(),r.setLength(k.y-w.y),o.setLength(k.x-w.x),a.copy(r.add(o)),t.crossVectors(a,g).normalize(),e*=m.rotateSpeed,n.setFromAxisAngle(t,e),g.applyQuaternion(n),m.object.up.applyQuaternion(n),C.copy(t),S=e):!m.staticMoving&&S&&(S*=Math.sqrt(1-m.dynamicDampingFactor),g.copy(m.object.position).sub(m.target),n.setFromAxisAngle(C,S),g.applyQuaternion(n),m.object.up.applyQuaternion(n)),w.copy(k)}}(),p.zoomCamera=function(){var e;b===v.TOUCH_ZOOM?(e=D/P,D=P,g.multiplyScalar(e)):(e=1+(T.y-I.y)*m.zoomSpeed,1!==e&&e>0&&(g.multiplyScalar(e),m.staticMoving?I.copy(T):I.y+=(T.y-I.y)*this.dynamicDampingFactor))},p.panCamera=function(){var e=new THREE.Vector2,t=new THREE.Vector3,n=new THREE.Vector3;return function(){e.copy(A).sub(E),e.lengthSq()&&(e.multiplyScalar(g.length()*m.panSpeed),n.copy(g).cross(m.object.up).setLength(e.x),n.add(t.copy(m.object.up).setLength(e.y)),m.object.position.add(n),m.target.add(n),m.staticMoving?E.copy(A):E.add(e.subVectors(A,E).multiplyScalar(m.dynamicDampingFactor)))}}(),p.checkDistances=function(){m.noZoom&&m.noPan||(g.lengthSq()>m.maxDistance*m.maxDistance&&m.object.position.addVectors(m.target,g.setLength(m.maxDistance)),g.lengthSq()<m.minDistance*m.minDistance&&m.object.position.addVectors(m.target,g.setLength(m.minDistance)))},p.update=function(){g.subVectors(m.object.position,m.target),m.noRotate||m.rotateCamera(),m.noZoom||m.zoomCamera(),m.noPan||m.panCamera(),m.noCustom||m.custom(z,O),m.object.position.addVectors(m.target,g),m.checkDistances(),m.object.lookAt(m.target),x.distanceToSquared(m.object.position)>y&&(m.dispatchEvent(R),x.copy(m.object.position))},p.reset=function(){b=v.NONE,_=v.NONE,m.target.copy(m.target0),m.object.position.copy(m.position0),m.object.up.copy(m.up0),g.subVectors(m.object.position,m.target),m.object.lookAt(m.target),m.dispatchEvent(R),x.copy(m.object.position)},p.setState=function(e){m.forceState=e,_=e,b=e},p.custom=function(e,t){},p.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),p.domElement.addEventListener("mousedown",s,!1),p.domElement.addEventListener("mousewheel",c,!1),p.domElement.addEventListener("DOMMouseScroll",c,!1),p.domElement.addEventListener("touchstart",f,!1),p.domElement.addEventListener("touchend",h,!1),p.domElement.addEventListener("touchmove",d,!1),window.addEventListener("keydown",o,!1),window.addEventListener("keyup",a,!1),p.handleResize(),p.update(),p}return o(t,e),t}(THREE.EventDispatcher);n["default"]=s},{}],60:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var s=function(e){function t(e,n){function o(e){y.enabled!==!1&&(window.removeEventListener("keydown",o),w=g,g===x.NONE&&(e.keyCode!==y.keys[x.ROTATE]||y.noRotate?e.keyCode!==y.keys[x.ZOOM]||y.noZoom?e.keyCode!==y.keys[x.PAN]||y.noPan||(g=x.PAN):g=x.ZOOM:g=x.ROTATE))}function a(e){y.enabled!==!1&&(g=w,window.addEventListener("keydown",o,!1))}function s(e){y.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),g===x.NONE&&(g=e.button),(g!==x.ROTATE||y.noRotate)&&(g!==x.ZOOM||y.noZoom?g!==x.PAN||y.noPan||(D.copy(O(e.pageX,e.pageY)),P.copy(D)):(C.copy(O(e.pageX,e.pageY)),S.copy(C))),document.addEventListener("mousemove",l,!1),document.addEventListener("mouseup",u,!1),y.dispatchEvent(A))}function l(e){y.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),(g!==x.ROTATE||y.noRotate)&&(g!==x.ZOOM||y.noZoom?g!==x.PAN||y.noPan||P.copy(O(e.pageX,e.pageY)):S.copy(O(e.pageX,e.pageY))))}function u(e){y.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),g=x.NONE,document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",u),y.dispatchEvent(z))}function c(e){if(y.enabled!==!1){e.preventDefault(),e.stopPropagation();var t=0;e.wheelDelta?t=e.wheelDelta/40:e.detail&&(t=-e.detail/3),y.dispatchEvent({type:"OnScroll",delta:t}),y.dispatchEvent(A),y.dispatchEvent(z)}}function f(e){if(y.enabled!==!1){switch(e.touches.length){case 1:g=x.TOUCH_ROTATE;break;case 2:g=x.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;T=I=Math.sqrt(t*t+n*n);var i=(e.touches[0].pageX+e.touches[1].pageX)/2,r=(e.touches[0].pageY+e.touches[1].pageY)/2;D.copy(O(i,r)),P.copy(D);break;default:g=x.NONE}y.dispatchEvent(A)}}function d(e){if(y.enabled!==!1)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:break;case 2:var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;T=Math.sqrt(t*t+n*n);var i=(e.touches[0].pageX+e.touches[1].pageX)/2,r=(e.touches[0].pageY+e.touches[1].pageY)/2;P.copy(O(i,r));break;default:g=x.NONE}}function h(e){if(y.enabled!==!1){switch(e.touches.length){case 1:break;case 2:I=T=0;var t=(e.touches[0].pageX+e.touches[1].pageX)/2,n=(e.touches[0].pageY+e.touches[1].pageY)/2;P.copy(O(t,n)),D.copy(P)}g=x.NONE,y.dispatchEvent(z)}}function p(e){e.preventDefault()}var m=arguments.length<=2||void 0===arguments[2]?{NONE:-1,ROTATE:1,ZOOM:2,PAN:0,SCROLL:4,TOUCH_ROTATE:4,TOUCH_ZOOM_PAN:5}:arguments[2];i(this,t);var v=r(this,Object.getPrototypeOf(t).call(this)),y=v,x=m;v.object=e,v.domElement=void 0!==n?n:document,v.enabled=!0,v.screen={left:0,top:0,width:0,height:0},v.radius=0,v.zoomSpeed=1.2,v.noZoom=!1,v.noPan=!1,v.staticMoving=!1,v.dynamicDampingFactor=.2,v.keys=[65,83,68],v.target=new THREE.Vector3;var b=1e-6,_=!0,g=x.NONE,w=x.NONE,k=new THREE.Vector3,C=new THREE.Vector2,S=new THREE.Vector2,I=0,T=0,D=new THREE.Vector2,P=new THREE.Vector2;v.target0=v.target.clone(),v.position0=v.object.position.clone(),v.up0=v.object.up.clone(),v.left0=v.object.left,v.right0=v.object.right,v.top0=v.object.top,v.bottom0=v.object.bottom;var E={type:"change"},A={type:"start"},z={type:"end"};v.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{
var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}this.radius=.5*Math.min(this.screen.width,this.screen.height),this.left0=this.object.left,this.right0=this.object.right,this.top0=this.object.top,this.bottom0=this.object.bottom},v.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)};var O=function(){var e=new THREE.Vector2;return function(t,n){return e.set((t-y.screen.left)/y.screen.width,(n-y.screen.top)/y.screen.height),e}}();return v.zoomCamera=function(){if(g===x.TOUCH_ZOOM_PAN){var e=T/I;I=T,y.object.zoom*=e,_=!0}else{var e=1+(S.y-C.y)*y.zoomSpeed;Math.abs(e-1)>b&&e>0&&(y.object.zoom/=e,y.staticMoving?C.copy(S):C.y+=(S.y-C.y)*this.dynamicDampingFactor,_=!0)}},v.panCamera=function(){var e=new THREE.Vector2,t=new THREE.Vector3,n=new THREE.Vector3;return function(){if(e.copy(P).sub(D),e.lengthSq()){var i=(y.object.right-y.object.left)/y.object.zoom,r=(y.object.top-y.object.bottom)/y.object.zoom;e.x*=i,e.y*=r,n.copy(k).cross(y.object.up).setLength(e.x),n.add(t.copy(y.object.up).setLength(e.y)),y.object.position.add(n),y.target.add(n),y.staticMoving?D.copy(P):D.add(e.subVectors(P,D).multiplyScalar(y.dynamicDampingFactor)),_=!0}}}(),v.update=function(){k.subVectors(y.object.position,y.target),y.noZoom||(y.zoomCamera(),_&&y.object.updateProjectionMatrix()),y.noPan||y.panCamera(),y.object.position.addVectors(y.target,k),y.object.lookAt(y.target),_&&(y.dispatchEvent(E),_=!1)},v.reset=function(){g=x.NONE,w=x.NONE,y.target.copy(y.target0),y.object.position.copy(y.position0),y.object.up.copy(y.up0),k.subVectors(y.object.position,y.target),y.object.left=y.left0,y.object.right=y.right0,y.object.top=y.top0,y.object.bottom=y.bottom0,y.object.lookAt(y.target),y.dispatchEvent(E),_=!1},v.dispose=function(){this.domElement.removeEventListener("contextmenu",p,!1),this.domElement.removeEventListener("mousedown",s,!1),this.domElement.removeEventListener("mousewheel",c,!1),this.domElement.removeEventListener("MozMousePixelScroll",c,!1),this.domElement.removeEventListener("touchstart",f,!1),this.domElement.removeEventListener("touchend",h,!1),this.domElement.removeEventListener("touchmove",d,!1),document.removeEventListener("mousemove",l,!1),document.removeEventListener("mouseup",u,!1),window.removeEventListener("keydown",o,!1),window.removeEventListener("keyup",a,!1)},v.domElement.addEventListener("contextmenu",p,!1),v.domElement.addEventListener("mousedown",s,!1),v.domElement.addEventListener("mousewheel",c,!1),v.domElement.addEventListener("MozMousePixelScroll",c,!1),v.domElement.addEventListener("touchstart",f,!1),v.domElement.addEventListener("touchend",h,!1),v.domElement.addEventListener("touchmove",d,!1),window.addEventListener("keydown",o,!1),window.addEventListener("keyup",a,!1),v.handleResize(),v.update(),v}return o(t,e),t}(THREE.EventDispatcher);n["default"]=s},{}],61:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=e("./core.utils"),s=i(a),l=e("./core.validators"),u=i(l),c=function(){function e(){r(this,e)}return o(e,null,[{key:"aabbPlane",value:function(e,t){var n=[];if(!this.validateAabb(e)||!this.validatePlane(t))return window.console.log("Invalid aabb or plane provided."),!1;var i=new THREE.Matrix4;i.getInverse(e.toAABB);var r=t.direction.clone().applyMatrix4(e.toAABB),o=new THREE.Vector3(0,0,0).applyMatrix4(e.toAABB),a=this.posdir(t.position.clone().applyMatrix4(e.toAABB),new THREE.Vector3(r.x-o.x,r.y-o.y,r.z-o.z).normalize()),l=s["default"].bbox(e.center,e.halfDimensions),u=new THREE.Vector3(new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1)),c=this.posdir(new THREE.Vector3(e.center.x-e.halfDimensions.x,e.center.y-e.halfDimensions.y,e.center.z-e.halfDimensions.z),u.x);this.rayPlaneInBBox(c,a,l,n),c.direction=u.y,this.rayPlaneInBBox(c,a,l,n),c.direction=u.z,this.rayPlaneInBBox(c,a,l,n);var f=this.posdir(new THREE.Vector3(e.center.x+e.halfDimensions.x,e.center.y+e.halfDimensions.y,e.center.z+e.halfDimensions.z),u.x);this.rayPlaneInBBox(f,a,l,n),f.direction=u.y,this.rayPlaneInBBox(f,a,l,n),f.direction=u.z,this.rayPlaneInBBox(f,a,l,n);var d=this.posdir(new THREE.Vector3(e.center.x+e.halfDimensions.x,e.center.y-e.halfDimensions.y,e.center.z-e.halfDimensions.z),u.y);this.rayPlaneInBBox(d,a,l,n),d.direction=u.z,this.rayPlaneInBBox(d,a,l,n);var h=this.posdir(new THREE.Vector3(e.center.x-e.halfDimensions.x,e.center.y+e.halfDimensions.y,e.center.z-e.halfDimensions.z),u.x);this.rayPlaneInBBox(h,a,l,n),h.direction=u.z,this.rayPlaneInBBox(h,a,l,n);var p=this.posdir(new THREE.Vector3(e.center.x-e.halfDimensions.x,e.center.y-e.halfDimensions.y,e.center.z+e.halfDimensions.z),u.x);return this.rayPlaneInBBox(p,a,l,n),p.direction=u.y,this.rayPlaneInBBox(p,a,l,n),n.map(function(e){return e.applyMatrix4(i)}),n}},{key:"rayPlane",value:function(e,t){if(0!==e.direction.dot(t.direction)){var n=(t.direction.x*(t.position.x-e.position.x)+t.direction.y*(t.position.y-e.position.y)+t.direction.z*(t.position.z-e.position.z))/(t.direction.x*e.direction.x+t.direction.y*e.direction.y+t.direction.z*e.direction.z),i=new THREE.Vector3(e.position.x+n*e.direction.x,e.position.y+n*e.direction.y,e.position.z+n*e.direction.z);return i}return null}},{key:"rayBox",value:function(e,t){var n=[],i=s["default"].bbox(t.center,t.halfDimensions),r=this.posdir(new THREE.Vector3(i.min.x,t.center.y,t.center.z),new THREE.Vector3(-1,0,0));return this.rayPlaneInBBox(e,r,i,n),r=this.posdir(new THREE.Vector3(i.max.x,t.center.y,t.center.z),new THREE.Vector3(1,0,0)),this.rayPlaneInBBox(e,r,i,n),r=this.posdir(new THREE.Vector3(t.center.x,i.min.y,t.center.z),new THREE.Vector3(0,-1,0)),this.rayPlaneInBBox(e,r,i,n),r=this.posdir(new THREE.Vector3(t.center.x,i.max.y,t.center.z),new THREE.Vector3(0,1,0)),this.rayPlaneInBBox(e,r,i,n),r=this.posdir(new THREE.Vector3(t.center.x,t.center.y,i.min.z),new THREE.Vector3(0,0,-1)),this.rayPlaneInBBox(e,r,i,n),r=this.posdir(new THREE.Vector3(t.center.x,t.center.y,i.max.z),new THREE.Vector3(0,0,1)),this.rayPlaneInBBox(e,r,i,n),n}},{key:"rayPlaneInBBox",value:function(e,t,n,i){var r=this.rayPlane(e,t);r&&this.inBBox(r,n)&&(i.find(this.findIntersection(r))||i.push(r))}},{key:"findIntersection",value:function(e){return function(t,n,i){return e.x===t.x&&e.y===t.y&&e.z===t.z}}},{key:"inBBox",value:function(e,t){var n=1e-4;return!!(e&&e.x>=t.min.x-n&&e.y>=t.min.y-n&&e.z>=t.min.z-n&&e.x<=t.max.x+n&&e.y<=t.max.y+n&&e.z<=t.max.z+n)}},{key:"posdir",value:function(e,t){return{position:e,direction:t}}},{key:"validatePlane",value:function(e){return null===e?(window.console.log("Invalid plane."),window.console.log(e),!1):u["default"].vector3(e.position)?u["default"].vector3(e.direction)?!0:(window.console.log("Invalid plane.direction."),window.console.log(e.direction),!1):(window.console.log("Invalid plane.position."),window.console.log(e.position),!1)}},{key:"validateAabb",value:function(e){return null===e?(window.console.log("Invalid aabb."),window.console.log(e),!1):u["default"].matrix4(e.toAABB)?u["default"].vector3(e.center)?u["default"].vector3(e.halfDimensions)&&e.halfDimensions.x>=0&&e.halfDimensions.y>=0&&e.halfDimensions.z>=0?!0:(window.console.log("Invalid aabb.halfDimensions."),window.console.log(e.halfDimensions),!1):(window.console.log("Invalid aabb.center."),window.console.log(e.center),!1):(window.console.log("Invalid aabb.toAABB: "),window.console.log(e.toAABB),!1)}}]),e}();n["default"]=c},{"./core.utils":64,"./core.validators":65}],62:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var r=e("./core.intersections"),o=i(r),a=e("./core.pack"),s=(i(a),e("./core.validators")),l=i(s),u=e("./core.utils"),c=i(u);n["default"]={Intersections:o["default"],Utils:c["default"],Validators:l["default"]}},{"./core.intersections":61,"./core.pack":63,"./core.utils":64,"./core.validators":65}],63:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function o(){i(this,o)};n["default"]=r},{}],64:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=e("./core.validators"),s=i(a),l=function(){function e(){r(this,e)}return o(e,null,[{key:"bbox",value:function(e,t){if(!s["default"].vector3(e)||!s["default"].vector3(t))return window.console.log("Invalid center or plane halfDimensions."),!1;if(!(t.x>=0&&t.y>=0&&t.z>=0))return window.console.log("halfDimensions must be >= 0."),window.console.log(t),!1;var n=e.clone().sub(t),i=e.clone().add(t);return{min:n,max:i}}}]),e}();n["default"]=l},{"./core.validators":65}],65:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(){i(this,e)}return r(e,null,[{key:"matrix4",value:function(e){return!(null===e||"undefined"==typeof e||!e.hasOwnProperty("elements")||16!==e.elements.length||"function"!=typeof e.identity||"function"!=typeof e.copy||"function"!=typeof e.determinant)}},{key:"vector3",value:function(e){return!(!(null!==e&&"undefined"!=typeof e&&e.hasOwnProperty("x")&&e.hasOwnProperty("y")&&e.hasOwnProperty("z"))||e.hasOwnProperty("w"))}},{key:"box",value:function(e){return!!(null!==e&&"undefined"!=typeof e&&e.hasOwnProperty("center")&&this.vector3(e.center)&&e.hasOwnProperty("halfDimensions")&&this.vector3(e.halfDimensions)&&e.halfDimensions.x>=0&&e.halfDimensions.y>=0&&e.halfDimensions.z>=0)}},{key:"ray",value:function(e){return!!(null!==e&&"undefined"!=typeof e&&e.hasOwnProperty("position")&&this.vector3(e.position)&&e.hasOwnProperty("direction")&&this.vector3(e.direction))}}]),e}();n["default"]=o},{}],66:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var r=e("./geometries.slice"),o=i(r),a=e("./geometries.voxel"),s=i(a);n["default"]={Slice:o["default"],Voxel:s["default"]}},{"./geometries.slice":67,"./geometries.voxel":68}],67:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":s(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":s(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=e("../../src/core/core.intersections"),c=i(u),f=function(e){function t(e,n,i,a){var s=arguments.length<=4||void 0===arguments[4]?new THREE.Matrix4:arguments[4];r(this,t);var l={halfDimensions:e,center:n,toAABB:s},u={position:i,direction:a},f=c["default"].aabbPlane(l,u);if(f.length<3)throw window.console.log("WARNING: Less than 3 intersections between AABB and Plane."),window.console.log("AABB"),window.console.log(l),window.console.log("Plane"),window.console.log(u),window.console.log("exiting..."),"geometries.slice has less than 3 intersections, can not create a valid geometry.";var d=t.orderIntersections(f,a),h=t.shape(d),p=o(this,Object.getPrototypeOf(t).call(this,h));return p.type="SliceGeometry",p.vertices=d,p.verticesNeedUpdate=!0,p}return a(t,e),l(t,null,[{key:"shape",value:function n(e){var n=new THREE.Shape;n.moveTo(e[0].xy.x,e[0].xy.y);for(var t=1;t<e.length;t++)n.lineTo(e[t].xy.x,e[t].xy.y);return n.lineTo(e[0].xy.x,e[0].xy.y),n}},{key:"centerOfMass",value:function i(e){for(var i=new THREE.Vector3(0,0,0),t=0;t<e.length;t++)i.x+=e[t].x,i.y+=e[t].y,i.z+=e[t].z;return i.divideScalar(e.length),i}},{key:"orderIntersections",value:function(e,n){for(var i=t.centerOfMass(e),r=new THREE.Vector3(e[0].x-i.x,e[0].y-i.y,e[0].z-i.z).normalize(),o=new THREE.Vector3(0,0,0).crossVectors(r,n).normalize(),a=[],s=0;s<e.length;s++){var l=new THREE.Vector3(e[s].x,e[s].y,e[s].z);l.direction=new THREE.Vector3(e[s].x-i.x,e[s].y-i.y,e[s].z-i.z).normalize();var u=r.dot(l.direction),c=o.dot(l.direction);l.xy={x:u,y:c};var f=Math.atan2(c,u)*(180/Math.PI);l.angle=f,a.push(l)}return a.sort(function(e,t){return e.angle-t.angle}),a}}]),t}(THREE.ShapeGeometry);n["default"]=f},{"../../src/core/core.intersections":61}],68:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),l=function(e){function t(e){i(this,t);var n=r(this,Object.getPrototypeOf(t).call(this,1,1,1));return n._location=e,n.applyMatrix((new THREE.Matrix4).makeTranslation(n._location.x,n._location.y,n._location.z)),n.verticesNeedUpdate=!0,n}return o(t,e),s(t,[{key:"resetVertices",value:function(){this.vertices[0].set(.5,.5,.5),this.vertices[1].set(.5,.5,-.5),this.vertices[2].set(.5,-.5,.5),this.vertices[3].set(.5,-.5,-.5),this.vertices[4].set(-.5,.5,-.5),this.vertices[5].set(-.5,.5,.5),this.vertices[6].set(-.5,-.5,-.5),this.vertices[7].set(-.5,-.5,.5)}},{key:"location",set:function(e){this._location=e,this.vertices[0].set(.5,.5,.5),this.vertices[1].set(.5,.5,-.5),this.vertices[2].set(.5,-.5,.5),this.vertices[3].set(.5,-.5,-.5),this.vertices[4].set(-.5,.5,-.5),this.vertices[5].set(-.5,.5,.5),this.vertices[6].set(-.5,-.5,-.5),this.vertices[7].set(-.5,-.5,.5),this.applyMatrix((new THREE.Matrix4).makeTranslation(this._location.x,this._location.y,this._location.z)),this.verticesNeedUpdate=!0},get:function(){return this._location}}]),t}(THREE.BoxGeometry);n["default"]=l},{}],69:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),l=function(e){function t(e){i(this,t);var n=r(this,Object.getPrototypeOf(t).call(this));return n._helpersSlice=e,n._visible=!0,n._color=16711680,n._material=null,n._geometry=null,n._mesh=null,n._create(),n}return o(t,e),s(t,[{key:"_create",value:function(){if(this._material||(this._material=new THREE.LineBasicMaterial({color:this._color,linewidth:1})),this._helpersSlice.geometry.vertices){this._geometry=new THREE.Geometry;for(var e=0;e<this._helpersSlice.geometry.vertices.length;e++)this._geometry.vertices.push(this._helpersSlice.geometry.vertices[e]);this._geometry.vertices.push(this._helpersSlice.geometry.vertices[0]),this._mesh=new THREE.Line(this._geometry,this._material),"IJK"===this._helpersSlice.aabbSpace&&this._mesh.applyMatrix(this._helpersSlice.stack.ijk2LPS),this._mesh.visible=this._visible,this.add(this._mesh)}}},{key:"_update",value:function(){this._mesh&&(this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh=null),this._create()}},{key:"helpersSlice",set:function(e){this._helpersSlice=e,this._update()},get:function(){return this._helpersSlice}},{key:"visible",set:function(e){this._visible=e,this._mesh&&(this._mesh.visible=this._visible)},get:function(){return this._visible}},{key:"color",set:function(e){this._color=e,this._material&&this._material.color.set(this._color)},get:function(){return this._color}}]),t}(THREE.Object3D);n["default"]=l},{}],70:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),l=function(e){function t(e){i(this,t);var n=r(this,Object.getPrototypeOf(t).call(this));return n._stack=e,n._visible=!0,n._color=6419187,n._material=null,n._geometry=null,n._mesh=null,n._create(),n}return o(t,e),s(t,[{key:"_create",value:function(){var e=this._stack.dimensionsIJK,t=this._stack.halfDimensionsIJK,n=new THREE.Vector3(-.5,-.5,-.5);this._geometry=new THREE.BoxGeometry(e.x,e.y,e.z),this._geometry.applyMatrix((new THREE.Matrix4).makeTranslation(t.x+n.x,t.y+n.y,t.z+n.z)),this._material=new THREE.MeshBasicMaterial({wireframe:!0,color:this._color}),this._mesh=new THREE.Mesh(this._geometry,this._material),this._mesh.applyMatrix(this._stack.ijk2LPS),this._mesh.visible=this._visible,this.add(this._mesh)}},{key:"_update",value:function(){this._mesh&&(this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.geometry=null,this._mesh.material.dispose(),this._mesh.material=null,this._mesh=null),this._create()}},{key:"visible",set:function(e){this._visible=e,this._mesh&&(this._mesh.visible=this._visible)},get:function(){return this._visible}},{key:"color",set:function(e){this._color=e,this._material&&this._material.color.set(this._color)},get:function(){return this._color}}]),t}(THREE.Object3D);n["default"]=l},{}],71:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var r=e("./helpers.border"),o=i(r),a=e("./helpers.boundingbox"),s=i(a),l=e("./helpers.lut"),u=i(l),c=e("./helpers.progressbar"),f=i(c),d=e("./helpers.slice"),h=i(d),p=e("./helpers.stack"),m=i(p),v=e("./helpers.volumerendering"),y=i(v),x=e("./helpers.voxel"),b=i(x);n["default"]={Border:o["default"],BoundingBox:s["default"],Lut:u["default"],ProgressBar:f["default"],Slice:h["default"],Stack:m["default"],VolumeRendering:y["default"],Voxel:b["default"]}},{"./helpers.border":69,"./helpers.boundingbox":70,"./helpers.lut":72,"./helpers.progressbar":73,"./helpers.slice":74,"./helpers.stack":75,"./helpers.volumerendering":76,"./helpers.voxel":77}],72:[function(e,t,n){"use strict";function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=function(){function e(t){var n=arguments.length<=1||void 0===arguments[1]?"default":arguments[1],o=arguments.length<=2||void 0===arguments[2]?"linear":arguments[2],a=arguments.length<=3||void 0===arguments[3]?[[0,0,0,0],[1,1,1,1]]:arguments[3],s=arguments.length<=4||void 0===arguments[4]?[[0,0],[1,1]]:arguments[4];r(this,e),this._containerID=t,this._color=a,this._lut=n,this._luts=i({},n,a),this._opacity=s,this._lutO=o,this._lutsO=i({},o,s),this.initCanvas(),this.paintCanvas()}return o(e,[{key:"initCanvas",value:function(){this._canvasContainer=this.initCanvasContainer(this._containerID),this._canvasBg=this.createCanvas(),this._canvasContainer.appendChild(this._canvasBg),this._canvas=this.createCanvas(),this._canvasContainer.appendChild(this._canvas)}},{key:"initCanvasContainer",value:function(e){var t=document.getElementById(e);return t.style.width="256 px",t.style.height="128 px",t.style.border="1px solid #F9F9F9",t}},{key:"createCanvas",value:function(){var e=document.createElement("canvas");return e.height=16,e.width=256,e}},{key:"paintCanvas",value:function(){var e=this._canvas.getContext("2d");e.clearRect(0,0,this._canvas.width,this._canvas.height),e.globalCompositeOperation="source-over";for(var t=e.createLinearGradient(0,0,this._canvas.width,this._canvas.height),n=0;n<this._color.length;n++)t.addColorStop(this._color[n][0],"rgba("+Math.round(255*this._color[n][1])+", "+Math.round(255*this._color[n][2])+", "+Math.round(255*this._color[n][3])+", 1)");e.fillStyle=t,e.fillRect(0,0,this._canvas.width,this._canvas.height),e.globalCompositeOperation="destination-in";for(var i=e.createLinearGradient(0,0,this._canvas.width,this._canvas.height),r=0;r<this._opacity.length;r++)i.addColorStop(this._opacity[r][0],"rgba(255, 255, 255, "+this._opacity[r][1]+")");e.fillStyle=i,e.fillRect(0,0,this._canvas.width,this._canvas.height)}},{key:"lutsAvailable",value:function(){var e=arguments.length<=0||void 0===arguments[0]?"color":arguments[0],t=[],n=this._luts;"color"!==e&&(n=this._lutsO);for(var i in n)t.push(i);return t}},{key:"texture",get:function(){var e=new THREE.Texture(this._canvas);return e.mapping=THREE.UVMapping,e.wrapS=e.wrapT=THREE.ClampToEdgeWrapping,e.magFilter=e.minFilter=THREE.NearestFilter,e.premultiplyAlpha=!0,e.needsUpdate=!0,e}},{key:"lut",set:function(e){this._color=this._luts[e],this._lut=e,this.paintCanvas()},get:function(){return this._lut}},{key:"luts",set:function(e){this._luts=e},get:function(){return this._luts}},{key:"lutO",set:function(e){this._opacity=this._lutsO[e],this._lutO=e,this.paintCanvas()},get:function(){return this._lutO}},{key:"lutsO",set:function(e){this._lutsO=e},get:function(){return this._lutsO}}],[{key:"presetLuts",value:function(){return{"default":[[0,0,0,0],[1,1,1,1]],spectrum:[[0,0,0,0],[.1,0,0,1],[.33,0,1,1],[.5,0,1,0],[.66,1,1,0],[.9,1,0,0],[1,1,1,1]],hot_and_cold:[[0,0,0,1],[.15,0,1,1],[.3,0,1,0],[.45,0,0,0],[.5,0,0,0],[.55,0,0,0],[.7,1,1,0],[.85,1,0,0],[1,1,1,1]],gold:[[0,0,0,0],[.13,.19,.03,0],[.25,.39,.12,0],[.38,.59,.26,0],[.5,.8,.46,.08],[.63,.99,.71,.21],[.75,.99,.88,.34],[.88,.99,.99,.48],[1,.9,.95,.61]],red:[[0,.75,0,0],[.5,1,.5,0],[.95,1,1,0],[1,1,1,1]],green:[[0,0,.75,0],[.5,.5,1,0],[.95,1,1,0],[1,1,1,1]],blue:[[0,0,0,1],[.5,0,.5,1],[.95,0,1,1],[1,1,1,1]],walking_dead:[[0,.1,1,1],[1,1,1,1]]}}},{key:"presetLutsO",value:function(){return{linear:[[0,0],[1,1]],lowpass:[[0,.8],[.2,.6],[.3,.1],[1,0]],bandpass:[[0,0],[.4,.8],[.6,.8],[1,0]],highpass:[[0,0],[.7,.1],[.8,.6],[1,.8]],flat:[[0,.7],[1,1]]}}}]),e}();n["default"]=a},{}],73:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(t){i(this,e),this._container=t,this._modes={load:{name:"load",color:"#FFF56F"},parse:{name:"parse",color:"#2196F3"}},this.requestAnimationFrameID=null,this._mode=null,this._value=null,this._total=null,this.init()}return r(e,[{key:"free",value:function(){var e=this._container.getElementsByClassName("progress container");e.length>0&&e[0].parentNode.removeChild(e[0]),e=null,window.cancelAnimationFrame(this.requestAnimationFrameID)}},{key:"init",value:function(){var e=this._domContainer();for(var t in this._modes)if(this._modes.hasOwnProperty(t)){var n=this._domBar(this._modes[t]);e.appendChild(n),n=null}this._container.appendChild(e),e=null,this.updateUI()}},{key:"update",value:function(e,t,n){this._mode=n,this._value=e,0===t?(this._total=e,this._value=Math.random()*e):this._total=t}},{key:"updateUI",value:function(){var e=this;if(this.requestAnimationFrameID=requestAnimationFrame(function(){e.updateUI()}),!(this._modes.hasOwnProperty(this._mode)&&this._modes[this._mode].hasOwnProperty("name")&&this._modes[this._mode].hasOwnProperty("color")))return!1;var t=Math.round(this._value/this._total*100),n=this._modes[this._mode].color,i=this._container.getElementsByClassName("progress "+this._modes[this._mode].name);i.length>0&&(i[0].style.borderColor=n,i[0].style.width=t+"%"),i=null}},{key:"_domContainer",value:function(){var e=document.createElement("div");return e.classList.add("progress"),e.classList.add("container"),e.style.width="100%",e.style.height="8px",e.style.position="absolute",e.style.backgroundColor="rgba(158, 158, 158, 0.5)",e.style.top="0",e.style.zIndex="1",e}},{key:"_domBar",value:function(e){if(!e.hasOwnProperty("name")||!e.hasOwnProperty("color"))return window.console.log("Invalid mode provided."),window.console.log(e),!1;var t=document.createElement("div");return t.classList.add(e.name),t.classList.add("progress"),t.style.border="2px solid "+e.color,t.style.width="0%",t}}]),e}();n["default"]=o},{}],74:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":s(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":s(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=e("../../src/geometries/geometries.slice"),c=i(u),f=e("../../src/shaders/shaders.data"),d=i(f),h=function(e){function t(e){var n=arguments.length<=1||void 0===arguments[1]?0:arguments[1],i=arguments.length<=2||void 0===arguments[2]?new THREE.Vector3(0,0,0):arguments[2],a=arguments.length<=3||void 0===arguments[3]?new THREE.Vector3(0,0,1):arguments[3],s=arguments.length<=4||void 0===arguments[4]?"IJK":arguments[4];r(this,t);var l=o(this,Object.getPrototypeOf(t).call(this));return l._stack=e,l._invert=l._stack.invert,l._lut="none",l._lutTexture=null,l._intensityAuto=!0,l._interpolation=1,l._index=n,l._windowWidth=null,l._windowCenter=null,l._rescaleSlope=null,l._rescaleIntercept=null,l._planePosition=i,l._planeDirection=a,l._aaBBspace=s,l._material=null,l._uniforms=d["default"].uniforms(),l._geometry=null,l._mesh=null,l._visible=!0,l._init(),l._create(),l}return a(t,e),l(t,[{key:"_init",value:function(){if(this._stack&&this._stack._prepared&&this._stack._packed)if("IJK"===this._aaBBspace)this._halfDimensions=this._stack.halfDimensionsIJK,this._center=new THREE.Vector3(this._stack.halfDimensionsIJK.x-.5,this._stack.halfDimensionsIJK.y-.5,this._stack.halfDimensionsIJK.z-.5),this._toAABB=new THREE.Matrix4;else{var e=this._stack.AABBox();this._halfDimensions=e.clone().multiplyScalar(.5),this._center=this._stack.centerAABBox(),this._toAABB=this._stack.lps2AABB}}},{key:"_create",value:function(){if(this._stack&&this._stack.prepared&&this._stack.packed){try{this._geometry=new c["default"](this._halfDimensions,this._center,this._planePosition,this._planeDirection,this._toAABB)}catch(e){return window.console.log(e),void window.console.log("invalid slice geometry - exiting...")}if(this._geometry.vertices){if(!this._material){this._uniforms.uTextureSize.value=this._stack.textureSize,this._uniforms.uDataDimensions.value=[this._stack.dimensionsIJK.x,this._stack.dimensionsIJK.y,this._stack.dimensionsIJK.z],this._uniforms.uWorldToData.value=this._stack.lps2IJK,this._uniforms.uNumberOfChannels.value=this._stack.numberOfChannels,this._uniforms.uPixelType.value=this._stack.pixelType,this._uniforms.uBitsAllocated.value=this._stack.bitsAllocated,
this._uniforms.uPackedPerPixel.value=this._stack.packedPerPixel;for(var t=[],n=0;n<this._stack.rawData.length;n++){var i=new THREE.DataTexture(this._stack.rawData[n],this._stack.textureSize,this._stack.textureSize,this._stack.textureType,THREE.UnsignedByteType,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.NearestFilter,THREE.NearestFilter);i.needsUpdate=!0,i.flipY=!0,t.push(i)}this._uniforms.uTextureContainer.value=t,this._material=new THREE.ShaderMaterial({side:THREE.DoubleSide,uniforms:this._uniforms,vertexShader:"#define GLSLIFY 1\nvarying vec4 vPos;\n\n//\n// main\n//\nvoid main() {\n\n  vPos = modelMatrix * vec4(position, 1.0 );\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0 );\n\n}",fragmentShader:"#define GLSLIFY 1\nuniform int       uTextureSize;\nuniform float     uWindowCenterWidth[2];\nuniform float     uRescaleSlopeIntercept[2];\nuniform sampler2D uTextureContainer[7];\nuniform ivec3     uDataDimensions;\nuniform mat4      uWorldToData;\nuniform int       uNumberOfChannels;\nuniform int       uPixelType;\nuniform int       uBitsAllocated;\nuniform int       uInvert;\nuniform int       uInterpolation;\nuniform int       uPackedPerPixel;\n\n// hack because can not pass arrays if too big\n// best would be to pass texture but have to deal with 16bits\nuniform int       uLut;\nuniform sampler2D uTextureLUT;\n\nvarying vec4      vPos;\n\n// include functions\n// unpack int 8\nvoid uInt8(in float r, out float value){\n  value = r * 256.;\n}\n\n// unpack int 16\nvoid uInt16(in float r, in float a, out float value){\n  value = r * 256. + a * 65536.;\n}\n\n// unpack int 32\nvoid uInt32(in float r, in float g, in float b, in float a, out float value){\n  value = r * 256. + g * 65536. + b * 16777216. + a * 4294967296.;\n}\n\n// unpack float 32\nvoid uFloat32(in float r, in float g, in float b, in float a, out float value){\n\n  // create arrays containing bits for rgba values\n  // value between 0 and 255\n  value = r * 255.;\n  int bytemeR[8];\n  bytemeR[0] = int(floor(value / 128.));\n  value -= float(bytemeR[0] * 128);\n  bytemeR[1] = int(floor(value / 64.));\n  value -= float(bytemeR[1] * 64);\n  bytemeR[2] = int(floor(value / 32.));\n  value -= float(bytemeR[2] * 32);\n  bytemeR[3] = int(floor(value / 16.));\n  value -= float(bytemeR[3] * 16);\n  bytemeR[4] = int(floor(value / 8.));\n  value -= float(bytemeR[4] * 8);\n  bytemeR[5] = int(floor(value / 4.));\n  value -= float(bytemeR[5] * 4);\n  bytemeR[6] = int(floor(value / 2.));\n  value -= float(bytemeR[6] * 2);\n  bytemeR[7] = int(floor(value));\n\n  value = g * 255.;\n  int bytemeG[8];\n  bytemeG[0] = int(floor(value / 128.));\n  value -= float(bytemeG[0] * 128);\n  bytemeG[1] = int(floor(value / 64.));\n  value -= float(bytemeG[1] * 64);\n  bytemeG[2] = int(floor(value / 32.));\n  value -= float(bytemeG[2] * 32);\n  bytemeG[3] = int(floor(value / 16.));\n  value -= float(bytemeG[3] * 16);\n  bytemeG[4] = int(floor(value / 8.));\n  value -= float(bytemeG[4] * 8);\n  bytemeG[5] = int(floor(value / 4.));\n  value -= float(bytemeG[5] * 4);\n  bytemeG[6] = int(floor(value / 2.));\n  value -= float(bytemeG[6] * 2);\n  bytemeG[7] = int(floor(value));\n\n  value = b * 255.;\n  int bytemeB[8];\n  bytemeB[0] = int(floor(value / 128.));\n  value -= float(bytemeB[0] * 128);\n  bytemeB[1] = int(floor(value / 64.));\n  value -= float(bytemeB[1] * 64);\n  bytemeB[2] = int(floor(value / 32.));\n  value -= float(bytemeB[2] * 32);\n  bytemeB[3] = int(floor(value / 16.));\n  value -= float(bytemeB[3] * 16);\n  bytemeB[4] = int(floor(value / 8.));\n  value -= float(bytemeB[4] * 8);\n  bytemeB[5] = int(floor(value / 4.));\n  value -= float(bytemeB[5] * 4);\n  bytemeB[6] = int(floor(value / 2.));\n  value -= float(bytemeB[6] * 2);\n  bytemeB[7] = int(floor(value));\n\n  value = a * 255.;\n  int bytemeA[8];\n  bytemeA[0] = int(floor(value / 128.));\n  value -= float(bytemeA[0] * 128);\n  bytemeA[1] = int(floor(value / 64.));\n  value -= float(bytemeA[1] * 64);\n  bytemeA[2] = int(floor(value / 32.));\n  value -= float(bytemeA[2] * 32);\n  bytemeA[3] = int(floor(value / 16.));\n  value -= float(bytemeA[3] * 16);\n  bytemeA[4] = int(floor(value / 8.));\n  value -= float(bytemeA[4] * 8);\n  bytemeA[5] = int(floor(value / 4.));\n  value -= float(bytemeA[5] * 4);\n  bytemeA[6] = int(floor(value / 2.));\n  value -= float(bytemeA[6] * 2);\n  bytemeA[7] = int(floor(value));\n\n  // compute float32 value from bit arrays\n\n  // sign\n  int issigned = 1 - 2 * bytemeR[0];\n  //   issigned = int(pow(-1., float(bytemeR[0])));\n\n  // exponent\n  int exponent = 0;\n\n  exponent += bytemeR[1] * int(pow(2., 7.));\n  exponent += bytemeR[2] * int(pow(2., 6.));\n  exponent += bytemeR[3] * int(pow(2., 5.));\n  exponent += bytemeR[4] * int(pow(2., 4.));\n  exponent += bytemeR[5] * int(pow(2., 3.));\n  exponent += bytemeR[6] * int(pow(2., 2.));\n  exponent += bytemeR[7] * int(pow(2., 1.));\n\n  exponent += bytemeG[0];\n\n  // fraction\n  float fraction = 0.;\n\n  fraction = float(bytemeG[1]) * pow(2., -1.);\n  fraction += float(bytemeG[2]) * pow(2., -2.);\n  fraction += float(bytemeG[3]) * pow(2., -3.);\n  fraction += float(bytemeG[4]) * pow(2., -4.);\n  fraction += float(bytemeG[5]) * pow(2., -5.);\n  fraction += float(bytemeG[6]) * pow(2., -6.);\n  fraction += float(bytemeG[7]) * pow(2., -7.);\n\n  fraction += float(bytemeB[0]) * pow(2., -8.);\n  fraction += float(bytemeB[1]) * pow(2., -9.);\n  fraction += float(bytemeB[2]) * pow(2., -10.);\n  fraction += float(bytemeB[3]) * pow(2., -11.);\n  fraction += float(bytemeB[4]) * pow(2., -12.);\n  fraction += float(bytemeB[5]) * pow(2., -13.);\n  fraction += float(bytemeB[6]) * pow(2., -14.);\n  fraction += float(bytemeB[7]) * pow(2., -15.);\n\n  fraction += float(bytemeA[0]) * pow(2., -16.);\n  fraction += float(bytemeA[1]) * pow(2., -17.);\n  fraction += float(bytemeA[2]) * pow(2., -18.);\n  fraction += float(bytemeA[3]) * pow(2., -19.);\n  fraction += float(bytemeA[4]) * pow(2., -20.);\n  fraction += float(bytemeA[5]) * pow(2., -21.);\n  fraction += float(bytemeA[6]) * pow(2., -22.);\n  fraction += float(bytemeA[7]) * pow(2., -23.);\n\n  value = float(issigned) * pow( 2., float(exponent - 127)) * (1. + fraction);\n}\n\n// entry point for the unpack function\nvoid unpack( in vec4 packedRGBA,\n             in int bitsAllocated,\n             in int signedNumber,\n             in int numberOfChannels,\n             in int pixelType,\n             in int offset,\n             out vec4 unpacked) {\n\n  if(numberOfChannels == 1){\n    if(bitsAllocated == 8 || bitsAllocated == 1){\n      uInt8(\n        packedRGBA.r,\n        unpacked.x);\n    }\n    else if(bitsAllocated == 16){\n      if( offset == 0 ){\n        uInt16(\n          packedRGBA.r,\n          packedRGBA.g,\n          unpacked.x);\n      }\n      else{\n        uInt16(\n          packedRGBA.b,\n          packedRGBA.a,\n          unpacked.x);\n      }\n\n    }\n    else if(bitsAllocated == 32){\n      if(pixelType == 0){\n        uInt32(\n          packedRGBA.r,\n          packedRGBA.g,\n          packedRGBA.b,\n          packedRGBA.a,\n          unpacked.x);\n      }\n      else{\n        uFloat32(\n          packedRGBA.r,\n          packedRGBA.g,\n          packedRGBA.b,\n          packedRGBA.a,\n          unpacked.x);\n      }\n\n    }\n  }\n  else if(numberOfChannels == 3){\n    unpacked = packedRGBA;\n  }\n}\n\n// Support up to textureSize*textureSize*7 voxels\n\nvoid texture3DPolyfill(in ivec3 dataCoordinates,\n                       in ivec3 dataDimensions,\n                       in int textureSize,\n                       in sampler2D textureContainer0,\n                       in sampler2D textureContainer1,\n                       in sampler2D textureContainer2,\n                       in sampler2D textureContainer3,\n                       in sampler2D textureContainer4,\n                       in sampler2D textureContainer5,\n                       in sampler2D textureContainer6,\n                       in sampler2D textureContainer[7], // not working on Moto X 2014\n                       in int packedPerPixel,\n                       out vec4 dataValue_0,\n                       out int offset_0\n  ) {\n\n  // int pack = 2;\n\n    // Model coordinate to data index\n  int index = dataCoordinates.x\n            + dataCoordinates.y * dataDimensions.x\n            + dataCoordinates.z * dataDimensions.y * dataDimensions.x;\n  int indexP = int(index/packedPerPixel);\n\n  if( 2*indexP < index){\n    offset_0 = 1;\n  }\n  else{\n    offset_0 = 0;\n  }\n\n  // Map data index to right sampler2D texture\n  int voxelsPerTexture = textureSize*textureSize;\n  int textureIndex = int(floor(float(indexP) / float(voxelsPerTexture)));\n  // modulo seems incorrect sometimes...\n  // int inTextureIndex = int(mod(float(index), float(textureSize*textureSize)));\n  int inTextureIndex = indexP - voxelsPerTexture*textureIndex;\n\n  // Get row and column in the texture\n  int colIndex = int(mod(float(inTextureIndex), float(textureSize)));\n  int rowIndex = int(floor(float(inTextureIndex)/float(textureSize)));\n\n  // // Model coordinate to data index\n  // int index = dataCoordinates.x\n  //           + dataCoordinates.y * dataDimensions.x \n  //           + dataCoordinates.z * dataDimensions.y * dataDimensions.x;\n\n  // // Map data index to right sampler2D texture\n  // int voxelsPerTexture = 2 * textureSize * textureSize;\n  // int textureIndex = int(floor(float(index) / float(voxelsPerTexture)));\n  // // modulo seems incorrect sometimes...\n  // // int inTextureIndex = int(mod(float(index), float(textureSize*textureSize)));\n  // int inTextureIndex = index - voxelsPerTexture*textureIndex;\n\n  // float modulo = 0.5 * float(inTextureIndex) / float( textureSize * textureSize);\n  // dataValue = vec4(modulo, modulo, modulo, 1.0);\n  // // return;\n\n  // // float modulo = 100.0 * float( textureIndex ) / 7.0;\n  // // dataValue = vec4(modulo, modulo, modulo, 1.0);\n\n  // // return;\n\n  // // Get row and column in the texture\n  // // 0.5\n  // int colIndex = int(mod(0.5*float(inTextureIndex), float( textureSize )));\n  // int rowIndex = int(floor(0.5*float(inTextureIndex) / float( textureSize )));\n  // float fcolIndex = 0.5 * mod(float(inTextureIndex), float( 2 * textureSize ));\n  // float frowIndex = floor(0.5*float(inTextureIndex) / float( textureSize ));\n  // fcolIndex = floor( 0.5 * float( inTextureIndex ) ) - frowIndex * float( textureSize );\n\n  // dataValue = vec4(float(colIndex) / 4096., mod( float(colIndex), 2.) , 1., 1.);\n  // return;\n\n  // Map row and column to uv\n  vec2 uv = vec2(0,0);\n  uv.x = (0.5 + float(colIndex)) / float(textureSize);\n  uv.y = 1. - (0.5 + float(rowIndex)) / float(textureSize);\n\n  //\n  if(textureIndex == 0){ dataValue_0 = texture2D(textureContainer0, uv); }\n  else if(textureIndex == 1){dataValue_0 = texture2D(textureContainer1, uv);}\n  else if(textureIndex == 2){ dataValue_0 = texture2D(textureContainer2, uv); }\n  else if(textureIndex == 3){ dataValue_0 = texture2D(textureContainer3, uv); }\n  else if(textureIndex == 4){ dataValue_0 = texture2D(textureContainer4, uv); }\n  else if(textureIndex == 5){ dataValue_0 = texture2D(textureContainer5, uv); }\n  else if(textureIndex == 6){ dataValue_0 = texture2D(textureContainer6, uv); }\n}\n\nvoid no(in vec3 currentVoxel,\n        in int kernelSize,\n        in ivec3 dataDimensions,\n        in int textureSize,\n        in sampler2D textureContainer0,\n        in sampler2D textureContainer1,\n        in sampler2D textureContainer2,\n        in sampler2D textureContainer3,\n        in sampler2D textureContainer4,\n        in sampler2D textureContainer5,\n        in sampler2D textureContainer6,\n        in sampler2D textureContainer[7], // not working on Moto X 2014\n        in int bitsAllocated, \n        in int numberOfChannels_1, \n        in int pixelType_1,\n        in int packedPerPixel_1,\n        out vec4 intensity_1\n  ) {\n  \n  // lower bound\n  vec3 rCurrentVoxel = vec3(floor(currentVoxel.x + 0.5 ), floor(currentVoxel.y + 0.5 ), floor(currentVoxel.z + 0.5 ));\n  ivec3 voxel = ivec3(int(rCurrentVoxel.x), int(rCurrentVoxel.y), int(rCurrentVoxel.z));\n\n  vec4 tmp = vec4(0., 0., 0., 0.);\n  int offset = 0;\n\n  texture3DPolyfill(\n    voxel,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    packedPerPixel_1,\n    tmp,\n    offset\n    );\n\n  unpack(\n    tmp,\n    bitsAllocated,\n    0,\n    numberOfChannels_1,\n    pixelType_1,\n    offset,\n    intensity_1);\n\n}\n\n// https://en.wikipedia.org/wiki/Trilinear_interpolation\n\nvoid trilinear(in vec3 currentVoxel,\n               in int kernelSize,\n               in ivec3 dataDimensions,\n               in int textureSize,\n               in sampler2D textureContainer0,\n               in sampler2D textureContainer1,\n               in sampler2D textureContainer2,\n               in sampler2D textureContainer3,\n               in sampler2D textureContainer4,\n               in sampler2D textureContainer5,\n               in sampler2D textureContainer6,\n               in sampler2D textureContainer[7], // not working on Moto X 2014\n               in int bitsAllocated, \n               in int numberOfChannels_2, \n               in int pixelType_2,\n               in int packedPerPixel_2,\n               out vec4 intensity_2\n  ) {\n  \n  // lower bound\n  vec3 lb = vec3(floor(currentVoxel.x + 0.5 ), floor(currentVoxel.y + 0.5 ), floor(currentVoxel.z + 0.5 ));\n\n  vec3 direction = currentVoxel - lb;\n\n  // higher bound\n  vec3 hb = lb + 1.0;\n\n  if( direction.x < 0.0){\n\n    hb.x -= 2.0;\n\n  }\n\n  if( direction.y < 0.0){\n\n    hb.y -= 2.0;\n\n  }\n\n  if( direction.z < 0.0){\n\n    hb.z -= 2.0;\n\n  }\n\n  vec3 lc = vec3(0.0, 0.0, 0.0);\n  vec3 hc = vec3(0.0, 0.0, 0.0);\n\n  if(lb.x < hb.x){\n\n    lc.x = lb.x;\n    hc.x = hb.x;\n\n  }\n  else{\n\n    lc.x = hb.x;\n    hc.x = lb.x;\n\n  }\n\n  if(lb.y < hb.y){\n\n    lc.y = lb.y;\n    hc.y = hb.y;\n\n  }\n  else{\n\n    lc.y = hb.y;\n    hc.y = lb.y;\n\n  }\n\n  if(lb.z < hb.z){\n\n    lc.z = lb.z;\n    hc.z = hb.z;\n\n  }\n  else{\n\n    lc.z = hb.z;\n    hc.z = lb.z;\n\n  }\n\n  float xd = ( currentVoxel.x - lc.x ) / ( hc.x - lc.x );\n  float yd = ( currentVoxel.y - lc.y ) / ( hc.y - lc.y );\n  float zd = ( currentVoxel.z - lc.z ) / ( hc.z - lc.z );\n\n  //\n  // c00\n  //\n\n  //\n\n  vec4 v000 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c000 = vec3(lc.x, lc.y, lc.z);\n\n  no(c000,\n    kernelSize,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    bitsAllocated, \n    numberOfChannels_2, \n    pixelType_2,\n    packedPerPixel_2,\n    v000\n  );\n\n  //\n\n  vec4 v100 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c100 = vec3(hc.x, lc.y, lc.z);\n\n  no(c100,\n    kernelSize,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    bitsAllocated, \n    numberOfChannels_2, \n    pixelType_2,\n    packedPerPixel_2,\n    v100\n  );\n\n  vec4 c00 = v000 * ( 1.0 - xd ) + v100 * xd;\n\n  //\n  // c01\n  //\n  vec4 v001 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c001 = vec3(lc.x, lc.y, hc.z);\n\n  no(c001,\n    kernelSize,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    bitsAllocated, \n    numberOfChannels_2, \n    pixelType_2,\n    packedPerPixel_2,\n    v001\n  );\n\n  vec4 v101 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c101 = vec3(hc.x, lc.y, hc.z);\n\n  no(c101,\n    kernelSize,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    bitsAllocated, \n    numberOfChannels_2, \n    pixelType_2,\n    packedPerPixel_2,\n    v101\n  );\n\n  vec4 c01 = v001 * ( 1.0 - xd ) + v101 * xd;\n\n  //\n  // c10\n  //\n  vec4 v010 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c010 = vec3(lc.x, hc.y, lc.z);\n\n  no(c010,\n    kernelSize,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    bitsAllocated, \n    numberOfChannels_2, \n    pixelType_2,\n    packedPerPixel_2,\n    v010\n  );\n\n  vec4 v110 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c110 = vec3(hc.x, hc.y, lc.z);\n\n  no(c110,\n    kernelSize,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    bitsAllocated, \n    numberOfChannels_2, \n    pixelType_2,\n    packedPerPixel_2,\n    v110\n  );\n\n  vec4 c10 = v010 * ( 1.0 - xd ) + v110 * xd;\n\n  //\n  // c11\n  //\n  vec4 v011 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c011 = vec3(lc.x, hc.y, hc.z);\n\n  no(c011,\n    kernelSize,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    bitsAllocated, \n    numberOfChannels_2, \n    pixelType_2,\n    packedPerPixel_2,\n    v011\n  );\n\n  vec4 v111 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c111 = vec3(hc.x, hc.y, hc.z);\n\n  no(c111,\n    kernelSize,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    bitsAllocated, \n    numberOfChannels_2, \n    pixelType_2,\n    packedPerPixel_2,\n    v111\n  );\n\n  vec4 c11 = v011 * ( 1.0 - xd ) + v111 * xd;\n\n  // c0 and c1\n  vec4 c0 = c00 * ( 1.0 - yd) + c10 * yd;\n  vec4 c1 = c01 * ( 1.0 - yd) + c11 * yd;\n\n  // c\n  vec4 c = c0 * ( 1.0 - zd) + c1 * zd;\n  intensity_2 = c;\n\n}\n\n// Support up to textureSize*textureSize*7 voxels\n\nvoid value_0(in vec3 dataCoordinates,\n           in int kernelSize,\n           in int interpolationMethod,\n           in ivec3 dataDimensions,\n           in int textureSize,\n           in sampler2D textureContainer0,\n           in sampler2D textureContainer1,\n           in sampler2D textureContainer2,\n           in sampler2D textureContainer3,\n           in sampler2D textureContainer4,\n           in sampler2D textureContainer5,\n           in sampler2D textureContainer6,\n           in sampler2D textureContainer[7], // not working on Moto X 2014\n           in int bitsAllocated, \n           in int numberOfChannels_0, \n           in int pixelType_0,\n           in int packedPerPixel_0,\n           out vec4 intensity_0\n  ) {\n\n  if( interpolationMethod == 0){\n\n    // no interpolation\n    no(dataCoordinates,\n       kernelSize,\n       dataDimensions,\n       textureSize,\n       textureContainer0,\n       textureContainer1,\n       textureContainer2,\n       textureContainer3,\n       textureContainer4,\n       textureContainer5,\n       textureContainer6,\n       textureContainer,\n       bitsAllocated,\n       numberOfChannels_0,\n       pixelType_0,\n       packedPerPixel_0,\n       intensity_0);\n\n  }\n  else if( interpolationMethod == 1){\n\n    // trilinear interpolation\n    trilinear(dataCoordinates,\n      kernelSize,\n      dataDimensions,\n      textureSize,\n      textureContainer0,\n      textureContainer1,\n      textureContainer2,\n      textureContainer3,\n      textureContainer4,\n      textureContainer5,\n      textureContainer6,\n      textureContainer,\n      bitsAllocated,\n      numberOfChannels_0,\n      pixelType_0,\n      packedPerPixel_0,\n      intensity_0);\n\n  }\n\n}\n\nvoid main(void) {\n\n  // get texture coordinates of current pixel\n  vec4 dataCoordinates = uWorldToData * vPos;\n  vec3 currentVoxel = vec3(dataCoordinates.x, dataCoordinates.y, dataCoordinates.z);\n  int kernelSize = 2;\n  vec4 dataValue = vec4(0., 0., 0., 0.);\n  value_0(\n    currentVoxel,\n    kernelSize,\n    uInterpolation,\n    uDataDimensions,\n    uTextureSize,\n    uTextureContainer[0],\n    uTextureContainer[1],\n    uTextureContainer[2],\n    uTextureContainer[3],\n    uTextureContainer[4],\n    uTextureContainer[5],\n    uTextureContainer[6],\n    uTextureContainer,     // not working on Moto X 2014\n    uBitsAllocated,\n    uNumberOfChannels,\n    uPixelType,\n    uPackedPerPixel,\n    dataValue\n  );\n\n  // gl_FragColor = dataValue;\n  // return;\n\n  // how do we deal wil more than 1 channel?\n  if(uNumberOfChannels == 1){\n    float intensity = dataValue.r;\n\n    // rescale/slope\n    intensity = intensity*uRescaleSlopeIntercept[0] + uRescaleSlopeIntercept[1];\n\n    float windowMin = uWindowCenterWidth[0] - uWindowCenterWidth[1] * 0.5;\n    float windowMax = uWindowCenterWidth[0] + uWindowCenterWidth[1] * 0.5;\n    intensity = ( intensity - windowMin ) / uWindowCenterWidth[1];\n\n    dataValue.r = dataValue.g = dataValue.b = intensity;\n    dataValue.a = 1.0;\n  }\n\n  // Apply LUT table...\n  //\n  if(uLut == 1){\n    // should opacity be grabbed there?\n    dataValue = texture2D( uTextureLUT, vec2( dataValue.r , 1.0) );\n  }\n\n  if(uInvert == 1){\n    dataValue = vec4(1.) - dataValue;\n    // how do we deal with that and opacity?\n    dataValue.a = 1.;\n  }\n\n  gl_FragColor = dataValue;\n\n}"})}this.updateIntensitySettings(),this.updateIntensitySettingsUniforms(),this._mesh=new THREE.Mesh(this._geometry,this._material),"IJK"===this._aaBBspace&&this._mesh.applyMatrix(this._stack.ijk2LPS),this._mesh.visible=this._visible,this.add(this._mesh)}}}},{key:"updateIntensitySettings",value:function(){this._intensityAuto?(this.updateIntensitySetting("windowCenter"),this.updateIntensitySetting("windowWidth"),this.updateIntensitySetting("rescaleSlope"),this.updateIntensitySetting("rescaleIntercept")):(null===this._windowCenter&&(this._windowCenter=this._stack.windowCenter),null===this.__windowWidth&&(this._windowWidth=this._stack.windowWidth),null===this._rescaleSlope&&(this._rescaleSlope=this._stack.rescaleSlope),null===this._rescaleIntercept&&(this._rescaleIntercept=this._stack.rescaleIntercept))}},{key:"updateIntensitySettingsUniforms",value:function(){this._uniforms.uRescaleSlopeIntercept.value=[this._rescaleSlope,this._rescaleIntercept],this._uniforms.uWindowCenterWidth.value=[this._windowCenter,this._windowWidth],this._uniforms.uInvert.value=this._invert===!0?1:0,this._uniforms.uInterpolation.value=this._interpolation,"none"===this._lut?this._uniforms.uLut.value=0:(this._uniforms.uLut.value=1,this._uniforms.uTextureLUT.value=this._lutTexture)}},{key:"updateIntensitySetting",value:function(e){this._stack.frame[this._index]&&this._stack.frame[this._index][e]?this["_"+e]=this._stack.frame[this._index][e]:this["_"+e]=this._stack[e]}},{key:"_update",value:function(){this._mesh&&(this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.geometry=null,this._mesh=null),this._create()}},{key:"stack",get:function(){return this._stack},set:function(e){this._stack=e}},{key:"windowWidth",get:function(){return this._windowWidth},set:function(e){this._windowWidth=e,this.updateIntensitySettingsUniforms()}},{key:"windowCenter",get:function(){return this._windowCenter},set:function(e){this._windowCenter=e,this.updateIntensitySettingsUniforms()}},{key:"rescaleSlope",get:function(){return this._rescaleSlope},set:function(e){this._rescaleSlope=e,this.updateIntensitySettingsUniforms()}},{key:"rescaleIntercept",get:function(){return this._rescaleIntercept},set:function(e){this._rescaleIntercept=e,this.updateIntensitySettingsUniforms()}},{key:"invert",get:function(){return this._invert},set:function(e){this._invert=e,this.updateIntensitySettingsUniforms()}},{key:"lut",get:function(){return this._lut},set:function(e){this._lut=e}},{key:"lutTexture",get:function(){return this._lutTexture},set:function(e){this._lutTexture=e,this.updateIntensitySettingsUniforms()}},{key:"intensityAuto",get:function(){return this._intensityAuto},set:function(e){this._intensityAuto=e,this.updateIntensitySettings(),this.updateIntensitySettingsUniforms()}},{key:"interpolation",get:function(){return this._interpolation},set:function(e){this._interpolation=e,this.updateIntensitySettingsUniforms()}},{key:"index",get:function(){return this._index},set:function(e){this._index=e,this._update()}},{key:"planePosition",set:function(e){this._planePosition=e,this._update()},get:function(){return this._planePosition}},{key:"planeDirection",set:function(e){this._planeDirection=e,this._update()},get:function(){return this._planeDirection}},{key:"halfDimensions",set:function(e){this._halfDimensions=e},get:function(){return this._halfDimensions}},{key:"center",set:function(e){this._center=e},get:function(){return this._center}},{key:"aabbSpace",set:function(e){this._aaBBspace=e,this._init()},get:function(){return this._aaBBspace}},{key:"mesh",set:function(e){this._mesh=e},get:function(){return this._mesh}},{key:"geometry",set:function(e){this._geometry=e},get:function(){return this._geometry}}]),t}(THREE.Object3D);n["default"]=h},{"../../src/geometries/geometries.slice":67,"../../src/shaders/shaders.data":92}],75:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":s(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":s(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=e("../../src/helpers/helpers.border"),c=i(u),f=e("../../src/helpers/helpers.boundingbox"),d=i(f),h=e("../../src/helpers/helpers.slice"),p=i(h),m=function(e){function t(e){r(this,t);var n=o(this,Object.getPrototypeOf(t).call(this));return n._stack=e,n._bBox=null,n._slice=null,n._border=null,n._dummy=null,n._orientation=0,n._index=0,n._uniforms=null,n._autoWindowLevel=!1,n._outOfBounds=!1,n._create(),n}return a(t,e),l(t,[{key:"_create",value:function(){this._stack?(this._prepareStack(),this._prepareBBox(),this._prepareSlice(),this._prepareBorder()):window.console.log("no stack to be prepared...")}},{key:"_isIndexOutOfBounds",value:function(){var e=this._stack.dimensionsIJK,t=0;switch(this._orientation){case 0:t=e.z;break;case 1:t=e.x;break;case 2:t=e.y}this._index>=t||this._index<0?this._outOfBounds=!0:this._outOfBounds=!1}},{key:"_prepareStack",value:function(){this._stack.prepared||this._stack.prepare(),this._stack.packed||this._stack.pack()}},{key:"_prepareBBox",value:function(){this._bBox=new d["default"](this._stack),this.add(this._bBox)}},{key:"_prepareBorder",value:function(){this._border=new c["default"](this._slice),this.add(this._border)}},{key:"_prepareSlice",value:function(){var e=this._stack.halfDimensionsIJK;this._index=this._prepareSliceIndex(e);var t=this._prepareSlicePosition(e,this._index),n=this._prepareDirection(this._orientation);this._slice=new p["default"](this._stack,this._index,t,n),this.add(this._slice)}},{key:"_prepareSliceIndex",value:function(e){var t=0;switch(this._orientation){case 0:t=Math.floor(e.z);break;case 1:t=Math.floor(e.x);break;case 2:t=Math.floor(e.y)}return t}},{key:"_prepareSlicePosition",value:function(e,t){var n=new THREE.Vector3(0,0,0);switch(this._orientation){case 0:n=new THREE.Vector3(Math.floor(e.x),Math.floor(e.y),t);break;case 1:n=new THREE.Vector3(t,Math.floor(e.y),Math.floor(e.z));break;case 2:n=new THREE.Vector3(Math.floor(e.x),t,Math.floor(e.z))}return n}},{key:"_prepareDirection",value:function(e){var t=new THREE.Vector3(0,0,1);switch(e){case 0:t=new THREE.Vector3(0,0,1);break;case 1:t=new THREE.Vector3(1,0,0);break;case 2:t=new THREE.Vector3(0,1,0)}return t}},{key:"stack",get:function(){return this._stack}},{key:"bbox",get:function(){return this._bBox}},{key:"slice",get:function(){return this._slice}},{key:"border",get:function(){return this._border}},{key:"index",get:function(){return this._index},set:function(e){this._index=e,this._slice.index=e;var t=this._stack.halfDimensionsIJK;this._slice.planePosition=this._prepareSlicePosition(t,this._index),this._border.helpersSlice=this._slice,this._isIndexOutOfBounds()}},{key:"orientation",set:function(e){this._orientation=e,this._slice.planeDirection=this._prepareDirection(this._orientation),this._border.helpersSlice=this._slice},get:function(){return this._orientation}},{key:"outOfBounds",set:function(e){this._outOfBounds=e},get:function(){return this._outOfBounds}}]),t}(THREE.Object3D);n["default"]=m},{"../../src/helpers/helpers.border":69,"../../src/helpers/helpers.boundingbox":70,"../../src/helpers/helpers.slice":74}],76:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":s(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":s(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=e("../../src/shaders/shaders.raycasting"),c=i(u),f=function(e){function t(e){r(this,t);var n=o(this,Object.getPrototypeOf(t).call(this));return n._stack=e,n._textures=[],
n._uniforms=null,n._material=null,n._geometry=null,n._create(),n}return a(t,e),l(t,[{key:"_create",value:function(){this._prepareStack(),this._prepareTexture(),this._prepareMaterial(),this._prepareGeometry(),this._mesh=new THREE.Mesh(this._geometry,this._material),this.add(this._mesh)}},{key:"_prepareStack",value:function(){this._stack.prepared||this._stack.prepare(),this._stack.packed||this._stack.pack()}},{key:"_prepareTexture",value:function(){this._textures=[];for(var e=0;e<this._stack._rawData.length;e++){var t=new THREE.DataTexture(this._stack.rawData[e],this._stack.textureSize,this._stack.textureSize,this._stack.textureType,THREE.UnsignedByteType,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.NearestFilter,THREE.NearestFilter);t.needsUpdate=!0,t.flipY=!0,this._textures.push(t)}}},{key:"_prepareMaterial",value:function(){this._uniforms=c["default"].singlePassUniforms(),this._uniforms.uWorldBBox.value=this._stack.worldBoundingBox(),this._uniforms.uTextureSize.value=this._stack.textureSize,this._uniforms.uTextureContainer.value=this._textures,this._uniforms.uWorldToData.value=this._stack.lps2IJK,this._uniforms.uNumberOfChannels.value=this._stack.numberOfChannels,this._uniforms.uPixelType.value=this._stack.pixelType,this._uniforms.uBitsAllocated.value=this._stack.bitsAllocated,this._uniforms.uPackedPerPixel.value=this._stack.packedPerPixel,this._uniforms.uWindowCenterWidth.value=[this._stack.windowCenter,.8*this._stack.windowWidth],this._uniforms.uRescaleSlopeIntercept.value=[this._stack.rescaleSlope,this._stack.rescaleIntercept],this._uniforms.uDataDimensions.value=[this._stack.dimensionsIJK.x,this._stack.dimensionsIJK.y,this._stack.dimensionsIJK.z],this._material=new THREE.ShaderMaterial({uniforms:this._uniforms,vertexShader:"#define GLSLIFY 1\nvarying vec4 vPos;\n\nvoid main() {\n\n  vPos = modelMatrix * vec4(position, 1.0 );\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0 );\n\n}\n",fragmentShader:"#define GLSLIFY 1\n// UNIFORMS\nuniform float     uWorldBBox[6];\nuniform int       uTextureSize;\nuniform float     uWindowCenterWidth[2];\nuniform float     uRescaleSlopeIntercept[2];\nuniform sampler2D uTextureContainer[7];\nuniform ivec3     uDataDimensions;\nuniform mat4      uWorldToData;\nuniform int       uNumberOfChannels;\nuniform int       uPixelType;\nuniform int       uBitsAllocated;\nuniform int       uLut;\nuniform sampler2D uTextureLUT;\nuniform int       uSteps;\nuniform float     uAlphaCorrection;\nuniform float     uFrequence;\nuniform float     uAmplitude;\nuniform int       uInterpolation;\nuniform int       uPackedPerPixel;\n\n// VARYING\nvarying vec4 vPos;\n\n// unpack int 8\nvoid uInt8(in float r, out float value){\n  value = r * 256.;\n}\n\n// unpack int 16\nvoid uInt16(in float r, in float a, out float value){\n  value = r * 256. + a * 65536.;\n}\n\n// unpack int 32\nvoid uInt32(in float r, in float g, in float b, in float a, out float value){\n  value = r * 256. + g * 65536. + b * 16777216. + a * 4294967296.;\n}\n\n// unpack float 32\nvoid uFloat32(in float r, in float g, in float b, in float a, out float value){\n\n  // create arrays containing bits for rgba values\n  // value between 0 and 255\n  value = r * 255.;\n  int bytemeR[8];\n  bytemeR[0] = int(floor(value / 128.));\n  value -= float(bytemeR[0] * 128);\n  bytemeR[1] = int(floor(value / 64.));\n  value -= float(bytemeR[1] * 64);\n  bytemeR[2] = int(floor(value / 32.));\n  value -= float(bytemeR[2] * 32);\n  bytemeR[3] = int(floor(value / 16.));\n  value -= float(bytemeR[3] * 16);\n  bytemeR[4] = int(floor(value / 8.));\n  value -= float(bytemeR[4] * 8);\n  bytemeR[5] = int(floor(value / 4.));\n  value -= float(bytemeR[5] * 4);\n  bytemeR[6] = int(floor(value / 2.));\n  value -= float(bytemeR[6] * 2);\n  bytemeR[7] = int(floor(value));\n\n  value = g * 255.;\n  int bytemeG[8];\n  bytemeG[0] = int(floor(value / 128.));\n  value -= float(bytemeG[0] * 128);\n  bytemeG[1] = int(floor(value / 64.));\n  value -= float(bytemeG[1] * 64);\n  bytemeG[2] = int(floor(value / 32.));\n  value -= float(bytemeG[2] * 32);\n  bytemeG[3] = int(floor(value / 16.));\n  value -= float(bytemeG[3] * 16);\n  bytemeG[4] = int(floor(value / 8.));\n  value -= float(bytemeG[4] * 8);\n  bytemeG[5] = int(floor(value / 4.));\n  value -= float(bytemeG[5] * 4);\n  bytemeG[6] = int(floor(value / 2.));\n  value -= float(bytemeG[6] * 2);\n  bytemeG[7] = int(floor(value));\n\n  value = b * 255.;\n  int bytemeB[8];\n  bytemeB[0] = int(floor(value / 128.));\n  value -= float(bytemeB[0] * 128);\n  bytemeB[1] = int(floor(value / 64.));\n  value -= float(bytemeB[1] * 64);\n  bytemeB[2] = int(floor(value / 32.));\n  value -= float(bytemeB[2] * 32);\n  bytemeB[3] = int(floor(value / 16.));\n  value -= float(bytemeB[3] * 16);\n  bytemeB[4] = int(floor(value / 8.));\n  value -= float(bytemeB[4] * 8);\n  bytemeB[5] = int(floor(value / 4.));\n  value -= float(bytemeB[5] * 4);\n  bytemeB[6] = int(floor(value / 2.));\n  value -= float(bytemeB[6] * 2);\n  bytemeB[7] = int(floor(value));\n\n  value = a * 255.;\n  int bytemeA[8];\n  bytemeA[0] = int(floor(value / 128.));\n  value -= float(bytemeA[0] * 128);\n  bytemeA[1] = int(floor(value / 64.));\n  value -= float(bytemeA[1] * 64);\n  bytemeA[2] = int(floor(value / 32.));\n  value -= float(bytemeA[2] * 32);\n  bytemeA[3] = int(floor(value / 16.));\n  value -= float(bytemeA[3] * 16);\n  bytemeA[4] = int(floor(value / 8.));\n  value -= float(bytemeA[4] * 8);\n  bytemeA[5] = int(floor(value / 4.));\n  value -= float(bytemeA[5] * 4);\n  bytemeA[6] = int(floor(value / 2.));\n  value -= float(bytemeA[6] * 2);\n  bytemeA[7] = int(floor(value));\n\n  // compute float32 value from bit arrays\n\n  // sign\n  int issigned = 1 - 2 * bytemeR[0];\n  //   issigned = int(pow(-1., float(bytemeR[0])));\n\n  // exponent\n  int exponent = 0;\n\n  exponent += bytemeR[1] * int(pow(2., 7.));\n  exponent += bytemeR[2] * int(pow(2., 6.));\n  exponent += bytemeR[3] * int(pow(2., 5.));\n  exponent += bytemeR[4] * int(pow(2., 4.));\n  exponent += bytemeR[5] * int(pow(2., 3.));\n  exponent += bytemeR[6] * int(pow(2., 2.));\n  exponent += bytemeR[7] * int(pow(2., 1.));\n\n  exponent += bytemeG[0];\n\n  // fraction\n  float fraction = 0.;\n\n  fraction = float(bytemeG[1]) * pow(2., -1.);\n  fraction += float(bytemeG[2]) * pow(2., -2.);\n  fraction += float(bytemeG[3]) * pow(2., -3.);\n  fraction += float(bytemeG[4]) * pow(2., -4.);\n  fraction += float(bytemeG[5]) * pow(2., -5.);\n  fraction += float(bytemeG[6]) * pow(2., -6.);\n  fraction += float(bytemeG[7]) * pow(2., -7.);\n\n  fraction += float(bytemeB[0]) * pow(2., -8.);\n  fraction += float(bytemeB[1]) * pow(2., -9.);\n  fraction += float(bytemeB[2]) * pow(2., -10.);\n  fraction += float(bytemeB[3]) * pow(2., -11.);\n  fraction += float(bytemeB[4]) * pow(2., -12.);\n  fraction += float(bytemeB[5]) * pow(2., -13.);\n  fraction += float(bytemeB[6]) * pow(2., -14.);\n  fraction += float(bytemeB[7]) * pow(2., -15.);\n\n  fraction += float(bytemeA[0]) * pow(2., -16.);\n  fraction += float(bytemeA[1]) * pow(2., -17.);\n  fraction += float(bytemeA[2]) * pow(2., -18.);\n  fraction += float(bytemeA[3]) * pow(2., -19.);\n  fraction += float(bytemeA[4]) * pow(2., -20.);\n  fraction += float(bytemeA[5]) * pow(2., -21.);\n  fraction += float(bytemeA[6]) * pow(2., -22.);\n  fraction += float(bytemeA[7]) * pow(2., -23.);\n\n  value = float(issigned) * pow( 2., float(exponent - 127)) * (1. + fraction);\n}\n\n// entry point for the unpack function\nvoid unpack( in vec4 packedRGBA,\n             in int bitsAllocated,\n             in int signedNumber,\n             in int numberOfChannels,\n             in int pixelType,\n             in int offset,\n             out vec4 unpacked) {\n\n  if(numberOfChannels == 1){\n    if(bitsAllocated == 8 || bitsAllocated == 1){\n      uInt8(\n        packedRGBA.r,\n        unpacked.x);\n    }\n    else if(bitsAllocated == 16){\n      if( offset == 0 ){\n        uInt16(\n          packedRGBA.r,\n          packedRGBA.g,\n          unpacked.x);\n      }\n      else{\n        uInt16(\n          packedRGBA.b,\n          packedRGBA.a,\n          unpacked.x);\n      }\n\n    }\n    else if(bitsAllocated == 32){\n      if(pixelType == 0){\n        uInt32(\n          packedRGBA.r,\n          packedRGBA.g,\n          packedRGBA.b,\n          packedRGBA.a,\n          unpacked.x);\n      }\n      else{\n        uFloat32(\n          packedRGBA.r,\n          packedRGBA.g,\n          packedRGBA.b,\n          packedRGBA.a,\n          unpacked.x);\n      }\n\n    }\n  }\n  else if(numberOfChannels == 3){\n    unpacked = packedRGBA;\n  }\n}\n\n// Support up to textureSize*textureSize*7 voxels\n\nvoid texture3DPolyfill(in ivec3 dataCoordinates,\n                       in ivec3 dataDimensions,\n                       in int textureSize,\n                       in sampler2D textureContainer0,\n                       in sampler2D textureContainer1,\n                       in sampler2D textureContainer2,\n                       in sampler2D textureContainer3,\n                       in sampler2D textureContainer4,\n                       in sampler2D textureContainer5,\n                       in sampler2D textureContainer6,\n                       in sampler2D textureContainer[7], // not working on Moto X 2014\n                       in int packedPerPixel,\n                       out vec4 dataValue_0,\n                       out int offset_0\n  ) {\n\n  // int pack = 2;\n\n    // Model coordinate to data index\n  int index = dataCoordinates.x\n            + dataCoordinates.y * dataDimensions.x\n            + dataCoordinates.z * dataDimensions.y * dataDimensions.x;\n  int indexP = int(index/packedPerPixel);\n\n  if( 2*indexP < index){\n    offset_0 = 1;\n  }\n  else{\n    offset_0 = 0;\n  }\n\n  // Map data index to right sampler2D texture\n  int voxelsPerTexture = textureSize*textureSize;\n  int textureIndex = int(floor(float(indexP) / float(voxelsPerTexture)));\n  // modulo seems incorrect sometimes...\n  // int inTextureIndex = int(mod(float(index), float(textureSize*textureSize)));\n  int inTextureIndex = indexP - voxelsPerTexture*textureIndex;\n\n  // Get row and column in the texture\n  int colIndex = int(mod(float(inTextureIndex), float(textureSize)));\n  int rowIndex = int(floor(float(inTextureIndex)/float(textureSize)));\n\n  // // Model coordinate to data index\n  // int index = dataCoordinates.x\n  //           + dataCoordinates.y * dataDimensions.x \n  //           + dataCoordinates.z * dataDimensions.y * dataDimensions.x;\n\n  // // Map data index to right sampler2D texture\n  // int voxelsPerTexture = 2 * textureSize * textureSize;\n  // int textureIndex = int(floor(float(index) / float(voxelsPerTexture)));\n  // // modulo seems incorrect sometimes...\n  // // int inTextureIndex = int(mod(float(index), float(textureSize*textureSize)));\n  // int inTextureIndex = index - voxelsPerTexture*textureIndex;\n\n  // float modulo = 0.5 * float(inTextureIndex) / float( textureSize * textureSize);\n  // dataValue = vec4(modulo, modulo, modulo, 1.0);\n  // // return;\n\n  // // float modulo = 100.0 * float( textureIndex ) / 7.0;\n  // // dataValue = vec4(modulo, modulo, modulo, 1.0);\n\n  // // return;\n\n  // // Get row and column in the texture\n  // // 0.5\n  // int colIndex = int(mod(0.5*float(inTextureIndex), float( textureSize )));\n  // int rowIndex = int(floor(0.5*float(inTextureIndex) / float( textureSize )));\n  // float fcolIndex = 0.5 * mod(float(inTextureIndex), float( 2 * textureSize ));\n  // float frowIndex = floor(0.5*float(inTextureIndex) / float( textureSize ));\n  // fcolIndex = floor( 0.5 * float( inTextureIndex ) ) - frowIndex * float( textureSize );\n\n  // dataValue = vec4(float(colIndex) / 4096., mod( float(colIndex), 2.) , 1., 1.);\n  // return;\n\n  // Map row and column to uv\n  vec2 uv = vec2(0,0);\n  uv.x = (0.5 + float(colIndex)) / float(textureSize);\n  uv.y = 1. - (0.5 + float(rowIndex)) / float(textureSize);\n\n  //\n  if(textureIndex == 0){ dataValue_0 = texture2D(textureContainer0, uv); }\n  else if(textureIndex == 1){dataValue_0 = texture2D(textureContainer1, uv);}\n  else if(textureIndex == 2){ dataValue_0 = texture2D(textureContainer2, uv); }\n  else if(textureIndex == 3){ dataValue_0 = texture2D(textureContainer3, uv); }\n  else if(textureIndex == 4){ dataValue_0 = texture2D(textureContainer4, uv); }\n  else if(textureIndex == 5){ dataValue_0 = texture2D(textureContainer5, uv); }\n  else if(textureIndex == 6){ dataValue_0 = texture2D(textureContainer6, uv); }\n}\n\nvoid no(in vec3 currentVoxel,\n        in int kernelSize,\n        in ivec3 dataDimensions,\n        in int textureSize,\n        in sampler2D textureContainer0,\n        in sampler2D textureContainer1,\n        in sampler2D textureContainer2,\n        in sampler2D textureContainer3,\n        in sampler2D textureContainer4,\n        in sampler2D textureContainer5,\n        in sampler2D textureContainer6,\n        in sampler2D textureContainer[7], // not working on Moto X 2014\n        in int bitsAllocated, \n        in int numberOfChannels_0, \n        in int pixelType_0,\n        in int packedPerPixel_0,\n        out vec4 intensity_0\n  ) {\n  \n  // lower bound\n  vec3 rCurrentVoxel = vec3(floor(currentVoxel.x + 0.5 ), floor(currentVoxel.y + 0.5 ), floor(currentVoxel.z + 0.5 ));\n  ivec3 voxel = ivec3(int(rCurrentVoxel.x), int(rCurrentVoxel.y), int(rCurrentVoxel.z));\n\n  vec4 tmp = vec4(0., 0., 0., 0.);\n  int offset = 0;\n\n  texture3DPolyfill(\n    voxel,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    packedPerPixel_0,\n    tmp,\n    offset\n    );\n\n  unpack(\n    tmp,\n    bitsAllocated,\n    0,\n    numberOfChannels_0,\n    pixelType_0,\n    offset,\n    intensity_0);\n\n}\n\n// https://en.wikipedia.org/wiki/Trilinear_interpolation\n\nvoid trilinear(in vec3 currentVoxel,\n               in int kernelSize,\n               in ivec3 dataDimensions,\n               in int textureSize,\n               in sampler2D textureContainer0,\n               in sampler2D textureContainer1,\n               in sampler2D textureContainer2,\n               in sampler2D textureContainer3,\n               in sampler2D textureContainer4,\n               in sampler2D textureContainer5,\n               in sampler2D textureContainer6,\n               in sampler2D textureContainer[7], // not working on Moto X 2014\n               in int bitsAllocated, \n               in int numberOfChannels_1, \n               in int pixelType_1,\n               in int packedPerPixel_1,\n               out vec4 intensity_1\n  ) {\n  \n  // lower bound\n  vec3 lb = vec3(floor(currentVoxel.x + 0.5 ), floor(currentVoxel.y + 0.5 ), floor(currentVoxel.z + 0.5 ));\n\n  vec3 direction = currentVoxel - lb;\n\n  // higher bound\n  vec3 hb = lb + 1.0;\n\n  if( direction.x < 0.0){\n\n    hb.x -= 2.0;\n\n  }\n\n  if( direction.y < 0.0){\n\n    hb.y -= 2.0;\n\n  }\n\n  if( direction.z < 0.0){\n\n    hb.z -= 2.0;\n\n  }\n\n  vec3 lc = vec3(0.0, 0.0, 0.0);\n  vec3 hc = vec3(0.0, 0.0, 0.0);\n\n  if(lb.x < hb.x){\n\n    lc.x = lb.x;\n    hc.x = hb.x;\n\n  }\n  else{\n\n    lc.x = hb.x;\n    hc.x = lb.x;\n\n  }\n\n  if(lb.y < hb.y){\n\n    lc.y = lb.y;\n    hc.y = hb.y;\n\n  }\n  else{\n\n    lc.y = hb.y;\n    hc.y = lb.y;\n\n  }\n\n  if(lb.z < hb.z){\n\n    lc.z = lb.z;\n    hc.z = hb.z;\n\n  }\n  else{\n\n    lc.z = hb.z;\n    hc.z = lb.z;\n\n  }\n\n  float xd = ( currentVoxel.x - lc.x ) / ( hc.x - lc.x );\n  float yd = ( currentVoxel.y - lc.y ) / ( hc.y - lc.y );\n  float zd = ( currentVoxel.z - lc.z ) / ( hc.z - lc.z );\n\n  //\n  // c00\n  //\n\n  //\n\n  vec4 v000 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c000 = vec3(lc.x, lc.y, lc.z);\n\n  no(c000,\n    kernelSize,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    bitsAllocated, \n    numberOfChannels_1, \n    pixelType_1,\n    packedPerPixel_1,\n    v000\n  );\n\n  //\n\n  vec4 v100 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c100 = vec3(hc.x, lc.y, lc.z);\n\n  no(c100,\n    kernelSize,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    bitsAllocated, \n    numberOfChannels_1, \n    pixelType_1,\n    packedPerPixel_1,\n    v100\n  );\n\n  vec4 c00 = v000 * ( 1.0 - xd ) + v100 * xd;\n\n  //\n  // c01\n  //\n  vec4 v001 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c001 = vec3(lc.x, lc.y, hc.z);\n\n  no(c001,\n    kernelSize,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    bitsAllocated, \n    numberOfChannels_1, \n    pixelType_1,\n    packedPerPixel_1,\n    v001\n  );\n\n  vec4 v101 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c101 = vec3(hc.x, lc.y, hc.z);\n\n  no(c101,\n    kernelSize,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    bitsAllocated, \n    numberOfChannels_1, \n    pixelType_1,\n    packedPerPixel_1,\n    v101\n  );\n\n  vec4 c01 = v001 * ( 1.0 - xd ) + v101 * xd;\n\n  //\n  // c10\n  //\n  vec4 v010 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c010 = vec3(lc.x, hc.y, lc.z);\n\n  no(c010,\n    kernelSize,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    bitsAllocated, \n    numberOfChannels_1, \n    pixelType_1,\n    packedPerPixel_1,\n    v010\n  );\n\n  vec4 v110 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c110 = vec3(hc.x, hc.y, lc.z);\n\n  no(c110,\n    kernelSize,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    bitsAllocated, \n    numberOfChannels_1, \n    pixelType_1,\n    packedPerPixel_1,\n    v110\n  );\n\n  vec4 c10 = v010 * ( 1.0 - xd ) + v110 * xd;\n\n  //\n  // c11\n  //\n  vec4 v011 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c011 = vec3(lc.x, hc.y, hc.z);\n\n  no(c011,\n    kernelSize,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    bitsAllocated, \n    numberOfChannels_1, \n    pixelType_1,\n    packedPerPixel_1,\n    v011\n  );\n\n  vec4 v111 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c111 = vec3(hc.x, hc.y, hc.z);\n\n  no(c111,\n    kernelSize,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    bitsAllocated, \n    numberOfChannels_1, \n    pixelType_1,\n    packedPerPixel_1,\n    v111\n  );\n\n  vec4 c11 = v011 * ( 1.0 - xd ) + v111 * xd;\n\n  // c0 and c1\n  vec4 c0 = c00 * ( 1.0 - yd) + c10 * yd;\n  vec4 c1 = c01 * ( 1.0 - yd) + c11 * yd;\n\n  // c\n  vec4 c = c0 * ( 1.0 - zd) + c1 * zd;\n  intensity_1 = c;\n\n}\n\n// Support up to textureSize*textureSize*7 voxels\n\nvoid value_0(in vec3 dataCoordinates,\n           in int kernelSize,\n           in int interpolationMethod,\n           in ivec3 dataDimensions,\n           in int textureSize,\n           in sampler2D textureContainer0,\n           in sampler2D textureContainer1,\n           in sampler2D textureContainer2,\n           in sampler2D textureContainer3,\n           in sampler2D textureContainer4,\n           in sampler2D textureContainer5,\n           in sampler2D textureContainer6,\n           in sampler2D textureContainer[7], // not working on Moto X 2014\n           in int bitsAllocated, \n           in int numberOfChannels_2, \n           in int pixelType_2,\n           in int packedPerPixel_2,\n           out vec4 intensity_2\n  ) {\n\n  if( interpolationMethod == 0){\n\n    // no interpolation\n    no(dataCoordinates,\n       kernelSize,\n       dataDimensions,\n       textureSize,\n       textureContainer0,\n       textureContainer1,\n       textureContainer2,\n       textureContainer3,\n       textureContainer4,\n       textureContainer5,\n       textureContainer6,\n       textureContainer,\n       bitsAllocated,\n       numberOfChannels_2,\n       pixelType_2,\n       packedPerPixel_2,\n       intensity_2);\n\n  }\n  else if( interpolationMethod == 1){\n\n    // trilinear interpolation\n    trilinear(dataCoordinates,\n      kernelSize,\n      dataDimensions,\n      textureSize,\n      textureContainer0,\n      textureContainer1,\n      textureContainer2,\n      textureContainer3,\n      textureContainer4,\n      textureContainer5,\n      textureContainer6,\n      textureContainer,\n      bitsAllocated,\n      numberOfChannels_2,\n      pixelType_2,\n      packedPerPixel_2,\n      intensity_2);\n\n  }\n\n}\n\nvec3 transformPoint(const in vec3 samplePoint, const in float frequency, const in float amplitude)\n// Apply a spatial transformation to a world space point\n{\n  return samplePoint + amplitude * vec3(samplePoint.x * sin(frequency * samplePoint.z),\n                                        samplePoint.y * cos(frequency * samplePoint.z),\n                                        0);\n}\n\n// needed for glslify\n\nvoid intersectBox(vec3 rayOrigin, vec3 rayDirection, vec3 boxMin, vec3 boxMax, out float tNear, out float tFar, out bool intersect){\n  // compute intersection of ray with all six bbox planes\n  vec3 invRay = vec3(1.) / rayDirection;\n  vec3 tBot = invRay * (boxMin - rayOrigin);\n  vec3 tTop = invRay * (boxMax - rayOrigin);\n  // re-order intersections to find smallest and largest on each axis\n  vec3 tMin = min(tTop, tBot);\n  vec3 tMax = max(tTop, tBot);\n  // find the largest tMin and the smallest tMax\n  float largest_tMin = max(max(tMin.x, tMin.y), max(tMin.x, tMin.z));\n  float smallest_tMax = min(min(tMax.x, tMax.y), min(tMax.x, tMax.z));\n  tNear = largest_tMin;\n  tFar = smallest_tMax;\n  intersect = smallest_tMax > largest_tMin;\n}\n\n/**\n * Get voxel value given IJK coordinates.\n * Also apply:\n *  - rescale slope/intercept\n *  - window center/width\n */\nvoid getIntensity(in vec3 dataCoordinates, out float intensity){\n\n  vec4 dataValue = vec4(0., 0., 0., 0.);\n  int kernelSize = 2;\n  value_0(\n    dataCoordinates,\n    kernelSize,\n    uInterpolation,\n    uDataDimensions,\n    uTextureSize,\n    uTextureContainer[0],\n    uTextureContainer[1],\n    uTextureContainer[2],\n    uTextureContainer[3],\n    uTextureContainer[4],\n    uTextureContainer[5],\n    uTextureContainer[6],\n    uTextureContainer,     // not working on Moto X 2014\n    uBitsAllocated,\n    uNumberOfChannels,\n    uPixelType,\n    uPackedPerPixel,\n    dataValue\n  );\n\n  intensity = dataValue.r;\n\n  // rescale/slope\n  intensity = intensity*uRescaleSlopeIntercept[0] + uRescaleSlopeIntercept[1];\n  // window level\n  float windowMin = uWindowCenterWidth[0] - uWindowCenterWidth[1] * 0.5;\n  intensity = ( intensity - windowMin ) / uWindowCenterWidth[1];\n}\n\nvoid main(void) {\n  const int maxSteps = 1024;\n\n  // the ray\n  vec3 rayOrigin = cameraPosition;\n  vec3 rayDirection = normalize(vPos.xyz - rayOrigin);\n\n  // the Axe-Aligned B-Box\n  vec3 AABBMin = vec3(uWorldBBox[0], uWorldBBox[2], uWorldBBox[4]);\n  vec3 AABBMax = vec3(uWorldBBox[1], uWorldBBox[3], uWorldBBox[5]);\n\n  // Intersection ray/bbox\n  float tNear, tFar;\n  bool intersect = false;\n  intersectBox(rayOrigin, rayDirection, AABBMin, AABBMax, tNear, tFar, intersect);\n  if (tNear < 0.0) tNear = 0.0;\n\n  // init the ray marching\n  float tCurrent = tNear;\n  float tStep = (tFar - tNear) / float(uSteps);\n  vec4 accumulatedColor = vec4(0.0);\n  float accumulatedAlpha = 0.0;\n\n  for(int rayStep = 0; rayStep < maxSteps; rayStep++){\n    vec3 currentPosition = rayOrigin + rayDirection * tCurrent;\n    // some non-linear FUN\n    // some occlusion issue to be fixed\n    vec3 transformedPosition = transformPoint(currentPosition, uAmplitude, uFrequence);\n    // world to data coordinates\n    // rounding trick\n    // first center of first voxel in data space is CENTERED on (0,0,0)\n    vec4 dataCoordinatesRaw = uWorldToData * vec4(transformedPosition, 1.0);\n    vec3 currentVoxel = vec3(dataCoordinatesRaw.x, dataCoordinatesRaw.y, dataCoordinatesRaw.z);\n\n    if ( all(greaterThanEqual(currentVoxel, vec3(0.0))) &&\n         all(lessThan(currentVoxel, vec3(float(uDataDimensions.x), float(uDataDimensions.y), float(uDataDimensions.z))))) {\n    // mapped intensity, given slope/intercept and window/level\n    float intensity = 0.0;\n    getIntensity(currentVoxel, intensity);\n    vec4 colorSample;\n    float alphaSample;\n    if(uLut == 1){\n      vec4 colorFromLUT = texture2D( uTextureLUT, vec2( intensity, 1.0) );\n      // 256 colors\n      colorSample.r = colorFromLUT.r;\n      colorSample.g = colorFromLUT.g;\n      colorSample.b = colorFromLUT.b;\n      alphaSample = colorFromLUT.a;\n    }\n    else{\n      alphaSample = intensity;\n      colorSample.r = colorSample.g = colorSample.b = intensity * alphaSample;\n    }\n\n    alphaSample = alphaSample * uAlphaCorrection;\n    alphaSample *= (1.0 - accumulatedAlpha);\n\n    accumulatedColor += alphaSample * colorSample;\n    accumulatedAlpha += alphaSample;\n\n    }\n\n    tCurrent += tStep;\n\n    if(tCurrent > tFar || accumulatedAlpha >= 1.0 ) break;\n  }\n\n  gl_FragColor = vec4(accumulatedColor.xyz, accumulatedAlpha);\n  return;\n}\n",side:THREE.FrontSide,transparent:!0})}},{key:"_prepareGeometry",value:function(){var e=this._stack.worldBoundingBox(),t=this._stack.worldCenter();this._geometry=new THREE.BoxGeometry(e[1]-e[0],e[3]-e[2],e[5]-e[4]),this._geometry.applyMatrix((new THREE.Matrix4).makeTranslation(t.x,t.y,t.z))}},{key:"uniforms",get:function(){return this._uniforms},set:function(e){this._uniforms=e}},{key:"stack",get:function(){return this._stack},set:function(e){this._stack=e}}]),t}(THREE.Object3D);n["default"]=f},{"../../src/shaders/shaders.raycasting":95}],77:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":s(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":s(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=e("../../src/geometries/geometries.voxel"),c=i(u),f=e("../../src/models/models.stack"),d=i(f),h=e("../../src/models/models.voxel"),p=i(h),m=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?null:arguments[0],n=arguments.length<=1||void 0===arguments[1]?null:arguments[1];r(this,t);var i=o(this,Object.getPrototypeOf(t).call(this));return i._stack=n,i._worldCoordinates=e,i._voxel=new p["default"],i._voxel.id=i.id,i._voxel.worldCoordinates=i._worldCoordinates,i._stack&&i._stack.prepared&&i._worldCoordinates&&i.updateVoxel(i._worldCoordinates),i._mesh=null,i._geometry=null,i._material=null,i._selected=!1,i._active=!1,i._hover=!1,i._distance=null,i._showVoxel=!0,i._showDomSVG=!0,i._showDomMeasurements=!0,i._color="#00B0FF",i._svgPointer='<svg width="40" height="40"                       viewBox="0 0 140 140" version="1.1"                       xmlns="http://www.w3.org/2000/svg">                                             <path d="M70,70                                L30,30                                A10,10 0 1 1 10,10                               A10,10 0 1 1 30,30" />                                            </svg>',i.createMesh(),i}return a(t,e),l(t,[{key:"updateVoxel",value:function(e){this._voxel.worldCoordinates=e,this._voxel.dataCoordinates=d["default"].worldToData(this._stack,this._voxel.worldCoordinates);var t=d["default"].value(this._stack,this._voxel.dataCoordinates);this._voxel.value=d["default"].valueRescaleSlopeIntercept(t,this._stack.rescaleSlope,this._stack.rescaleIntercept)}},{key:"updateVoxelScreenCoordinates",value:function(e,n){this._voxel.screenCoordinates=t.worldToScreen(this._worldCoordinates,e,n)}},{key:"createMesh",value:function(){var e=d["default"].worldToData(this._stack,this._worldCoordinates);this._geometry=new c["default"](e),this._material=new THREE.MeshBasicMaterial({wireframe:!0,wireframeLinewidth:2}),this._material.color.set(this._color),this._mesh=new THREE.Mesh(this._geometry,this._material),this._mesh.applyMatrix(this._stack.ijk2LPS),this._mesh.visible=this._showVoxel,this.add(this._mesh)}},{key:"createDom",value:function(){var e=this._createDiv("VJSVoxelMeasurements",this.id,"VJSVoxelMeasurements"),t=this._createDiv("VJSVoxelProbeWorld",this.id,"VJSVoxelProbeWorld");e.appendChild(t);var n=this._createDiv("VJSVoxelProbeData",this.id,"VJSVoxelProbeData");e.appendChild(n);var i=this._createDiv("VJSVoxelProbeValue",this.id,"VJSVoxelProbeValue");e.appendChild(i);var r=this._createDiv("VJSVoxelProbeSVG",this.id,"VJSVoxelProbeSVG");r.innerHTML=this._svgPointer;var o=this._createDiv("VJSWidgetVoxelProbe",this.id,"VJSWidgetVoxelProbe");return o.appendChild(r),o.appendChild(e),o}},{key:"updateDom",value:function(e){null===document.getElementById("VJSVoxelProbeWorld"+this.id)&&e.appendChild(this.createDom());var t=document.getElementById("VJSVoxelProbeWorld"+this.id),n=this._voxel.worldCoordinates.x.toFixed(2)+" : "+this._voxel.worldCoordinates.y.toFixed(2)+" : "+this._voxel.worldCoordinates.z.toFixed(2);t.innerHTML="LPS: "+n;var i=document.getElementById("VJSVoxelProbeData"+this.id),r=this._voxel.dataCoordinates.x+" : "+this._voxel.dataCoordinates.y+" : "+this._voxel.dataCoordinates.z;i.innerHTML="IJK: "+r;var o=document.getElementById("VJSVoxelProbeValue"+this.id),a=this._voxel.value;o.innerHTML="Value: "+a;var s=document.getElementById("VJSWidgetVoxelProbe"+this.id);s.style.top=this._voxel.screenCoordinates.y,s.style.left=this._voxel.screenCoordinates.x,this.updateDomClass(s)}},{key:"updateDomClass",
value:function(){var e=document.getElementById("VJSWidgetVoxelProbe"+this.id);this._active===!0?e.classList.add("VJSVoxelProbeActive"):e.classList.remove("VJSVoxelProbeActive"),this._hover===!0?e.classList.add("VJSVoxelProbeHover"):e.classList.remove("VJSVoxelProbeHover"),this._selected===!0?e.classList.add("VJSVoxelProbeSelect"):e.classList.remove("VJSVoxelProbeSelect"),this.updateDomElementDisplay("VJSVoxelMeasurements"+this.id,this._showDomMeasurements),this.updateDomElementDisplay("VJSVoxelProbeSVG"+this.id,this._showDomSVG)}},{key:"updateDomElementDisplay",value:function(e,t){t?document.getElementById(e).style.display="block":document.getElementById(e).style.display="none"}},{key:"removeTest",value:function(){var e=document.getElementById("VJSWidgetVoxelProbe"+this.id);e.parentNode&&e.parentNode.removeChild(e),this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.material.dispose(),this._mesh=null}},{key:"_createDiv",value:function(e,t,n){var i=document.createElement("div");return i.setAttribute("id",e+t),i.setAttribute("class",n),i}},{key:"color",set:function(e){this._color=e,this._material&&this._material.color.set(this._color);var t=document.getElementById("VJSVoxelMeasurements"+this.id);t&&(t.style.borderColor=this._color.replace("0x","#")),t=document.querySelector("#VJSVoxelProbeSVG"+this.id+"> svg > path"),t&&(t.style.stroke=this._color.replace("0x","#"))},get:function(){return this._color}},{key:"worldCoordinates",set:function(e){this._worldCoordinates=e,this._voxel._worldCoordinates=e,this.updateVoxel(this._worldCoordinates),this._mesh&&this._mesh.geometry&&(this._mesh.geometry.location=this._voxel.dataCoordinates)},get:function(){return this._worldCoordinates}},{key:"voxel",get:function(){return this._voxel},set:function(e){this._voxel=e}},{key:"showVoxel",set:function(e){this._showVoxel=e,this._mesh&&(this._mesh.visible=this._showVoxel)},get:function(){return this._showVoxel}},{key:"showDomSVG",set:function(e){this._showDomSVG=e,this.updateDomClass()},get:function(){return this._showDomSVG}},{key:"showDomMeasurements",set:function(e){this._showDomMeasurements=e,this.updateDomClass()},get:function(){return this._showDomMeasurements}},{key:"distance",set:function(e){this._distance=e},get:function(){return this._distance}},{key:"selected",set:function(e){this._selected=e},get:function(){return this._selected}},{key:"hover",set:function(e){this._hover=e},get:function(){return this._hover}},{key:"active",set:function(e){this._active=e},get:function(){return this._active}}],[{key:"worldToScreen",value:function(e,t,n){var i=e.clone();return i.project(t),i.x=Math.round((i.x+1)*n.offsetWidth/2),i.y=Math.round((-i.y+1)*n.offsetHeight/2),i.z=0,i}}]),t}(THREE.Object3D);n["default"]=m},{"../../src/geometries/geometries.voxel":68,"../../src/models/models.stack":85,"../../src/models/models.voxel":86}],78:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=e("../../src/helpers/helpers.progressbar"),s=i(a),l=e("../../src/models/models.series"),u=(i(l),e("../../src/models/models.stack")),c=(i(u),e("../../src/models/models.frame")),f=(i(c),function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?document.body:arguments[0],n=arguments.length<=1||void 0===arguments[1]?s["default"]:arguments[1];r(this,e),this._loaded=-1,this._totalLoaded=-1,this._parsed=-1,this._totalParsed=-1,this._container=t,this._helpersProgressBar=n,this._progressBar=null,this._container&&this._helpersProgressBar&&(this._progressBar=new n(this._container))}return o(e,[{key:"free",value:function(){this._container=null,this._helpersProgressBar=null,this._progressBar&&(this._progressBar.free(),this._progressBar=null)}},{key:"fetch",value:function(e){var t=this;return new Promise(function(n,i){var r=new XMLHttpRequest;r.open("GET",e),r.crossOrigin=!0,r.responseType="arraybuffer",r.onload=function(o){if(200===r.status){t._loaded=o.loaded,t._totalLoaded=o.total,t._progressBar&&t._progressBar.update(t._loaded,t._totalLoaded,"load");var a=r.response,s={url:e,buffer:a};n(s)}else i(r.statusText)},r.onerror=function(){i(r.statusText)},r.onprogress=function(e){t._loaded=e.loaded,t._totalLoaded=e.total,t._progressBar&&t._progressBar.update(t._loaded,t._totalLoaded,"load")},r.send()})}}]),e}());n["default"]=f},{"../../src/helpers/helpers.progressbar":73,"../../src/models/models.frame":82,"../../src/models/models.series":84,"../../src/models/models.stack":85}],79:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var r=e("./loaders.volume"),o=i(r);n["default"]={Volume:o["default"]}},{"./loaders.volume":80}],80:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":s(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":s(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=e("./loaders.base"),c=i(u),f=e("../../src/models/models.series"),d=i(f),h=e("../../src/models/models.stack"),p=i(h),m=e("../../src/models/models.frame"),v=i(m),y=e("../../src/parsers/parsers.dicom"),x=i(y),b=e("../../src/parsers/parsers.nifti"),_=i(b),g=e("../../src/parsers/parsers.nrrd"),w=i(g),k=e("pako"),C=function(e){function t(){return r(this,t),o(this,Object.getPrototypeOf(t).apply(this,arguments))}return a(t,e),l(t,[{key:"parse",value:function(e){var t=this;return new Promise(function(n,i){var r=e;r.gzcompressed=!1,r.filename="",r.extension="",r.filename=e.url.split("/").pop(),r.gzcompressed=!1;var o=r.filename.split(".");if(o.length<=1?r.extension="":r.extension=r.filename.split(".").pop(),"gz"===r.extension){r.gzcompressed=!0,r.extension=r.filename.split(".gz").shift().split(".").pop();var a=k.inflate(r.buffer);r.buffer=a.buffer}var s=t._parser(r.extension);s||i(r.filename+" can not be parsed.");var l=null;try{l=new s(r,0)}catch(u){window.console.log(u),i(u)}var c=new d["default"];c.seriesInstanceUID=l.seriesInstanceUID(),c.numberOfFrames=l.numberOfFrames(),c.numberOfFrames||(c.numberOfFrames=1),c.numberOfChannels=l.numberOfChannels();var f=new p["default"];f.numberOfChannels=l.numberOfChannels(),f.pixelType=l.pixelType(),f.invert=l.invert(),c.stack.push(f),setTimeout(t.parseFrame(c,f,e.url,0,l,n,i),0)})}},{key:"parseFrame",value:function(e,t,n,i,r,o,a){var s=new v["default"];s.sopInstanceUID=r.sopInstanceUID(i),s.url=n,s.rows=r.rows(i),s.columns=r.columns(i),s.numberOfChannels=t.numberOfChannels,s.pixelType=r.pixelType(i),s.pixelData=r.extractPixelData(i),s.pixelSpacing=r.pixelSpacing(i),s.sliceThickness=r.sliceThickness(i),s.imageOrientation=r.imageOrientation(i),null===s.imageOrientation&&(s.imageOrientation=[1,0,0,0,1,0]),s.imagePosition=r.imagePosition(i),null===s.imagePosition&&(s.imagePosition=[0,0,i]),s.dimensionIndexValues=r.dimensionIndexValues(i),s.bitsAllocated=r.bitsAllocated(i),s.instanceNumber=r.instanceNumber(i),s.windowCenter=r.windowCenter(i),s.windowWidth=r.windowWidth(i),s.rescaleSlope=r.rescaleSlope(i),s.rescaleIntercept=r.rescaleIntercept(i),s.minMax=r.minMaxPixelData(s.pixelData),t.frame.push(s),this._parsed=i+1,this._totalParsed=e.numberOfFrames,this._progressBar&&this._progressBar.update(this._parsed,this._totalParsed,"parse"),this._parsed===this._totalParsed?o(e):setTimeout(this.parseFrame(e,t,n,this._parsed,r,o,a),0)}},{key:"_parser",value:function(e){var t=null;switch(e.toUpperCase()){case"NII":case"NII_":t=_["default"];break;case"DCM":case"DICOM":case"IMA":case"":t=x["default"];break;case"NRRD":t=w["default"];break;default:return window.console.log("unsupported extension: "+e),!1}return t}}]),t}(c["default"]);n["default"]=C},{"../../src/models/models.frame":82,"../../src/models/models.series":84,"../../src/models/models.stack":85,"../../src/parsers/parsers.dicom":87,"../../src/parsers/parsers.nifti":89,"../../src/parsers/parsers.nrrd":90,"./loaders.base":78,pako:29}],81:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(){i(this,e),this._id=-1}return r(e,[{key:"mergeModels",value:function(e,t){if(!this._validateModelArray(e)||!this._validateModelArray(t))return window.console.log("invalid inputs provided."),!1;for(var n=0;n<t.length;n++)for(var i=0;i<e.length&&!e[i].merge(t[n]);i++)i===e.length-1&&e.push(t[n]);return!0}},{key:"merge",value:function(e){return this.validate(e)?this._id===e._id:!1}},{key:"validate",value:function(e){return!(!e||null===e||"function"!=typeof e.merge)}},{key:"_validateModelArray",value:function(e){if(null===e||Array!==e.constructor)return window.console.log("invalid model array provided."),!1;for(var t=0;t<e.length;t++)if(!e[t]||null===e[t]||"function"!=typeof e[t].validate||!e[t].validate(e[t]))return!1;return!0}}]),e}();n["default"]=o},{}],82:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":s(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":s(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=function h(e,t,n){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,t);if(void 0===i){var r=Object.getPrototypeOf(e);return null===r?void 0:h(r,t,n)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(n)},c=e("../../src/models/models.base"),f=i(c),d=function(e){function t(){r(this,t);var e=o(this,Object.getPrototypeOf(t).call(this));return e._sopInstanceUID=null,e._url=null,e._stackID=-1,e._rows=0,e._columns=0,e._dimensionIndexValues=[],e._imagePosition=null,e._imageOrientation=null,e._sliceThickness=1,e._spacingBetweenSlices=null,e._pixelType=0,e._pixelSpacing=null,e._pixelAspectRatio=null,e._pixelData=null,e._instanceNumber=null,e._windowCenter=null,e._windowWidth=null,e._rescaleSlope=null,e._rescaleIntercept=null,e._bitsAllocated=8,e._minMax=null,e._dist=null,e}return a(t,e),l(t,[{key:"validate",value:function(e){return!!(u(Object.getPrototypeOf(t.prototype),"validate",this).call(this,e)&&"function"==typeof e.cosines&&"function"==typeof e.spacingXY&&e.hasOwnProperty("_sopInstanceUID")&&e.hasOwnProperty("_dimensionIndexValues")&&e.hasOwnProperty("_imageOrientation")&&e.hasOwnProperty("_imagePosition"))}},{key:"merge",value:function(e){return this.validate(e)?!!(this._compareArrays(this._dimensionIndexValues,e.dimensionIndexValues)&&this._compareArrays(this._imageOrientation,e.imageOrientation)&&this._compareArrays(this._imagePosition,e.imagePosition)&&this._instanceNumber===e.instanceNumber&&this._sopInstanceUID===e.sopInstanceUID):!1}},{key:"cosines",value:function n(){var n=[new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1)];if(this._imageOrientation&&6===this._imageOrientation.length){var e=new THREE.Vector3(this._imageOrientation[0],this._imageOrientation[1],this._imageOrientation[2]),t=new THREE.Vector3(this._imageOrientation[3],this._imageOrientation[4],this._imageOrientation[5]);e.length()>0&&t.length()>0&&(n[0]=e,n[1]=t,n[2]=new THREE.Vector3(0,0,0).crossVectors(n[0],n[1]).normalize())}else window.console.log("No valid image orientation for frame"),window.console.log(this),window.console.log("Returning default orientation.");return n}},{key:"spacingXY",value:function i(){var i=[1,1];return this.pixelSpacing?(i[0]=this.pixelSpacing[0],i[1]=this.pixelSpacing[1]):this.pixelAspectRatio&&(i[0]=1,i[1]=1*this.pixelAspectRatio[1]/this.pixelAspectRatio[0]),i}},{key:"value",value:function(e,t){return this.pixelData[e+this._columns*t]}},{key:"_compareArrays",value:function(e,t){return e===t?!0:!(!e||!t||e.join()!==t.join())}},{key:"rows",get:function(){return this._rows},set:function(e){this._rows=e}},{key:"columns",get:function(){return this._columns},set:function(e){this._columns=e}},{key:"spacingBetweenSlices",get:function(){return this._spacingBetweenSlices},set:function(e){this._spacingBetweenSlices=e}},{key:"sliceThickness",get:function(){return this._sliceThickness},set:function(e){this._sliceThickness=e}},{key:"imagePosition",get:function(){return this._imagePosition},set:function(e){this._imagePosition=e}},{key:"imageOrientation",get:function(){return this._imageOrientation},set:function(e){this._imageOrientation=e}},{key:"windowWidth",get:function(){return this._windowWidth},set:function(e){this._windowWidth=e}},{key:"windowCenter",get:function(){return this._windowCenter},set:function(e){this._windowCenter=e}},{key:"rescaleSlope",get:function(){return this._rescaleSlope},set:function(e){this._rescaleSlope=e}},{key:"rescaleIntercept",get:function(){return this._rescaleIntercept},set:function(e){this._rescaleIntercept=e}},{key:"bitsAllocated",get:function(){return this._bitsAllocated},set:function(e){this._bitsAllocated=e}},{key:"dist",get:function(){return this._dist},set:function(e){this._dist=e}},{key:"pixelSpacing",get:function(){return this._pixelSpacing},set:function(e){this._pixelSpacing=e}},{key:"pixelAspectRatio",get:function(){return this._pixelAspectRatio},set:function(e){this._pixelAspectRatio=e}},{key:"minMax",get:function(){return this._minMax},set:function(e){this._minMax=e}},{key:"dimensionIndexValues",get:function(){return this._dimensionIndexValues},set:function(e){this._dimensionIndexValues=e}},{key:"instanceNumber",get:function(){return this._instanceNumber},set:function(e){this._instanceNumber=e}},{key:"pixelData",get:function(){return this._pixelData},set:function(e){this._pixelData=e}},{key:"sopInstanceUID",set:function(e){this._sopInstanceUID=e},get:function(){return this._sopInstanceUID}},{key:"pixelType",get:function(){return this._pixelType},set:function(e){this._pixelType=e}},{key:"url",get:function(){return this._url},set:function(e){this._url=e}}]),t}(f["default"]);n["default"]=d},{"../../src/models/models.base":81}],83:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var r=e("./models.frame"),o=i(r),a=e("./models.stack"),s=i(a),l=e("./models.series"),u=i(l),c=e("./models.voxel"),f=i(c);n["default"]={Frame:o["default"],Stack:s["default"],Series:u["default"],Voxel:f["default"]}},{"./models.frame":82,"./models.series":84,"./models.stack":85,"./models.voxel":86}],84:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":s(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":s(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=function h(e,t,n){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,t);if(void 0===i){var r=Object.getPrototypeOf(e);return null===r?void 0:h(r,t,n)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(n)},c=e("../../src/models/models.base"),f=i(c),d=function(e){function t(){r(this,t);var e=o(this,Object.getPrototypeOf(t).call(this));return e._concatenationUID=-1,e._seriesInstanceUID=-1,e._seriesNumber=-1,e._dimensionIndexSequence=[],e._numberOfFrames=0,e._numberOfChannels=1,e._stack=[],e}return a(t,e),l(t,[{key:"validate",value:function(e){return!!(u(Object.getPrototypeOf(t.prototype),"validate",this).call(this,e)&&"function"==typeof e.mergeSeries&&e.hasOwnProperty("_seriesInstanceUID")&&e.hasOwnProperty("_numberOfFrames")&&e.hasOwnProperty("_numberOfChannels")&&e.hasOwnProperty("_stack")&&"undefined"!=typeof e._stack&&Array===e._stack.constructor)}},{key:"merge",value:function(e){return this.validate(e)&&this._seriesInstanceUID===e.seriesInstanceUID?this.mergeModels(this._stack,e.stack):!1}},{key:"mergeSeries",value:function(e){var t=[this];return this.mergeModels(t,e),t}},{key:"seriesInstanceUID",set:function(e){this._seriesInstanceUID=e},get:function(){return this._seriesInstanceUID}},{key:"numberOfFrames",set:function(e){this._numberOfFrames=e},get:function(){return this._numberOfFrames}},{key:"numberOfChannels",set:function(e){this._numberOfChannels=e},get:function(){return this._numberOfChannels}},{key:"stack",set:function(e){this._stack=e},get:function(){return this._stack}}]),t}(f["default"]);n["default"]=d},{"../../src/models/models.base":81}],85:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":s(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":s(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=e("../../src/core/core.pack"),c=(i(u),e("../../src/models/models.base")),f=i(c),d=e("math-float32-to-binary-string"),h=function(e){function t(){r(this,t);var e=o(this,Object.getPrototypeOf(t).call(this));return e._uid=null,e._stackID=-1,e._frame=[],e._numberOfFrames=0,e._rows=0,e._columns=0,e._numberOfChannels=1,e._bitsAllocated=8,e._pixelType=0,e._origin=null,e._textureSize=4096,e._nbTextures=7,e._rawData=[],e._windowCenter=0,e._windowWidth=0,e._rescaleSlope=1,e._rescaleIntercept=0,e._minMax=[65535,-32768],e._ijk2LPS=null,e._lps2IJK=null,e._aabb2LPS=null,e._lps2AABB=null,e._dimensionsIJK=null,e._halfDimensionsIJK=null,e._spacing=new THREE.Vector3(1,1,1),e._spacingBetweenSlices=0,e._sliceThickness=0,e._origin=null,e._xCosine=new THREE.Vector3(1,0,0),e._yCosine=new THREE.Vector3(0,1,0),e._zCosine=new THREE.Vector3(0,0,1),e._prepared=!1,e._packed=!1,e._packedPerPixel=1,e._invert=!1,e}return a(t,e),l(t,[{key:"prepare",value:function(){if(!(this._frame&&this._frame.length>0))return window.console.log("_frame doesn't contain anything...."),window.console.log(this._frame),!1;this._numberOfFrames=this._frame.length,this._rows=this._frame[0].rows,this._columns=this._frame[0].columns,this._dimensionsIJK=new THREE.Vector3(this._columns,this._rows,this._numberOfFrames),this._halfDimensionsIJK=new THREE.Vector3(this._dimensionsIJK.x/2,this._dimensionsIJK.y/2,this._dimensionsIJK.z/2),this._spacingBetweenSlices=this._frame[0].spacingBetweenSlices,this._sliceThickness=this._frame[0].sliceThickness,this.computeCosines(),this.orderFrames(),this.computeSpacing(),this._frame[0].imagePosition||(this._frame[0].imagePosition=[0,0,0]),this._frame[0].imageOrientation||(this._frame[0].imageOrientation=[1,0,0,0,1,0]),this._origin=this._vector3FromArray(this._frame[0].imagePosition,0),this.computeIJK2LPS(),this.computeLPS2AABB(),this._rescaleSlope=this._frame[0].rescaleSlope||1,this._rescaleIntercept=this._frame[0].rescaleIntercept||0,this.computeMinMaxIntensities(),this._minMax[0]=t.valueRescaleSlopeIntercept(this._minMax[0],this._rescaleSlope,this._rescaleIntercept),this._minMax[1]=t.valueRescaleSlopeIntercept(this._minMax[1],this._rescaleSlope,this._rescaleIntercept);var e=this._frame[0].windowWidth||this._minMax[1]-this._minMax[0];this._windowWidth=this._rescaleSlope*e+this._rescaleIntercept;var n=this._frame[0].windowCenter||this._minMax[0]+e/2;this._windowCenter=this._rescaleSlope*n+this._rescaleIntercept,this._bitsAllocated=this._frame[0].bitsAllocated,this._prepared=!0}},{key:"packEchos",value:function(){for(var e=4,t=[],n=0;n<this._frame.length;n+=e){for(var i=this._frame[n],r=0;r<this._rows*this._columns;r++){for(var o=1;e>o;o++)i.pixelData[r]+=this._frame[n+o].pixelData[r];i.pixelData[r]/=e}t.push(i)}this._frame=t,this._numberOfFrames=this._frame.length,this._dimensionsIJK=new THREE.Vector3(this._columns,this._rows,this._numberOfFrames),this._halfDimensionsIJK=new THREE.Vector3(this._dimensionsIJK.x/2,this._dimensionsIJK.y/2,this._dimensionsIJK.z/2)}},{key:"computeCosines",value:function(){if(this._frame&&this._frame[0]){var e=this._frame[0].cosines();this._xCosine=e[0],this._yCosine=e[1],this._zCosine=e[2]}}},{key:"orderFrames",value:function(){this._frame[0].dimensionIndexValues?this._frame.sort(this._orderFrameOnDimensionIndicesArraySort):this._frame[0].imagePosition&&this._frame[0].imageOrientation&&this._frame[1]&&this._frame[1].imagePosition&&this._frame[1].imageOrientation&&this._frame[0].imagePosition.join()!==this._frame[1].imagePosition.join()?(this._frame.map(this._computeDistanceArrayMap.bind(null,this._zCosine)),this._frame.sort(this._sortDistanceArraySort)):null!==this._frame[0].instanceNumber&&this._frame[1]&&null!==this._frame[1].instanceNumber&&this._frame[0].instanceNumber!==this._frame[1].instanceNumber?this._frame.sort(this._sortInstanceNumberArraySort):this._frame[0].sopInstanceUID&&this._frame[1]&&this._frame[1].sopInstanceUID&&this._frame[0].sopInstanceUID!==this._frame[1].sopInstanceUID?this._frame.sort(this._sortSopInstanceUIDArraySort):window.console.log("do not know how to order the frames...")}},{key:"computeSpacing",value:function(){this.xySpacing(),this.zSpacing()}},{key:"zSpacing",value:function(){this._numberOfFrames>1&&(this._spacingBetweenSlices?this._spacing.z=this._spacingBetweenSlices:this._frame[0].pixelSpacing&&this._frame[0].pixelSpacing[2]?this._spacing.z=this._frame[0].pixelSpacing[2]:(this._frame.map(this._computeDistanceArrayMap.bind(null,this._zCosine)),this._frame.sort(this._sortDistanceArraySort),this._spacing.z=this._frame[1].dist-this._frame[0].dist)),0===this._spacing.z&&(this._spacing.z=1)}},{key:"xySpacing",value:function(){if(this._frame&&this._frame[0]){var e=this._frame[0].spacingXY();this._spacing.x=e[0],this._spacing.y=e[1]}}},{key:"computeMinMaxIntensities",value:function(){for(var e=0;e<this._frame.length;e++)this._minMax[0]=Math.min(this._minMax[0],this._frame[e].minMax[0]),this._minMax[1]=Math.max(this._minMax[1],this._frame[e].minMax[1])}},{key:"computeIJK2LPS",value:function(){this._ijk2LPS=new THREE.Matrix4,this._ijk2LPS.set(this._xCosine.x*this._spacing.x,this._yCosine.x*this._spacing.y,this._zCosine.x*this._spacing.z,this._origin.x,this._xCosine.y*this._spacing.x,this._yCosine.y*this._spacing.y,this._zCosine.y*this._spacing.z,this._origin.y,this._xCosine.z*this._spacing.x,this._yCosine.z*this._spacing.y,this._zCosine.z*this._spacing.z,this._origin.z,0,0,0,1),this._lps2IJK=new THREE.Matrix4,this._lps2IJK.getInverse(this._ijk2LPS)}},{key:"computeLPS2AABB",value:function(){this._aabb2LPS=new THREE.Matrix4,this._aabb2LPS.set(this._xCosine.x,this._yCosine.x,this._zCosine.x,this._origin.x,this._xCosine.y,this._yCosine.y,this._zCosine.y,this._origin.y,this._xCosine.z,this._yCosine.z,this._zCosine.z,this._origin.z,0,0,0,1),this._lps2AABB=new THREE.Matrix4,this._lps2AABB.getInverse(this._aabb2LPS)}},{key:"merge",value:function(e){return this._stackID===e.stackID?this.mergeModels(this._frame,e.frame):!1}},{key:"pack",value:function(){var e=this._dimensionsIJK.x*this._dimensionsIJK.y*this._dimensionsIJK.z;16===this._bitsAllocated&&1===this._numberOfChannels&&(this._packedPerPixel=2);var t=this._textureSize*this._textureSize,n=Math.ceil(e/(t*this._packedPerPixel)),i=0,r=this._packedPerPixel*t;r>e&&(r=e);for(var o=0;n>o;o++){var a=this._packTo8Bits(this._bitsAllocated,this._pixelType,this._numberOfChannels,this._frame,this._textureSize,i,r);this._textureType=a.textureType,this._rawData.push(a.data),i+=this._packedPerPixel*t,r+=this._packedPerPixel*t,r>e&&(r=e)}this._packed=!0}},{key:"_packTo8Bits",value:function(e,t,n,i,r,o,a){var s={textureType:null,data:null},l=0,u=0,c=0,f=i[0].rows*i[0].columns;if(8===e&&1===n||1===e){for(var h=new Uint8Array(r*r*1),p=o;a>p;p++)u=~~(p/f),c=p%f,h[l]=i[u].pixelData[c],l++;s.textureType=THREE.LuminanceFormat,s.data=h}else if(16===e&&1===n){for(var m=new Uint8Array(r*r*4),v=0,y=0,x=o;a>x;x++){u=~~(x/f),c=x%f;var b=i[u].pixelData[c];m[4*v+2*y]=255&b,m[4*v+2*y+1]=b>>>8&255,l++,v=Math.floor(l/2),y=l%2}s.textureType=THREE.RGBAFormat,s.data=m}else if(32===e&&1===n&&0===t){for(var _=new Uint8Array(r*r*4),g=o;a>g;g++){u=~~(g/f),c=g%f;var w=i[u].pixelData[c];_[4*l]=255&w,_[4*l+1]=w>>>8&255,_[4*l+2]=w>>>8&255,_[4*l+3]=w>>>8&255,l++}s.textureType=THREE.RGBAFormat,s.data=_}else if(32===e&&1===n&&1===t){for(var k=new Uint8Array(r*r*4),C=o;a>C;C++){u=~~(C/f),c=C%f;var S=i[u].pixelData[c],I=d(S),T=I.match(/.{1,8}/g);k[4*l]=parseInt(T[0],2),k[4*l+1]=parseInt(T[1],2),k[4*l+2]=parseInt(T[2],2),k[4*l+3]=parseInt(T[3],2),l++}s.textureType=THREE.RGBAFormat,s.data=k}else if(8===e&&3===n){for(var D=new Uint8Array(r*r*3),P=o;a>P;P++)u=~~(P/f),c=P%f,D[3*l]=i[u].pixelData[3*c],D[3*l+1]=i[u].pixelData[3*c+1],D[3*l+2]=i[u].pixelData[3*c+2],l++;s.textureType=THREE.RGBFormat,s.data=D}return s}},{key:"worldCenter",value:function(){var e=this._halfDimensionsIJK.clone().addScalar(-.5).applyMatrix4(this._ijk2LPS);return e}},{key:"worldBoundingBox",value:function(){for(var e=[Number.MAX_VALUE,Number.MIN_VALUE,Number.MAX_VALUE,Number.MIN_VALUE,Number.MAX_VALUE,Number.MIN_VALUE],t=0;t<=this._dimensionsIJK.x;t+=this._dimensionsIJK.x)for(var n=0;n<=this._dimensionsIJK.y;n+=this._dimensionsIJK.y)for(var i=0;i<=this._dimensionsIJK.z;i+=this._dimensionsIJK.z){var r=new THREE.Vector3(t,n,i).applyMatrix4(this._ijk2LPS);e=[Math.min(e[0],r.x),Math.max(e[1],r.x),Math.min(e[2],r.y),Math.max(e[3],r.y),Math.min(e[4],r.z),Math.max(e[5],r.z)]}return e}},{key:"AABBox",value:function(){var e=(new THREE.Vector3).addScalar(-.5).applyMatrix4(this._ijk2LPS).applyMatrix4(this._lps2AABB),t=this._dimensionsIJK.clone().addScalar(-.5).applyMatrix4(this._ijk2LPS).applyMatrix4(this._lps2AABB),n=new THREE.Vector3(Math.abs(e.x-t.x),Math.abs(e.y-t.y),Math.abs(e.z-t.z));return n}},{key:"centerAABBox",value:function(){var e=this.worldCenter();return e.applyMatrix4(this._lps2AABB),e}},{key:"_vector3FromArray",value:function(e,t){return new THREE.Vector3(e[t],e[t+1],e[t+2])}},{key:"_orderFrameOnDimensionIndicesArraySort",value:function(e,t){if("dimensionIndexValues"in e&&"[object Array]"===Object.prototype.toString.call(e.dimensionIndexValues)&&"dimensionIndexValues"in t&&"[object Array]"===Object.prototype.toString.call(t.dimensionIndexValues))for(var n=0;n<e.dimensionIndexValues.length;n++){if(parseInt(e.dimensionIndexValues[n],10)>parseInt(t.dimensionIndexValues[n],10))return 1;if(parseInt(e.dimensionIndexValues[n],10)<parseInt(t.dimensionIndexValues[n],10))return-1}else window.console.log("One of the frames doesn't have a dimensionIndexValues array."),window.console.log(e),window.console.log(t);return 0}},{key:"_computeDistanceArrayMap",value:function(e,t){return t.dist=t.imagePosition[0]*e.x+t.imagePosition[1]*e.y+t.imagePosition[2]*e.z,t}},{key:"_sortDistanceArraySort",value:function(e,t){return e.dist-t.dist}},{key:"_sortInstanceNumberArraySort",value:function(e,t){return e.instanceNumber-t.instanceNumber}},{key:"_sortSopInstanceUIDArraySort",value:function(e,t){return e.sopInstanceUID-t.sopInstanceUID}},{key:"numberOfChannels",set:function(e){this._numberOfChannels=e},get:function(){return this._numberOfChannels}},{key:"frame",set:function(e){this._frame=e},get:function(){return this._frame}},{key:"prepared",set:function(e){this._prepared=e},get:function(){return this._prepared}},{key:"packed",set:function(e){this._packed=e},get:function(){return this._packed}},{key:"packedPerPixel",set:function(e){this._packedPerPixel=e},get:function(){return this._packedPerPixel}},{key:"dimensionsIJK",set:function(e){this._dimensionsIJK=e},get:function(){return this._dimensionsIJK}},{key:"halfDimensionsIJK",set:function(e){this._halfDimensionsIJK=e},get:function(){return this._halfDimensionsIJK}},{key:"ijk2LPS",set:function(e){this._ijk2LPS=e},get:function(){return this._ijk2LPS}},{key:"lps2IJK",set:function(e){this._lps2IJK=e},get:function(){return this._lps2IJK}},{key:"lps2AABB",set:function(e){this._lps2AABB=e},get:function(){return this._lps2AABB}},{key:"textureSize",set:function(e){this._textureSize=e},get:function(){return this._textureSize}},{key:"textureType",set:function(e){this._textureType=e},get:function(){return this._textureType}},{key:"bitsAllocated",
set:function(e){this._bitsAllocated=e},get:function(){return this._bitsAllocated}},{key:"rawData",set:function(e){this._rawData=e},get:function(){return this._rawData}},{key:"windowWidth",get:function(){return this._windowWidth},set:function(e){this._windowWidth=e}},{key:"windowCenter",get:function(){return this._windowCenter},set:function(e){this._windowCenter=e}},{key:"rescaleSlope",get:function(){return this._rescaleSlope},set:function(e){this._rescaleSlope=e}},{key:"rescaleIntercept",get:function(){return this._rescaleIntercept},set:function(e){this._rescaleIntercept=e}},{key:"xCosine",get:function(){return this._xCosine},set:function(e){this._xCosine=e}},{key:"yCosine",get:function(){return this._yCosine},set:function(e){this._yCosine=e}},{key:"zCosine",get:function(){return this._zCosine},set:function(e){this._zCosine=e}},{key:"minMax",get:function(){return this._minMax},set:function(e){this._minMax=e}},{key:"stackID",get:function(){return this._stackID},set:function(e){this._stackID=e}},{key:"pixelType",get:function(){return this._pixelType},set:function(e){this._pixelType=e}},{key:"invert",set:function(e){this._invert=e},get:function(){return this._invert}}],[{key:"worldToData",value:function(e,t){var n=(new THREE.Vector3).copy(t).applyMatrix4(e._lps2IJK);return n.addScalar(.5).floor(),n}},{key:"value",value:function(e,t){return t.z>=0&&t.z<e._frame.length?e._frame[t.z].value(t.x,t.y):null}},{key:"valueRescaleSlopeIntercept",value:function(e,t,n){return e*t+n}},{key:"indexInDimensions",value:function(e,t){return e.x>=0&&e.y>=0&&e.z>=0&&e.x<t.x&&e.y<t.y&&e.z<t.z}}]),t}(f["default"]);n["default"]=h},{"../../src/core/core.pack":63,"../../src/models/models.base":81,"math-float32-to-binary-string":21}],86:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(){i(this,e),this._id=-1,this._worldCoordinates=null,this._dataCoordinates=null,this._screenCoordinates=null,this._value=null}return r(e,[{key:"worldCoordinates",set:function(e){this._worldCoordinates=e},get:function(){return this._worldCoordinates}},{key:"dataCoordinates",set:function(e){this._dataCoordinates=e},get:function(){return this._dataCoordinates}},{key:"screenCoordinates",set:function(e){this._screenCoordinates=e},get:function(){return this._screenCoordinates}},{key:"value",set:function(e){this._value=e},get:function(){return this._value}},{key:"id",set:function(e){this._id=e},get:function(){return this._id}}]),e}();n["default"]=o},{}],87:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":s(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":s(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=e("./parsers.volume"),c=i(u),f=e("dicom-parser"),d=e("jpeg-lossless-decoder-js"),h=e("../../external/scripts/jpeg"),p=e("../../external/scripts/jpx"),m=function(e){function t(e,n){r(this,t);var i=o(this,Object.getPrototypeOf(t).call(this));i._id=n,i._arrayBuffer=e.buffer;var a=new Uint8Array(i._arrayBuffer);i._dataSet=null;try{i._dataSet=f.parseDicom(a)}catch(s){throw window.console.log(s),"parsers.dicom could not parse the file"}return i}return a(t,e),l(t,[{key:"seriesInstanceUID",value:function(){return this._dataSet.string("x0020000e")}},{key:"studyInstanceUID",value:function(){return this._dataSet.string("x0020000d")}},{key:"modality",value:function(){return this._dataSet.string("x00080060")}},{key:"sopInstanceUID",value:function n(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],n=this._findStringEverywhere("x2005140f","x00080018",e);return n}},{key:"transferSyntaxUID",value:function(){return this._dataSet.string("x00020010")}},{key:"photometricInterpretation",value:function(){return this._dataSet.string("x00280004")}},{key:"planarConfiguration",value:function i(){var i=this._dataSet.uint16("x00280006");return"undefined"==typeof i&&(i=null),i}},{key:"samplesPerPixel",value:function(){return this._dataSet.uint16("x00280002")}},{key:"numberOfFrames",value:function s(){var s=this._dataSet.intString("x00280008");return"undefined"==typeof s&&(s=null),s}},{key:"numberOfChannels",value:function u(){var u=1,e=this.photometricInterpretation();return"RGB"!==e&&"PALETTE COLOR"!==e&&"YBR_FULL"!==e&&"YBR_FULL_422"!==e&&"YBR_PARTIAL_422"!==e&&"YBR_PARTIAL_420"!==e&&"YBR_RCT"!==e||(u=3),u}},{key:"invert",value:function(){var e=this.photometricInterpretation();return"MONOCHROME1"===e}},{key:"imageOrientation",value:function c(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],c=this._findStringEverywhere("x00209116","x00200037",e);return c&&(c=c.split("\\").map(Number)),c}},{key:"pixelAspectRatio",value:function m(){var m=[this._dataSet.intString("x00280034",0),this._dataSet.intString("x00280034",1)];return"undefined"==typeof m[0]&&(m=null),m}},{key:"imagePosition",value:function v(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],v=this._findStringEverywhere("x00209113","x00200032",e);return v&&(v=v.split("\\").map(Number)),v}},{key:"instanceNumber",value:function y(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],y=null,t=this._dataSet.elements.x52009230;if("undefined"!=typeof t)if(t.items[e].dataSet.elements.x2005140f){var n=t.items[e].dataSet.elements.x2005140f.items[0].dataSet;y=n.intString("x00200013")}else y=this._dataSet.intString("x00200013"),"undefined"==typeof y&&(y=null);else y=this._dataSet.intString("x00200013"),"undefined"==typeof y&&(y=null);return y}},{key:"pixelSpacing",value:function x(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],x=this._findStringEverywhere("x00289110","x00280030",e);return x&&(x=x.split("\\").map(Number)),x}},{key:"rows",value:function b(){var b=(arguments.length<=0||void 0===arguments[0]?0:arguments[0],this._dataSet.uint16("x00280010"));return"undefined"==typeof b&&(b=null),b}},{key:"columns",value:function _(){var _=(arguments.length<=0||void 0===arguments[0]?0:arguments[0],this._dataSet.uint16("x00280011"));return"undefined"==typeof _&&(_=null),_}},{key:"pixelType",value:function(){arguments.length<=0||void 0===arguments[0]?0:arguments[0];return 0}},{key:"pixelRepresentation",value:function g(){var g=(arguments.length<=0||void 0===arguments[0]?0:arguments[0],this._dataSet.uint16("x00280103"));return g}},{key:"bitsAllocated",value:function w(){var w=(arguments.length<=0||void 0===arguments[0]?0:arguments[0],this._dataSet.uint16("x00280100"));return w}},{key:"highBit",value:function k(){var k=(arguments.length<=0||void 0===arguments[0]?0:arguments[0],this._dataSet.uint16("x00280102"));return k}},{key:"rescaleIntercept",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0];return this._findFloatStringInFrameGroupSequence("x00289145","x00281052",e)}},{key:"rescaleSlope",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0];return this._findFloatStringInFrameGroupSequence("x00289145","x00281053",e)}},{key:"windowCenter",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0];return this._findFloatStringInFrameGroupSequence("x00289132","x00281050",e)}},{key:"windowWidth",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0];return this._findFloatStringInFrameGroupSequence("x00289132","x00281051",e)}},{key:"sliceThickness",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0];return this._findFloatStringInFrameGroupSequence("x00289110","x00180050",e)}},{key:"dimensionIndexValues",value:function C(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],C=[],t=this._dataSet.elements.x52009230;if("undefined"!=typeof t)for(var n=t.items[e].dataSet.elements.x00209111.items[0].dataSet,i=n.elements.x00209157,r=i.length/4,o=0;r>o;o++)C.push(n.uint32("x00209157",o));else C=null;return C}},{key:"inStackPositionNumber",value:function S(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],S=null,t=this._dataSet.elements.x52009230;if("undefined"!=typeof t){var n=t.items[e].dataSet.elements.x00209111.items[0].dataSet;S=n.uint32("x00209057")}else S=null;return S}},{key:"stackID",value:function I(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],I=null,t=this._dataSet.elements.x52009230;if("undefined"!=typeof t){var n=t.items[e].dataSet.elements.x00209111.items[0].dataSet;I=n.intString("x00209056")}else I=null;return I}},{key:"extractPixelData",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],t=this._decodePixelData(e),n=this.numberOfChannels();return n>1?this._convertColorSpace(t):t}},{key:"minMaxPixelData",value:function(){for(var e=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],t=[65535,-32768],n=e.length,i=0;n>i;i++){var r=e[i];t[0]=Math.min(t[0],r),t[1]=Math.max(t[1],r)}return t}},{key:"_findInGroupSequence",value:function(e,t,n){var i=this._dataSet.elements[e];if("undefined"!=typeof i){var r=i.items[n].dataSet.elements[t];if("undefined"!=typeof r)return r.items[0].dataSet}return null}},{key:"_findStringInGroupSequence",value:function(e,t,n,i){var r=this._findInGroupSequence(e,t,i);return null!==r?r.string(n):null}},{key:"_findStringInFrameGroupSequence",value:function(e,t,n){return this._findStringInGroupSequence("x52009229",e,t,0)||this._findStringInGroupSequence("x52009230",e,t,n)}},{key:"_findStringEverywhere",value:function(e,t,n){var i=this._findStringInFrameGroupSequence(e,t,n);return null===i&&(i=this._dataSet.string(t)),"undefined"==typeof i&&(i=null),i}},{key:"_findFloatStringInGroupSequence",value:function(e,t,n,i){var r=this._dataSet.floatString(n);return"undefined"==typeof r?(r=this._findInGroupSequence(e,t,i),null!==r?r.floatString(n):null):r}},{key:"_findFloatStringInFrameGroupSequence",value:function(e,t,n){return this._findFloatStringInGroupSequence("x52009229",e,t,0)||this._findFloatStringInGroupSequence("x52009230",e,t,n)}},{key:"_decodePixelData",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],t=this.transferSyntaxUID();if("1.2.840.10008.1.2.4.90"===t||"1.2.840.10008.1.2.4.91"===t)return this._decodeJ2K(e);if("1.2.840.10008.1.2.4.57"===t||"1.2.840.10008.1.2.4.70"===t)return this._decodeJPEGLossless(e);if("1.2.840.10008.1.2.4.50"===t||"1.2.840.10008.1.2.4.51"===t)return this._decodeJPEGBaseline(e);if("1.2.840.10008.1.2"===t||"1.2.840.10008.1.2.1"===t)return this._decodeUncompressed(e);if("1.2.840.10008.1.2.2"===t){var n=this._decodeUncompressed(e);return this._swapFrame(n)}throw"no decoder for transfer syntax ${transferSyntaxUID}"}},{key:"_decodeJ2K",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],t=f.readEncapsulatedPixelData(this._dataSet,this._dataSet.elements.x7fe00010,e),n=new p;n.parse(t);var i=n.componentsCount;if(1!==i)throw"JPEG2000 decoder returned a componentCount of ${componentsCount}, when 1 is expected";var r=n.tiles.length;if(1!==r)throw"JPEG2000 decoder returned a tileCount of ${tileCount}, when 1 is expected";var o=n.tiles[0],a=o.items;return a}},{key:"_decodeJPEGLossless",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],t=f.readEncapsulatedPixelData(this._dataSet,this._dataSet.elements.x7fe00010,e),n=this.pixelRepresentation(e),i=this.bitsAllocated(e),r=8>=i?1:2,o=new d.lossless.Decoder,a=o.decode(t.buffer,t.byteOffset,t.length,r);return 0===n?2===r?new Uint16Array(a.buffer):new Uint8Array(a.buffer):new Int16Array(a.buffer)}},{key:"_decodeJPEGBaseline",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],t=f.readEncapsulatedPixelData(this._dataSet,this._dataSet.elements.x7fe00010,e),n=this.rows(e),i=this.columns(e),r=this.bitsAllocated(e),o=new h;return o.parse(t),8===r?o.getData(i,n):16===r?o.getData16(i,n):void 0}},{key:"_decodeUncompressed",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],t=this.pixelRepresentation(e),n=this.bitsAllocated(e),i=this._dataSet.elements.x7fe00010,r=i.dataOffset,o=this.numberOfChannels(),a=this.rows(e)*this.columns(e)*o,s=0,l=this._dataSet.byteArray.buffer;if(0===t&&8===n)return s=r+e*a,new Uint8Array(l,s,a);if(0===t&&16===n)return s=r+e*a*2,new Uint16Array(l,s,a);if(1===t&&16===n)return s=r+e*a*2,new Int16Array(l,s,a);if(0===t&&32===n)return s=r+e*a*4,new Uint32Array(l,s,a);if(0===t&&1===n){var u=new ArrayBuffer(a),c=new Uint8Array(u);s=r+e*a;for(var f=0,d=e*a,h=e*a+a,p=Math.floor(d/8),m=d-8*p,v=Math.ceil(h/8),y=new Uint8Array(l,r),x=p;v>=x;x++){for(;8>m;){switch(m){case 0:c[f]=1&y[x];break;case 1:c[f]=y[x]>>>1&1;break;case 2:c[f]=y[x]>>>2&1;break;case 3:c[f]=y[x]>>>3&1;break;case 4:c[f]=y[x]>>>4&1;break;case 5:c[f]=y[x]>>>5&1;break;case 6:c[f]=y[x]>>>6&1;break;case 7:c[f]=y[x]>>>7&1}if(m++,f++,f>=a)return c}m=0}}}},{key:"_convertColorSpace",value:function(e){var t=null,n=this.photometricInterpretation(),i=this.planarConfiguration();if("RGB"===n&&0===i)t=e;else if("RGB"===n&&1===i){if(e instanceof Int8Array)t=new Int8Array(e.length);else if(e instanceof Uint8Array)t=new Uint8Array(e.length);else if(e instanceof Int16Array)t=new Int16Array(e.length);else{if(!(e instanceof Uint16Array))throw"unsuported typed array: ${uncompressedData}";t=new Uint16Array(e.length)}for(var r=e.length/3,o=0,a=0,s=r,l=2*r,u=0;r>u;u++)t[o++]=e[a++],t[o++]=e[s++],t[o++]=e[l++]}else{if("YBR_FULL"!==n)throw"photometric interpolation not supported: ${photometricInterpretation}";if(e instanceof Int8Array)t=new Int8Array(e.length);else if(e instanceof Uint8Array)t=new Uint8Array(e.length);else if(e instanceof Int16Array)t=new Int16Array(e.length);else{if(!(e instanceof Uint16Array))throw"unsuported typed array: ${uncompressedData}";t=new Uint16Array(e.length)}for(var c=e.length/3,f=0,d=0,h=0;c>h;h++){var p=e[f++],m=e[f++],v=e[f++];t[d++]=p+1.402*(v-128),t[d++]=p-.34414*(m-128)-.71414*(v-128),t[d++]=p+1.772*(m-128)}}return t}},{key:"_swapFrame",value:function(e){var t=this.bitsAllocated();if(16===t)for(var n=0;n<e.length;n++)e[n]=this._swap16(e[n]);else if(32===t)for(var i=0;i<e.length;i++)e[i]=this._swap32(e[i]);return e}}]),t}(c["default"]);n["default"]=m},{"../../external/scripts/jpeg":1,"../../external/scripts/jpx":2,"./parsers.volume":91,"dicom-parser":6,"jpeg-lossless-decoder-js":13}],88:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var r=e("./parsers.dicom"),o=i(r),a=e("./parsers.nifti"),s=i(a),l=e("./parsers.nrrd"),u=i(l);n["default"]={Dicom:o["default"],Nifti:s["default"],Nrrd:u["default"]}},{"./parsers.dicom":87,"./parsers.nifti":89,"./parsers.nrrd":90}],89:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":s(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":s(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=e("./parsers.volume"),c=i(u),f=e("nifti-reader-js"),d=function(e){function t(e,n){r(this,t);var i=o(this,Object.getPrototypeOf(t).call(this));if(i._id=n,i._arrayBuffer=e.buffer,i._url=e.url,i._dataSet=null,i._niftiHeader=null,i._niftiImage=null,i._ordered=!0,i._orderedData=null,!f.isNIFTI(i._arrayBuffer))throw"parsers.nifti could not parse the file";return i._dataSet=f.readHeader(i._arrayBuffer),i._niftiImage=f.readImage(i._dataSet,i._arrayBuffer),i}return a(t,e),l(t,[{key:"seriesInstanceUID",value:function(){return this._url}},{key:"numberOfFrames",value:function(){return this._dataSet.dims[3]}},{key:"numberOfChannels",value:function n(){var n=1;return this._dataSet.dims[0]>=5?(n=this._dataSet.dims[5],this._ordered=!1):128===this._dataSet.datatypeCode?n=3:2304===this._dataSet.datatypeCode&&(n=4),n}},{key:"sopInstanceUID",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0];return e}},{key:"rows",value:function(){arguments.length<=0||void 0===arguments[0]?0:arguments[0];return this._dataSet.dims[2]}},{key:"columns",value:function(){arguments.length<=0||void 0===arguments[0]?0:arguments[0];return this._dataSet.dims[1]}},{key:"pixelType",value:function i(){var i=(arguments.length<=0||void 0===arguments[0]?0:arguments[0],0);return 16!==this._dataSet.datatypeCode&&64!==this._dataSet.datatypeCode&&1536!==this._dataSet.datatypeCode||(i=1),i}},{key:"bitsAllocated",value:function(){arguments.length<=0||void 0===arguments[0]?0:arguments[0];return this._dataSet.numBitsPerVoxel}},{key:"pixelSpacing",value:function(){arguments.length<=0||void 0===arguments[0]?0:arguments[0];return[this._dataSet.pixDims[1],this._dataSet.pixDims[2],this._dataSet.pixDims[3]]}},{key:"sliceThickness",value:function(){return null}},{key:"imageOrientation",value:function(){arguments.length<=0||void 0===arguments[0]?0:arguments[0];if(this._dataSet.qform_code>0){var e=0,t=this._dataSet.quatern_b,n=this._dataSet.quatern_c,i=this._dataSet.quatern_d;return e=1-(t*t+n*n+i*i),1e-7>e?(e=1/Math.sqrt(t*t+n*n+i*i),t*=e,n*=e,i*=e,e=0):e=Math.sqrt(e),[e*e+t*t-n*n-i*i,2*(t*n-e*i),2*(t*i+e*n),2*(t*n+e*i),e*e+n*n-t*t-i*i,2*(n*i-e*t)]}if(this._dataSet.sform_code>0){this._dataSet.srow_x,this._dataSet.srow_y,this._dataSet.srow_z}else 0===this._dataSet.qform_code;return[1,0,0,0,1,0]}},{key:"imagePosition",value:function(){arguments.length<=0||void 0===arguments[0]?0:arguments[0];return[-this._dataSet.qoffset_x,-this._dataSet.qoffset_y,this._dataSet.qoffset_z]}},{key:"dimensionIndexValues",value:function(){arguments.length<=0||void 0===arguments[0]?0:arguments[0];return null}},{key:"instanceNumber",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0];return e}},{key:"windowCenter",value:function(){arguments.length<=0||void 0===arguments[0]?0:arguments[0];return null}},{key:"windowWidth",value:function(){arguments.length<=0||void 0===arguments[0]?0:arguments[0];return null}},{key:"rescaleSlope",value:function(){arguments.length<=0||void 0===arguments[0]?0:arguments[0];return this._dataSet.scl_slope}},{key:"rescaleIntercept",value:function(){arguments.length<=0||void 0===arguments[0]?0:arguments[0];return this._dataSet.scl_intercept}},{key:"minMaxPixelData",value:function(){for(var e=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],t=[65535,-32768],n=e.length,i=0;n>i;i++){var r=e[i];t[0]=Math.min(t[0],r),t[1]=Math.max(t[1],r)}return t}},{key:"extractPixelData",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0];return this._decompressUncompressed(e)}},{key:"_decompressUncompressed",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],t=this.numberOfChannels(),n=this.rows(e)*this.columns(e)*t,i=e*n,r=this._niftiImage;return this._ordered||null!==this._orderedData||this._reorderData(),null!==this._orderedData?this._orderedData.slice(i,i+n):2===this._dataSet.datatypeCode?new Uint8Array(r,i,n):256===this._dataSet.datatypeCode?new Int8Array(r,i,n):512===this._dataSet.datatypeCode?(i=2*i,new Uint16Array(r,i,n)):4===this._dataSet.datatypeCode?(i=2*i,new Int16Array(r,i,n)):16===this._dataSet.datatypeCode?(i=4*i,new Float32Array(r,i,n)):void 0}},{key:"_reorderData",value:function(){window.console.log("re-order");var e=this.numberOfChannels(),t=this.rows()*this.columns()*e,n=this._niftiImage,i=t*this.numberOfFrames(),r=null;this._orderedData=null,2===this._dataSet.datatypeCode?(r=new Uint8Array(n,0,i),this._orderedData=new Uint8Array(r.length)):256===this._dataSet.datatypeCode?(r=new Int8Array(n,0,i),this._orderedData=new Int8Array(r.length)):512===this._dataSet.datatypeCode?(r=new Uint16Array(n,0,i),this._orderedData=new Uint16Array(r.length)):4===this._dataSet.datatypeCode?(r=new Int16Array(n,0,i),this._orderedData=new Int16Array(r.length)):16===this._dataSet.datatypeCode&&(r=new Float32Array(n,0,i),this._orderedData=new Float32Array(r.length));for(var o=r.length/3,a=0,s=0,l=o,u=2*o,c=0;o>c;c++)this._orderedData[a++]=r[s++],this._orderedData[a++]=r[l++],this._orderedData[a++]=r[u++];this._ordered=!0}}]),t}(c["default"]);n["default"]=d},{"./parsers.volume":91,"nifti-reader-js":24}],90:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":s(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":s(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=e("./parsers.volume"),c=i(u),f=e("pako"),d=e("nrrd-js"),h=function(e){function t(e,n){r(this,t);var i=o(this,Object.getPrototypeOf(t).call(this));i._id=n,i._arrayBuffer=e.buffer,i._url=e.url,i._dataSet=null,i._unpackedData=null;try{i._dataSet=d.parse(i._arrayBuffer)}catch(a){window.console.log("ooops... :(")}return window.console.log(i._dataSet),i}return a(t,e),l(t,[{key:"seriesInstanceUID",value:function(){return this._url}},{key:"numberOfFrames",value:function(){return this._dataSet.sizes[2]}},{key:"numberOfChannels",value:function n(){var n=1;return n}},{key:"sopInstanceUID",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0];return e}},{key:"rows",value:function(){arguments.length<=0||void 0===arguments[0]?0:arguments[0];return this._dataSet.sizes[1]}},{key:"columns",value:function(){arguments.length<=0||void 0===arguments[0]?0:arguments[0];return this._dataSet.sizes[0]}},{key:"pixelType",value:function i(){var i=(arguments.length<=0||void 0===arguments[0]?0:arguments[0],0);return"float"===this._dataSet.type&&(i=1),i}},{key:"bitsAllocated",value:function s(){var s=(arguments.length<=0||void 0===arguments[0]?0:arguments[0],1);return"int8"===this._dataSet.type||"uint8"===this._dataSet.type||"char"===this._dataSet.type?s=8:"int16"===this._dataSet.type||"uint16"===this._dataSet.type||"short"===this._dataSet.type?s=16:"int32"!==this._dataSet.type&&"uint32"!==this._dataSet.type&&"float"!==this._dataSet.type||(s=32),s}},{key:"pixelSpacing",value:function(){var e=(arguments.length<=0||void 0===arguments[0]?0:arguments[0],new THREE.Vector3(this._dataSet.spaceDirections[0][0],this._dataSet.spaceDirections[0][1],this._dataSet.spaceDirections[0][2])),t=new THREE.Vector3(this._dataSet.spaceDirections[1][0],this._dataSet.spaceDirections[1][1],this._dataSet.spaceDirections[1][2]),n=new THREE.Vector3(this._dataSet.spaceDirections[2][0],this._dataSet.spaceDirections[2][1],this._dataSet.spaceDirections[2][2]);return[e.length(),t.length(),n.length()]}},{key:"sliceThickness",value:function(){return null}},{key:"imageOrientation",value:function(){var e=(arguments.length<=0||void 0===arguments[0]?0:arguments[0],new THREE.Vector3(this._dataSet.spaceDirections[0][0],this._dataSet.spaceDirections[0][1],this._dataSet.spaceDirections[0][2]));e.normalize();var t=new THREE.Vector3(this._dataSet.spaceDirections[1][0],this._dataSet.spaceDirections[1][1],this._dataSet.spaceDirections[1][2]);return t.normalize(),[e.x,e.y,e.z,t.x,t.y,t.z]}},{key:"imagePosition",value:function(){arguments.length<=0||void 0===arguments[0]?0:arguments[0];return[this._dataSet.spaceOrigin[0],this._dataSet.spaceOrigin[1],this._dataSet.spaceOrigin[2]]}},{key:"dimensionIndexValues",value:function(){arguments.length<=0||void 0===arguments[0]?0:arguments[0];return null}},{key:"instanceNumber",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0];return e}},{key:"windowCenter",value:function(){arguments.length<=0||void 0===arguments[0]?0:arguments[0];return null}},{key:"windowWidth",value:function(){arguments.length<=0||void 0===arguments[0]?0:arguments[0];return null}},{key:"rescaleSlope",value:function(){arguments.length<=0||void 0===arguments[0]?0:arguments[0];return 1}},{key:"rescaleIntercept",value:function(){arguments.length<=0||void 0===arguments[0]?0:arguments[0];return 0}},{key:"minMaxPixelData",value:function(){for(var e=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],t=[65535,-32768],n=e.length,i=0;n>i;i++){var r=e[i];t[0]=Math.min(t[0],r),t[1]=Math.max(t[1],r)}return t}},{key:"extractPixelData",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0];return this._decompressUncompressed(e)}},{key:"_decompressUncompressed",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],t=this._dataSet.buffer,n=this.numberOfChannels(),i=this.rows(e)*this.columns(e)*n,r=e*i;if(null===this._unpackedData&&"gzip"===this._dataSet.encoding){var o=f.inflate(this._dataSet.buffer);this._unpackedData=o.buffer,t=this._unpackedData}else"gzip"===this._dataSet.encoding&&(t=this._unpackedData);return"int8"===this._dataSet.type||"char"===this._dataSet.type?(r=r,new Int8Array(t,r,i)):"uint8"===this._dataSet.type?(r=r,new Uint8Array(t,r,i)):"int16"===this._dataSet.type||"short"===this._dataSet.type?(r=2*r,new Int16Array(t,r,i)):"uint16"===this._dataSet.type?(r=2*r,new Uint16Array(t,r,i)):"int32"===this._dataSet.type?(r=4*r,new Int32Array(t,r,i)):"uint32"===this._dataSet.type?(r=4*r,new Uint32Array(t,r,i)):"float"===this._dataSet.type?(r=4*r,new Float32Array(t,r,i)):void 0}}]),t}(c["default"]);n["default"]=h},{"./parsers.volume":91,"nrrd-js":28,pako:29}],91:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(){i(this,e)}return r(e,[{key:"_decompressUncompressed",value:function(){}},{key:"_swap16",value:function(e){return(255&e)<<8|e>>8&255}},{key:"_swap32",value:function(e){return(255&e)<<24|(65280&e)<<8|e>>8&65280|e>>24&255}},{key:"invert",value:function(){return!1}}]),e}();n["default"]=o},{}],92:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(){i(this,e)}return r(e,null,[{key:"uniforms",value:function(){return{uTextureSize:{type:"i",value:0},uTextureContainer:{type:"tv",value:[]},uDataDimensions:{type:"iv",value:[0,0,0]},uWorldToData:{type:"m4",value:new THREE.Matrix4},uWindowCenterWidth:{type:"fv1",value:[0,0]},uRescaleSlopeIntercept:{type:"fv1",value:[0,0]},uNumberOfChannels:{type:"i",value:1},uBitsAllocated:{type:"i",value:8},uInvert:{type:"i",value:0},uLut:{type:"i",value:0},uTextureLUT:{type:"t",value:[]},uPixelType:{type:"i",value:0},uPackedPerPixel:{type:"i",value:1},uInterpolation:{type:"i",value:1}}}}]),e}();n["default"]=o},{}],93:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var r=e("./shaders.data.js"),o=i(r),a=e("./shaders.layer.js"),s=i(a),l=e("./shaders.raycasting.js"),u=i(l),c="#define GLSLIFY 1\nvarying vec4 vPos;\n\n//\n// main\n//\nvoid main() {\n\n  vPos = modelMatrix * vec4(position, 1.0 );\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0 );\n\n}",f="#define GLSLIFY 1\nuniform int       uTextureSize;\nuniform float     uWindowCenterWidth[2];\nuniform float     uRescaleSlopeIntercept[2];\nuniform sampler2D uTextureContainer[7];\nuniform ivec3     uDataDimensions;\nuniform mat4      uWorldToData;\nuniform int       uNumberOfChannels;\nuniform int       uPixelType;\nuniform int       uBitsAllocated;\nuniform int       uInvert;\nuniform int       uInterpolation;\nuniform int       uPackedPerPixel;\n\n// hack because can not pass arrays if too big\n// best would be to pass texture but have to deal with 16bits\nuniform int       uLut;\nuniform sampler2D uTextureLUT;\n\nvarying vec4      vPos;\n\n// include functions\n// unpack int 8\nvoid uInt8(in float r, out float value){\n  value = r * 256.;\n}\n\n// unpack int 16\nvoid uInt16(in float r, in float a, out float value){\n  value = r * 256. + a * 65536.;\n}\n\n// unpack int 32\nvoid uInt32(in float r, in float g, in float b, in float a, out float value){\n  value = r * 256. + g * 65536. + b * 16777216. + a * 4294967296.;\n}\n\n// unpack float 32\nvoid uFloat32(in float r, in float g, in float b, in float a, out float value){\n\n  // create arrays containing bits for rgba values\n  // value between 0 and 255\n  value = r * 255.;\n  int bytemeR[8];\n  bytemeR[0] = int(floor(value / 128.));\n  value -= float(bytemeR[0] * 128);\n  bytemeR[1] = int(floor(value / 64.));\n  value -= float(bytemeR[1] * 64);\n  bytemeR[2] = int(floor(value / 32.));\n  value -= float(bytemeR[2] * 32);\n  bytemeR[3] = int(floor(value / 16.));\n  value -= float(bytemeR[3] * 16);\n  bytemeR[4] = int(floor(value / 8.));\n  value -= float(bytemeR[4] * 8);\n  bytemeR[5] = int(floor(value / 4.));\n  value -= float(bytemeR[5] * 4);\n  bytemeR[6] = int(floor(value / 2.));\n  value -= float(bytemeR[6] * 2);\n  bytemeR[7] = int(floor(value));\n\n  value = g * 255.;\n  int bytemeG[8];\n  bytemeG[0] = int(floor(value / 128.));\n  value -= float(bytemeG[0] * 128);\n  bytemeG[1] = int(floor(value / 64.));\n  value -= float(bytemeG[1] * 64);\n  bytemeG[2] = int(floor(value / 32.));\n  value -= float(bytemeG[2] * 32);\n  bytemeG[3] = int(floor(value / 16.));\n  value -= float(bytemeG[3] * 16);\n  bytemeG[4] = int(floor(value / 8.));\n  value -= float(bytemeG[4] * 8);\n  bytemeG[5] = int(floor(value / 4.));\n  value -= float(bytemeG[5] * 4);\n  bytemeG[6] = int(floor(value / 2.));\n  value -= float(bytemeG[6] * 2);\n  bytemeG[7] = int(floor(value));\n\n  value = b * 255.;\n  int bytemeB[8];\n  bytemeB[0] = int(floor(value / 128.));\n  value -= float(bytemeB[0] * 128);\n  bytemeB[1] = int(floor(value / 64.));\n  value -= float(bytemeB[1] * 64);\n  bytemeB[2] = int(floor(value / 32.));\n  value -= float(bytemeB[2] * 32);\n  bytemeB[3] = int(floor(value / 16.));\n  value -= float(bytemeB[3] * 16);\n  bytemeB[4] = int(floor(value / 8.));\n  value -= float(bytemeB[4] * 8);\n  bytemeB[5] = int(floor(value / 4.));\n  value -= float(bytemeB[5] * 4);\n  bytemeB[6] = int(floor(value / 2.));\n  value -= float(bytemeB[6] * 2);\n  bytemeB[7] = int(floor(value));\n\n  value = a * 255.;\n  int bytemeA[8];\n  bytemeA[0] = int(floor(value / 128.));\n  value -= float(bytemeA[0] * 128);\n  bytemeA[1] = int(floor(value / 64.));\n  value -= float(bytemeA[1] * 64);\n  bytemeA[2] = int(floor(value / 32.));\n  value -= float(bytemeA[2] * 32);\n  bytemeA[3] = int(floor(value / 16.));\n  value -= float(bytemeA[3] * 16);\n  bytemeA[4] = int(floor(value / 8.));\n  value -= float(bytemeA[4] * 8);\n  bytemeA[5] = int(floor(value / 4.));\n  value -= float(bytemeA[5] * 4);\n  bytemeA[6] = int(floor(value / 2.));\n  value -= float(bytemeA[6] * 2);\n  bytemeA[7] = int(floor(value));\n\n  // compute float32 value from bit arrays\n\n  // sign\n  int issigned = 1 - 2 * bytemeR[0];\n  //   issigned = int(pow(-1., float(bytemeR[0])));\n\n  // exponent\n  int exponent = 0;\n\n  exponent += bytemeR[1] * int(pow(2., 7.));\n  exponent += bytemeR[2] * int(pow(2., 6.));\n  exponent += bytemeR[3] * int(pow(2., 5.));\n  exponent += bytemeR[4] * int(pow(2., 4.));\n  exponent += bytemeR[5] * int(pow(2., 3.));\n  exponent += bytemeR[6] * int(pow(2., 2.));\n  exponent += bytemeR[7] * int(pow(2., 1.));\n\n  exponent += bytemeG[0];\n\n  // fraction\n  float fraction = 0.;\n\n  fraction = float(bytemeG[1]) * pow(2., -1.);\n  fraction += float(bytemeG[2]) * pow(2., -2.);\n  fraction += float(bytemeG[3]) * pow(2., -3.);\n  fraction += float(bytemeG[4]) * pow(2., -4.);\n  fraction += float(bytemeG[5]) * pow(2., -5.);\n  fraction += float(bytemeG[6]) * pow(2., -6.);\n  fraction += float(bytemeG[7]) * pow(2., -7.);\n\n  fraction += float(bytemeB[0]) * pow(2., -8.);\n  fraction += float(bytemeB[1]) * pow(2., -9.);\n  fraction += float(bytemeB[2]) * pow(2., -10.);\n  fraction += float(bytemeB[3]) * pow(2., -11.);\n  fraction += float(bytemeB[4]) * pow(2., -12.);\n  fraction += float(bytemeB[5]) * pow(2., -13.);\n  fraction += float(bytemeB[6]) * pow(2., -14.);\n  fraction += float(bytemeB[7]) * pow(2., -15.);\n\n  fraction += float(bytemeA[0]) * pow(2., -16.);\n  fraction += float(bytemeA[1]) * pow(2., -17.);\n  fraction += float(bytemeA[2]) * pow(2., -18.);\n  fraction += float(bytemeA[3]) * pow(2., -19.);\n  fraction += float(bytemeA[4]) * pow(2., -20.);\n  fraction += float(bytemeA[5]) * pow(2., -21.);\n  fraction += float(bytemeA[6]) * pow(2., -22.);\n  fraction += float(bytemeA[7]) * pow(2., -23.);\n\n  value = float(issigned) * pow( 2., float(exponent - 127)) * (1. + fraction);\n}\n\n// entry point for the unpack function\nvoid unpack( in vec4 packedRGBA,\n             in int bitsAllocated,\n             in int signedNumber,\n             in int numberOfChannels,\n             in int pixelType,\n             in int offset,\n             out vec4 unpacked) {\n\n  if(numberOfChannels == 1){\n    if(bitsAllocated == 8 || bitsAllocated == 1){\n      uInt8(\n        packedRGBA.r,\n        unpacked.x);\n    }\n    else if(bitsAllocated == 16){\n      if( offset == 0 ){\n        uInt16(\n          packedRGBA.r,\n          packedRGBA.g,\n          unpacked.x);\n      }\n      else{\n        uInt16(\n          packedRGBA.b,\n          packedRGBA.a,\n          unpacked.x);\n      }\n\n    }\n    else if(bitsAllocated == 32){\n      if(pixelType == 0){\n        uInt32(\n          packedRGBA.r,\n          packedRGBA.g,\n          packedRGBA.b,\n          packedRGBA.a,\n          unpacked.x);\n      }\n      else{\n        uFloat32(\n          packedRGBA.r,\n          packedRGBA.g,\n          packedRGBA.b,\n          packedRGBA.a,\n          unpacked.x);\n      }\n\n    }\n  }\n  else if(numberOfChannels == 3){\n    unpacked = packedRGBA;\n  }\n}\n\n// Support up to textureSize*textureSize*7 voxels\n\nvoid texture3DPolyfill(in ivec3 dataCoordinates,\n                       in ivec3 dataDimensions,\n                       in int textureSize,\n                       in sampler2D textureContainer0,\n                       in sampler2D textureContainer1,\n                       in sampler2D textureContainer2,\n                       in sampler2D textureContainer3,\n                       in sampler2D textureContainer4,\n                       in sampler2D textureContainer5,\n                       in sampler2D textureContainer6,\n                       in sampler2D textureContainer[7], // not working on Moto X 2014\n                       in int packedPerPixel,\n                       out vec4 dataValue_0,\n                       out int offset_0\n  ) {\n\n  // int pack = 2;\n\n    // Model coordinate to data index\n  int index = dataCoordinates.x\n            + dataCoordinates.y * dataDimensions.x\n            + dataCoordinates.z * dataDimensions.y * dataDimensions.x;\n  int indexP = int(index/packedPerPixel);\n\n  if( 2*indexP < index){\n    offset_0 = 1;\n  }\n  else{\n    offset_0 = 0;\n  }\n\n  // Map data index to right sampler2D texture\n  int voxelsPerTexture = textureSize*textureSize;\n  int textureIndex = int(floor(float(indexP) / float(voxelsPerTexture)));\n  // modulo seems incorrect sometimes...\n  // int inTextureIndex = int(mod(float(index), float(textureSize*textureSize)));\n  int inTextureIndex = indexP - voxelsPerTexture*textureIndex;\n\n  // Get row and column in the texture\n  int colIndex = int(mod(float(inTextureIndex), float(textureSize)));\n  int rowIndex = int(floor(float(inTextureIndex)/float(textureSize)));\n\n  // // Model coordinate to data index\n  // int index = dataCoordinates.x\n  //           + dataCoordinates.y * dataDimensions.x \n  //           + dataCoordinates.z * dataDimensions.y * dataDimensions.x;\n\n  // // Map data index to right sampler2D texture\n  // int voxelsPerTexture = 2 * textureSize * textureSize;\n  // int textureIndex = int(floor(float(index) / float(voxelsPerTexture)));\n  // // modulo seems incorrect sometimes...\n  // // int inTextureIndex = int(mod(float(index), float(textureSize*textureSize)));\n  // int inTextureIndex = index - voxelsPerTexture*textureIndex;\n\n  // float modulo = 0.5 * float(inTextureIndex) / float( textureSize * textureSize);\n  // dataValue = vec4(modulo, modulo, modulo, 1.0);\n  // // return;\n\n  // // float modulo = 100.0 * float( textureIndex ) / 7.0;\n  // // dataValue = vec4(modulo, modulo, modulo, 1.0);\n\n  // // return;\n\n  // // Get row and column in the texture\n  // // 0.5\n  // int colIndex = int(mod(0.5*float(inTextureIndex), float( textureSize )));\n  // int rowIndex = int(floor(0.5*float(inTextureIndex) / float( textureSize )));\n  // float fcolIndex = 0.5 * mod(float(inTextureIndex), float( 2 * textureSize ));\n  // float frowIndex = floor(0.5*float(inTextureIndex) / float( textureSize ));\n  // fcolIndex = floor( 0.5 * float( inTextureIndex ) ) - frowIndex * float( textureSize );\n\n  // dataValue = vec4(float(colIndex) / 4096., mod( float(colIndex), 2.) , 1., 1.);\n  // return;\n\n  // Map row and column to uv\n  vec2 uv = vec2(0,0);\n  uv.x = (0.5 + float(colIndex)) / float(textureSize);\n  uv.y = 1. - (0.5 + float(rowIndex)) / float(textureSize);\n\n  //\n  if(textureIndex == 0){ dataValue_0 = texture2D(textureContainer0, uv); }\n  else if(textureIndex == 1){dataValue_0 = texture2D(textureContainer1, uv);}\n  else if(textureIndex == 2){ dataValue_0 = texture2D(textureContainer2, uv); }\n  else if(textureIndex == 3){ dataValue_0 = texture2D(textureContainer3, uv); }\n  else if(textureIndex == 4){ dataValue_0 = texture2D(textureContainer4, uv); }\n  else if(textureIndex == 5){ dataValue_0 = texture2D(textureContainer5, uv); }\n  else if(textureIndex == 6){ dataValue_0 = texture2D(textureContainer6, uv); }\n}\n\nvoid no(in vec3 currentVoxel,\n        in int kernelSize,\n        in ivec3 dataDimensions,\n        in int textureSize,\n        in sampler2D textureContainer0,\n        in sampler2D textureContainer1,\n        in sampler2D textureContainer2,\n        in sampler2D textureContainer3,\n        in sampler2D textureContainer4,\n        in sampler2D textureContainer5,\n        in sampler2D textureContainer6,\n        in sampler2D textureContainer[7], // not working on Moto X 2014\n        in int bitsAllocated, \n        in int numberOfChannels_1, \n        in int pixelType_1,\n        in int packedPerPixel_1,\n        out vec4 intensity_1\n  ) {\n  \n  // lower bound\n  vec3 rCurrentVoxel = vec3(floor(currentVoxel.x + 0.5 ), floor(currentVoxel.y + 0.5 ), floor(currentVoxel.z + 0.5 ));\n  ivec3 voxel = ivec3(int(rCurrentVoxel.x), int(rCurrentVoxel.y), int(rCurrentVoxel.z));\n\n  vec4 tmp = vec4(0., 0., 0., 0.);\n  int offset = 0;\n\n  texture3DPolyfill(\n    voxel,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    packedPerPixel_1,\n    tmp,\n    offset\n    );\n\n  unpack(\n    tmp,\n    bitsAllocated,\n    0,\n    numberOfChannels_1,\n    pixelType_1,\n    offset,\n    intensity_1);\n\n}\n\n// https://en.wikipedia.org/wiki/Trilinear_interpolation\n\nvoid trilinear(in vec3 currentVoxel,\n               in int kernelSize,\n               in ivec3 dataDimensions,\n               in int textureSize,\n               in sampler2D textureContainer0,\n               in sampler2D textureContainer1,\n               in sampler2D textureContainer2,\n               in sampler2D textureContainer3,\n               in sampler2D textureContainer4,\n               in sampler2D textureContainer5,\n               in sampler2D textureContainer6,\n               in sampler2D textureContainer[7], // not working on Moto X 2014\n               in int bitsAllocated, \n               in int numberOfChannels_2, \n               in int pixelType_2,\n               in int packedPerPixel_2,\n               out vec4 intensity_2\n  ) {\n  \n  // lower bound\n  vec3 lb = vec3(floor(currentVoxel.x + 0.5 ), floor(currentVoxel.y + 0.5 ), floor(currentVoxel.z + 0.5 ));\n\n  vec3 direction = currentVoxel - lb;\n\n  // higher bound\n  vec3 hb = lb + 1.0;\n\n  if( direction.x < 0.0){\n\n    hb.x -= 2.0;\n\n  }\n\n  if( direction.y < 0.0){\n\n    hb.y -= 2.0;\n\n  }\n\n  if( direction.z < 0.0){\n\n    hb.z -= 2.0;\n\n  }\n\n  vec3 lc = vec3(0.0, 0.0, 0.0);\n  vec3 hc = vec3(0.0, 0.0, 0.0);\n\n  if(lb.x < hb.x){\n\n    lc.x = lb.x;\n    hc.x = hb.x;\n\n  }\n  else{\n\n    lc.x = hb.x;\n    hc.x = lb.x;\n\n  }\n\n  if(lb.y < hb.y){\n\n    lc.y = lb.y;\n    hc.y = hb.y;\n\n  }\n  else{\n\n    lc.y = hb.y;\n    hc.y = lb.y;\n\n  }\n\n  if(lb.z < hb.z){\n\n    lc.z = lb.z;\n    hc.z = hb.z;\n\n  }\n  else{\n\n    lc.z = hb.z;\n    hc.z = lb.z;\n\n  }\n\n  float xd = ( currentVoxel.x - lc.x ) / ( hc.x - lc.x );\n  float yd = ( currentVoxel.y - lc.y ) / ( hc.y - lc.y );\n  float zd = ( currentVoxel.z - lc.z ) / ( hc.z - lc.z );\n\n  //\n  // c00\n  //\n\n  //\n\n  vec4 v000 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c000 = vec3(lc.x, lc.y, lc.z);\n\n  no(c000,\n    kernelSize,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    bitsAllocated, \n    numberOfChannels_2, \n    pixelType_2,\n    packedPerPixel_2,\n    v000\n  );\n\n  //\n\n  vec4 v100 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c100 = vec3(hc.x, lc.y, lc.z);\n\n  no(c100,\n    kernelSize,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    bitsAllocated, \n    numberOfChannels_2, \n    pixelType_2,\n    packedPerPixel_2,\n    v100\n  );\n\n  vec4 c00 = v000 * ( 1.0 - xd ) + v100 * xd;\n\n  //\n  // c01\n  //\n  vec4 v001 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c001 = vec3(lc.x, lc.y, hc.z);\n\n  no(c001,\n    kernelSize,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    bitsAllocated, \n    numberOfChannels_2, \n    pixelType_2,\n    packedPerPixel_2,\n    v001\n  );\n\n  vec4 v101 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c101 = vec3(hc.x, lc.y, hc.z);\n\n  no(c101,\n    kernelSize,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    bitsAllocated, \n    numberOfChannels_2, \n    pixelType_2,\n    packedPerPixel_2,\n    v101\n  );\n\n  vec4 c01 = v001 * ( 1.0 - xd ) + v101 * xd;\n\n  //\n  // c10\n  //\n  vec4 v010 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c010 = vec3(lc.x, hc.y, lc.z);\n\n  no(c010,\n    kernelSize,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    bitsAllocated, \n    numberOfChannels_2, \n    pixelType_2,\n    packedPerPixel_2,\n    v010\n  );\n\n  vec4 v110 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c110 = vec3(hc.x, hc.y, lc.z);\n\n  no(c110,\n    kernelSize,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    bitsAllocated, \n    numberOfChannels_2, \n    pixelType_2,\n    packedPerPixel_2,\n    v110\n  );\n\n  vec4 c10 = v010 * ( 1.0 - xd ) + v110 * xd;\n\n  //\n  // c11\n  //\n  vec4 v011 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c011 = vec3(lc.x, hc.y, hc.z);\n\n  no(c011,\n    kernelSize,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    bitsAllocated, \n    numberOfChannels_2, \n    pixelType_2,\n    packedPerPixel_2,\n    v011\n  );\n\n  vec4 v111 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c111 = vec3(hc.x, hc.y, hc.z);\n\n  no(c111,\n    kernelSize,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    bitsAllocated, \n    numberOfChannels_2, \n    pixelType_2,\n    packedPerPixel_2,\n    v111\n  );\n\n  vec4 c11 = v011 * ( 1.0 - xd ) + v111 * xd;\n\n  // c0 and c1\n  vec4 c0 = c00 * ( 1.0 - yd) + c10 * yd;\n  vec4 c1 = c01 * ( 1.0 - yd) + c11 * yd;\n\n  // c\n  vec4 c = c0 * ( 1.0 - zd) + c1 * zd;\n  intensity_2 = c;\n\n}\n\n// Support up to textureSize*textureSize*7 voxels\n\nvoid value_0(in vec3 dataCoordinates,\n           in int kernelSize,\n           in int interpolationMethod,\n           in ivec3 dataDimensions,\n           in int textureSize,\n           in sampler2D textureContainer0,\n           in sampler2D textureContainer1,\n           in sampler2D textureContainer2,\n           in sampler2D textureContainer3,\n           in sampler2D textureContainer4,\n           in sampler2D textureContainer5,\n           in sampler2D textureContainer6,\n           in sampler2D textureContainer[7], // not working on Moto X 2014\n           in int bitsAllocated, \n           in int numberOfChannels_0, \n           in int pixelType_0,\n           in int packedPerPixel_0,\n           out vec4 intensity_0\n  ) {\n\n  if( interpolationMethod == 0){\n\n    // no interpolation\n    no(dataCoordinates,\n       kernelSize,\n       dataDimensions,\n       textureSize,\n       textureContainer0,\n       textureContainer1,\n       textureContainer2,\n       textureContainer3,\n       textureContainer4,\n       textureContainer5,\n       textureContainer6,\n       textureContainer,\n       bitsAllocated,\n       numberOfChannels_0,\n       pixelType_0,\n       packedPerPixel_0,\n       intensity_0);\n\n  }\n  else if( interpolationMethod == 1){\n\n    // trilinear interpolation\n    trilinear(dataCoordinates,\n      kernelSize,\n      dataDimensions,\n      textureSize,\n      textureContainer0,\n      textureContainer1,\n      textureContainer2,\n      textureContainer3,\n      textureContainer4,\n      textureContainer5,\n      textureContainer6,\n      textureContainer,\n      bitsAllocated,\n      numberOfChannels_0,\n      pixelType_0,\n      packedPerPixel_0,\n      intensity_0);\n\n  }\n\n}\n\nvoid main(void) {\n\n  // get texture coordinates of current pixel\n  vec4 dataCoordinates = uWorldToData * vPos;\n  vec3 currentVoxel = vec3(dataCoordinates.x, dataCoordinates.y, dataCoordinates.z);\n  int kernelSize = 2;\n  vec4 dataValue = vec4(0., 0., 0., 0.);\n  value_0(\n    currentVoxel,\n    kernelSize,\n    uInterpolation,\n    uDataDimensions,\n    uTextureSize,\n    uTextureContainer[0],\n    uTextureContainer[1],\n    uTextureContainer[2],\n    uTextureContainer[3],\n    uTextureContainer[4],\n    uTextureContainer[5],\n    uTextureContainer[6],\n    uTextureContainer,     // not working on Moto X 2014\n    uBitsAllocated,\n    uNumberOfChannels,\n    uPixelType,\n    uPackedPerPixel,\n    dataValue\n  );\n\n  // gl_FragColor = dataValue;\n  // return;\n\n  // how do we deal wil more than 1 channel?\n  if(uNumberOfChannels == 1){\n    float intensity = dataValue.r;\n\n    // rescale/slope\n    intensity = intensity*uRescaleSlopeIntercept[0] + uRescaleSlopeIntercept[1];\n\n    float windowMin = uWindowCenterWidth[0] - uWindowCenterWidth[1] * 0.5;\n    float windowMax = uWindowCenterWidth[0] + uWindowCenterWidth[1] * 0.5;\n    intensity = ( intensity - windowMin ) / uWindowCenterWidth[1];\n\n    dataValue.r = dataValue.g = dataValue.b = intensity;\n    dataValue.a = 1.0;\n  }\n\n  // Apply LUT table...\n  //\n  if(uLut == 1){\n    // should opacity be grabbed there?\n    dataValue = texture2D( uTextureLUT, vec2( dataValue.r , 1.0) );\n  }\n\n  if(uInvert == 1){\n    dataValue = vec4(1.) - dataValue;\n    // how do we deal with that and opacity?\n    dataValue.a = 1.;\n  }\n\n  gl_FragColor = dataValue;\n\n}",d="#define GLSLIFY 1\nuniform sampler2D uTextureBackTest0;\nuniform float     uOpacity0;\nuniform int       uType0;\nuniform sampler2D uTextureBackTest1;\nuniform float     uOpacity1;\nuniform int       uType1;\nuniform int       uTrackMouse;\nuniform vec2      uMouse;\n\nvarying vec4      vPos;\nvarying vec4      vProjectedCoords;\n\n// include functions\n// unpack int 8\nvoid uInt8(in float r, out float value){\n  value = r * 256.;\n}\n\n// unpack int 16\nvoid uInt16(in float r, in float a, out float value){\n  value = r * 256. + a * 65536.;\n}\n\n// unpack int 32\nvoid uInt32(in float r, in float g, in float b, in float a, out float value){\n  value = r * 256. + g * 65536. + b * 16777216. + a * 4294967296.;\n}\n\n// unpack float 32\nvoid uFloat32(in float r, in float g, in float b, in float a, out float value){\n\n  // create arrays containing bits for rgba values\n  // value between 0 and 255\n  value = r * 255.;\n  int bytemeR[8];\n  bytemeR[0] = int(floor(value / 128.));\n  value -= float(bytemeR[0] * 128);\n  bytemeR[1] = int(floor(value / 64.));\n  value -= float(bytemeR[1] * 64);\n  bytemeR[2] = int(floor(value / 32.));\n  value -= float(bytemeR[2] * 32);\n  bytemeR[3] = int(floor(value / 16.));\n  value -= float(bytemeR[3] * 16);\n  bytemeR[4] = int(floor(value / 8.));\n  value -= float(bytemeR[4] * 8);\n  bytemeR[5] = int(floor(value / 4.));\n  value -= float(bytemeR[5] * 4);\n  bytemeR[6] = int(floor(value / 2.));\n  value -= float(bytemeR[6] * 2);\n  bytemeR[7] = int(floor(value));\n\n  value = g * 255.;\n  int bytemeG[8];\n  bytemeG[0] = int(floor(value / 128.));\n  value -= float(bytemeG[0] * 128);\n  bytemeG[1] = int(floor(value / 64.));\n  value -= float(bytemeG[1] * 64);\n  bytemeG[2] = int(floor(value / 32.));\n  value -= float(bytemeG[2] * 32);\n  bytemeG[3] = int(floor(value / 16.));\n  value -= float(bytemeG[3] * 16);\n  bytemeG[4] = int(floor(value / 8.));\n  value -= float(bytemeG[4] * 8);\n  bytemeG[5] = int(floor(value / 4.));\n  value -= float(bytemeG[5] * 4);\n  bytemeG[6] = int(floor(value / 2.));\n  value -= float(bytemeG[6] * 2);\n  bytemeG[7] = int(floor(value));\n\n  value = b * 255.;\n  int bytemeB[8];\n  bytemeB[0] = int(floor(value / 128.));\n  value -= float(bytemeB[0] * 128);\n  bytemeB[1] = int(floor(value / 64.));\n  value -= float(bytemeB[1] * 64);\n  bytemeB[2] = int(floor(value / 32.));\n  value -= float(bytemeB[2] * 32);\n  bytemeB[3] = int(floor(value / 16.));\n  value -= float(bytemeB[3] * 16);\n  bytemeB[4] = int(floor(value / 8.));\n  value -= float(bytemeB[4] * 8);\n  bytemeB[5] = int(floor(value / 4.));\n  value -= float(bytemeB[5] * 4);\n  bytemeB[6] = int(floor(value / 2.));\n  value -= float(bytemeB[6] * 2);\n  bytemeB[7] = int(floor(value));\n\n  value = a * 255.;\n  int bytemeA[8];\n  bytemeA[0] = int(floor(value / 128.));\n  value -= float(bytemeA[0] * 128);\n  bytemeA[1] = int(floor(value / 64.));\n  value -= float(bytemeA[1] * 64);\n  bytemeA[2] = int(floor(value / 32.));\n  value -= float(bytemeA[2] * 32);\n  bytemeA[3] = int(floor(value / 16.));\n  value -= float(bytemeA[3] * 16);\n  bytemeA[4] = int(floor(value / 8.));\n  value -= float(bytemeA[4] * 8);\n  bytemeA[5] = int(floor(value / 4.));\n  value -= float(bytemeA[5] * 4);\n  bytemeA[6] = int(floor(value / 2.));\n  value -= float(bytemeA[6] * 2);\n  bytemeA[7] = int(floor(value));\n\n  // compute float32 value from bit arrays\n\n  // sign\n  int issigned = 1 - 2 * bytemeR[0];\n  //   issigned = int(pow(-1., float(bytemeR[0])));\n\n  // exponent\n  int exponent = 0;\n\n  exponent += bytemeR[1] * int(pow(2., 7.));\n  exponent += bytemeR[2] * int(pow(2., 6.));\n  exponent += bytemeR[3] * int(pow(2., 5.));\n  exponent += bytemeR[4] * int(pow(2., 4.));\n  exponent += bytemeR[5] * int(pow(2., 3.));\n  exponent += bytemeR[6] * int(pow(2., 2.));\n  exponent += bytemeR[7] * int(pow(2., 1.));\n\n  exponent += bytemeG[0];\n\n  // fraction\n  float fraction = 0.;\n\n  fraction = float(bytemeG[1]) * pow(2., -1.);\n  fraction += float(bytemeG[2]) * pow(2., -2.);\n  fraction += float(bytemeG[3]) * pow(2., -3.);\n  fraction += float(bytemeG[4]) * pow(2., -4.);\n  fraction += float(bytemeG[5]) * pow(2., -5.);\n  fraction += float(bytemeG[6]) * pow(2., -6.);\n  fraction += float(bytemeG[7]) * pow(2., -7.);\n\n  fraction += float(bytemeB[0]) * pow(2., -8.);\n  fraction += float(bytemeB[1]) * pow(2., -9.);\n  fraction += float(bytemeB[2]) * pow(2., -10.);\n  fraction += float(bytemeB[3]) * pow(2., -11.);\n  fraction += float(bytemeB[4]) * pow(2., -12.);\n  fraction += float(bytemeB[5]) * pow(2., -13.);\n  fraction += float(bytemeB[6]) * pow(2., -14.);\n  fraction += float(bytemeB[7]) * pow(2., -15.);\n\n  fraction += float(bytemeA[0]) * pow(2., -16.);\n  fraction += float(bytemeA[1]) * pow(2., -17.);\n  fraction += float(bytemeA[2]) * pow(2., -18.);\n  fraction += float(bytemeA[3]) * pow(2., -19.);\n  fraction += float(bytemeA[4]) * pow(2., -20.);\n  fraction += float(bytemeA[5]) * pow(2., -21.);\n  fraction += float(bytemeA[6]) * pow(2., -22.);\n  fraction += float(bytemeA[7]) * pow(2., -23.);\n\n  value = float(issigned) * pow( 2., float(exponent - 127)) * (1. + fraction);\n}\n\n// entry point for the unpack function\nvoid unpack( in vec4 packedRGBA,\n             in int bitsAllocated,\n             in int signedNumber,\n             in int numberOfChannels,\n             in int pixelType,\n             in int offset,\n             out vec4 unpacked) {\n\n  if(numberOfChannels == 1){\n    if(bitsAllocated == 8 || bitsAllocated == 1){\n      uInt8(\n        packedRGBA.r,\n        unpacked.x);\n    }\n    else if(bitsAllocated == 16){\n      if( offset == 0 ){\n        uInt16(\n          packedRGBA.r,\n          packedRGBA.g,\n          unpacked.x);\n      }\n      else{\n        uInt16(\n          packedRGBA.b,\n          packedRGBA.a,\n          unpacked.x);\n      }\n\n    }\n    else if(bitsAllocated == 32){\n      if(pixelType == 0){\n        uInt32(\n          packedRGBA.r,\n          packedRGBA.g,\n          packedRGBA.b,\n          packedRGBA.a,\n          unpacked.x);\n      }\n      else{\n        uFloat32(\n          packedRGBA.r,\n          packedRGBA.g,\n          packedRGBA.b,\n          packedRGBA.a,\n          unpacked.x);\n      }\n\n    }\n  }\n  else if(numberOfChannels == 3){\n    unpacked = packedRGBA;\n  }\n}\n\n// Support up to textureSize*textureSize*7 voxels\n\nvoid texture3DPolyfill(in ivec3 dataCoordinates,\n                       in ivec3 dataDimensions,\n                       in int textureSize,\n                       in sampler2D textureContainer0,\n                       in sampler2D textureContainer1,\n                       in sampler2D textureContainer2,\n                       in sampler2D textureContainer3,\n                       in sampler2D textureContainer4,\n                       in sampler2D textureContainer5,\n                       in sampler2D textureContainer6,\n                       in sampler2D textureContainer[7], // not working on Moto X 2014\n                       in int packedPerPixel,\n                       out vec4 dataValue,\n                       out int offset_0\n  ) {\n\n  // int pack = 2;\n\n    // Model coordinate to data index\n  int index = dataCoordinates.x\n            + dataCoordinates.y * dataDimensions.x\n            + dataCoordinates.z * dataDimensions.y * dataDimensions.x;\n  int indexP = int(index/packedPerPixel);\n\n  if( 2*indexP < index){\n    offset_0 = 1;\n  }\n  else{\n    offset_0 = 0;\n  }\n\n  // Map data index to right sampler2D texture\n  int voxelsPerTexture = textureSize*textureSize;\n  int textureIndex = int(floor(float(indexP) / float(voxelsPerTexture)));\n  // modulo seems incorrect sometimes...\n  // int inTextureIndex = int(mod(float(index), float(textureSize*textureSize)));\n  int inTextureIndex = indexP - voxelsPerTexture*textureIndex;\n\n  // Get row and column in the texture\n  int colIndex = int(mod(float(inTextureIndex), float(textureSize)));\n  int rowIndex = int(floor(float(inTextureIndex)/float(textureSize)));\n\n  // // Model coordinate to data index\n  // int index = dataCoordinates.x\n  //           + dataCoordinates.y * dataDimensions.x \n  //           + dataCoordinates.z * dataDimensions.y * dataDimensions.x;\n\n  // // Map data index to right sampler2D texture\n  // int voxelsPerTexture = 2 * textureSize * textureSize;\n  // int textureIndex = int(floor(float(index) / float(voxelsPerTexture)));\n  // // modulo seems incorrect sometimes...\n  // // int inTextureIndex = int(mod(float(index), float(textureSize*textureSize)));\n  // int inTextureIndex = index - voxelsPerTexture*textureIndex;\n\n  // float modulo = 0.5 * float(inTextureIndex) / float( textureSize * textureSize);\n  // dataValue = vec4(modulo, modulo, modulo, 1.0);\n  // // return;\n\n  // // float modulo = 100.0 * float( textureIndex ) / 7.0;\n  // // dataValue = vec4(modulo, modulo, modulo, 1.0);\n\n  // // return;\n\n  // // Get row and column in the texture\n  // // 0.5\n  // int colIndex = int(mod(0.5*float(inTextureIndex), float( textureSize )));\n  // int rowIndex = int(floor(0.5*float(inTextureIndex) / float( textureSize )));\n  // float fcolIndex = 0.5 * mod(float(inTextureIndex), float( 2 * textureSize ));\n  // float frowIndex = floor(0.5*float(inTextureIndex) / float( textureSize ));\n  // fcolIndex = floor( 0.5 * float( inTextureIndex ) ) - frowIndex * float( textureSize );\n\n  // dataValue = vec4(float(colIndex) / 4096., mod( float(colIndex), 2.) , 1., 1.);\n  // return;\n\n  // Map row and column to uv\n  vec2 uv = vec2(0,0);\n  uv.x = (0.5 + float(colIndex)) / float(textureSize);\n  uv.y = 1. - (0.5 + float(rowIndex)) / float(textureSize);\n\n  //\n  if(textureIndex == 0){ dataValue = texture2D(textureContainer0, uv); }\n  else if(textureIndex == 1){dataValue = texture2D(textureContainer1, uv);}\n  else if(textureIndex == 2){ dataValue = texture2D(textureContainer2, uv); }\n  else if(textureIndex == 3){ dataValue = texture2D(textureContainer3, uv); }\n  else if(textureIndex == 4){ dataValue = texture2D(textureContainer4, uv); }\n  else if(textureIndex == 5){ dataValue = texture2D(textureContainer5, uv); }\n  else if(textureIndex == 6){ dataValue = texture2D(textureContainer6, uv); }\n}\n\nvoid no(in vec3 currentVoxel,\n        in int kernelSize,\n        in ivec3 dataDimensions,\n        in int textureSize,\n        in sampler2D textureContainer0,\n        in sampler2D textureContainer1,\n        in sampler2D textureContainer2,\n        in sampler2D textureContainer3,\n        in sampler2D textureContainer4,\n        in sampler2D textureContainer5,\n        in sampler2D textureContainer6,\n        in sampler2D textureContainer[7], // not working on Moto X 2014\n        in int bitsAllocated, \n        in int numberOfChannels_1, \n        in int pixelType_1,\n        in int packedPerPixel_1,\n        out vec4 intensity_1\n  ) {\n  \n  // lower bound\n  vec3 rCurrentVoxel = vec3(floor(currentVoxel.x + 0.5 ), floor(currentVoxel.y + 0.5 ), floor(currentVoxel.z + 0.5 ));\n  ivec3 voxel = ivec3(int(rCurrentVoxel.x), int(rCurrentVoxel.y), int(rCurrentVoxel.z));\n\n  vec4 tmp = vec4(0., 0., 0., 0.);\n  int offset = 0;\n\n  texture3DPolyfill(\n    voxel,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    packedPerPixel_1,\n    tmp,\n    offset\n    );\n\n  unpack(\n    tmp,\n    bitsAllocated,\n    0,\n    numberOfChannels_1,\n    pixelType_1,\n    offset,\n    intensity_1);\n\n}\n\n// https://en.wikipedia.org/wiki/Trilinear_interpolation\n\nvoid trilinear(in vec3 currentVoxel,\n               in int kernelSize,\n               in ivec3 dataDimensions,\n               in int textureSize,\n               in sampler2D textureContainer0,\n               in sampler2D textureContainer1,\n               in sampler2D textureContainer2,\n               in sampler2D textureContainer3,\n               in sampler2D textureContainer4,\n               in sampler2D textureContainer5,\n               in sampler2D textureContainer6,\n               in sampler2D textureContainer[7], // not working on Moto X 2014\n               in int bitsAllocated, \n               in int numberOfChannels_2, \n               in int pixelType_2,\n               in int packedPerPixel_2,\n               out vec4 intensity_2\n  ) {\n  \n  // lower bound\n  vec3 lb = vec3(floor(currentVoxel.x + 0.5 ), floor(currentVoxel.y + 0.5 ), floor(currentVoxel.z + 0.5 ));\n\n  vec3 direction = currentVoxel - lb;\n\n  // higher bound\n  vec3 hb = lb + 1.0;\n\n  if( direction.x < 0.0){\n\n    hb.x -= 2.0;\n\n  }\n\n  if( direction.y < 0.0){\n\n    hb.y -= 2.0;\n\n  }\n\n  if( direction.z < 0.0){\n\n    hb.z -= 2.0;\n\n  }\n\n  vec3 lc = vec3(0.0, 0.0, 0.0);\n  vec3 hc = vec3(0.0, 0.0, 0.0);\n\n  if(lb.x < hb.x){\n\n    lc.x = lb.x;\n    hc.x = hb.x;\n\n  }\n  else{\n\n    lc.x = hb.x;\n    hc.x = lb.x;\n\n  }\n\n  if(lb.y < hb.y){\n\n    lc.y = lb.y;\n    hc.y = hb.y;\n\n  }\n  else{\n\n    lc.y = hb.y;\n    hc.y = lb.y;\n\n  }\n\n  if(lb.z < hb.z){\n\n    lc.z = lb.z;\n    hc.z = hb.z;\n\n  }\n  else{\n\n    lc.z = hb.z;\n    hc.z = lb.z;\n\n  }\n\n  float xd = ( currentVoxel.x - lc.x ) / ( hc.x - lc.x );\n  float yd = ( currentVoxel.y - lc.y ) / ( hc.y - lc.y );\n  float zd = ( currentVoxel.z - lc.z ) / ( hc.z - lc.z );\n\n  //\n  // c00\n  //\n\n  //\n\n  vec4 v000 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c000 = vec3(lc.x, lc.y, lc.z);\n\n  no(c000,\n    kernelSize,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    bitsAllocated, \n    numberOfChannels_2, \n    pixelType_2,\n    packedPerPixel_2,\n    v000\n  );\n\n  //\n\n  vec4 v100 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c100 = vec3(hc.x, lc.y, lc.z);\n\n  no(c100,\n    kernelSize,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    bitsAllocated, \n    numberOfChannels_2, \n    pixelType_2,\n    packedPerPixel_2,\n    v100\n  );\n\n  vec4 c00 = v000 * ( 1.0 - xd ) + v100 * xd;\n\n  //\n  // c01\n  //\n  vec4 v001 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c001 = vec3(lc.x, lc.y, hc.z);\n\n  no(c001,\n    kernelSize,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    bitsAllocated, \n    numberOfChannels_2, \n    pixelType_2,\n    packedPerPixel_2,\n    v001\n  );\n\n  vec4 v101 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c101 = vec3(hc.x, lc.y, hc.z);\n\n  no(c101,\n    kernelSize,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    bitsAllocated, \n    numberOfChannels_2, \n    pixelType_2,\n    packedPerPixel_2,\n    v101\n  );\n\n  vec4 c01 = v001 * ( 1.0 - xd ) + v101 * xd;\n\n  //\n  // c10\n  //\n  vec4 v010 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c010 = vec3(lc.x, hc.y, lc.z);\n\n  no(c010,\n    kernelSize,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    bitsAllocated, \n    numberOfChannels_2, \n    pixelType_2,\n    packedPerPixel_2,\n    v010\n  );\n\n  vec4 v110 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c110 = vec3(hc.x, hc.y, lc.z);\n\n  no(c110,\n    kernelSize,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    bitsAllocated, \n    numberOfChannels_2, \n    pixelType_2,\n    packedPerPixel_2,\n    v110\n  );\n\n  vec4 c10 = v010 * ( 1.0 - xd ) + v110 * xd;\n\n  //\n  // c11\n  //\n  vec4 v011 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c011 = vec3(lc.x, hc.y, hc.z);\n\n  no(c011,\n    kernelSize,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    bitsAllocated, \n    numberOfChannels_2, \n    pixelType_2,\n    packedPerPixel_2,\n    v011\n  );\n\n  vec4 v111 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c111 = vec3(hc.x, hc.y, hc.z);\n\n  no(c111,\n    kernelSize,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    bitsAllocated, \n    numberOfChannels_2, \n    pixelType_2,\n    packedPerPixel_2,\n    v111\n  );\n\n  vec4 c11 = v011 * ( 1.0 - xd ) + v111 * xd;\n\n  // c0 and c1\n  vec4 c0 = c00 * ( 1.0 - yd) + c10 * yd;\n  vec4 c1 = c01 * ( 1.0 - yd) + c11 * yd;\n\n  // c\n  vec4 c = c0 * ( 1.0 - zd) + c1 * zd;\n  intensity_2 = c;\n\n}\n\n// Support up to textureSize*textureSize*7 voxels\n\nvoid value_0(in vec3 dataCoordinates,\n           in int kernelSize,\n           in int interpolationMethod,\n           in ivec3 dataDimensions,\n           in int textureSize,\n           in sampler2D textureContainer0,\n           in sampler2D textureContainer1,\n           in sampler2D textureContainer2,\n           in sampler2D textureContainer3,\n           in sampler2D textureContainer4,\n           in sampler2D textureContainer5,\n           in sampler2D textureContainer6,\n           in sampler2D textureContainer[7], // not working on Moto X 2014\n           in int bitsAllocated, \n           in int numberOfChannels_0, \n           in int pixelType_0,\n           in int packedPerPixel_0,\n           out vec4 intensity_0\n  ) {\n\n  if( interpolationMethod == 0){\n\n    // no interpolation\n    no(dataCoordinates,\n       kernelSize,\n       dataDimensions,\n       textureSize,\n       textureContainer0,\n       textureContainer1,\n       textureContainer2,\n       textureContainer3,\n       textureContainer4,\n       textureContainer5,\n       textureContainer6,\n       textureContainer,\n       bitsAllocated,\n       numberOfChannels_0,\n       pixelType_0,\n       packedPerPixel_0,\n       intensity_0);\n\n  }\n  else if( interpolationMethod == 1){\n\n    // trilinear interpolation\n    trilinear(dataCoordinates,\n      kernelSize,\n      dataDimensions,\n      textureSize,\n      textureContainer0,\n      textureContainer1,\n      textureContainer2,\n      textureContainer3,\n      textureContainer4,\n      textureContainer5,\n      textureContainer6,\n      textureContainer,\n      bitsAllocated,\n      numberOfChannels_0,\n      pixelType_0,\n      packedPerPixel_0,\n      intensity_0);\n\n  }\n\n}\n\nvoid main(void) {\n\n  vec2 texc = vec2(((vProjectedCoords.x / vProjectedCoords.w) + 1.0 ) / 2.0,\n                ((vProjectedCoords.y / vProjectedCoords.w) + 1.0 ) / 2.0 );\n\n  // just silence warning for\n  vec4 dummy = vPos;\n\n  //The back position is the world space position stored in the texture.\n  vec4 baseColor0 = texture2D(uTextureBackTest0, texc);\n  vec4 baseColor1 = texture2D(uTextureBackTest1, texc);\n\n  vec4 pixelColor = baseColor0;\n\n  if( uTrackMouse == 1 ){\n\n      if( vProjectedCoords.x < uMouse.x ){\n\n        pixelColor = baseColor0;\n\n      }\n      else{\n\n        pixelColor = baseColor1;\n\n      }\n\n  }\n  else{\n\n    if( uType1 == 0 ){\n\n      //merge an inmage into\n      pixelColor = mix( pixelColor, baseColor1, uOpacity1 );\n\n    }\n    else{\n\n      float opacity = baseColor1.a;\n      pixelColor = mix( pixelColor, baseColor1, opacity * uOpacity1 );\n\n    }\n\n  }\n\n  gl_FragColor = pixelColor;\n\n  return;\n\n}",h="#define GLSLIFY 1\nuniform float uWorldBBox[6];\n\nvarying vec4 vPos;\n\nvoid main(void) {\n\n  // NORMALIZE LPS VALUES\n  gl_FragColor = vec4((vPos.x - uWorldBBox[0])/(uWorldBBox[1] - uWorldBBox[0]),\n                      (vPos.y - uWorldBBox[2])/(uWorldBBox[3] - uWorldBBox[2]),\n                      (vPos.z - uWorldBBox[4])/(uWorldBBox[5] - uWorldBBox[4]),\n                      1.0);\n\n}",p="#define GLSLIFY 1\nvarying vec4 vPos;\nvarying vec4 vProjectedCoords;\n//\n// main\n//\nvoid main() {\n\n  vPos = modelMatrix * vec4(position, 1.0 );\n  vProjectedCoords =  projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0 );\n\n}",m="#define GLSLIFY 1\nuniform int       uTextureSize;\nuniform float     uWindowCenterWidth[2];\nuniform float     uRescaleSlopeIntercept[2];\nuniform sampler2D uTextureContainer[7];\nuniform ivec3     uDataDimensions;\nuniform mat4      uWorldToData;\nuniform int       uNumberOfChannels;\nuniform int       uPixelType;\nuniform int       uBitsAllocated;\nuniform float     uWorldBBox[6];\nuniform sampler2D uTextureBack;\nuniform int       uSteps;\nuniform int       uLut;\nuniform sampler2D uTextureLUT;\nuniform float     uAlphaCorrection;\nuniform float     uFrequence;\nuniform float     uAmplitude;\nuniform int       uInterpolation;\nuniform int       uPackedPerPixel;\n\nvarying vec4      vPos;\nvarying vec4      vProjectedCoords;\n\n// include functions\n// unpack int 8\nvoid uInt8(in float r, out float value){\n  value = r * 256.;\n}\n\n// unpack int 16\nvoid uInt16(in float r, in float a, out float value){\n  value = r * 256. + a * 65536.;\n}\n\n// unpack int 32\nvoid uInt32(in float r, in float g, in float b, in float a, out float value){\n  value = r * 256. + g * 65536. + b * 16777216. + a * 4294967296.;\n}\n\n// unpack float 32\nvoid uFloat32(in float r, in float g, in float b, in float a, out float value){\n\n  // create arrays containing bits for rgba values\n  // value between 0 and 255\n  value = r * 255.;\n  int bytemeR[8];\n  bytemeR[0] = int(floor(value / 128.));\n  value -= float(bytemeR[0] * 128);\n  bytemeR[1] = int(floor(value / 64.));\n  value -= float(bytemeR[1] * 64);\n  bytemeR[2] = int(floor(value / 32.));\n  value -= float(bytemeR[2] * 32);\n  bytemeR[3] = int(floor(value / 16.));\n  value -= float(bytemeR[3] * 16);\n  bytemeR[4] = int(floor(value / 8.));\n  value -= float(bytemeR[4] * 8);\n  bytemeR[5] = int(floor(value / 4.));\n  value -= float(bytemeR[5] * 4);\n  bytemeR[6] = int(floor(value / 2.));\n  value -= float(bytemeR[6] * 2);\n  bytemeR[7] = int(floor(value));\n\n  value = g * 255.;\n  int bytemeG[8];\n  bytemeG[0] = int(floor(value / 128.));\n  value -= float(bytemeG[0] * 128);\n  bytemeG[1] = int(floor(value / 64.));\n  value -= float(bytemeG[1] * 64);\n  bytemeG[2] = int(floor(value / 32.));\n  value -= float(bytemeG[2] * 32);\n  bytemeG[3] = int(floor(value / 16.));\n  value -= float(bytemeG[3] * 16);\n  bytemeG[4] = int(floor(value / 8.));\n  value -= float(bytemeG[4] * 8);\n  bytemeG[5] = int(floor(value / 4.));\n  value -= float(bytemeG[5] * 4);\n  bytemeG[6] = int(floor(value / 2.));\n  value -= float(bytemeG[6] * 2);\n  bytemeG[7] = int(floor(value));\n\n  value = b * 255.;\n  int bytemeB[8];\n  bytemeB[0] = int(floor(value / 128.));\n  value -= float(bytemeB[0] * 128);\n  bytemeB[1] = int(floor(value / 64.));\n  value -= float(bytemeB[1] * 64);\n  bytemeB[2] = int(floor(value / 32.));\n  value -= float(bytemeB[2] * 32);\n  bytemeB[3] = int(floor(value / 16.));\n  value -= float(bytemeB[3] * 16);\n  bytemeB[4] = int(floor(value / 8.));\n  value -= float(bytemeB[4] * 8);\n  bytemeB[5] = int(floor(value / 4.));\n  value -= float(bytemeB[5] * 4);\n  bytemeB[6] = int(floor(value / 2.));\n  value -= float(bytemeB[6] * 2);\n  bytemeB[7] = int(floor(value));\n\n  value = a * 255.;\n  int bytemeA[8];\n  bytemeA[0] = int(floor(value / 128.));\n  value -= float(bytemeA[0] * 128);\n  bytemeA[1] = int(floor(value / 64.));\n  value -= float(bytemeA[1] * 64);\n  bytemeA[2] = int(floor(value / 32.));\n  value -= float(bytemeA[2] * 32);\n  bytemeA[3] = int(floor(value / 16.));\n  value -= float(bytemeA[3] * 16);\n  bytemeA[4] = int(floor(value / 8.));\n  value -= float(bytemeA[4] * 8);\n  bytemeA[5] = int(floor(value / 4.));\n  value -= float(bytemeA[5] * 4);\n  bytemeA[6] = int(floor(value / 2.));\n  value -= float(bytemeA[6] * 2);\n  bytemeA[7] = int(floor(value));\n\n  // compute float32 value from bit arrays\n\n  // sign\n  int issigned = 1 - 2 * bytemeR[0];\n  //   issigned = int(pow(-1., float(bytemeR[0])));\n\n  // exponent\n  int exponent = 0;\n\n  exponent += bytemeR[1] * int(pow(2., 7.));\n  exponent += bytemeR[2] * int(pow(2., 6.));\n  exponent += bytemeR[3] * int(pow(2., 5.));\n  exponent += bytemeR[4] * int(pow(2., 4.));\n  exponent += bytemeR[5] * int(pow(2., 3.));\n  exponent += bytemeR[6] * int(pow(2., 2.));\n  exponent += bytemeR[7] * int(pow(2., 1.));\n\n  exponent += bytemeG[0];\n\n  // fraction\n  float fraction = 0.;\n\n  fraction = float(bytemeG[1]) * pow(2., -1.);\n  fraction += float(bytemeG[2]) * pow(2., -2.);\n  fraction += float(bytemeG[3]) * pow(2., -3.);\n  fraction += float(bytemeG[4]) * pow(2., -4.);\n  fraction += float(bytemeG[5]) * pow(2., -5.);\n  fraction += float(bytemeG[6]) * pow(2., -6.);\n  fraction += float(bytemeG[7]) * pow(2., -7.);\n\n  fraction += float(bytemeB[0]) * pow(2., -8.);\n  fraction += float(bytemeB[1]) * pow(2., -9.);\n  fraction += float(bytemeB[2]) * pow(2., -10.);\n  fraction += float(bytemeB[3]) * pow(2., -11.);\n  fraction += float(bytemeB[4]) * pow(2., -12.);\n  fraction += float(bytemeB[5]) * pow(2., -13.);\n  fraction += float(bytemeB[6]) * pow(2., -14.);\n  fraction += float(bytemeB[7]) * pow(2., -15.);\n\n  fraction += float(bytemeA[0]) * pow(2., -16.);\n  fraction += float(bytemeA[1]) * pow(2., -17.);\n  fraction += float(bytemeA[2]) * pow(2., -18.);\n  fraction += float(bytemeA[3]) * pow(2., -19.);\n  fraction += float(bytemeA[4]) * pow(2., -20.);\n  fraction += float(bytemeA[5]) * pow(2., -21.);\n  fraction += float(bytemeA[6]) * pow(2., -22.);\n  fraction += float(bytemeA[7]) * pow(2., -23.);\n\n  value = float(issigned) * pow( 2., float(exponent - 127)) * (1. + fraction);\n}\n\n// entry point for the unpack function\nvoid unpack( in vec4 packedRGBA,\n             in int bitsAllocated,\n             in int signedNumber,\n             in int numberOfChannels,\n             in int pixelType,\n             in int offset,\n             out vec4 unpacked) {\n\n  if(numberOfChannels == 1){\n    if(bitsAllocated == 8 || bitsAllocated == 1){\n      uInt8(\n        packedRGBA.r,\n        unpacked.x);\n    }\n    else if(bitsAllocated == 16){\n      if( offset == 0 ){\n        uInt16(\n          packedRGBA.r,\n          packedRGBA.g,\n          unpacked.x);\n      }\n      else{\n        uInt16(\n          packedRGBA.b,\n          packedRGBA.a,\n          unpacked.x);\n      }\n\n    }\n    else if(bitsAllocated == 32){\n      if(pixelType == 0){\n        uInt32(\n          packedRGBA.r,\n          packedRGBA.g,\n          packedRGBA.b,\n          packedRGBA.a,\n          unpacked.x);\n      }\n      else{\n        uFloat32(\n          packedRGBA.r,\n          packedRGBA.g,\n          packedRGBA.b,\n          packedRGBA.a,\n          unpacked.x);\n      }\n\n    }\n  }\n  else if(numberOfChannels == 3){\n    unpacked = packedRGBA;\n  }\n}\n\n// Support up to textureSize*textureSize*7 voxels\n\nvoid texture3DPolyfill(in ivec3 dataCoordinates,\n                       in ivec3 dataDimensions,\n                       in int textureSize,\n                       in sampler2D textureContainer0,\n                       in sampler2D textureContainer1,\n                       in sampler2D textureContainer2,\n                       in sampler2D textureContainer3,\n                       in sampler2D textureContainer4,\n                       in sampler2D textureContainer5,\n                       in sampler2D textureContainer6,\n                       in sampler2D textureContainer[7], // not working on Moto X 2014\n                       in int packedPerPixel,\n                       out vec4 dataValue_0,\n                       out int offset_0\n  ) {\n\n  // int pack = 2;\n\n    // Model coordinate to data index\n  int index = dataCoordinates.x\n            + dataCoordinates.y * dataDimensions.x\n            + dataCoordinates.z * dataDimensions.y * dataDimensions.x;\n  int indexP = int(index/packedPerPixel);\n\n  if( 2*indexP < index){\n    offset_0 = 1;\n  }\n  else{\n    offset_0 = 0;\n  }\n\n  // Map data index to right sampler2D texture\n  int voxelsPerTexture = textureSize*textureSize;\n  int textureIndex = int(floor(float(indexP) / float(voxelsPerTexture)));\n  // modulo seems incorrect sometimes...\n  // int inTextureIndex = int(mod(float(index), float(textureSize*textureSize)));\n  int inTextureIndex = indexP - voxelsPerTexture*textureIndex;\n\n  // Get row and column in the texture\n  int colIndex = int(mod(float(inTextureIndex), float(textureSize)));\n  int rowIndex = int(floor(float(inTextureIndex)/float(textureSize)));\n\n  // // Model coordinate to data index\n  // int index = dataCoordinates.x\n  //           + dataCoordinates.y * dataDimensions.x \n  //           + dataCoordinates.z * dataDimensions.y * dataDimensions.x;\n\n  // // Map data index to right sampler2D texture\n  // int voxelsPerTexture = 2 * textureSize * textureSize;\n  // int textureIndex = int(floor(float(index) / float(voxelsPerTexture)));\n  // // modulo seems incorrect sometimes...\n  // // int inTextureIndex = int(mod(float(index), float(textureSize*textureSize)));\n  // int inTextureIndex = index - voxelsPerTexture*textureIndex;\n\n  // float modulo = 0.5 * float(inTextureIndex) / float( textureSize * textureSize);\n  // dataValue = vec4(modulo, modulo, modulo, 1.0);\n  // // return;\n\n  // // float modulo = 100.0 * float( textureIndex ) / 7.0;\n  // // dataValue = vec4(modulo, modulo, modulo, 1.0);\n\n  // // return;\n\n  // // Get row and column in the texture\n  // // 0.5\n  // int colIndex = int(mod(0.5*float(inTextureIndex), float( textureSize )));\n  // int rowIndex = int(floor(0.5*float(inTextureIndex) / float( textureSize )));\n  // float fcolIndex = 0.5 * mod(float(inTextureIndex), float( 2 * textureSize ));\n  // float frowIndex = floor(0.5*float(inTextureIndex) / float( textureSize ));\n  // fcolIndex = floor( 0.5 * float( inTextureIndex ) ) - frowIndex * float( textureSize );\n\n  // dataValue = vec4(float(colIndex) / 4096., mod( float(colIndex), 2.) , 1., 1.);\n  // return;\n\n  // Map row and column to uv\n  vec2 uv = vec2(0,0);\n  uv.x = (0.5 + float(colIndex)) / float(textureSize);\n  uv.y = 1. - (0.5 + float(rowIndex)) / float(textureSize);\n\n  //\n  if(textureIndex == 0){ dataValue_0 = texture2D(textureContainer0, uv); }\n  else if(textureIndex == 1){dataValue_0 = texture2D(textureContainer1, uv);}\n  else if(textureIndex == 2){ dataValue_0 = texture2D(textureContainer2, uv); }\n  else if(textureIndex == 3){ dataValue_0 = texture2D(textureContainer3, uv); }\n  else if(textureIndex == 4){ dataValue_0 = texture2D(textureContainer4, uv); }\n  else if(textureIndex == 5){ dataValue_0 = texture2D(textureContainer5, uv); }\n  else if(textureIndex == 6){ dataValue_0 = texture2D(textureContainer6, uv); }\n}\n\nvoid no(in vec3 currentVoxel,\n        in int kernelSize,\n        in ivec3 dataDimensions,\n        in int textureSize,\n        in sampler2D textureContainer0,\n        in sampler2D textureContainer1,\n        in sampler2D textureContainer2,\n        in sampler2D textureContainer3,\n        in sampler2D textureContainer4,\n        in sampler2D textureContainer5,\n        in sampler2D textureContainer6,\n        in sampler2D textureContainer[7], // not working on Moto X 2014\n        in int bitsAllocated, \n        in int numberOfChannels_2, \n        in int pixelType_2,\n        in int packedPerPixel_2,\n        out vec4 intensity_2\n  ) {\n  \n  // lower bound\n  vec3 rCurrentVoxel = vec3(floor(currentVoxel.x + 0.5 ), floor(currentVoxel.y + 0.5 ), floor(currentVoxel.z + 0.5 ));\n  ivec3 voxel = ivec3(int(rCurrentVoxel.x), int(rCurrentVoxel.y), int(rCurrentVoxel.z));\n\n  vec4 tmp = vec4(0., 0., 0., 0.);\n  int offset = 0;\n\n  texture3DPolyfill(\n    voxel,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    packedPerPixel_2,\n    tmp,\n    offset\n    );\n\n  unpack(\n    tmp,\n    bitsAllocated,\n    0,\n    numberOfChannels_2,\n    pixelType_2,\n    offset,\n    intensity_2);\n\n}\n\n// https://en.wikipedia.org/wiki/Trilinear_interpolation\n\nvoid trilinear(in vec3 currentVoxel,\n               in int kernelSize,\n               in ivec3 dataDimensions,\n               in int textureSize,\n               in sampler2D textureContainer0,\n               in sampler2D textureContainer1,\n               in sampler2D textureContainer2,\n               in sampler2D textureContainer3,\n               in sampler2D textureContainer4,\n               in sampler2D textureContainer5,\n               in sampler2D textureContainer6,\n               in sampler2D textureContainer[7], // not working on Moto X 2014\n               in int bitsAllocated, \n               in int numberOfChannels_0, \n               in int pixelType_0,\n               in int packedPerPixel_0,\n               out vec4 intensity_0\n  ) {\n  \n  // lower bound\n  vec3 lb = vec3(floor(currentVoxel.x + 0.5 ), floor(currentVoxel.y + 0.5 ), floor(currentVoxel.z + 0.5 ));\n\n  vec3 direction = currentVoxel - lb;\n\n  // higher bound\n  vec3 hb = lb + 1.0;\n\n  if( direction.x < 0.0){\n\n    hb.x -= 2.0;\n\n  }\n\n  if( direction.y < 0.0){\n\n    hb.y -= 2.0;\n\n  }\n\n  if( direction.z < 0.0){\n\n    hb.z -= 2.0;\n\n  }\n\n  vec3 lc = vec3(0.0, 0.0, 0.0);\n  vec3 hc = vec3(0.0, 0.0, 0.0);\n\n  if(lb.x < hb.x){\n\n    lc.x = lb.x;\n    hc.x = hb.x;\n\n  }\n  else{\n\n    lc.x = hb.x;\n    hc.x = lb.x;\n\n  }\n\n  if(lb.y < hb.y){\n\n    lc.y = lb.y;\n    hc.y = hb.y;\n\n  }\n  else{\n\n    lc.y = hb.y;\n    hc.y = lb.y;\n\n  }\n\n  if(lb.z < hb.z){\n\n    lc.z = lb.z;\n    hc.z = hb.z;\n\n  }\n  else{\n\n    lc.z = hb.z;\n    hc.z = lb.z;\n\n  }\n\n  float xd = ( currentVoxel.x - lc.x ) / ( hc.x - lc.x );\n  float yd = ( currentVoxel.y - lc.y ) / ( hc.y - lc.y );\n  float zd = ( currentVoxel.z - lc.z ) / ( hc.z - lc.z );\n\n  //\n  // c00\n  //\n\n  //\n\n  vec4 v000 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c000 = vec3(lc.x, lc.y, lc.z);\n\n  no(c000,\n    kernelSize,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    bitsAllocated, \n    numberOfChannels_0, \n    pixelType_0,\n    packedPerPixel_0,\n    v000\n  );\n\n  //\n\n  vec4 v100 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c100 = vec3(hc.x, lc.y, lc.z);\n\n  no(c100,\n    kernelSize,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    bitsAllocated, \n    numberOfChannels_0, \n    pixelType_0,\n    packedPerPixel_0,\n    v100\n  );\n\n  vec4 c00 = v000 * ( 1.0 - xd ) + v100 * xd;\n\n  //\n  // c01\n  //\n  vec4 v001 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c001 = vec3(lc.x, lc.y, hc.z);\n\n  no(c001,\n    kernelSize,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    bitsAllocated, \n    numberOfChannels_0, \n    pixelType_0,\n    packedPerPixel_0,\n    v001\n  );\n\n  vec4 v101 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c101 = vec3(hc.x, lc.y, hc.z);\n\n  no(c101,\n    kernelSize,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    bitsAllocated, \n    numberOfChannels_0, \n    pixelType_0,\n    packedPerPixel_0,\n    v101\n  );\n\n  vec4 c01 = v001 * ( 1.0 - xd ) + v101 * xd;\n\n  //\n  // c10\n  //\n  vec4 v010 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c010 = vec3(lc.x, hc.y, lc.z);\n\n  no(c010,\n    kernelSize,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    bitsAllocated, \n    numberOfChannels_0, \n    pixelType_0,\n    packedPerPixel_0,\n    v010\n  );\n\n  vec4 v110 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c110 = vec3(hc.x, hc.y, lc.z);\n\n  no(c110,\n    kernelSize,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    bitsAllocated, \n    numberOfChannels_0, \n    pixelType_0,\n    packedPerPixel_0,\n    v110\n  );\n\n  vec4 c10 = v010 * ( 1.0 - xd ) + v110 * xd;\n\n  //\n  // c11\n  //\n  vec4 v011 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c011 = vec3(lc.x, hc.y, hc.z);\n\n  no(c011,\n    kernelSize,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    bitsAllocated, \n    numberOfChannels_0, \n    pixelType_0,\n    packedPerPixel_0,\n    v011\n  );\n\n  vec4 v111 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c111 = vec3(hc.x, hc.y, hc.z);\n\n  no(c111,\n    kernelSize,\n    dataDimensions,\n    textureSize,\n    textureContainer[0],\n    textureContainer[1],\n    textureContainer[2],\n    textureContainer[3],\n    textureContainer[4],\n    textureContainer[5],\n    textureContainer[6],\n    textureContainer,     // not working on Moto X 2014\n    bitsAllocated, \n    numberOfChannels_0, \n    pixelType_0,\n    packedPerPixel_0,\n    v111\n  );\n\n  vec4 c11 = v011 * ( 1.0 - xd ) + v111 * xd;\n\n  // c0 and c1\n  vec4 c0 = c00 * ( 1.0 - yd) + c10 * yd;\n  vec4 c1 = c01 * ( 1.0 - yd) + c11 * yd;\n\n  // c\n  vec4 c = c0 * ( 1.0 - zd) + c1 * zd;\n  intensity_0 = c;\n\n}\n\n// Support up to textureSize*textureSize*7 voxels\n\nvoid value_0(in vec3 dataCoordinates,\n           in int kernelSize,\n           in int interpolationMethod,\n           in ivec3 dataDimensions,\n           in int textureSize,\n           in sampler2D textureContainer0,\n           in sampler2D textureContainer1,\n           in sampler2D textureContainer2,\n           in sampler2D textureContainer3,\n           in sampler2D textureContainer4,\n           in sampler2D textureContainer5,\n           in sampler2D textureContainer6,\n           in sampler2D textureContainer[7], // not working on Moto X 2014\n           in int bitsAllocated, \n           in int numberOfChannels_1, \n           in int pixelType_1,\n           in int packedPerPixel_1,\n           out vec4 intensity_1\n  ) {\n\n  if( interpolationMethod == 0){\n\n    // no interpolation\n    no(dataCoordinates,\n       kernelSize,\n       dataDimensions,\n       textureSize,\n       textureContainer0,\n       textureContainer1,\n       textureContainer2,\n       textureContainer3,\n       textureContainer4,\n       textureContainer5,\n       textureContainer6,\n       textureContainer,\n       bitsAllocated,\n       numberOfChannels_1,\n       pixelType_1,\n       packedPerPixel_1,\n       intensity_1);\n\n  }\n  else if( interpolationMethod == 1){\n\n    // trilinear interpolation\n    trilinear(dataCoordinates,\n      kernelSize,\n      dataDimensions,\n      textureSize,\n      textureContainer0,\n      textureContainer1,\n      textureContainer2,\n      textureContainer3,\n      textureContainer4,\n      textureContainer5,\n      textureContainer6,\n      textureContainer,\n      bitsAllocated,\n      numberOfChannels_1,\n      pixelType_1,\n      packedPerPixel_1,\n      intensity_1);\n\n  }\n\n}\n\nvec3 transformPoint(const in vec3 samplePoint, const in float frequency, const in float amplitude)\n// Apply a spatial transformation to a world space point\n{\n  return samplePoint + amplitude * vec3(samplePoint.x * sin(frequency * samplePoint.z),\n                                        samplePoint.y * cos(frequency * samplePoint.z),\n                                        0);\n}\n\n// needed for glslify\n\nvoid getIntensity(in vec3 dataCoordinates, out float intensity){\n\n  vec4 dataValue = vec4(0., 0., 0., 0.);\n  int kernelSize = 2;\n  value_0(\n    dataCoordinates,\n    kernelSize,\n    uInterpolation,\n    uDataDimensions,\n    uTextureSize,\n    uTextureContainer[0],\n    uTextureContainer[1],\n    uTextureContainer[2],\n    uTextureContainer[3],\n    uTextureContainer[4],\n    uTextureContainer[5],\n    uTextureContainer[6],\n    uTextureContainer,     // not working on Moto X 2014\n    uBitsAllocated,\n    uNumberOfChannels,\n    uPixelType,\n    uPackedPerPixel,\n    dataValue\n  );\n  \n  intensity = dataValue.r;\n\n  // rescale/slope\n  intensity = intensity*uRescaleSlopeIntercept[0] + uRescaleSlopeIntercept[1];\n  // window level\n  float windowMin = uWindowCenterWidth[0] - uWindowCenterWidth[1] * 0.5;\n  // float windowMax = uWindowCenterWidth[0] + uWindowCenterWidth[1] * 0.5;\n  intensity = ( intensity - windowMin ) / uWindowCenterWidth[1];\n}\n\nvoid main(void) {\n  const int maxSteps = 1024;\n\n  //\n  vec2 texc = vec2(((vProjectedCoords.x / vProjectedCoords.w) + 1.0 ) / 2.0,\n                ((vProjectedCoords.y / vProjectedCoords.w) + 1.0 ) / 2.0 );\n  //The back position is the world space position stored in the texture.\n  vec3 backPosNormalized = texture2D(uTextureBack, texc).xyz;\n  //\n  vec3 backPos = vec3(backPosNormalized.x * (uWorldBBox[1] - uWorldBBox[0]) + uWorldBBox[0],\n                     backPosNormalized.y * (uWorldBBox[3] - uWorldBBox[2]) + uWorldBBox[2],\n                     backPosNormalized.z * (uWorldBBox[5] - uWorldBBox[4]) + uWorldBBox[4]);\n  vec3 frontPos = vec3(vPos.x, vPos.y, vPos.z);\n\n  // init the ray\n  vec3 rayDir = backPos - frontPos;\n  float rayLength = length(rayDir);\n\n  // init the delta\n  float delta = 1.0 / float(uSteps);\n  vec3  deltaDirection = rayDir * delta;\n  float deltaDirectionLength = length(deltaDirection);\n\n  // init the ray marching\n  vec3 currentPosition = frontPos;\n  vec4 accumulatedColor = vec4(0.0);\n  float accumulatedAlpha = 0.0;\n  float accumulatedLength = 0.0;\n\n  // color and alpha at intersection\n  vec4 colorSample;\n  float alphaSample;\n  float gradientLPS = 1.;\n  for(int rayStep = 0; rayStep < maxSteps; rayStep++){\n\n    // get data value at given location\n    // need a function/polyfill to hide it\n\n    // get texture coordinates of current pixel\n    // doesn't need that in theory\n    vec3 currentPosition2 = transformPoint(currentPosition, uAmplitude, uFrequence);\n    vec4 currentPos4 = vec4(currentPosition2, 1.0);\n\n    vec4 dataCoordinatesRaw = uWorldToData * currentPos4;\n    vec3 currentVoxel = vec3(dataCoordinatesRaw.x, dataCoordinatesRaw.y, dataCoordinatesRaw.z);\n\n    if ( all(greaterThanEqual(currentVoxel, vec3(0.0))) &&\n         all(lessThan(currentVoxel, vec3(float(uDataDimensions.x), float(uDataDimensions.y), float(uDataDimensions.z))))) {\n      \n      float intensity = 0.0;\n      getIntensity(currentVoxel, intensity);\n\n      if(uLut == 1){\n        vec4 test = texture2D( uTextureLUT, vec2( intensity, 1.0) );\n        // 256 colors\n        colorSample.r = test.r;//test.a;\n        colorSample.g = test.g;//test.a;\n        colorSample.b = test.b;///test.a;\n        alphaSample = test.a;\n\n      }\n      else{\n        alphaSample = intensity;\n        colorSample.r = colorSample.g = colorSample.b = intensity * alphaSample;\n      }\n\n      alphaSample = alphaSample * uAlphaCorrection;\n      alphaSample *= (1.0 - accumulatedAlpha);\n\n      // we have the intensity now\n      // colorSample.x = colorSample.y = colorSample.z = intensity;\n      // use a dummy alpha for now\n      // alphaSample = intensity;\n      // if(alphaSample < 0.15){\n      //   alphaSample = 0.;\n      // }\n\n      //Perform the composition.\n      // (1.0 - accumulatedAlpha) *\n      accumulatedColor += alphaSample * colorSample;// * alphaSample;\n\n      //Store the alpha accumulated so far.\n      accumulatedAlpha += alphaSample;\n      // accumulatedAlpha += 1.0;\n\n    }\n\n    //Advance the ray.\n    currentPosition += deltaDirection;\n    accumulatedLength += deltaDirectionLength;\n\n    if(accumulatedLength >= rayLength || accumulatedAlpha >= 1.0 ) break;\n  }\n\n  gl_FragColor = vec4(accumulatedColor.xyz, accumulatedAlpha);\n}";
n["default"]={DataUniforms:o["default"],DataVertex:c,DataFragment:f,LayerUniforms:s["default"],LayerFragment:d,RaycastingUniforms:u["default"],RaycastingFirstpassFragment:h,RaycastingSecondpassVertex:p,RaycastingSecondpassFragment:m}},{"./shaders.data.js":92,"./shaders.layer.js":94,"./shaders.raycasting.js":95}],94:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(){i(this,e)}return r(e,null,[{key:"uniforms",value:function(){return{uTextureBackTest0:{type:"t",value:[]},uTextureBackTest1:{type:"t",value:[]},uOpacity0:{type:"f",value:1},uOpacity1:{type:"f",value:1},uType0:{type:"i",value:0},uType1:{type:"i",value:1},uTrackMouse:{type:"i",value:0},uMouse:{type:"v2",value:new THREE.Vector2}}}}]),e}();n["default"]=o},{}],95:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(){i(this,e)}return r(e,null,[{key:"singlePassUniforms",value:function(){return{uWorldBBox:{type:"fv1",value:[0,0,0,0,0,0]},uTextureSize:{type:"i",value:0},uTextureContainer:{type:"tv",value:[]},uDataDimensions:{type:"iv",value:[0,0,0]},uWorldToData:{type:"m4",value:new THREE.Matrix4},uWindowCenterWidth:{type:"fv1",value:[0,0]},uRescaleSlopeIntercept:{type:"fv1",value:[0,0]},uNumberOfChannels:{type:"i",value:1},uBitsAllocated:{type:"i",value:8},uLut:{type:"i",value:0},uTextureLUT:{type:"t",value:[]},uSteps:{type:"i",value:256},uAlphaCorrection:{type:"f",value:.5},uFrequence:{type:"f",value:0},uAmplitude:{type:"f",value:0},uPixelType:{type:"i",value:0},uInterpolation:{type:"i",value:0},uPackedPerPixel:{type:"i",value:1}}}},{key:"firstPassUniforms",value:function(){return{uWorldBBox:{type:"fv1",value:[0,0,0,0,0,0]}}}},{key:"secondPassUniforms",value:function(){return{uTextureSize:{type:"i",value:0},uTextureContainer:{type:"tv",value:[]},uDataDimensions:{type:"iv",value:[0,0,0]},uWorldToData:{type:"m4",value:new THREE.Matrix4},uWindowCenterWidth:{type:"fv1",value:[0,0]},uRescaleSlopeIntercept:{type:"fv1",value:[0,0]},uNumberOfChannels:{type:"i",value:1},uBitsAllocated:{type:"i",value:8},uTextureBack:{type:"t",value:null},uWorldBBox:{type:"fv1",value:[0,0,0,0,0,0]},uSteps:{type:"i",value:128},uLut:{type:"i",value:0},uTextureLUT:{type:"t",value:[]},uAlphaCorrection:{type:"f",value:1},uFrequence:{type:"f",value:0},uAmplitude:{type:"f",value:0},uPixelType:{type:"i",value:0},uInterpolation:{type:"i",value:0},uPackedPerPixel:{type:"i",value:1}}}}]),e}();n["default"]=o},{}],96:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var r=e("./widgets.voxelProbe"),o=i(r);n["default"]={VoxelProbe:o["default"]}},{"./widgets.voxelProbe":97}],97:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":s(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":s(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=e("../../src/helpers/helpers.voxel"),c=i(u),f=function(e){function t(e,n,i,a,s){r(this,t);var l=o(this,Object.getPrototypeOf(t).call(this));return l._enabled=!0,l._targetMesh=n,l._stack=e,l._container=s,l._controls=i,l._camera=a,l._mouse={x:0,y:0,screenX:0,screenY:0},l._showFrame=-1,l._raycaster=new THREE.Raycaster,l._draggingMouse=!1,l._active=-1,l._hover=-1,l._closest=null,l._selected=[],l._voxels=[],l._current=new c["default"](e.worldCenter(),e),l._current._showVoxel=!0,l._current._showDomSVG=!0,l._current._showDomMeasurements=!0,l.add(l._current),l._container.addEventListener("mousedown",l.onMouseDown.bind(l),!1),l._container.addEventListener("mouseup",l.onMouseUp.bind(l),!1),l._container.addEventListener("mousemove",l.onMouseMove.bind(l),!1),l._container.addEventListener("mousewheel",l.onMouseMove.bind(l),!1),l._container.addEventListener("DOMMouseScroll",l.onMouseMove.bind(l),!1),window.addEventListener("keypress",l.onKeyPress.bind(l),!1),l._defaultColor="#00B0FF",l._activeColor="#FFEB3B",l._hoverColor="#F50057",l._selectedColor="#76FF03",l._showVoxel=!0,l._showDomSVG=!0,l._showDomMeasurements=!0,l}return a(t,e),l(t,[{key:"isEnabled",value:function(){}},{key:"onKeyPress",value:function(e){this._enabled!==!1&&100===e.keyCode&&this.deleteAllSelected()}},{key:"onMouseMove",value:function(){this._enabled!==!1&&(this.updateRaycaster(this._raycaster,event,this._container),this._draggingMouse=!0,this.update())}},{key:"onMouseDown",value:function(e){this._enabled!==!1&&(this.updateRaycaster(this._raycaster,e,this._container),this._draggingMouse=!1,this.activateVoxel())}},{key:"onMouseUp",value:function(e){this._enabled!==!1&&(this.updateRaycaster(this._raycaster,e,this._container),this._draggingMouse===!1?-1===this._active?this.createVoxel():(this.selectVoxel(),this.activateVoxel()):this._active>=0&&this.activateVoxel())}},{key:"updateRaycaster",value:function(e,t,n){this._mouse={x:t.clientX/n.offsetWidth*2-1,y:2*-(t.clientY/n.offsetHeight)+1,screenX:t.clientX,screenY:t.clientY},e.setFromCamera(this._mouse,this._camera)}},{key:"updateColor",value:function(e){e._active?e.color=this._activeColor:e.hover?e.color=this._hoverColor:e.selected?e.color=this._selectedColor:e.color=this._defaultColor}},{key:"deleteAllSelected",value:function(){for(var e=this._voxels.length;e--;){var t=this._selected.indexOf(e);t>=0&&(this._active===e&&(this._active=-1),this.remove(this._voxels[e]),this._voxels[e].removeTest(),this._voxels.splice(e,1))}this._selected=[],this._closest=null}},{key:"selectVoxel",value:function(){var e=this._selected.indexOf(this._active);-1===e?(this._selected.push(this._active),this._voxels[this._active].selected=!0,this.updateColor(this._voxels[this._active])):(this._selected.splice(e,1),this._voxels[this._active].selected=!1)}},{key:"activateVoxel",value:function(){if(-1===this._active){var e=this._raycaster.intersectObject(this._targetMesh);if(e.length>0&&(this._hover>=0||null!==this._closest&&this._voxels[this._closest].distance<10)){var t=Math.max(this._hover,this._closest);this._voxels[t]._active=!0,this.updateColor(this._voxels[t]),this._active=t,this._controls.enabled=!1}}else this._voxels[this._active].active=!1,this._active=-1,this._controls.enabled=!0}},{key:"createVoxel",value:function(){if(!(this._hover>=0)){var e=this._raycaster.intersectObject(this._targetMesh);if(e.length>0){var t=new c["default"](e[0].point,this._stack);this.add(t),this._voxels.push(t),t.updateVoxelScreenCoordinates(this._camera,this._container),this.hoverVoxel(t,this._mouse,this._current.voxel.dataCoordinates),this.updateColor(t),t.updateDom(this._container),t.showVoxel=this._showVoxel,t.showDomSVG=this._showDomSVG,t.showDomMeasurements=this._showDomMeasurements}}}},{key:"update",value:function(){if(this._targetMesh){var e=this._raycaster.intersectObject(this._targetMesh);e.length>0&&(this._current.worldCoordinates=e[0].point,this._current.updateVoxelScreenCoordinates(this._camera,this._container),this.updateColor(this._current),this._current.updateDom(this._container),this._current.showVoxel=this._showVoxel,this._current.showDomSVG=this._showDomSVG,this._current.showDomMeasurements=this._showDomMeasurements,this._active>=0&&(this._voxels[this._active].worldCoordinates=e[0].point)),this.updateVoxels()}}},{key:"updateVoxels",value:function(){for(var e=-1,t=null,n=0;n<this._voxels.length;n++)this._voxels[n].updateVoxelScreenCoordinates(this._camera,this._container),this.hoverVoxel(this._voxels[n],this._mouse,this._current.voxel.dataCoordinates),this.updateColor(this._voxels[n]),this.showOfIntersectsFrame(this._voxels[n],this._showFrame),this._voxels[n].updateDom(this._container),this._voxels[n].hover&&(e=n),(null===t||this._voxels[n].distance<this._voxels[t].distance)&&(t=n),this._voxels[n].showVoxel=this._showVoxel,this._voxels[n].showDomSVG=this._showDomSVG,this._voxels[n].showDomMeasurements=this._showDomMeasurements;this._hover=e,this._closest=t}},{key:"hoverVoxel",value:function(e,t,n){if(e.voxel.dataCoordinates.x===n.x&&e.voxel.dataCoordinates.y===n.y&&e.voxel.dataCoordinates.z===n.z)e.hover=!0;else{var i=t.screenX-e.voxel.screenCoordinates.x,r=t.screenY-e.voxel.screenCoordinates.y,o=Math.sqrt(i*i+r*r);e.distance=o,o>=0&&10>o?e.hover=!0:e.hover=!1}}},{key:"showOfIntersectsFrame",value:function(e,t){t===e.voxel.dataCoordinates.z||-1===t?(e._showDomSVG=!0,e._showDomMeasurements=!0):(e._showDomSVG=!1,e._showDomMeasurements=!1)}},{key:"defaultColor",set:function(e){this._defaultColor=e,this.update()},get:function(){return this._defaultColor}},{key:"activeColor",set:function(e){this._activeColor=e,this.update()},get:function(){return this._activeColor}},{key:"hoverColor",set:function(e){this._hoverColor=e,this.update()},get:function(){return this._hoverColor}},{key:"selectedColor",set:function(e){this._selectedColor=e,this.update()},get:function(){return this._selectedColor}},{key:"showVoxel",set:function(e){this._showVoxel=e,this.update()},get:function(){return this._showVoxel}},{key:"showDomSVG",set:function(e){this._showDomSVG=e,this.update()},get:function(){return this._showDomSVG}},{key:"showDomMeasurements",set:function(e){this._showDomMeasurements=e,this.update()},get:function(){return this._showDomMeasurements}}]),t}(THREE.Object3D);n["default"]=f},{"../../src/helpers/helpers.voxel":77}]},{},[55])(55)});