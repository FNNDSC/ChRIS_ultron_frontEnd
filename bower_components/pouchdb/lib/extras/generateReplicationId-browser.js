"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e["default"]:e}function rawToBase64(e){return btoa$1(e)}function appendBuffer(e,t,r,n){(r>0||n<t.byteLength)&&(t=new Uint8Array(t,r,Math.min(n,t.byteLength)-r)),e.append(t)}function appendString(e,t,r,n){(r>0||n<t.length)&&(t=t.substring(r,n)),e.appendBinary(t)}function binaryMd5(e,t){function r(){var n=u*o,i=n+o;if(u++,a>u)c(l,e,n,i),setImmediateShim(r);else{c(l,e,n,i);var f=l.end(!0),d=rawToBase64(f);t(d),l.destroy()}}var n="string"==typeof e,i=n?e.length:e.byteLength,o=Math.min(MD5_CHUNK_SIZE,i),a=Math.ceil(i/o),u=0,l=n?new Md5:new Md5.ArrayBuffer,c=n?appendString:appendBuffer;r()}function sortObjectPropertiesByKey(e){return Object.keys(e).sort(pouchdbCollate.collate).reduce(function(t,r){return t[r]=e[r],t},{})}function generateReplicationId(e,t,r){var n=r.doc_ids?r.doc_ids.sort(pouchdbCollate.collate):"",i=r.filter?r.filter.toString():"",o="",a="";return r.filter&&r.query_params&&(o=JSON.stringify(sortObjectPropertiesByKey(r.query_params))),r.filter&&"_view"===r.filter&&(a=r.view.toString()),PouchPromise.all([e.id(),t.id()]).then(function(e){var t=e[0]+e[1]+i+a+o+n;return new PouchPromise(function(e){binaryMd5(t,e)})}).then(function(e){return e=e.replace(/\//g,".").replace(/\+/g,"_"),"_local/"+e})}var lie=_interopDefault(require("lie")),Md5=_interopDefault(require("spark-md5")),pouchdbCollate=require("pouchdb-collate"),PouchPromise="function"==typeof Promise?Promise:lie,btoa$1=function(e){return btoa(e)},setImmediateShim=global.setImmediate||global.setTimeout,MD5_CHUNK_SIZE=32768;module.exports=generateReplicationId;