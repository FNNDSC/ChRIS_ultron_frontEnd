"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e["default"]:e}function isBinaryObject(e){return e instanceof Buffer}function cloneBinaryObject(e){var t=new Buffer(e.length);return e.copy(t),t}function isPlainObject(e){var t=Object.getPrototypeOf(e);if(null===t)return!0;var r=t.constructor;return"function"==typeof r&&r instanceof r&&funcToString.call(r)==objectCtorString}function clone(e){var t,r,n;if(!e||"object"!=typeof e)return e;if(Array.isArray(e)){for(t=[],r=0,n=e.length;n>r;r++)t[r]=clone(e[r]);return t}if(e instanceof Date)return e.toISOString();if(isBinaryObject(e))return cloneBinaryObject(e);if(!isPlainObject(e))return e;t={};for(r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var o=clone(e[r]);"undefined"!=typeof o&&(t[r]=o)}return t}function once(e){var t=!1;return getArguments(function(r){if(t)throw new Error("once called more than once");t=!0,e.apply(this,r)})}function toPromise(e){return getArguments(function(t){t=clone(t);var r,n=this,o="function"==typeof t[t.length-1]?t.pop():!1;o&&(r=function(e,t){process.nextTick(function(){o(e,t)})});var i=new PouchPromise(function(r,o){var i;try{var a=once(function(e,t){e?o(e):r(t)});t.push(a),i=e.apply(n,t),i&&"function"==typeof i.then&&r(i)}catch(s){o(s)}});return r&&i.then(function(e){r(null,e)},r),i})}function pick(e,t){for(var r={},n=0,o=t.length;o>n;n++){var i=t[n];i in e&&(r[i]=e[i])}return r}function isChromeApp(){return!1}function hasLocalStorage(){return!1}function attachBrowserEvents(e){isChromeApp()?chrome.storage.onChanged.addListener(function(t){null!=t.db_name&&e.emit(t.dbName.newValue)}):hasLocalStorage()&&("undefined"!=typeof addEventListener?addEventListener("storage",function(t){e.emit(t.key)}):window.attachEvent("storage",function(t){e.emit(t.key)}))}function Changes(){events.EventEmitter.call(this),this._listeners={},attachBrowserEvents(this)}function guardedConsole(e){if("undefined"!==console&&e in console){var t=Array.prototype.slice.call(arguments,1);console[e].apply(console,t)}}function PouchError(e){Error.call(this,e.reason),this.status=e.status,this.name=e.error,this.message=e.reason,this.error=!0}function createError(e,t,r){function n(t){for(var n in e)"function"!=typeof e[n]&&(this[n]=e[n]);void 0!==r&&(this.name=r),void 0!==t&&(this.reason=t)}return n.prototype=PouchError.prototype,new n(t)}function tryFilter(e,t,r){try{return!e(t,r)}catch(n){var o="Filter function threw: "+n.toString();return createError(BAD_REQUEST,o)}}function filterChange(e){var t={},r=e.filter&&"function"==typeof e.filter;return t.query=e.query_params,function(n){n.doc||(n.doc={});var o=r&&tryFilter(e.filter,n.doc,t);if("object"==typeof o)return o;if(o)return!1;if(e.include_docs){if(!e.attachments)for(var i in n.doc._attachments)n.doc._attachments.hasOwnProperty(i)&&(n.doc._attachments[i].stub=!0)}else delete n.doc;return!0}}function invalidIdError(e){var t;if(e?"string"!=typeof e?t=createError(INVALID_ID):/^_/.test(e)&&!/^_(design|local)/.test(e)&&(t=createError(RESERVED_ID)):t=createError(MISSING_ID),t)throw t}function getValue(e){return 0|Math.random()*e}function uuid(e,t){t=t||chars.length;var r="",n=-1;if(e){for(;++n<e;)r+=chars[getValue(t)];return r}for(;++n<36;)switch(n){case 8:case 13:case 18:case 23:r+="-";break;case 19:r+=chars[3&getValue(16)|8];break;default:r+=chars[getValue(16)]}return r}function toObject(e){return e.reduce(function(e,t){return e[t]=!0,e},{})}function parseRevisionInfo(e){if(!/^\d+\-./.test(e))return createError(INVALID_REV);var t=e.indexOf("-"),r=e.substring(0,t),n=e.substring(t+1);return{prefix:parseInt(r,10),id:n}}function makeRevTreeFromRevisions(e,t){for(var r=e.start-e.ids.length+1,n=e.ids,o=[n[0],t,[]],i=1,a=n.length;a>i;i++)o=[n[i],{status:"missing"},[o]];return[{pos:r,ids:o}]}function parseDoc(e,t){var r,n,o,i={status:"available"};if(e._deleted&&(i.deleted=!0),t)if(e._id||(e._id=uuid()),n=uuid(32,16).toLowerCase(),e._rev){if(o=parseRevisionInfo(e._rev),o.error)return o;e._rev_tree=[{pos:o.prefix,ids:[o.id,{status:"missing"},[[n,i,[]]]]}],r=o.prefix+1}else e._rev_tree=[{pos:1,ids:[n,i,[]]}],r=1;else if(e._revisions&&(e._rev_tree=makeRevTreeFromRevisions(e._revisions,i),r=e._revisions.start,n=e._revisions.ids[0]),!e._rev_tree){if(o=parseRevisionInfo(e._rev),o.error)return o;r=o.prefix,n=o.id,e._rev_tree=[{pos:r,ids:[n,i,[]]}]}invalidIdError(e._id),e._rev=r+"-"+n;var a={metadata:{},data:{}};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){var c="_"===s[0];if(c&&!reservedWords[s]){var u=createError(DOC_VALIDATION,s);throw u.message=DOC_VALIDATION.message+": "+s,u}c&&!dataWords[s]?a.metadata[s.slice(1)]=e[s]:a.data[s]=e[s]}return a}function winningRev(e){for(var t,r,n,o,i=e.rev_tree.slice();o=i.pop();){var a=o.ids,s=a[2],c=o.pos;if(s.length)for(var u=0,E=s.length;E>u;u++)i.push({pos:c+1,ids:s[u]});else{var d=!!a[1].deleted,_=a[0];t&&!(n!==d?n:r!==c?c>r:_>t)||(t=_,r=c,n=d)}}return r+"-"+t}function traverseRevTree(e,t){for(var r,n=e.slice();r=n.pop();)for(var o=r.pos,i=r.ids,a=i[2],s=t(0===a.length,o,i[0],r.ctx,i[1]),c=0,u=a.length;u>c;c++)n.push({pos:o+1,ids:a[c],ctx:s})}function sortByPos(e,t){return e.pos-t.pos}function collectLeaves(e){var t=[];traverseRevTree(e,function(e,r,n,o,i){e&&t.push({rev:r+"-"+n,pos:r,opts:i})}),t.sort(sortByPos).reverse();for(var r=0,n=t.length;n>r;r++)delete t[r].pos;return t}function collectConflicts(e){for(var t=winningRev(e),r=collectLeaves(e.rev_tree),n=[],o=0,i=r.length;i>o;o++){var a=r[o];a.rev===t||a.opts.deleted||n.push(a.rev)}return n}function compactTree(e){var t=[];return traverseRevTree(e.rev_tree,function(e,r,n,o,i){"available"!==i.status||e||(t.push(r+"-"+n),i.status="missing")}),t}function rootToLeaf(e){for(var t,r=[],n=e.slice();t=n.pop();){var o=t.pos,i=t.ids,a=i[0],s=i[1],c=i[2],u=0===c.length,E=t.history?t.history.slice():[];E.push({id:a,opts:s}),u&&r.push({pos:o+1-E.length,ids:E});for(var d=0,_=c.length;_>d;d++)n.push({pos:o+1,ids:c[d],history:E})}return r.reverse()}function sortByPos$1(e,t){return e.pos-t.pos}function binarySearch(e,t,r){for(var n,o=0,i=e.length;i>o;)n=o+i>>>1,r(e[n],t)<0?o=n+1:i=n;return o}function insertSorted(e,t,r){var n=binarySearch(e,t,r);e.splice(n,0,t)}function pathToTree(e,t){for(var r,n,o=t,i=e.length;i>o;o++){var a=e[o],s=[a.id,a.opts,[]];n?(n[2].push(s),n=s):r=n=s}return r}function compareTree(e,t){return e[0]<t[0]?-1:1}function mergeTree(e,t){for(var r=[{tree1:e,tree2:t}],n=!1;r.length>0;){var o=r.pop(),i=o.tree1,a=o.tree2;(i[1].status||a[1].status)&&(i[1].status="available"===i[1].status||"available"===a[1].status?"available":"missing");for(var s=0;s<a[2].length;s++)if(i[2][0]){for(var c=!1,u=0;u<i[2].length;u++)i[2][u][0]===a[2][s][0]&&(r.push({tree1:i[2][u],tree2:a[2][s]}),c=!0);c||(n="new_branch",insertSorted(i[2],a[2][s],compareTree))}else n="new_leaf",i[2][0]=a[2][s]}return{conflicts:n,tree:e}}function doMerge(e,t,r){var n,o=[],i=!1,a=!1;if(!e.length)return{tree:[t],conflicts:"new_leaf"};for(var s=0,c=e.length;c>s;s++){var u=e[s];if(u.pos===t.pos&&u.ids[0]===t.ids[0])n=mergeTree(u.ids,t.ids),o.push({pos:u.pos,ids:n.tree}),i=i||n.conflicts,a=!0;else if(r!==!0){var E=u.pos<t.pos?u:t,d=u.pos<t.pos?t:u,_=d.pos-E.pos,f=[],l=[];for(l.push({ids:E.ids,diff:_,parent:null,parentIdx:null});l.length>0;){var S=l.pop();if(0!==S.diff)for(var T=S.ids[2],v=0,O=T.length;O>v;v++)l.push({ids:T[v],diff:S.diff-1,parent:S.ids,parentIdx:v});else S.ids[0]===d.ids[0]&&f.push(S)}var h=f[0];h?(n=mergeTree(h.ids,d.ids),h.parent[2][h.parentIdx]=n.tree,o.push({pos:E.pos,ids:E.ids}),i=i||n.conflicts,a=!0):o.push(u)}else o.push(u)}return a||o.push(t),o.sort(sortByPos$1),{tree:o,conflicts:i||"internal_node"}}function stem(e,t){for(var r,n=rootToLeaf(e),o={},i=0,a=n.length;a>i;i++){for(var s=n[i],c=s.ids,u=Math.max(0,c.length-t),E={pos:s.pos+u,ids:pathToTree(c,u)},d=0;u>d;d++){var _=s.pos+d+"-"+c[d].id;o[_]=!0}r=r?doMerge(r,E,!0).tree:[E]}return traverseRevTree(r,function(e,t,r){delete o[t+"-"+r]}),{tree:r,revs:Object.keys(o)}}function merge(e,t,r){var n=doMerge(e,t),o=stem(n.tree,r);return{tree:o.tree,stemmedRevs:o.revs,conflicts:n.conflicts}}function revExists(e,t){for(var r,n=e.slice(),o=t.split("-"),i=parseInt(o[0],10),a=o[1];r=n.pop();){if(r.pos===i&&r.ids[0]===a)return!0;for(var s=r.ids[2],c=0,u=s.length;u>c;c++)n.push({pos:r.pos+1,ids:s[c]})}return!1}function getTrees(e){return e.ids}function isDeleted(e,t){t||(t=winningRev(e));for(var r,n=t.substring(t.indexOf("-")+1),o=e.rev_tree.map(getTrees);r=o.pop();){if(r[0]===n)return!!r[1].deleted;o=o.concat(r[2])}}function isLocalId(e){return/^_local/.test(e)}function arrayBufferToBase64(e){return e.toString("binary")}function arrayBufferToBinaryString(e){return e.toString("binary")}function thisAtob(e){var t=new Buffer(e,"base64");if(t.toString("base64")!==e)throw new Error("attachment is not a valid base64 string");return t.toString("binary")}function thisBtoa(e){return new Buffer(e,"binary").toString("base64")}function typedBuffer(e,t,r){var n=new Buffer(e,t);return n.type=r,n}function binStringToBluffer(e,t){return typedBuffer(e,"binary",t)}function readAsArrayBuffer(e,t){t(e)}function binaryMd5(e,t){var r=crypto.createHash("md5").update(e,"binary").digest("base64");t(r)}function preprocessAttachments(e,t,r){function n(e){try{return thisAtob(e)}catch(t){var r=createError(BAD_ARG,"Attachment is not a valid base64 string");return{error:r}}}function o(e,r){if(e.stub)return r();if("string"==typeof e.data){var o=n(e.data);if(o.error)return r(o.error);e.length=o.length,"blob"===t?e.data=binStringToBluffer(o,e.content_type):"base64"===t?e.data=thisBtoa(o):e.data=o,binaryMd5(o,function(t){e.digest="md5-"+t,r()})}else readAsArrayBuffer(e.data,function(n){"binary"===t?e.data=arrayBufferToBinaryString(n):"base64"===t&&(e.data=arrayBufferToBase64(n)),binaryMd5(n,function(t){e.digest="md5-"+t,e.length=n.byteLength,r()})})}function i(){s++,e.length===s&&(a?r(a):r())}if(!e.length)return r();var a,s=0;e.forEach(function(e){function t(e){a=e,n++,n===r.length&&i()}var r=e.data&&e.data._attachments?Object.keys(e.data._attachments):[],n=0;if(!r.length)return i();for(var s in e.data._attachments)e.data._attachments.hasOwnProperty(s)&&o(e.data._attachments[s],t)})}function updateDoc(e,t,r,n,o,i,a,s){if(revExists(t.rev_tree,r.metadata.rev))return n[o]=r,i();var c=t.winningRev||winningRev(t),u="deleted"in t?t.deleted:isDeleted(t,c),E="deleted"in r.metadata?r.metadata.deleted:isDeleted(r.metadata),d=/^1-/.test(r.metadata.rev);if(u&&!E&&s&&d){var _=r.data;_._rev=c,_._id=r.metadata.id,r=parseDoc(_,s)}var f=merge(t.rev_tree,r.metadata.rev_tree[0],e),l=s&&(u&&E||!u&&"new_leaf"!==f.conflicts||u&&!E&&"new_branch"===f.conflicts);if(l){var S=createError(REV_CONFLICT);return n[o]=S,i()}var T=r.metadata.rev;r.metadata.rev_tree=f.tree,r.stemmedRevs=f.stemmedRevs||[],t.rev_map&&(r.metadata.rev_map=t.rev_map);var v,O=winningRev(r.metadata),h=isDeleted(r.metadata,O),R=u===h?0:h>u?-1:1;v=T===O?h:isDeleted(r.metadata,T),a(r,O,h,v,!0,R,o,i)}function rootIsMissing(e){return"missing"===e.metadata.rev_tree[0].ids[1].status}function processDocs(e,t,r,n,o,i,a,s,c){function u(e,t,r){var n=winningRev(e.metadata),o=isDeleted(e.metadata,n);if("was_delete"in s&&o)return i[t]=createError(MISSING_DOC,"deleted"),r();var c=d&&rootIsMissing(e);if(c){var u=createError(REV_CONFLICT);return i[t]=u,r()}var E=o?0:1;a(e,n,o,o,!1,E,t,r)}function E(){++f===l&&c&&c()}e=e||1e3;var d=s.new_edits,_=new pouchdbCollections.Map,f=0,l=t.length;t.forEach(function(e,t){if(e._id&&isLocalId(e._id)){var n=e._deleted?"_removeLocal":"_putLocal";return void r[n](e,{ctx:o},function(e,r){i[t]=e||r,E()})}var a=e.metadata.id;_.has(a)?(l--,_.get(a).push([e,t])):_.set(a,[[e,t]])}),_.forEach(function(t,r){function o(){++c<t.length?s():E()}function s(){var s=t[c],E=s[0],_=s[1];if(n.has(r))updateDoc(e,n.get(r),E,i,_,o,a,d);else{var f=merge([],E.metadata.rev_tree[0],e);E.metadata.rev_tree=f.tree,E.stemmedRevs=f.stemmedRevs||[],u(E,_,o)}}var c=0;s()})}function slowJsonParse(e){try{return JSON.parse(e)}catch(t){return vuvuzela.parse(e)}}function safeJsonParse(e){return e.length<5e4?JSON.parse(e):slowJsonParse(e)}function safeJsonStringify(e){try{return JSON.stringify(e)}catch(t){return vuvuzela.stringify(e)}}function decodeUtf8(e){return decodeURIComponent(escape(e))}function hexToInt(e){return 65>e?e-48:e-55}function parseHexUtf8(e,t,r){for(var n="";r>t;)n+=String.fromCharCode(hexToInt(e.charCodeAt(t++))<<4|hexToInt(e.charCodeAt(t++)));return n}function parseHexUtf16(e,t,r){for(var n="";r>t;)n+=String.fromCharCode(hexToInt(e.charCodeAt(t+2))<<12|hexToInt(e.charCodeAt(t+3))<<8|hexToInt(e.charCodeAt(t))<<4|hexToInt(e.charCodeAt(t+1))),t+=4;return n}function parseHexString(e,t){return"UTF-8"===t?decodeUtf8(parseHexUtf8(e,0,e.length)):parseHexUtf16(e,0,e.length)}function quote(e){return"'"+e+"'"}function escapeBlob(e){return e.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"")}function unescapeBlob(e){return e.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,"")}function stringifyDoc(e){return delete e._id,delete e._rev,JSON.stringify(e)}function unstringifyDoc(e,t,r){return e=JSON.parse(e),e._id=t,e._rev=r,e}function qMarks(e){for(var t="(";e--;)t+="?",e&&(t+=",");return t+")"}function select(e,t,r,n,o){return"SELECT "+e+" FROM "+("string"==typeof t?t:t.join(" JOIN "))+(r?" ON "+r:"")+(n?" WHERE "+("string"==typeof n?n:n.join(" AND ")):"")+(o?" ORDER BY "+o:"")}function compactRevs(e,t,r){function n(){++i===e.length&&o()}function o(){if(a.length){var e="SELECT DISTINCT digest AS digest FROM "+ATTACH_AND_SEQ_STORE+" WHERE seq IN "+qMarks(a.length);r.executeSql(e,a,function(e,t){for(var r=[],n=0;n<t.rows.length;n++)r.push(t.rows.item(n).digest);if(r.length){var o="DELETE FROM "+ATTACH_AND_SEQ_STORE+" WHERE seq IN ("+a.map(function(){return"?"}).join(",")+")";e.executeSql(o,a,function(e){var t="SELECT digest FROM "+ATTACH_AND_SEQ_STORE+" WHERE digest IN ("+r.map(function(){return"?"}).join(",")+")";e.executeSql(t,r,function(e,t){for(var n=new pouchdbCollections.Set,o=0;o<t.rows.length;o++)n.add(t.rows.item(o).digest);r.forEach(function(t){n.has(t)||(e.executeSql("DELETE FROM "+ATTACH_AND_SEQ_STORE+" WHERE digest=?",[t]),e.executeSql("DELETE FROM "+ATTACH_STORE+" WHERE digest=?",[t]))})})})}})}}if(e.length){var i=0,a=[];e.forEach(function(e){var o="SELECT seq FROM "+BY_SEQ_STORE+" WHERE doc_id=? AND rev=?";r.executeSql(o,[t,e],function(e,t){if(!t.rows.length)return n();var r=t.rows.item(0).seq;a.push(r),e.executeSql("DELETE FROM "+BY_SEQ_STORE+" WHERE seq=?",[r],n)})})}}function websqlError(e){return function(t){guardedConsole("error","WebSQL threw an error",t);var r=t&&t.constructor.toString().match(/function ([^\(]+)/),n=r&&r[1]||t.type,o=t.target||t.message;e(createError(WSQ_ERROR,o,n))}}function getSize(e){if("size"in e)return 1e6*e.size;var t="undefined"!=typeof navigator&&/Android/.test(navigator.userAgent);return t?5e6:1}function websqlBulkDocs(e,t,r,n,o,i,a){function s(){return h?a(h):(i.notify(n._name),n._docCount=-1,void a(null,R))}function c(e,t){var r="SELECT count(*) as cnt FROM "+ATTACH_STORE+" WHERE digest=?";O.executeSql(r,[e],function(r,n){if(0===n.rows.item(0).cnt){var o=createError(MISSING_STUB,"unknown stub attachment with digest "+e);t(o)}else t()})}function u(e){function t(){++o===r.length&&e(n)}var r=[];if(T.forEach(function(e){e.data&&e.data._attachments&&Object.keys(e.data._attachments).forEach(function(t){var n=e.data._attachments[t];n.stub&&r.push(n.digest)})}),!r.length)return e();var n,o=0;r.forEach(function(e){c(e,function(e){e&&!n&&(n=e),t()})})}function E(e,t,r,o,i,a,s,c){function u(){function t(e,t){function n(){return++i===a.length&&t(),!1}function o(t){var o="INSERT INTO "+ATTACH_AND_SEQ_STORE+" (digest, seq) VALUES (?,?)",i=[r._attachments[t].digest,e];O.executeSql(o,i,n,n)}var i=0,a=Object.keys(r._attachments||{});if(!a.length)return t();for(var s=0;s<a.length;s++)o(a[s])}var r=e.data,n=o?1:0,i=r._id,a=r._rev,s=stringifyDoc(r),c="INSERT INTO "+BY_SEQ_STORE+" (doc_id, rev, json, deleted) VALUES (?, ?, ?, ?);",u=[i,a,s,n];O.executeSql(c,u,function(e,r){var n=r.insertId;t(n,function(){_(e,n)})},function(){var e=select("seq",BY_SEQ_STORE,null,"doc_id=? AND rev=?");return O.executeSql(e,[i,a],function(e,r){var o=r.rows.item(0).seq,c="UPDATE "+BY_SEQ_STORE+" SET json=?, deleted=? WHERE doc_id=? AND rev=?;",u=[s,n,i,a];e.executeSql(c,u,function(e){t(o,function(){_(e,o)})})}),!1})}function E(e){l||(e?(l=e,c(l)):S===T.length&&u())}function d(e){S++,E(e)}function _(r,o){var a=e.metadata.id,u=e.stemmedRevs||[];i&&n.auto_compaction&&(u=compactTree(e.metadata).concat(u)),u.length&&compactRevs(u,a,r),e.metadata.seq=o,delete e.metadata.rev;var E=i?"UPDATE "+DOC_STORE+" SET json=?, max_seq=?, winningseq=(SELECT seq FROM "+BY_SEQ_STORE+" WHERE doc_id="+DOC_STORE+".id AND rev=?) WHERE id=?":"INSERT INTO "+DOC_STORE+" (id, winningseq, max_seq, json) VALUES (?,?,?,?);",d=safeJsonStringify(e.metadata),_=i?[d,o,t,a]:[a,o,o,d];r.executeSql(E,_,function(){R[s]={ok:!0,id:e.metadata.id,rev:t},p.set(a,e.metadata),c()})}var l=null,S=0;e.data._id=e.metadata.id,e.data._rev=e.metadata.rev;var T=Object.keys(e.data._attachments||{});o&&(e.data._deleted=!0),T.forEach(function(r){var n=e.data._attachments[r];if(n.stub)S++,E();else{var o=n.data;delete n.data,n.revpos=parseInt(t,10);var i=n.digest;f(i,o,d)}}),T.length||u()}function d(){processDocs(e.revs_limit,T,n,p,O,R,E,r)}function _(e){function t(){++r===T.length&&e()}if(!T.length)return e();var r=0;T.forEach(function(e){if(e._id&&isLocalId(e._id))return t();var r=e.metadata.id;O.executeSql("SELECT json FROM "+DOC_STORE+" WHERE id = ?",[r],function(e,n){if(n.rows.length){var o=safeJsonParse(n.rows.item(0).json);p.set(r,o)}t()})})}function f(e,t,r){var n="SELECT digest FROM "+ATTACH_STORE+" WHERE digest=?";O.executeSql(n,[e],function(o,i){return i.rows.length?r():(n="INSERT INTO "+ATTACH_STORE+" (digest, body, escaped) VALUES (?,?,1)",void o.executeSql(n,[e,escapeBlob(t)],function(){r()},function(){return r(),!1}))})}var l=r.new_edits,S=t.docs,T=S.map(function(e){if(e._id&&isLocalId(e._id))return e;var t=parseDoc(e,l);return t}),v=T.filter(function(e){return e.error});if(v.length)return a(v[0]);var O,h,R=new Array(T.length),p=new pouchdbCollections.Map;preprocessAttachments(T,"binary",function(e){return e?a(e):void o.transaction(function(e){O=e,u(function(e){e?h=e:_(d)})},websqlError(a),s)})}function openDatabaseWithOpts(e){return e.websql(e.name,e.version,e.description,e.size)}function openDBSafely(e){try{return{db:openDatabaseWithOpts(e)}}catch(t){return{error:t}}}function openDB(e){var t=cachedDatabases.get(e.name);return t||(t=openDBSafely(e),cachedDatabases.set(e.name,t),t.db&&(t.db._sqlitePlugin="undefined"!=typeof sqlitePlugin)),t}function fetchAttachmentsIfNecessary(e,t,r,n,o){function i(){++c===s.length&&o&&o()}function a(e,o){var a=e._attachments[o],s={binary:t.binary,ctx:n};r._getAttachment(e._id,o,a,s,function(t,r){e._attachments[o]=jsExtend.extend(pick(a,["digest","content_type"]),{data:r}),i()})}var s=Object.keys(e._attachments||{});if(!s.length)return o&&o();var c=0;s.forEach(function(r){t.attachments&&t.include_docs?a(e,r):(e._attachments[r].stub=!0,i())})}function WebSqlPouch(e,t){function r(){hasLocalStorage()&&(window.localStorage["_pouch__websqldb_"+T._name]=!0),t(null,T)}function n(e,t){e.executeSql(DOC_STORE_WINNINGSEQ_INDEX_SQL),e.executeSql("ALTER TABLE "+BY_SEQ_STORE+" ADD COLUMN deleted TINYINT(1) DEFAULT 0",[],function(){e.executeSql(BY_SEQ_STORE_DELETED_INDEX_SQL),e.executeSql("ALTER TABLE "+DOC_STORE+" ADD COLUMN local TINYINT(1) DEFAULT 0",[],function(){e.executeSql("CREATE INDEX IF NOT EXISTS 'doc-store-local-idx' ON "+DOC_STORE+" (local, id)");var r="SELECT "+DOC_STORE+".winningseq AS seq, "+DOC_STORE+".json AS metadata FROM "+BY_SEQ_STORE+" JOIN "+DOC_STORE+" ON "+BY_SEQ_STORE+".seq = "+DOC_STORE+".winningseq";e.executeSql(r,[],function(e,r){for(var n=[],o=[],i=0;i<r.rows.length;i++){var a=r.rows.item(i),s=a.seq,c=JSON.parse(a.metadata);isDeleted(c)&&n.push(s),isLocalId(c.id)&&o.push(c.id)}e.executeSql("UPDATE "+DOC_STORE+"SET local = 1 WHERE id IN "+qMarks(o.length),o,function(){e.executeSql("UPDATE "+BY_SEQ_STORE+" SET deleted = 1 WHERE seq IN "+qMarks(n.length),n,t)})})})})}function o(e,t){var r="CREATE TABLE IF NOT EXISTS "+LOCAL_STORE+" (id UNIQUE, rev, json)";e.executeSql(r,[],function(){var r="SELECT "+DOC_STORE+".id AS id, "+BY_SEQ_STORE+".json AS data FROM "+BY_SEQ_STORE+" JOIN "+DOC_STORE+" ON "+BY_SEQ_STORE+".seq = "+DOC_STORE+".winningseq WHERE local = 1";e.executeSql(r,[],function(e,r){function n(){if(!o.length)return t(e);var r=o.shift(),i=JSON.parse(r.data)._rev;e.executeSql("INSERT INTO "+LOCAL_STORE+" (id, rev, json) VALUES (?,?,?)",[r.id,i,r.data],function(e){e.executeSql("DELETE FROM "+DOC_STORE+" WHERE id=?",[r.id],function(e){e.executeSql("DELETE FROM "+BY_SEQ_STORE+" WHERE seq=?",[r.seq],function(){n()})})})}for(var o=[],i=0;i<r.rows.length;i++)o.push(r.rows.item(i));n()})})}function i(e,t){function r(r){function n(){if(!r.length)return t(e);var o=r.shift(),i=parseHexString(o.hex,S),a=i.lastIndexOf("::"),s=i.substring(0,a),c=i.substring(a+2),u="UPDATE "+BY_SEQ_STORE+" SET doc_id=?, rev=? WHERE doc_id_rev=?";e.executeSql(u,[s,c,i],function(){n()})}n()}var n="ALTER TABLE "+BY_SEQ_STORE+" ADD COLUMN doc_id";e.executeSql(n,[],function(e){var t="ALTER TABLE "+BY_SEQ_STORE+" ADD COLUMN rev";e.executeSql(t,[],function(e){e.executeSql(BY_SEQ_STORE_DOC_ID_REV_INDEX_SQL,[],function(e){var t="SELECT hex(doc_id_rev) as hex FROM "+BY_SEQ_STORE;e.executeSql(t,[],function(e,t){for(var n=[],o=0;o<t.rows.length;o++)n.push(t.rows.item(o));r(n)})})})})}function a(e,t){function r(e){var r="SELECT COUNT(*) AS cnt FROM "+ATTACH_STORE;e.executeSql(r,[],function(e,r){function n(){var r=select(SELECT_DOCS+", "+DOC_STORE+".id AS id",[DOC_STORE,BY_SEQ_STORE],DOC_STORE_AND_BY_SEQ_JOINER,null,DOC_STORE+".id ");r+=" LIMIT "+a+" OFFSET "+i,i+=a,e.executeSql(r,[],function(e,r){function o(e,t){var r=i[e]=i[e]||[];-1===r.indexOf(t)&&r.push(t)}if(!r.rows.length)return t(e);for(var i={},a=0;a<r.rows.length;a++)for(var s=r.rows.item(a),c=unstringifyDoc(s.data,s.id,s.rev),u=Object.keys(c._attachments||{}),E=0;E<u.length;E++){var d=c._attachments[u[E]];o(d.digest,s.seq)}var _=[];if(Object.keys(i).forEach(function(e){var t=i[e];t.forEach(function(t){_.push([e,t])})}),!_.length)return n();var f=0;_.forEach(function(t){var r="INSERT INTO "+ATTACH_AND_SEQ_STORE+" (digest, seq) VALUES (?,?)";e.executeSql(r,t,function(){++f===_.length&&n()})})})}var o=r.rows.item(0).cnt;if(!o)return t(e);var i=0,a=10;n()})}var n="CREATE TABLE IF NOT EXISTS "+ATTACH_AND_SEQ_STORE+" (digest, seq INTEGER)";e.executeSql(n,[],function(e){e.executeSql(ATTACH_AND_SEQ_STORE_ATTACH_INDEX_SQL,[],function(e){e.executeSql(ATTACH_AND_SEQ_STORE_SEQ_INDEX_SQL,[],r)})})}function s(e,t){var r="ALTER TABLE "+ATTACH_STORE+" ADD COLUMN escaped TINYINT(1) DEFAULT 0";e.executeSql(r,[],t)}function c(e,t){var r="ALTER TABLE "+DOC_STORE+" ADD COLUMN max_seq INTEGER";e.executeSql(r,[],function(e){var r="UPDATE "+DOC_STORE+" SET max_seq=(SELECT MAX(seq) FROM "+BY_SEQ_STORE+" WHERE doc_id=id)";e.executeSql(r,[],function(e){var r="CREATE UNIQUE INDEX IF NOT EXISTS 'doc-max-seq-idx' ON "+DOC_STORE+" (max_seq)";e.executeSql(r,[],t)})})}function u(e,t){e.executeSql('SELECT HEX("a") AS hex',[],function(e,r){var n=r.rows.item(0).hex;S=2===n.length?"UTF-8":"UTF-16",t()})}function E(){for(;h.length>0;){var e=h.pop();e(null,v)}}function d(e,t){if(0===t){var r="CREATE TABLE IF NOT EXISTS "+META_STORE+" (dbid, db_version INTEGER)",u="CREATE TABLE IF NOT EXISTS "+ATTACH_STORE+" (digest UNIQUE, escaped TINYINT(1), body BLOB)",d="CREATE TABLE IF NOT EXISTS "+ATTACH_AND_SEQ_STORE+" (digest, seq INTEGER)",_="CREATE TABLE IF NOT EXISTS "+DOC_STORE+" (id unique, json, winningseq, max_seq INTEGER UNIQUE)",f="CREATE TABLE IF NOT EXISTS "+BY_SEQ_STORE+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, json, deleted TINYINT(1), doc_id, rev)",l="CREATE TABLE IF NOT EXISTS "+LOCAL_STORE+" (id UNIQUE, rev, json)";e.executeSql(u),e.executeSql(l),e.executeSql(d,[],function(){e.executeSql(ATTACH_AND_SEQ_STORE_SEQ_INDEX_SQL),e.executeSql(ATTACH_AND_SEQ_STORE_ATTACH_INDEX_SQL)}),e.executeSql(_,[],function(){e.executeSql(DOC_STORE_WINNINGSEQ_INDEX_SQL),e.executeSql(f,[],function(){e.executeSql(BY_SEQ_STORE_DELETED_INDEX_SQL),e.executeSql(BY_SEQ_STORE_DOC_ID_REV_INDEX_SQL),e.executeSql(r,[],function(){var t="INSERT INTO "+META_STORE+" (db_version, dbid) VALUES (?,?)";v=uuid();var r=[ADAPTER_VERSION,v];e.executeSql(t,r,function(){E()})})})})}else{var S=function(){var r=ADAPTER_VERSION>t;r&&e.executeSql("UPDATE "+META_STORE+" SET db_version = "+ADAPTER_VERSION);var n="SELECT dbid FROM "+META_STORE;e.executeSql(n,[],function(e,t){v=t.rows.item(0).dbid,E()})},T=[n,o,i,a,s,c,S],O=t,h=function(e){T[O-1](e,h),O++};h(e)}}function _(){g.transaction(function(e){u(e,function(){f(e)})},websqlError(t),r)}function f(e){var t="SELECT sql FROM sqlite_master WHERE tbl_name = "+META_STORE;e.executeSql(t,[],function(e,t){t.rows.length?/db_version/.test(t.rows.item(0).sql)?e.executeSql("SELECT db_version FROM "+META_STORE,[],function(e,t){var r=t.rows.item(0).db_version;d(e,r)}):e.executeSql("ALTER TABLE "+META_STORE+" ADD COLUMN db_version INTEGER",[],function(){d(e,1)}):d(e,0)})}function l(e,t){if(-1!==T._docCount)return t(T._docCount);var r=select("COUNT("+DOC_STORE+".id) AS 'num'",[DOC_STORE,BY_SEQ_STORE],DOC_STORE_AND_BY_SEQ_JOINER,BY_SEQ_STORE+".deleted=0");e.executeSql(r,[],function(e,r){T._docCount=r.rows.item(0).num,t(T._docCount)})}var S,T=this,v=null,O=getSize(e),h=[];T._docCount=-1,T._name=e.name;var R=jsExtend.extend({},e,{version:POUCH_VERSION,description:e.name,size:O}),p=openDB(R);if(p.error)return websqlError(t)(p.error);var g=p.db;"function"!=typeof g.readTransaction&&(g.readTransaction=g.transaction),_(),T.type=function(){return"websql"},T._id=toPromise(function(e){e(null,v)}),T._info=function(e){g.readTransaction(function(t){l(t,function(r){var n="SELECT MAX(seq) AS seq FROM "+BY_SEQ_STORE;t.executeSql(n,[],function(t,n){var o=n.rows.item(0).seq||0;e(null,{doc_count:r,update_seq:o,sqlite_plugin:g._sqlitePlugin,websql_encoding:S})})})},websqlError(e))},T._bulkDocs=function(t,r,n){websqlBulkDocs(e,t,r,T,g,websqlChanges,n)},T._get=function(e,t,r){function n(){r(a,{doc:o,metadata:i,ctx:s})}var o,i,a,s=t.ctx;if(!s)return g.readTransaction(function(n){T._get(e,jsExtend.extend({ctx:n},t),r)});var c,u;t.rev?(c=select(SELECT_DOCS,[DOC_STORE,BY_SEQ_STORE],DOC_STORE+".id="+BY_SEQ_STORE+".doc_id",[BY_SEQ_STORE+".doc_id=?",BY_SEQ_STORE+".rev=?"]),u=[e,t.rev]):(c=select(SELECT_DOCS,[DOC_STORE,BY_SEQ_STORE],DOC_STORE_AND_BY_SEQ_JOINER,DOC_STORE+".id=?"),u=[e]),s.executeSql(c,u,function(e,r){if(!r.rows.length)return a=createError(MISSING_DOC,"missing"),n();var s=r.rows.item(0);return i=safeJsonParse(s.metadata),s.deleted&&!t.rev?(a=createError(MISSING_DOC,"deleted"),n()):(o=unstringifyDoc(s.data,i.id,s.rev),void n())})},T._allDocs=function(e,t){var r,n=[],o="startkey"in e?e.startkey:!1,i="endkey"in e?e.endkey:!1,a="key"in e?e.key:!1,s="descending"in e?e.descending:!1,c="limit"in e?e.limit:-1,u="skip"in e?e.skip:0,E=e.inclusive_end!==!1,d=[],_=[];if(a!==!1)_.push(DOC_STORE+".id = ?"),d.push(a);else if(o!==!1||i!==!1){if(o!==!1&&(_.push(DOC_STORE+".id "+(s?"<=":">=")+" ?"),d.push(o)),i!==!1){var f=s?">":"<";E&&(f+="="),_.push(DOC_STORE+".id "+f+" ?"),d.push(i)}a!==!1&&(_.push(DOC_STORE+".id = ?"),d.push(a))}"ok"!==e.deleted&&_.push(BY_SEQ_STORE+".deleted = 0"),g.readTransaction(function(t){l(t,function(o){if(r=o,0!==c){var i=select(SELECT_DOCS,[DOC_STORE,BY_SEQ_STORE],DOC_STORE_AND_BY_SEQ_JOINER,_,DOC_STORE+".id "+(s?"DESC":"ASC"));i+=" LIMIT "+c+" OFFSET "+u,t.executeSql(i,d,function(t,r){for(var o=0,i=r.rows.length;i>o;o++){var a=r.rows.item(o),s=safeJsonParse(a.metadata),c=s.id,u=unstringifyDoc(a.data,c,a.rev),E=u._rev,d={id:c,key:c,value:{rev:E}};if(e.include_docs&&(d.doc=u,d.doc._rev=E,e.conflicts&&(d.doc._conflicts=collectConflicts(s)),fetchAttachmentsIfNecessary(d.doc,e,T,t)),a.deleted){if("ok"!==e.deleted)continue;d.value.deleted=!0,d.doc=null}n.push(d)}})}})},websqlError(t),function(){t(null,{total_rows:r,offset:e.skip,rows:n})})},T._changes=function(e){function t(){var t=DOC_STORE+".json AS metadata, "+DOC_STORE+".max_seq AS maxSeq, "+BY_SEQ_STORE+".json AS winningDoc, "+BY_SEQ_STORE+".rev AS winningRev ",r=DOC_STORE+" JOIN "+BY_SEQ_STORE,c=DOC_STORE+".id="+BY_SEQ_STORE+".doc_id AND "+DOC_STORE+".winningseq="+BY_SEQ_STORE+".seq",u=["maxSeq > ?"],E=[e.since];e.doc_ids&&(u.push(DOC_STORE+".id IN "+qMarks(e.doc_ids.length)),E=E.concat(e.doc_ids));var d="maxSeq "+(n?"DESC":"ASC"),_=select(t,r,c,u,d),f=filterChange(e);e.view||e.filter||(_+=" LIMIT "+o);var l=e.since||0;g.readTransaction(function(t){t.executeSql(_,E,function(t,r){function n(t){return function(){e.onChange(t)}}for(var c=0,u=r.rows.length;u>c;c++){var E=r.rows.item(c),d=safeJsonParse(E.metadata);l=E.maxSeq;var _=unstringifyDoc(E.winningDoc,d.id,E.winningRev),S=e.processChange(_,d,e);S.seq=E.maxSeq;var v=f(S);if("object"==typeof v)return e.complete(v);if(v&&(s++,i&&a.push(S),e.attachments&&e.include_docs?fetchAttachmentsIfNecessary(_,e,T,t,n(S)):n(S)()),s===o)break}})},websqlError(e.complete),function(){e.continuous||e.complete(null,{results:a,last_seq:l})})}if(e=clone(e),e.continuous){var r=T._name+":"+uuid();return websqlChanges.addListener(T._name,r,T,e),websqlChanges.notify(T._name),{cancel:function(){websqlChanges.removeListener(T._name,r)}}}var n=e.descending;e.since=e.since&&!n?e.since:0;var o="limit"in e?e.limit:-1;0===o&&(o=1);var i;i="return_docs"in e?e.return_docs:"returnDocs"in e?e.returnDocs:!0;var a=[],s=0;t()},T._close=function(e){e()},T._getAttachment=function(e,t,r,n,o){var i,a=n.ctx,s=r.digest,c=r.content_type,u="SELECT escaped, CASE WHEN escaped = 1 THEN body ELSE HEX(body) END AS body FROM "+ATTACH_STORE+" WHERE digest=?";a.executeSql(u,[s],function(e,t){var r=t.rows.item(0),a=r.escaped?unescapeBlob(r.body):parseHexString(r.body,S);i=n.binary?binStringToBluffer(a,c):thisBtoa(a),o(null,i)})},T._getRevisionTree=function(e,t){g.readTransaction(function(r){var n="SELECT json AS metadata FROM "+DOC_STORE+" WHERE id = ?";r.executeSql(n,[e],function(e,r){if(r.rows.length){var n=safeJsonParse(r.rows.item(0).metadata);t(null,n.rev_tree)}else t(createError(MISSING_DOC))})})},T._doCompaction=function(e,t,r){return t.length?void g.transaction(function(r){var n="SELECT json AS metadata FROM "+DOC_STORE+" WHERE id = ?";r.executeSql(n,[e],function(r,n){var o=safeJsonParse(n.rows.item(0).metadata);traverseRevTree(o.rev_tree,function(e,r,n,o,i){var a=r+"-"+n;-1!==t.indexOf(a)&&(i.status="missing")});var i="UPDATE "+DOC_STORE+" SET json = ? WHERE id = ?";r.executeSql(i,[safeJsonStringify(o),e])}),compactRevs(t,e,r)},websqlError(r),function(){r()}):r()},T._getLocal=function(e,t){g.readTransaction(function(r){var n="SELECT json, rev FROM "+LOCAL_STORE+" WHERE id=?";r.executeSql(n,[e],function(r,n){if(n.rows.length){var o=n.rows.item(0),i=unstringifyDoc(o.json,e,o.rev);t(null,i)}else t(createError(MISSING_DOC))})})},T._putLocal=function(e,t,r){function n(e){var n,u;i?(n="UPDATE "+LOCAL_STORE+" SET rev=?, json=? WHERE id=? AND rev=?",u=[o,c,a,i]):(n="INSERT INTO "+LOCAL_STORE+" (id, rev, json) VALUES (?,?,?)",u=[a,o,c]),e.executeSql(n,u,function(e,n){n.rowsAffected?(s={ok:!0,id:a,rev:o},t.ctx&&r(null,s)):r(createError(REV_CONFLICT))},function(){return r(createError(REV_CONFLICT)),!1})}"function"==typeof t&&(r=t,t={}),delete e._revisions;var o,i=e._rev,a=e._id;o=i?e._rev="0-"+(parseInt(i.split("-")[1],10)+1):e._rev="0-1";var s,c=stringifyDoc(e);t.ctx?n(t.ctx):g.transaction(n,websqlError(r),function(){s&&r(null,s)})},T._removeLocal=function(e,t,r){function n(n){var i="DELETE FROM "+LOCAL_STORE+" WHERE id=? AND rev=?",a=[e._id,e._rev];n.executeSql(i,a,function(n,i){return i.rowsAffected?(o={ok:!0,id:e._id,rev:"0-0"},void(t.ctx&&r(null,o))):r(createError(MISSING_DOC));
})}"function"==typeof t&&(r=t,t={});var o;t.ctx?n(t.ctx):g.transaction(n,websqlError(r),function(){o&&r(null,o)})},T._destroy=function(e,t){websqlChanges.removeAllListeners(T._name),g.transaction(function(e){var t=[DOC_STORE,BY_SEQ_STORE,ATTACH_STORE,META_STORE,LOCAL_STORE,ATTACH_AND_SEQ_STORE];t.forEach(function(t){e.executeSql("DROP TABLE IF EXISTS "+t,[])})},websqlError(t),function(){hasLocalStorage()&&(delete window.localStorage["_pouch__websqldb_"+T._name],delete window.localStorage[T._name]),t(null,{ok:!0})})}}function NodeWebSqlPouch(e,t){var r=jsExtend.extend({websql:websql},e);WebSqlPouch.call(this,r,t)}function WebSqlPouchPlugin(e){e.adapter("websql",NodeWebSqlPouch,!0)}var jsExtend=require("js-extend"),lie=_interopDefault(require("lie")),getArguments=_interopDefault(require("argsarray")),debug=_interopDefault(require("debug")),events=require("events"),inherits=_interopDefault(require("inherits")),crypto=_interopDefault(require("crypto")),pouchdbCollections=require("pouchdb-collections"),vuvuzela=_interopDefault(require("vuvuzela")),websql=_interopDefault(require("websql")),PouchPromise="function"==typeof Promise?Promise:lie,funcToString=Function.prototype.toString,objectCtorString=funcToString.call(Object),log=debug("pouchdb:api");inherits(Changes,events.EventEmitter),Changes.prototype.addListener=function(e,t,r,n){function o(){function e(){a=!1}if(i._listeners[t]){if(a)return void(a="waiting");a=!0;var s=pick(n,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);r.changes(s).on("change",function(e){e.seq>n.since&&!n.cancelled&&(n.since=e.seq,n.onChange(e))}).on("complete",function(){"waiting"===a&&setTimeout(function(){o()},0),a=!1}).on("error",e)}}if(!this._listeners[t]){var i=this,a=!1;this._listeners[t]=o,this.on(e,o)}},Changes.prototype.removeListener=function(e,t){t in this._listeners&&events.EventEmitter.prototype.removeListener.call(this,e,this._listeners[t])},Changes.prototype.notifyLocalWindows=function(e){isChromeApp()?chrome.storage.local.set({dbName:e}):hasLocalStorage()&&(localStorage[e]="a"===localStorage[e]?"b":"a")},Changes.prototype.notify=function(e){this.emit(e),this.notifyLocalWindows(e)},inherits(PouchError,Error),PouchError.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};var UNAUTHORIZED=new PouchError({status:401,error:"unauthorized",reason:"Name or password is incorrect."}),MISSING_BULK_DOCS=new PouchError({status:400,error:"bad_request",reason:"Missing JSON list of 'docs'"}),MISSING_DOC=new PouchError({status:404,error:"not_found",reason:"missing"}),REV_CONFLICT=new PouchError({status:409,error:"conflict",reason:"Document update conflict"}),INVALID_ID=new PouchError({status:400,error:"invalid_id",reason:"_id field must contain a string"}),MISSING_ID=new PouchError({status:412,error:"missing_id",reason:"_id is required for puts"}),RESERVED_ID=new PouchError({status:400,error:"bad_request",reason:"Only reserved document ids may start with underscore."}),NOT_OPEN=new PouchError({status:412,error:"precondition_failed",reason:"Database not open"}),UNKNOWN_ERROR=new PouchError({status:500,error:"unknown_error",reason:"Database encountered an unknown error"}),BAD_ARG=new PouchError({status:500,error:"badarg",reason:"Some query argument is invalid"}),INVALID_REQUEST=new PouchError({status:400,error:"invalid_request",reason:"Request was invalid"}),QUERY_PARSE_ERROR=new PouchError({status:400,error:"query_parse_error",reason:"Some query parameter is invalid"}),DOC_VALIDATION=new PouchError({status:500,error:"doc_validation",reason:"Bad special document member"}),BAD_REQUEST=new PouchError({status:400,error:"bad_request",reason:"Something wrong with the request"}),NOT_AN_OBJECT=new PouchError({status:400,error:"bad_request",reason:"Document must be a JSON object"}),DB_MISSING=new PouchError({status:404,error:"not_found",reason:"Database not found"}),IDB_ERROR=new PouchError({status:500,error:"indexed_db_went_bad",reason:"unknown"}),WSQ_ERROR=new PouchError({status:500,error:"web_sql_went_bad",reason:"unknown"}),LDB_ERROR=new PouchError({status:500,error:"levelDB_went_went_bad",reason:"unknown"}),FORBIDDEN=new PouchError({status:403,error:"forbidden",reason:"Forbidden by design doc validate_doc_update function"}),INVALID_REV=new PouchError({status:400,error:"bad_request",reason:"Invalid rev format"}),FILE_EXISTS=new PouchError({status:412,error:"file_exists",reason:"The database could not be created, the file already exists."}),MISSING_STUB=new PouchError({status:412,error:"missing_stub"}),INVALID_URL=new PouchError({status:413,error:"invalid_url",reason:"Provided URL is invalid"}),allErrors=[UNAUTHORIZED,MISSING_BULK_DOCS,MISSING_DOC,REV_CONFLICT,INVALID_ID,MISSING_ID,RESERVED_ID,NOT_OPEN,UNKNOWN_ERROR,BAD_ARG,INVALID_REQUEST,QUERY_PARSE_ERROR,DOC_VALIDATION,BAD_REQUEST,NOT_AN_OBJECT,DB_MISSING,WSQ_ERROR,LDB_ERROR,FORBIDDEN,INVALID_REV,FILE_EXISTS,MISSING_STUB,IDB_ERROR,INVALID_URL],chars="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),reservedWords=toObject(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),dataWords=toObject(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]),ADAPTER_VERSION=7,DOC_STORE=quote("document-store"),BY_SEQ_STORE=quote("by-sequence"),ATTACH_STORE=quote("attach-store"),LOCAL_STORE=quote("local-store"),META_STORE=quote("metadata-store"),ATTACH_AND_SEQ_STORE=quote("attach-seq-store"),cachedDatabases=new pouchdbCollections.Map,websqlChanges=new Changes,POUCH_VERSION=1,BY_SEQ_STORE_DELETED_INDEX_SQL="CREATE INDEX IF NOT EXISTS 'by-seq-deleted-idx' ON "+BY_SEQ_STORE+" (seq, deleted)",BY_SEQ_STORE_DOC_ID_REV_INDEX_SQL="CREATE UNIQUE INDEX IF NOT EXISTS 'by-seq-doc-id-rev' ON "+BY_SEQ_STORE+" (doc_id, rev)",DOC_STORE_WINNINGSEQ_INDEX_SQL="CREATE INDEX IF NOT EXISTS 'doc-winningseq-idx' ON "+DOC_STORE+" (winningseq)",ATTACH_AND_SEQ_STORE_SEQ_INDEX_SQL="CREATE INDEX IF NOT EXISTS 'attach-seq-seq-idx' ON "+ATTACH_AND_SEQ_STORE+" (seq)",ATTACH_AND_SEQ_STORE_ATTACH_INDEX_SQL="CREATE UNIQUE INDEX IF NOT EXISTS 'attach-seq-digest-idx' ON "+ATTACH_AND_SEQ_STORE+" (digest, seq)",DOC_STORE_AND_BY_SEQ_JOINER=BY_SEQ_STORE+".seq = "+DOC_STORE+".winningseq",SELECT_DOCS=BY_SEQ_STORE+".seq AS seq, "+BY_SEQ_STORE+".deleted AS deleted, "+BY_SEQ_STORE+".json AS data, "+BY_SEQ_STORE+".rev AS rev, "+DOC_STORE+".json AS metadata";NodeWebSqlPouch.valid=function(){return!0},NodeWebSqlPouch.use_prefix=!1;var PDB="undefined"!=typeof PouchDB?PouchDB:require("pouchdb");PDB?WebSqlPouchPlugin(PDB):guardedConsole("error",'websql adapter plugin error: Cannot find global "PouchDB" object! Did you remember to include pouchdb.js?');