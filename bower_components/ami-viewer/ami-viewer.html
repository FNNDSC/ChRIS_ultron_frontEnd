<html><head><link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../ami-import/ami-import.html">



</head><body><dom-module id="ami-viewer">
  <template>
    <style>

      :host {
        display: block;
        position: relative;
      }

      #container {
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
      }

    </style>

    <div id="container"></div>

  </template>

  <script>Polymer({is:"ami-viewer",properties:{series:{type:Array,value:[],observer:"_seriesChanged"},stack:{type:Object,value:null},stackHelper:{type:Object,value:null},renderer:{type:Object,value:null},scene:{type:Object,value:null},camera:{type:Object,value:null},init:{type:Boolean,value:!1},animationFrameID:{type:Number,value:-1},orientation:{type:Number,value:0,observer:"_orientationChanged"},index:{type:Number,value:0,notify:!0,observer:"_indexChanged"},indexMax:{type:Number,value:0,notify:!0},flipRows:{type:Boolean,value:!1,observer:"_flipRowsChanged"},flipColumns:{type:Boolean,value:!1,observer:"_flipColumnsChanged"},borderColor:{type:String,value:"#FF9800",observer:"_borderColorChanged"},angle:{type:Number,value:0,notify:!0,observer:"_angleChanged"}},_seriesChanged:function(e){console.log("series changed"),console.log(this.series),!this.series||this.series.length<=0||(this.init||this._init(),this.scene.remove(this.stackHelper),this.stack=this.series[0].stack[0],this.stackHelper=new AMI.default.Helpers.Stack(this.stack),this.stackHelper.orientation=this.orientation,this._setupIndex(),this.stackHelper.bbox.visible=!1,this.stackHelper.border.color=this.borderColor,this.scene.add(this.stackHelper),this._setupCamera(),this.flipRows&&this.camera.invertRows(),this.flipColumns&&this.camera.invertColumns())},_init:function(){this.renderer=new THREE.WebGLRenderer({antialias:!0}),this.renderer.setSize(this.$.container.offsetWidth,this.$.container.offsetHeight),this.renderer.setClearColor(3487029,1),this.renderer.setPixelRatio(window.devicePixelRatio),this.$.container.appendChild(this.renderer.domElement),this.scene=new THREE.Scene,this.camera=new AMI.default.Cameras.Orthographic(this.$.container.offsetWidth/-2,this.$.container.offsetWidth/2,this.$.container.offsetHeight/2,this.$.container.offsetHeight/-2,.1,1e4),this.controls=new AMI.default.Controls.TrackballOrtho(this.camera,this.$.container),this.controls.staticMoving=!0,this.controls.noRotate=!0,this._onWindowResize=this._onWindowResize.bind(this),window.addEventListener("resize",this._onWindowResize,!1),this.init=!0,this.animate()},animate:function(){this.animationFrameID=window.requestAnimationFrame(this.animate.bind(this)),this.controls.update(),this.renderer.render(this.scene,this.camera)},_onWindowResize:function(e){this.camera.canvas={width:this.$.container.offsetWidth,height:this.$.container.offsetHeight},this.camera.fitBox(2),this.renderer.setSize(this.$.container.offsetWidth,this.$.container.offsetHeight)},_orientationChanged:function(e){(this.orientation<0||this.orientation>2)&&(window.console.log("invalid orientation: "+this.orientation),window.console.log("setting orientation to 0"),this.orientation=0),this.stackHelper&&(this.stackHelper.orientation=this.orientation,this._setupIndex(),this._setupCamera())},_setupIndex:function(){var e=0,t=this.stack.dimensionsIJK;switch(this.orientation){case 0:e=t.z-1;break;case 1:e=t.x-1;break;case 2:e=t.y-1}this.indexMax=e,this.index=Math.floor(this.indexMax/2),this.stackHelper.index=this.index},_setupCamera:function(){var e,t,i,s=this.stack.worldBoundingBox(),n=new THREE.Vector3(s[1]-s[0],s[3]-s[2],s[5]-s[4]),o={center:this.stack.worldCenter().clone(),halfDimensions:new THREE.Vector3(n.x+10,n.y+10,n.z+10)},a={width:this.$.container.offsetWidth,height:this.$.container.offsetHeight};0===this.orientation?(e=this.stack.xCosine,t=this.stack.yCosine,i=this.stack.zCosine):1===this.orientation?(e=this.stack.yCosine,t=this.stack.zCosine,i=this.stack.xCosine):(e=this.stack.zCosine,t=this.stack.xCosine,i=this.stack.yCosine),this.camera.init(e,t,i,this.controls,o,a),this.camera.angle=this.angle,this.camera.fitBox(2)},_indexChanged:function(e){this.stackHelper&&(this.stackHelper.index=this.index,this.index=this.stackHelper.index)},_flipRowsChanged:function(e){this.camera&&(this.camera.invertRows(),this.angle=this.camera.angle)},_flipColumnsChanged:function(e){this.camera&&(this.camera.invertColumns(),this.angle=this.camera.angle)},_angleChanged:function(e){this.camera&&(this.camera.angle=this.angle)},_borderColorChanged:function(e){this.stackHelper&&(window.console.log(this.borderColor),this.stackHelper.border.color=this.borderColor)}});</script>
</dom-module>
</body></html>