"use strict";exports.Promise=require("pouchdb/extras/promise"),exports.inherits=require("inherits"),exports.extend=require("pouchdb-extend");var argsarray=require("argsarray");exports.promisedCallback=function(r,t){return t&&r.then(function(r){process.nextTick(function(){t(null,r)})},function(r){process.nextTick(function(){t(r)})}),r},exports.callbackify=function(r){return argsarray(function(t){var e=t.pop(),n=r.apply(this,t);return"function"==typeof e&&exports.promisedCallback(n,e),n})},exports.fin=function(r,t){return r.then(function(r){var e=t();return"function"==typeof e.then?e.then(function(){return r}):r},function(r){var e=t();if("function"==typeof e.then)return e.then(function(){throw r});throw r})},exports.sequentialize=function(r,t){return function(){var e=arguments,n=this;return r.add(function(){return t.apply(n,e)})}},exports.flatten=function(r){for(var t=[],e=0,n=r.length;n>e;e++)t=t.concat(r[e]);return t},exports.uniq=function(r){for(var t={},e=0,n=r.length;n>e;e++)t["$"+r[e]]=!0;var o=Object.keys(t),i=new Array(o.length);for(e=0,n=o.length;n>e;e++)i[e]=o[e].substring(1);return i};var crypto=require("crypto"),Md5=require("spark-md5");exports.MD5=function(r){return process.browser?Md5.hash(r):crypto.createHash("md5").update(r).digest("hex")};