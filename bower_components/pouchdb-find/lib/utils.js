"use strict";var Promise=require("pouchdb/extras/promise");exports.once=function(r){var e=!1;return exports.getArguments(function(t){if(e)throw console.trace(),new Error("once called  more than once");e=!0,r.apply(this,t)})},exports.getArguments=function(r){return function(){for(var e=arguments.length,t=new Array(e),n=-1;++n<e;)t[n]=arguments[n];return r.call(this,t)}},exports.toPromise=function(r){return exports.getArguments(function(e){var t,n=this,o="function"==typeof e[e.length-1]?e.pop():!1;o&&(t=function(r,e){process.nextTick(function(){o(r,e)})});var u=new Promise(function(t,o){try{var u=exports.once(function(r,e){r?o(r):t(e)});e.push(u),r.apply(n,e)}catch(s){o(s)}});return t&&u.then(function(r){t(null,r)},t),u.cancel=function(){return this},u})},exports.inherits=require("inherits"),exports.Promise=Promise,exports.clone=function(r){return exports.extend(!0,{},r)},exports.extend=require("pouchdb-extend"),exports.callbackify=function(r){return exports.getArguments(function(e){var t=e.pop(),n=r.apply(this,e);return exports.promisedCallback(n,t),n})},exports.promisedCallback=function(r,e){return r.then(function(r){process.nextTick(function(){e(null,r)})},function(r){process.nextTick(function(){e(r)})}),r};var crypto=require("crypto"),Md5=require("spark-md5");exports.MD5=function(r){return process.browser?Md5.hash(r):crypto.createHash("md5").update(r).digest("hex")},exports.flatten=exports.getArguments(function(r){for(var e=[],t=0,n=r.length;n>t;t++){var o=r[t];Array.isArray(o)?e=e.concat(exports.flatten.apply(null,o)):e.push(o)}return e}),exports.mergeObjects=function(r){for(var e={},t=0,n=r.length;n>t;t++)e=exports.extend(!0,e,r[t]);return e},exports.pick=function(r,e){for(var t={},n=0,o=e.length;o>n;n++){var u=e[n];t[u]=r[u]}return t},exports.oneArrayIsSubArrayOfOther=function(r,e){for(var t=0,n=Math.min(r.length,e.length);n>t;t++)if(r[t]!==e[t])return!1;return!0},exports.oneArrayIsStrictSubArrayOfOther=function(r,e){return r.length>e.length?!1:exports.oneArrayIsSubArrayOfOther(r,e)},exports.oneSetIsSubArrayOfOther=function(r,e){r=r.slice();for(var t=0,n=e.length;n>t;t++){var o=e[t];if(!r.length)break;var u=r.indexOf(o);if(-1===u)return!1;r.splice(u,1)}return!0},exports.compare=function(r,e){return e>r?-1:r>e?1:0},exports.arrayToObject=function(r){for(var e={},t=0,n=r.length;n>t;t++)e[r[t]]=!0;return e},exports.max=function(r,e){for(var t=null,n=-1,o=0,u=r.length;u>o;o++){var s=r[o],i=e(s);i>n&&(n=i,t=s)}return t},exports.arrayEquals=function(r,e){if(r.length!==e.length)return!1;for(var t=0,n=r.length;n>t;t++)if(r[t]!==e[t])return!1;return!0},exports.uniq=function(r){for(var e={},t=0;t<r.length;t++)e["$"+r[t]]=!0;return Object.keys(e).map(function(r){return r.substring(1)})},exports.log=require("debug")("pouchdb:find");