<html><head><link rel="import" href="../polymer/polymer.html">
<link rel="import" href="app-pouchdb-database-behavior.html">
<link rel="import" href="pouchdb.html">
<link rel="import" href="pouchdb.find.html">

<script>!function(){"use strict";Polymer({is:"app-pouchdb-query",behaviors:[Polymer.AppPouchDBDatabaseBehavior],properties:{selector:{type:String},fields:{type:Array,value:function(){return[]}},sort:{type:Array,value:function(){return[]}},limit:{type:Number,value:0},skip:{type:Number,value:0},parsedSelector:{type:Object,computed:"__computeParsedSelector(selector)"},query:{type:Object,computed:"__computeQuery(db, parsedSelector, fields.*, sort.*, limit, skip)"},data:{type:Array,readOnly:!0,notify:!0,value:function(){return[]}}},observers:["refresh(db, query)"],refresh:function(){if(!this.query)throw new Error("Query not configured!");this.debounce("find",function(){this.db.find(this.query).then(function(e){this._setData(e.docs||[])}.bind(this))["catch"](function(e){console.error(e)}.bind(this))},1)},__computeQuery:function(){var e={};return e.selector=this.parsedSelector,e.fields=this.fields,e.sort=this.sort,this.limit&&(e.limit=this.limit),this.skip&&(e.skip=this.skip),e},__computeParsedSelector:function(e){for(var t=e.split(/\s*[,]\s*/),r={},i=0;i<t.length;++i)t[i]&&this.__parseDimension(r,t[i]);return r},__parseDimension:function(e,t){for(var r={},i=t.split(/\s+/),s=i.shift();i.length>1;)try{this.__parseConstraint(r,i.splice(0,2))}catch(n){}e[s]=r},__parseConstraint:function(e,t){var r,i=t[0],s=t[1];/^['"].*['"]$/.test(s)?s=s.slice(1,s.length-1):(r=window.parseFloat(s,10),s=window.isNaN(r)?"true"===s:r),null!=i&&null!=s&&(e[i]=s)}})}();</script>
</head><body></body></html>