<html><head><link rel="import" href="../polymer/polymer.html">
<link rel="import" href="pouchdb.html">
<script>!function(){"use strict";Polymer.AppPouchDBDatabaseBehavior={properties:{adapter:{type:String,value:null},dbName:{type:String},revsLimit:{type:Number,value:0},db:{type:Object,computed:"__computeDb(dbName, adapter, revsLimit)",notify:!0},upsert:{type:Boolean,value:!1},resolveConflict:{type:Function,value:null}},_put:function(t,i,e){return this.upsert?this._upsert(t,i,e):this._conflictAwareTransaction("put",e)},_post:function(t){return this.upsert?this._upsert("data",t,t):this._conflictAwareTransaction("post",t)},_upsert:function(t,i,e){var n=null!=e._id?this.db.get(e._id):Promise.reject({status:404});return this._log("Upsert",t,i,e),n.then(function(n){return this._log("Upsert -> update",t,i,e),"data"===t?(i._rev=n._rev,i._id=n._id,e=i):(this.set(t,i,{data:n}),e=n),this._conflictAwareTransaction("put",e)}.bind(this))["catch"](function(n){if(404===n.status)return this._log("Upsert -> insert",t,i,e),this._conflictAwareTransaction("post",e);throw n}.bind(this))},_conflictAwareTransaction:function(t,i){return!t in this.db?Promise.reject("No such method:",t):(this._log("Conflict aware:",t,i),this.db[t](i)["catch"](function(e){var n=null;if(e&&409===e.status&&(this._log("Conflict for",t,i._id,e._rev,e._conflicts),n=this.resolveConflict,n||this.fire("app-pouchdb-conflict",{resolveConflict:function(t){t&&(n=t)}.bind(this)}),n))return this._log("Attempting conflict resolution..",t,i),Promise.resolve(n.call(this,this.db,t,i,e));throw e}.bind(this)))},__computeDb:function(t,i,e){if(this.db&&this.db.removeAllListeners(),!t)return null;var n={auto_compaction:!0};return e&&(n.adapter=e),i&&(n.revs_limit=i),new PouchDB(t,n)}}}();</script>
</head><body></body></html>