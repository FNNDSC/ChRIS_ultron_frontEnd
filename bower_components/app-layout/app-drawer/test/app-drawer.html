<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>test for app-drawer</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">

  <script src="../../../webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../../../web-component-tester/browser.js"></script>
  <script src="../../../test-fixture/test-fixture-mocha.js"></script>
  <link rel="import" href="../../../test-fixture/test-fixture.html">
  <link rel="import" href="../app-drawer.html">
  <style is="custom-style">body{margin:0;}</style>
</head>
<body>

  <test-fixture id="testDrawer">
    <template>
      <app-drawer></app-drawer>
    </template>
  </test-fixture>

  <test-fixture id="rtlDrawer">
    <template>
      <app-drawer dir="rtl"></app-drawer>
    </template>
  </test-fixture>

  <test-fixture id="focusDrawer">
    <template>
      <focus-drawer></focus-drawer>
    </template>
  </test-fixture>

  <dom-module id="focus-drawer">
    <template>
      <app-drawer>
        <input type="text">
        <div tabindex="0">Div</div>
        <span>Not focusable</span>
      </app-drawer>
    </template>
    <script>HTMLImports.whenReady(function(){Polymer({is:"focus-drawer"})});</script>
  </dom-module>

  <script>suite("basic features",function(){function e(e,t,s){var r=new CustomEvent("keydown",{bubbles:!0,cancelable:!0});return r.keyCode=t,r.shiftKey=!!s,e.dispatchEvent(r),r}function t(e,t,s){assert.equal(l.lastCall.args[0],"translate3d("+e+"px,0,0)",s),assert.equal(parseFloat(d.style.opacity).toFixed(4),t.toFixed(4),s)}function s(){assert.equal(d.style.opacity,""),assert.equal(l.lastCall.args[0],"")}function r(e){assert.equal(o.style.transitionDuration,e),assert.equal(d.style.transitionDuration,e)}function a(e){assert.isAbove(parseFloat(o.style.transitionDuration),e),assert.isAbove(parseFloat(d.style.transitionDuration),e)}function i(e){assert.equal(o.style.transitionTimingFunction,e),assert.equal(d.style.transitionTimingFunction,e)}var n,d,o,l;setup(function(){n=fixture("testDrawer"),d=n.$.scrim,o=n.$.contentContainer,l=sinon.spy(n,"transform")}),test("default values",function(){assert.isFalse(n.opened),assert.isFalse(n.persistent),assert.equal(n.align,"left"),assert.isFalse(n.swipeOpen),assert.isFalse(n.noFocusTrap)}),test("set scroll direction",function(){assert.equal(n.__polymerGesturesTouchAction,"pan-y")}),test("transitions are enabled after attached",function(e){r("0s"),window.setTimeout(function(){r(""),e()},350)}),test("computed position",function(){rtlDrawer.align="start",assert.equal(n.position,"left"),n.align="end",assert.equal(n.position,"right"),n.align="left",assert.equal(n.position,"left"),n.align="right",assert.equal(n.position,"right")}),test("computed position for RTL",function(){var e=fixture("rtlDrawer");e.align="start",assert.equal(e.position,"right"),e.align="end",assert.equal(e.position,"left"),e.align="right",assert.equal(e.position,"right"),e.align="left",assert.equal(e.position,"left")}),test("left drawer opens and closes",function(){n.align="left";var e=o.getBoundingClientRect();assert.isTrue(e.right<=0),n.opened=!0,e=o.getBoundingClientRect(),assert.equal(e.left,0),n.opened=!1,e=o.getBoundingClientRect(),assert.isTrue(e.right<=0)}),test("right drawer opens and closes",function(){n.align="right";var e=o.getBoundingClientRect();assert.isTrue(e.left>=window.innerWidth),n.opened=!0,e=o.getBoundingClientRect(),assert.equal(e.right,window.innerWidth),n.opened=!1,e=o.getBoundingClientRect(),assert.isTrue(e.left>=window.innerWidth)}),test("open(), close(), and toggle()",function(){assert.isFalse(n.opened),n.open(),assert.isTrue(n.opened),n.close(),assert.isFalse(n.opened),n.toggle(),assert.isTrue(n.opened),n.toggle(),assert.isFalse(n.opened)}),test("getWidth()",function(){assert.equal(n.getWidth(),o.offsetWidth)}),test("app-drawer-reset-layout",function(e){var t=sinon.spy();n.addEventListener("app-drawer-reset-layout",t),n.align="right",window.setTimeout(function(){assert.isTrue(t.called),e()},1)}),test("app-drawer-transitioned",function(e){window.setTimeout(function(){var t=sinon.spy();n.addEventListener("app-drawer-transitioned",t),n.persistent=!0,assert.isFalse(t.called,"should not fire after toggling persistent when closed"),n.opened=!0,window.setTimeout(function(){assert.equal(t.callCount,1,"should fire after toggling opened state"),n.persistent=!1,window.setTimeout(function(){assert.equal(t.callCount,2,"should fire after toggling persistent when opened"),n.fire("track",{state:"start"}),n.fire("track",{state:"track",dx:0,ddx:0}),n.fire("track",{state:"end",dx:-200,ddx:-200}),window.setTimeout(function(){assert.isFalse(n.opened),assert.equal(t.callCount,3,"should fire after flinging"),n.fire("track",{state:"start"}),n.fire("track",{state:"track",dx:10,ddx:10}),n.fire("track",{state:"end",dx:10,ddx:0}),window.setTimeout(function(){assert.isFalse(n.opened),assert.equal(t.callCount,4,"should fire after swiping even if opened state unchanged"),n.fire("track",{state:"start"}),n.fire("track",{state:"track",dx:200,ddx:200}),n.fire("track",{state:"end",dx:200,ddx:0}),window.setTimeout(function(){assert.isTrue(n.opened),assert.equal(t.callCount,5,"should fire after swiping"),n.fire("track",{state:"start"}),n.fire("track",{state:"track",dx:-1e3,ddx:-1e3}),n.fire("track",{state:"end",dx:-1e3,ddx:0}),window.setTimeout(function(){assert.isFalse(n.opened),assert.equal(t.callCount,6,"should fire after swiping beyond end state"),e()},350)},350)},350)},350)},350)},350)},100)}),test("track events block user selection",function(e){window.setTimeout(function(){var t=n.fire("track",null,{cancelable:!0});assert.isTrue(t.defaultPrevented),e()},350)}),test("styles reset after swiping",function(e){window.setTimeout(function(){n.fire("track",{state:"start"}),assert.equal(n.style.visibility,"visible"),r("0s"),n.fire("track",{state:"track",dx:200,ddx:200}),n.fire("track",{state:"end",dx:200,ddx:0}),assert.equal(n.style.visibility,""),r(""),s(),e()},350)}),test("styles reset after swiping beyond the end state",function(e){window.setTimeout(function(){n.fire("track",{state:"start"}),assert.equal(n.style.visibility,"visible"),r("0s"),n.fire("track",{state:"track",dx:1e3,ddx:1e3}),n.fire("track",{state:"end",dx:1e3,ddx:0}),assert.equal(n.style.visibility,""),r(""),s(),e()},350)}),test("left drawer swiping",function(e){window.setTimeout(function(){var s=n.getWidth(),r=s/2;n.align="left",n.fire("track",{state:"start"}),n.fire("track",{state:"track",dx:-r,ddx:-r}),t(-s,0,"styles are lower bounded"),n.fire("track",{state:"track",dx:r,ddx:s}),t(-r,.5,"style by track distance"),n.fire("track",{state:"track",dx:r+s,ddx:s}),t(0,1,"styles are upper bounded"),n._trackDetails=[],n.fire("track",{state:"end",dx:r,ddx:-s}),assert.isFalse(n.opened,"drawer stays closed when track distance is small"),n.fire("track",{state:"start"}),n.fire("track",{state:"track",dx:r+1,ddx:r+1}),n.fire("track",{state:"end",dx:r+1,ddx:0}),assert.isTrue(n.opened,"drawer opens when track distance is large"),n.fire("track",{state:"start"}),n.fire("track",{state:"track",dx:-r,ddx:-r}),n.fire("track",{state:"end",dx:-r,ddx:0}),assert.isTrue(n.opened,"drawer stays opened when track distance is small"),n.fire("track",{state:"start"}),n.fire("track",{state:"track",dx:-r-1,ddx:-r-1}),n.fire("track",{state:"end",dx:-r-1,ddx:0}),assert.isFalse(n.opened,"drawer closes when track distance is large"),e()},350)}),test("right drawer swiping",function(e){window.setTimeout(function(){var s=n.getWidth(),r=s/2;n.align="right",n.fire("track",{state:"start"}),n.fire("track",{state:"track",dx:r,ddx:r}),t(s,0,"styles are lower bounded"),n.fire("track",{state:"track",dx:-r,ddx:-s}),t(r,.5,"style by track distance"),n.fire("track",{state:"track",dx:-r-s,ddx:-s}),t(0,1,"styles are upper bounded"),n._trackDetails=[],n.fire("track",{state:"end",dx:-r,ddx:s}),assert.isFalse(n.opened,"drawer stays closed when track distance is small"),n.fire("track",{state:"start"}),n.fire("track",{state:"track",dx:-r-1,ddx:-r-1}),n.fire("track",{state:"end",dx:-r-1,ddx:0}),assert.isTrue(n.opened,"drawer opens when track distance is large"),n.fire("track",{state:"start"}),n.fire("track",{state:"track",dx:r,ddx:r}),n.fire("track",{state:"end",dx:r,ddx:0}),assert.isTrue(n.opened,"drawer stays opened when track distance is small"),n.fire("track",{state:"start"}),n.fire("track",{state:"track",dx:r+1,ddx:r+1}),n.fire("track",{state:"end",dx:r+1,ddx:0}),assert.isFalse(n.opened,"drawer closes when track distance is large"),e()},350)}),test("styles reset after flinging",function(e){window.setTimeout(function(){n.fire("track",{state:"start"}),assert.equal(n.style.visibility,"visible"),r("0s"),n.fire("track",{state:"track",dx:0,ddx:0}),n.fire("track",{state:"end",dx:200,ddx:200}),window.setTimeout(function(){assert.equal(n.style.visibility,""),r(""),i(""),s(),e()},350)},350)}),test("styles reset after flinging beyond the end state",function(e){window.setTimeout(function(){n.fire("track",{state:"start"}),assert.equal(n.style.visibility,"visible"),r("0s"),n.fire("track",{state:"track",dx:0,ddx:0}),n.fire("track",{state:"end",dx:1e3,ddx:1e3}),assert.equal(n.style.visibility,""),r(""),i(""),s(),e()},350)}),test("left drawer flinging open",function(e){window.setTimeout(function(){n.align="left",n.fire("track",{state:"start"}),n.fire("track",{state:"track",dx:0,ddx:0}),n.fire("track",{state:"end",dx:.1,ddx:.1}),assert.isFalse(n.opened,"drawer stays closed when velocity is small"),r(""),i(""),s(),n.fire("track",{state:"start"}),n.fire("track",{state:"track",dx:0,ddx:0}),n.fire("track",{state:"end",dx:6,ddx:6}),assert.isTrue(n.opened,"drawer opens when velocity is large"),a(60),i(n._FLING_TIMING_FUNCTION),s(),e()},350)}),test("left drawer flinging close",function(e){window.setTimeout(function(){n.align="left",n.opened=!0,n.fire("track",{state:"start"}),n.fire("track",{state:"track",dx:0,ddx:0}),n.fire("track",{state:"end",dx:-.1,ddx:-.1}),assert.isTrue(n.opened,"drawer stays opened when velocity is small"),r(""),i(""),s(),n.fire("track",{state:"start"}),n.fire("track",{state:"track",dx:0,ddx:0}),n.fire("track",{state:"end",dx:-6,ddx:-6}),assert.isFalse(n.opened,"drawer closes when velocity is large"),a(60),i(n._FLING_TIMING_FUNCTION),s(),e()},350)}),test("right drawer flinging open",function(e){window.setTimeout(function(){n.align="right",n.fire("track",{state:"start"}),n.fire("track",{state:"track",dx:0,ddx:0}),n.fire("track",{state:"end",dx:-.1,ddx:-.1}),assert.isFalse(n.opened,"drawer stays closed when velocity is small"),r(""),i(""),s(),n.fire("track",{state:"start"}),n.fire("track",{state:"track",dx:0,ddx:0}),n.fire("track",{state:"end",dx:-6,ddx:-6}),assert.isTrue(n.opened,"drawer opens when velocity is large"),a(60),i(n._FLING_TIMING_FUNCTION),s(),e()},350)}),test("right drawer flinging close",function(e){window.setTimeout(function(){n.align="right",n.opened=!0,n.fire("track",{state:"start"}),n.fire("track",{state:"track",dx:0,ddx:0}),n.fire("track",{state:"end",dx:.1,ddx:.1}),assert.isTrue(n.opened,"drawer stays opened when velocity is small"),r(""),i(""),s(),n.fire("track",{state:"start"}),n.fire("track",{state:"track",dx:0,ddx:0}),n.fire("track",{state:"end",dx:6,ddx:6}),assert.isFalse(n.opened,"drawer closes when velocity is large"),a(60),i(n._FLING_TIMING_FUNCTION),s(),e()},350)}),test("doc scroll",function(e){window.setTimeout(function(){n.opened=!0,window.setTimeout(function(){assert.equal(document.body.style.overflow,"hidden","should block scrolling when opened"),n.persistent=!0,window.setTimeout(function(){assert.equal(document.body.style.overflow,"","should not block scrolling when persistent"),n.persistent=!1,window.setTimeout(function(){assert.equal(document.body.style.overflow,"hidden","should block scrolling when not persistent"),n.opened=!1,window.setTimeout(function(){assert.equal(document.body.style.overflow,"","should not block scrolling when closed"),e()},350)},350)},350)},350)},100)}),test("focus trap",function(t){var s=fixture("focusDrawer"),r=Polymer.dom(s.root),a=r.querySelector("app-drawer"),i=Polymer.dom(a).querySelector("input"),n=Polymer.dom(a).querySelector("div[tabindex]"),d=sinon.spy(i,"focus"),o=sinon.spy(n,"focus");a.opened=!0,window.setTimeout(function(){assert.isTrue(d.called);var s=e(i,9);assert.isFalse(s.defaultPrevented,"should not prevent default"),i.focus(),d.reset(),s=e(i,9,!0),assert.isTrue(o.called),assert.isTrue(s.defaultPrevented,"should prevent default"),s=e(n,9,!0),assert.isFalse(s.defaultPrevented,"should not prevent default"),n.focus(),s=e(n,9),assert.isTrue(d.called),assert.isTrue(s.defaultPrevented,"should prevent default"),t()},350)}),test("focus trap with app-drawer tabindex set",function(e){var t=fixture("focusDrawer"),s=Polymer.dom(t.root),r=s.querySelector("app-drawer"),a=Polymer.dom(r).querySelector("input"),i=sinon.spy(r,"focus"),n=sinon.spy(a,"focus");r.tabIndex=0,r.opened=!0,window.setTimeout(function(){assert.isTrue(i.called),assert.isFalse(n.called),e()},350)}),test("no focus trap",function(e){var t=fixture("focusDrawer"),s=Polymer.dom(t.root),r=s.querySelector("app-drawer"),a=Polymer.dom(r).querySelector("input"),i=sinon.spy(a,"focus");r.noFocusTrap=!0,r.opened=!0,window.setTimeout(function(){assert.isFalse(i.called),e()},350)}),test("esc key handler",function(t){n.opened=!0,window.setTimeout(function(){var s=e(document,27);assert.isFalse(n.opened,"should close drawer on esc"),assert.isTrue(s.defaultPrevented,"should prevent default"),t()},350)}),test("scrim",function(){d.style.transitionDuration="0s",assert.equal(window.getComputedStyle(d).opacity,0),n.opened=!0,assert.equal(window.getComputedStyle(d).opacity,1),n.persistent=!0,assert.equal(window.getComputedStyle(d).visibility,"hidden")}),test("tap on scrim closes drawer",function(){n.opened=!0,n.fire("tap",null,{node:d}),assert.isFalse(n.opened)}),test("persistent drawer should not cover content",function(){n.opened=!0,n.persistent=!0,assert.notEqual(document.elementFromPoint(400,10).tagName,"APP-DRAWER")}),test("right persistent drawer should be in the correct position",function(){n.align="right",n.opened=!0,n.persistent=!0,assert.equal(n.getBoundingClientRect().right,window.innerWidth)})});</script>



</body></html>